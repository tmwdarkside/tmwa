From 12afc48ec54fa1e1e58ad250a6d45ac9394a41d1 Mon Sep 17 00:00:00 2001
From: Andrei Karas <akaras@inbox.ru>
Date: Thu, 3 Feb 2011 21:48:26 +0200
Subject: [PATCH 222/226] Remove outdated code from tmw. Add small checks from
 cppcheck.

---
 Makefile                                  |    6 +-
 src/char/inter.c                          |    1 +
 src/char_sql/Makefile                     |   22 -
 src/char_sql/char.c                       | 3750 ----------------
 src/char_sql/char.h                       |   87 -
 src/char_sql/int_guild.c                  | 2111 ---------
 src/char_sql/int_guild.h                  |   10 -
 src/char_sql/int_party.c                  |  935 ----
 src/char_sql/int_party.h                  |    8 -
 src/char_sql/int_pet.c                    |  383 --
 src/char_sql/int_pet.h                    |   12 -
 src/char_sql/int_storage.c                |  441 --
 src/char_sql/int_storage.h                |   12 -
 src/char_sql/inter.c                      |  662 ---
 src/char_sql/inter.h                      |   43 -
 src/char_sql/itemdb.c                     |  265 --
 src/char_sql/itemdb.h                     |   35 -
 src/char_sql/make.sh                      |   11 -
 src/char_sql/readme.txt                   |  250 --
 src/char_sql/strlib.c                     |   89 -
 src/char_sql/strlib.h                     |   10 -
 src/ladmin/Makefile                       |   16 -
 src/ladmin/ladmin.c                       | 6651 -----------------------------
 src/ladmin/ladmin.h                       |   11 -
 src/ladmin/md5calc.c                      |  333 --
 src/ladmin/md5calc.h                      |   11 -
 src/login_sql/Makefile                    |   19 -
 src/login_sql/login.c                     | 2073 ---------
 src/login_sql/login.h                     |   42 -
 src/login_sql/make.sh                     |    6 -
 src/login_sql/md5calc.c                   |  292 --
 src/login_sql/md5calc.h                   |    7 -
 src/login_sql/readme.txt                  |  120 -
 src/login_sql/strlib.c                    |   64 -
 src/login_sql/strlib.h                    |    9 -
 src/login_sql/timer.h                     |   45 -
 src/map/clif.c                            |   25 +-
 src/map/npc.c                             |    2 +-
 src/txt-converter/char/Makefile           |   15 -
 src/txt-converter/char/char-converter.c   |  971 -----
 src/txt-converter/char/char.h             |   39 -
 src/txt-converter/char/int_guild.h        |   10 -
 src/txt-converter/char/int_party.h        |   11 -
 src/txt-converter/char/int_pet.h          |   12 -
 src/txt-converter/char/int_storage.h      |   11 -
 src/txt-converter/char/inter.h            |   27 -
 src/txt-converter/char/strlib.c           |   76 -
 src/txt-converter/char/strlib.h           |    9 -
 src/txt-converter/common/mmo.h            |  300 --
 src/txt-converter/login/Makefile          |   12 -
 src/txt-converter/login/login-converter.c |  282 --
 src/webserver/Makefile                    |   26 -
 src/webserver/doc/API.txt                 |   50 -
 src/webserver/doc/README                  |   11 -
 src/webserver/generate.c                  |   35 -
 src/webserver/htmlstyle.c                 |   45 -
 src/webserver/logs.c                      |    8 -
 src/webserver/main.c                      |  145 -
 src/webserver/pages/about.c               |    6 -
 src/webserver/pages/notdone.c             |    6 -
 src/webserver/pages/sample.c              |   22 -
 src/webserver/parse.c                     |  132 -
 62 files changed, 22 insertions(+), 21108 deletions(-)
 delete mode 100644 src/char_sql/Makefile
 delete mode 100644 src/char_sql/char.c
 delete mode 100644 src/char_sql/char.h
 delete mode 100644 src/char_sql/int_guild.c
 delete mode 100644 src/char_sql/int_guild.h
 delete mode 100644 src/char_sql/int_party.c
 delete mode 100644 src/char_sql/int_party.h
 delete mode 100644 src/char_sql/int_pet.c
 delete mode 100644 src/char_sql/int_pet.h
 delete mode 100644 src/char_sql/int_storage.c
 delete mode 100644 src/char_sql/int_storage.h
 delete mode 100644 src/char_sql/inter.c
 delete mode 100644 src/char_sql/inter.h
 delete mode 100644 src/char_sql/itemdb.c
 delete mode 100644 src/char_sql/itemdb.h
 delete mode 100644 src/char_sql/make.sh
 delete mode 100644 src/char_sql/readme.txt
 delete mode 100644 src/char_sql/strlib.c
 delete mode 100644 src/char_sql/strlib.h
 delete mode 100644 src/ladmin/Makefile
 delete mode 100644 src/ladmin/ladmin.c
 delete mode 100644 src/ladmin/ladmin.h
 delete mode 100644 src/ladmin/md5calc.c
 delete mode 100644 src/ladmin/md5calc.h
 delete mode 100644 src/login_sql/Makefile
 delete mode 100644 src/login_sql/login.c
 delete mode 100644 src/login_sql/login.h
 delete mode 100644 src/login_sql/make.sh
 delete mode 100644 src/login_sql/md5calc.c
 delete mode 100644 src/login_sql/md5calc.h
 delete mode 100644 src/login_sql/readme.txt
 delete mode 100644 src/login_sql/strlib.c
 delete mode 100644 src/login_sql/strlib.h
 delete mode 100644 src/login_sql/timer.h
 delete mode 100644 src/txt-converter/char/Makefile
 delete mode 100644 src/txt-converter/char/char-converter.c
 delete mode 100644 src/txt-converter/char/char.h
 delete mode 100644 src/txt-converter/char/int_guild.h
 delete mode 100644 src/txt-converter/char/int_party.h
 delete mode 100644 src/txt-converter/char/int_pet.h
 delete mode 100644 src/txt-converter/char/int_storage.h
 delete mode 100644 src/txt-converter/char/inter.h
 delete mode 100644 src/txt-converter/char/strlib.c
 delete mode 100644 src/txt-converter/char/strlib.h
 delete mode 100644 src/txt-converter/common/mmo.h
 delete mode 100644 src/txt-converter/login/Makefile
 delete mode 100644 src/txt-converter/login/login-converter.c
 delete mode 100644 src/webserver/Makefile
 delete mode 100644 src/webserver/doc/API.txt
 delete mode 100644 src/webserver/doc/README
 delete mode 100644 src/webserver/generate.c
 delete mode 100644 src/webserver/htmlstyle.c
 delete mode 100644 src/webserver/logs.c
 delete mode 100644 src/webserver/main.c
 delete mode 100644 src/webserver/pages/about.c
 delete mode 100644 src/webserver/pages/notdone.c
 delete mode 100644 src/webserver/pages/sample.c
 delete mode 100644 src/webserver/parse.c

diff --git a/Makefile b/Makefile
index a6b9350..eb35f59 100644
--- a/Makefile
+++ b/Makefile
@@ -1,12 +1,8 @@
 # $Id$
 include make.defs
 
-all clean: src/common/Makefile src/login/Makefile src/char/Makefile src/map/Makefile src/ladmin/Makefile
+all clean: src/common/Makefile src/login/Makefile src/char/Makefile src/map/Makefile
 	cd src ; cd common ; $(MAKE) $(MKDEF) $@ ; cd ..
 	cd src ; cd login ; $(MAKE) $(MKDEF) $@ ; cd ..
 	cd src ; cd char ; $(MAKE) $(MKDEF) $@ ; cd ..
 	cd src ; cd map ; $(MAKE) $(MKDEF) $@ ; cd ..
-	cd src ; cd ladmin ; $(MAKE) $(MKDEF) $@ ; cd ..
-
-tools:
-	cd src/tool && $(MAKE) $(MKDEF) && cd ..
diff --git a/src/char/inter.c b/src/char/inter.c
index eb32932..e3e2ef0 100644
--- a/src/char/inter.c
+++ b/src/char/inter.c
@@ -106,6 +106,7 @@ int inter_accreg_fromstr (const char *str, struct accreg *reg)
     int  j, v, n;
     char buf[128];
     const char *p = str;
+    buf[0] = 0;
 
     if (sscanf (p, "%d\t%n", &reg->account_id, &n) != 1
         || reg->account_id <= 0)
diff --git a/src/char_sql/Makefile b/src/char_sql/Makefile
deleted file mode 100644
index 8f21f0b..0000000
--- a/src/char_sql/Makefile
+++ /dev/null
@@ -1,22 +0,0 @@
-include ../../make.defs
-
-all: char-server_sql
-sql: char-server_sql
-
-COMMON_OBJ = ../common/core.o ../common/socket.o ../common/timer.o ../common/db.o ../common/malloc.o
-COMMON_H = ../common/core.h ../common/socket.h ../common/timer.h ../common/db.h ../common/malloc.h
-
-char-server_sql: char.o inter.o int_party.o int_guild.o int_storage.o int_pet.o strlib.o itemdb.o $(COMMON_OBJ)
-	$(CC) -o ../../$@ $^ $(LIB_S)
-
-char.o: char.c char.h strlib.h itemdb.h
-inter.o: inter.c inter.h int_party.h int_guild.h int_storage.h int_pet.h ../common/mmo.h char.h ../common/socket.h
-int_party.o: int_party.c int_party.h inter.h ../common/mmo.h char.h ../common/socket.h ../common/timer.h ../common/db.h
-int_guild.o: int_guild.c int_guild.h inter.h ../common/mmo.h char.h ../common/socket.h ../common/db.h
-int_storage.o: int_storage.c int_storage.h char.h itemdb.h
-int_pet.o: int_pet.c int_pet.h inter.h char.h ../common/mmo.h ../common/socket.h ../common/db.h
-strlib.o: strlib.c strlib.h
-itemdb.o: itemdb.c itemdb.h ../common/db.h ../common/mmo.h
-
-clean:
-	rm -f *.o ../../char-server_sql
diff --git a/src/char_sql/char.c b/src/char_sql/char.c
deleted file mode 100644
index 4bfce6d..0000000
--- a/src/char_sql/char.c
+++ /dev/null
@@ -1,3750 +0,0 @@
-// $Id: char.c,v 1.16 2004/09/23 18:31:16 MouseJstr Exp $
-// original : char2.c 2003/03/14 11:58:35 Rev.1.5
-//
-// original code from athena
-// SQL conversion by Jioh L. Jung
-// TXT 1.105
-#include <sys/types.h>
-
-#ifdef LCCWIN32
-#include <winsock.h>
-#pragma lib <libmysql.lib>
-#else
-#include <sys/socket.h>
-#include <netinet/in.h>
-#include <sys/time.h>
-#include <sys/ioctl.h>
-#include <arpa/inet.h>
-#include <netdb.h>
-#endif
-
-#include "utils.h"
-#include <stdio.h>
-#include <stdlib.h>
-#include <netinet/in.h>
-#include <sys/time.h>
-#include <time.h>
-#include <sys/ioctl.h>
-#include <unistd.h>
-#include <signal.h>
-#include <fcntl.h>
-#include <string.h>
-#include <arpa/inet.h>
-#include <netdb.h>
-#include <stdarg.h>
-
-#include "char.h"
-#include "strlib.h"
-#include "itemdb.h"
-#include "inter.h"
-
-#ifdef MEMWATCH
-#include "memwatch.h"
-#endif
-
-char char_db[256] = "char";
-char cart_db[256] = "cart_inventory";
-char inventory_db[256] = "inventory";
-char charlog_db[256] = "charlog";
-char storage_db[256] = "storage";
-char interlog_db[256] = "interlog";
-char reg_db[256] = "global_reg_value";
-char skill_db[256] = "skill";
-char memo_db[256] = "memo";
-char guild_db[256] = "guild";
-char guild_alliance_db[256] = "guild_alliance";
-char guild_castle_db[256] = "guild_castle";
-char guild_expulsion_db[256] = "guild_expulsion";
-char guild_member_db[256] = "guild_member";
-char guild_position_db[256] = "guild_position";
-char guild_skill_db[256] = "guild_skill";
-char guild_storage_db[256] = "guild_storage";
-char party_db[256] = "party";
-char pet_db[256] = "pet";
-char login_db[256] = "login";
-
-char login_db_account_id[32] = "account_id";
-char login_db_level[32] = "level";
-
-int  lowest_gm_level = 1;
-
-unsigned char *SQL_CONF_NAME = "conf/inter_athena.conf";
-
-struct mmo_map_server server[MAX_MAP_SERVERS];
-int  server_fd[MAX_MAP_SERVERS];
-int  server_freezeflag[MAX_MAP_SERVERS];    // Map-server anti-freeze system. Counter. 5 ok, 4...0 freezed
-
-int  anti_freeze_enable = 0;
-int  ANTI_FREEZE_INTERVAL = 6;
-
-int  login_fd, char_fd;
-char userid[24];
-char passwd[24];
-char server_name[20];
-char wisp_server_name[24] = "Server";
-char login_ip_str[128];
-int  login_ip;
-int  login_port = 6900;
-char char_ip_str[128];
-int  char_ip;
-int  char_port = 6121;
-int  char_maintenance;
-int  char_new;
-int  name_ignoring_case = 0;    // Allow or not identical name for characters but with a different case by [Yor]
-int  char_name_option = 0;      // Option to know which letters/symbols are authorised in the name of a character (0: all, 1: only those in char_name_letters, 2: all EXCEPT those in char_name_letters) by [Yor]
-char char_name_letters[1024] = "";  // list of letters/symbols used to authorise or not a name of a character. by [Yor]
-
-char lan_map_ip[128];           // Lan map ip added by kashy
-int  subnetmaski[4];            // Subnetmask added by kashy
-char unknown_char_name[1024] = "Unknown";
-
-struct char_session_data
-{
-    int  account_id, login_id1, login_id2, sex;
-    int  found_char[9];
-    char email[40];             // e-mail (default: a@a.com) by [Yor]
-    time_t connect_until_time;  // # of seconds 1/1/1970 (timestamp): Validity limit of the account (0 = unlimited)
-};
-
-#define AUTH_FIFO_SIZE 256
-struct
-{
-    int  account_id, char_id, login_id1, login_id2, ip, char_pos, delflag,
-        sex;
-    time_t connect_until_time;  // # of seconds 1/1/1970 (timestamp): Validity limit of the account (0 = unlimited)
-} auth_fifo[AUTH_FIFO_SIZE];
-int  auth_fifo_pos = 0;
-
-int  check_ip_flag = 1;         // It's to check IP of a player between char-server and other servers (part of anti-hacking system)
-
-int  char_id_count = 150000;
-struct mmo_charstatus *char_dat;
-int  char_num, char_max;
-int  max_connect_user = 0;
-int  autosave_interval = DEFAULT_AUTOSAVE_INTERVAL;
-int  start_zeny = 500;
-int  start_weapon = 1201;
-int  start_armor = 2301;
-
-// check for exit signal
-// 0 is saving complete
-// other is char_id
-unsigned int save_flag = 0;
-
-// start point (you can reset point on conf file)
-struct point start_point = { "new_1-1.gat", 53, 111 };
-
-struct gm_account *gm_account = NULL;
-int  GM_num = 0;
-
-//-----------------------------------------------------
-// Function to suppress control characters in a string.
-//-----------------------------------------------------
-int remove_control_chars (unsigned char *str)
-{
-    int  i;
-    int  change = 0;
-
-    for (i = 0; i < strlen (str); i++)
-    {
-        if (str[i] < 32)
-        {
-            str[i] = '_';
-            change = 1;
-        }
-    }
-
-    return change;
-}
-
-//----------------------------------------------------------------------
-// Determine if an account (id) is a GM account
-// and returns its level (or 0 if it isn't a GM account or if not found)
-//----------------------------------------------------------------------
-// Removed since nothing GM related goes on in the char server [CLOWNISIUS]
-int isGM (int account_id)
-{
-    int  i;
-
-    for (i = 0; i < GM_num; i++)
-        if (gm_account[i].account_id == account_id)
-            return gm_account[i].level;
-    return 0;
-}
-
-void read_gm_account (void)
-{
-    if (gm_account != NULL)
-        free (gm_account);
-    GM_num = 0;
-
-    sprintf (tmp_lsql, "SELECT `%s`,`%s` FROM `%s` WHERE `%s`>='%d'",
-             login_db_account_id, login_db_level, login_db, login_db_level,
-             lowest_gm_level);
-    if (mysql_query (&lmysql_handle, tmp_lsql))
-    {
-        printf ("DB server Error (select %s to Memory)- %s\n", login_db,
-                mysql_error (&lmysql_handle));
-    }
-    lsql_res = mysql_store_result (&lmysql_handle);
-    if (lsql_res)
-    {
-        gm_account =
-            calloc (sizeof (struct gm_account) * mysql_num_rows (lsql_res),
-                    1);
-        while ((lsql_row = mysql_fetch_row (lsql_res)))
-        {
-            gm_account[GM_num].account_id = atoi (lsql_row[0]);
-            gm_account[GM_num].level = atoi (lsql_row[1]);
-            GM_num++;
-        }
-    }
-
-    mysql_free_result (lsql_res);
-}
-
-//=====================================================================================================
-int mmo_char_tosql (int char_id, struct mmo_charstatus *p)
-{
-    int  i = 0, party_exist, guild_exist;
-    int  eqcount = 1;
-    int  noteqcount = 1;
-    char temp_str[32];
-
-    struct itemtemp mapitem;
-    if (char_id != p->char_id)
-        return 0;
-
-    save_flag = p->char_id;
-    printf ("(\033[1;32m%d\033[0m) %s \trequest save char data - ", char_id,
-            char_dat[0].name);
-
-//for(testcount=1;testcount<50;testcount++){//---------------------------test count--------------------
-//  printf("test count : %d\n", testcount);
-//  eqcount=1;
-//  noteqcount=1;
-//  dbeqcount=1;
-//  dbnoteqcount=1;
-//-----------------------------------------------------------------------------------------------------
-
-//=========================================map  inventory data > memory ===============================
-    //map inventory data
-    for (i = 0; i < MAX_INVENTORY; i++)
-    {
-        if (p->inventory[i].nameid > 0)
-        {
-            if (itemdb_isequip (p->inventory[i].nameid) == 1)
-            {
-                mapitem.equip[eqcount].flag = 0;
-                mapitem.equip[eqcount].id = p->inventory[i].id;
-                mapitem.equip[eqcount].nameid = p->inventory[i].nameid;
-                mapitem.equip[eqcount].amount = p->inventory[i].amount;
-                mapitem.equip[eqcount].equip = p->inventory[i].equip;
-                mapitem.equip[eqcount].identify = p->inventory[i].identify;
-                mapitem.equip[eqcount].refine = p->inventory[i].refine;
-                mapitem.equip[eqcount].attribute = p->inventory[i].attribute;
-                mapitem.equip[eqcount].card[0] = p->inventory[i].card[0];
-                mapitem.equip[eqcount].card[1] = p->inventory[i].card[1];
-                mapitem.equip[eqcount].card[2] = p->inventory[i].card[2];
-                mapitem.equip[eqcount].card[3] = p->inventory[i].card[3];
-                mapitem.equip[eqcount].broken = p->inventory[i].broken;
-                eqcount++;
-            }
-            else if (itemdb_isequip (p->inventory[i].nameid) == 0)
-            {
-                mapitem.notequip[noteqcount].flag = 0;
-                mapitem.notequip[noteqcount].id = p->inventory[i].id;
-                mapitem.notequip[noteqcount].nameid = p->inventory[i].nameid;
-                mapitem.notequip[noteqcount].amount = p->inventory[i].amount;
-                mapitem.notequip[noteqcount].equip = p->inventory[i].equip;
-                mapitem.notequip[noteqcount].identify =
-                    p->inventory[i].identify;
-                mapitem.notequip[noteqcount].refine = p->inventory[i].refine;
-                mapitem.notequip[noteqcount].attribute =
-                    p->inventory[i].attribute;
-                mapitem.notequip[noteqcount].card[0] =
-                    p->inventory[i].card[0];
-                mapitem.notequip[noteqcount].card[1] =
-                    p->inventory[i].card[1];
-                mapitem.notequip[noteqcount].card[2] =
-                    p->inventory[i].card[2];
-                mapitem.notequip[noteqcount].card[3] =
-                    p->inventory[i].card[3];
-                mapitem.notequip[noteqcount].broken = p->inventory[i].broken;
-                noteqcount++;
-            }
-        }
-    }
-    //printf("- Save item data to MySQL!\n");
-    memitemdata_to_sql (mapitem, eqcount, noteqcount, p->char_id,
-                        TABLE_INVENTORY);
-
-//=========================================map  cart data > memory ====================================
-    eqcount = 1;
-    noteqcount = 1;
-
-    //map cart data
-    for (i = 0; i < MAX_CART; i++)
-    {
-        if (p->cart[i].nameid > 0)
-        {
-            if (itemdb_isequip (p->cart[i].nameid) == 1)
-            {
-                mapitem.equip[eqcount].flag = 0;
-                mapitem.equip[eqcount].id = p->cart[i].id;
-                mapitem.equip[eqcount].nameid = p->cart[i].nameid;
-                mapitem.equip[eqcount].amount = p->cart[i].amount;
-                mapitem.equip[eqcount].equip = p->cart[i].equip;
-                mapitem.equip[eqcount].identify = p->cart[i].identify;
-                mapitem.equip[eqcount].refine = p->cart[i].refine;
-                mapitem.equip[eqcount].attribute = p->cart[i].attribute;
-                mapitem.equip[eqcount].card[0] = p->cart[i].card[0];
-                mapitem.equip[eqcount].card[1] = p->cart[i].card[1];
-                mapitem.equip[eqcount].card[2] = p->cart[i].card[2];
-                mapitem.equip[eqcount].card[3] = p->cart[i].card[3];
-                mapitem.equip[eqcount].broken = p->cart[i].broken;
-                eqcount++;
-            }
-            else if (itemdb_isequip (p->cart[i].nameid) == 0)
-            {
-                mapitem.notequip[noteqcount].flag = 0;
-                mapitem.notequip[noteqcount].id = p->cart[i].id;
-                mapitem.notequip[noteqcount].nameid = p->cart[i].nameid;
-                mapitem.notequip[noteqcount].amount = p->cart[i].amount;
-                mapitem.notequip[noteqcount].equip = p->cart[i].equip;
-                mapitem.notequip[noteqcount].identify = p->cart[i].identify;
-                mapitem.notequip[noteqcount].refine = p->cart[i].refine;
-                mapitem.notequip[noteqcount].attribute = p->cart[i].attribute;
-                mapitem.notequip[noteqcount].card[0] = p->cart[i].card[0];
-                mapitem.notequip[noteqcount].card[1] = p->cart[i].card[1];
-                mapitem.notequip[noteqcount].card[2] = p->cart[i].card[2];
-                mapitem.notequip[noteqcount].card[3] = p->cart[i].card[3];
-                mapitem.notequip[noteqcount].broken = p->cart[i].broken;
-                noteqcount++;
-            }
-        }
-    }
-
-    //printf("- Save cart data to MySQL!\n");
-    memitemdata_to_sql (mapitem, eqcount, noteqcount, p->char_id, TABLE_CART);
-
-//=====================================================================================================
-
-//}//---------------------------test count------------------------------
-    //check party_exist
-    party_exist = 0;
-    sprintf (tmp_sql, "SELECT count(*) FROM `%s` WHERE `party_id` = '%d'",
-             party_db, p->party_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    sql_row = mysql_fetch_row (sql_res);
-    if (sql_row)
-        party_exist = atoi (sql_row[0]);
-    mysql_free_result (sql_res);
-
-    //check guild_exist
-    guild_exist = 0;
-    sprintf (tmp_sql, "SELECT count(*) FROM `%s` WHERE `guild_id` = '%d'",
-             guild_db, p->guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    sql_row = mysql_fetch_row (sql_res);
-    if (sql_row)
-        guild_exist = atoi (sql_row[0]);
-    mysql_free_result (sql_res);
-
-    if (guild_exist == 0)
-        p->guild_id = 0;
-    if (party_exist == 0)
-        p->party_id = 0;
-
-    //sql query
-    //`char`( `char_id`,`account_id`,`char_num`,`name`,`class`,`base_level`,`job_level`,`base_exp`,`job_exp`,`zeny`, //9
-    //`str`,`agi`,`vit`,`int`,`dex`,`luk`, //15
-    //`max_hp`,`hp`,`max_sp`,`sp`,`status_point`,`skill_point`, //21
-    //`option`,`karma`,`manner`,`party_id`,`guild_id`,`pet_id`, //27
-    //`hair`,`hair_color`,`clothes_color`,`weapon`,`shield`,`head_top`,`head_mid`,`head_bottom`, //35
-    //`last_map`,`last_x`,`last_y`,`save_map`,`save_x`,`save_y`)
-    //printf("- Save char data to MySQL!\n");
-    sprintf (tmp_sql,
-             "UPDATE `%s` SET `class`='%d', `base_level`='%d', `job_level`='%d',"
-             "`base_exp`='%d', `job_exp`='%d', `zeny`='%d',"
-             "`max_hp`='%d',`hp`='%d',`max_sp`='%d',`sp`='%d',`status_point`='%d',`skill_point`='%d',"
-             "`str`='%d',`agi`='%d',`vit`='%d',`int`='%d',`dex`='%d',`luk`='%d',"
-             "`option`='%d',`karma`='%d',`manner`='%d',`party_id`='%d',`guild_id`='%d',`pet_id`='%d',"
-             "`hair`='%d',`hair_color`='%d',`clothes_color`='%d',`weapon`='%d',`shield`='%d',`head_top`='%d',`head_mid`='%d',`head_bottom`='%d',"
-             "`last_map`='%s',`last_x`='%d',`last_y`='%d',`save_map`='%s',`save_x`='%d',`save_y`='%d',`partner_id`='%d' WHERE  `account_id`='%d' AND `char_id` = '%d'",
-             char_db, p->class, p->base_level, p->job_level, p->base_exp,
-             p->job_exp, p->zeny, p->max_hp, p->hp, p->max_sp, p->sp,
-             p->status_point, p->skill_point, p->str, p->agi, p->vit, p->int_,
-             p->dex, p->luk, p->option, p->karma, p->manner, p->party_id,
-             p->guild_id, p->pet_id, p->hair, p->hair_color, p->clothes_color,
-             p->weapon, p->shield, p->head_top, p->head_mid, p->head_bottom,
-             p->last_point.map, p->last_point.x, p->last_point.y,
-             p->save_point.map, p->save_point.x, p->save_point.y,
-             p->partner_id, p->account_id, p->char_id);
-
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (update `char`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    //printf("- Save memo data to MySQL!\n");
-    //`memo` (`memo_id`,`char_id`,`map`,`x`,`y`)
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `char_id`='%d'", memo_db,
-             p->char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `memo`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    //insert here.
-    for (i = 0; i < 10; i++)
-    {
-        if (p->memo_point[i].map[0])
-        {
-            sprintf (tmp_sql,
-                     "INSERT INTO `%s`(`char_id`,`map`,`x`,`y`) VALUES ('%d', '%s', '%d', '%d')",
-                     memo_db, char_id, p->memo_point[i].map,
-                     p->memo_point[i].x, p->memo_point[i].y);
-            if (mysql_query (&mysql_handle, tmp_sql))
-                printf ("DB server Error (insert `memo`)- %s\n",
-                        mysql_error (&mysql_handle));
-        }
-    }
-
-    //printf("- Save skill data to MySQL!\n");
-    //`skill` (`char_id`, `id`, `lv`)
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `char_id`='%d'", skill_db,
-             p->char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `skill`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    //printf("- Insert skill \n");
-    //insert here.
-    for (i = 0; i < MAX_SKILL; i++)
-    {
-        if (p->skill[i].id)
-        {
-            if (p->skill[i].id && p->skill[i].flag != 1)
-            {
-                sprintf (tmp_sql,
-                         "INSERT delayed INTO `%s`(`char_id`, `id`, `lv`) VALUES ('%d', '%d','%d')",
-                         skill_db, char_id, p->skill[i].id,
-                         (p->skill[i].flag ==
-                          0) ? p->skill[i].lv : p->skill[i].flag - 2);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error (insert `skill`)- %s\n",
-                            mysql_error (&mysql_handle));
-                }
-            }
-        }
-    }
-
-    //printf("- Save global_reg_value data to MySQL!\n");
-    //`global_reg_value` (`char_id`, `str`, `value`)
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `type`=3 AND `char_id`='%d'",
-             reg_db, p->char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `global_reg_value`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    //insert here.
-    for (i = 0; i < p->global_reg_num; i++)
-    {
-        if (p->global_reg[i].str)
-        {
-            if (p->global_reg[i].value != 0)
-            {
-                sprintf (tmp_sql,
-                         "INSERT INTO `%s` (`char_id`, `str`, `value`) VALUES ('%d', '%s','%d')",
-                         reg_db, char_id, jstrescapecpy (temp_str,
-                                                         (unsigned char *)
-                                                         p->global_reg[i].
-                                                         str),
-                         p->global_reg[i].value);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf
-                        ("DB server Error (insert `global_reg_value`)- %s\n",
-                         mysql_error (&mysql_handle));
-                }
-            }
-        }
-    }
-    printf ("saving char is done.\n");
-    save_flag = 0;
-
-    return 0;
-}
-
-int memitemdata_to_sql (struct itemtemp mapitem, int eqcount, int noteqcount,
-                        int char_id, int tableswitch)
-{
-    //equ
-    int  i, j;
-    int  dbeqcount = 1;
-    int  dbnoteqcount = 1;
-    struct itemtemp dbitem;
-    char tablename[16];
-    char selectoption[16];
-
-    switch (tableswitch)
-    {
-        case TABLE_INVENTORY:
-            sprintf (tablename, "%s", inventory_db);
-            sprintf (selectoption, "char_id");
-            break;
-        case TABLE_CART:
-            sprintf (tablename, "%s", cart_db);
-            sprintf (selectoption, "char_id");
-            break;
-        case TABLE_STORAGE:
-            sprintf (tablename, "%s", storage_db);
-            sprintf (selectoption, "account_id");
-            break;
-        case TABLE_GUILD_STORAGE:
-            sprintf (tablename, "%s", guild_storage_db);
-            sprintf (selectoption, "guild_id");
-            break;
-    }
-    //printf("Working Table : %s \n",tablename);
-
-    //=======================================mysql database data > memory===============================================
-
-    sprintf (tmp_sql,
-             "SELECT `id`, `nameid`, `amount`, `equip`, `identify`, `refine`, `attribute`, `card0`, `card1`, `card2`, `card3` , `broken` "
-             "FROM `%s` WHERE `%s`='%d'", tablename, selectoption, char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `%s` to Memory)- %s\n", tablename,
-                mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res)
-    {
-        for (i = 0; (sql_row = mysql_fetch_row (sql_res)); i++)
-        {
-            if (itemdb_isequip (atoi (sql_row[1])) == 1)
-            {
-                dbitem.equip[dbeqcount].flag = 0;
-                dbitem.equip[dbeqcount].id = atoi (sql_row[0]);
-                dbitem.equip[dbeqcount].nameid = atoi (sql_row[1]);
-                dbitem.equip[dbeqcount].amount = atoi (sql_row[2]);
-                dbitem.equip[dbeqcount].equip = atoi (sql_row[3]);
-                dbitem.equip[dbeqcount].identify = atoi (sql_row[4]);
-                dbitem.equip[dbeqcount].refine = atoi (sql_row[5]);
-                dbitem.equip[dbeqcount].attribute = atoi (sql_row[6]);
-                dbitem.equip[dbeqcount].card[0] = atoi (sql_row[7]);
-                dbitem.equip[dbeqcount].card[1] = atoi (sql_row[8]);
-                dbitem.equip[dbeqcount].card[2] = atoi (sql_row[9]);
-                dbitem.equip[dbeqcount].card[3] = atoi (sql_row[10]);
-                dbitem.equip[dbeqcount].broken = atoi (sql_row[11]);
-                dbeqcount++;
-            }
-            else
-            {
-                dbitem.notequip[dbnoteqcount].flag = 0;
-                dbitem.notequip[dbnoteqcount].id = atoi (sql_row[0]);
-                dbitem.notequip[dbnoteqcount].nameid = atoi (sql_row[1]);
-                dbitem.notequip[dbnoteqcount].amount = atoi (sql_row[2]);
-                dbitem.notequip[dbnoteqcount].equip = atoi (sql_row[3]);
-                dbitem.notequip[dbnoteqcount].identify = atoi (sql_row[4]);
-                dbitem.notequip[dbnoteqcount].refine = atoi (sql_row[5]);
-                dbitem.notequip[dbnoteqcount].attribute = atoi (sql_row[6]);
-                dbitem.notequip[dbnoteqcount].card[0] = atoi (sql_row[7]);
-                dbitem.notequip[dbnoteqcount].card[1] = atoi (sql_row[8]);
-                dbitem.notequip[dbnoteqcount].card[2] = atoi (sql_row[9]);
-                dbitem.notequip[dbnoteqcount].card[3] = atoi (sql_row[10]);
-                dbitem.notequip[dbnoteqcount].broken = atoi (sql_row[11]);
-                dbnoteqcount++;
-            }
-        }
-        mysql_free_result (sql_res);
-    }
-
-    //==============================================Memory data > SQL ===============================
-    //======================================Equip ITEM=======================================
-    if ((eqcount == 1) && (dbeqcount == 1))
-    {                           //printf("%s Equip Empty\n",tablename);
-        //item empty
-    }
-    else
-    {
-
-        for (i = 1; i < eqcount; i++)
-        {
-            for (j = 1; j < dbeqcount; j++)
-            {
-                if (mapitem.equip[i].flag == 1)
-                    break;
-                if (!(dbitem.equip[j].flag == 1))
-                {
-                    if (mapitem.equip[i].nameid == dbitem.equip[j].nameid)
-                    {
-                        if ((mapitem.equip[i].equip == dbitem.equip[j].equip)
-                            && (mapitem.equip[i].identify ==
-                                dbitem.equip[j].identify)
-                            && (mapitem.equip[i].amount ==
-                                dbitem.equip[j].amount)
-                            && (mapitem.equip[i].refine ==
-                                dbitem.equip[j].refine)
-                            && (mapitem.equip[i].attribute ==
-                                dbitem.equip[j].attribute)
-                            && (mapitem.equip[i].card[0] ==
-                                dbitem.equip[j].card[0])
-                            && (mapitem.equip[i].card[1] ==
-                                dbitem.equip[j].card[1])
-                            && (mapitem.equip[i].card[2] ==
-                                dbitem.equip[j].card[2])
-                            && (mapitem.equip[i].card[3] ==
-                                dbitem.equip[j].card[3])
-                            && (mapitem.equip[i].broken ==
-                                dbitem.equip[j].broken))
-                        {
-                            mapitem.equip[i].flag = 1;
-                            dbitem.equip[j].flag = 1;
-                            //printf("the same item : %d , equip : %d , i : %d , flag :  %d\n", mapitem.equip[i].nameid,mapitem.equip[i].equip , i, mapitem.equip[i].flag); //DEBUG-STRING
-                        }
-                        else
-                        {
-                            sprintf (tmp_sql,
-                                     "UPDATE `%s` SET `equip`='%d', `identify`='%d', `refine`='%d',"
-                                     "`attribute`='%d', `card0`='%d', `card1`='%d', `card2`='%d', `card3`='%d', `broken`='%d', `amount`='%d' WHERE `id`='%d' LIMIT 1",
-                                     tablename, mapitem.equip[i].equip,
-                                     mapitem.equip[i].identify,
-                                     mapitem.equip[i].refine,
-                                     mapitem.equip[i].attribute,
-                                     mapitem.equip[i].card[0],
-                                     mapitem.equip[i].card[1],
-                                     mapitem.equip[i].card[2],
-                                     mapitem.equip[i].card[3],
-                                     mapitem.equip[i].broken,
-                                     mapitem.equip[i].amount,
-                                     dbitem.equip[j].id);
-                            //printf("%s\n",tmp_sql);
-                            if (mysql_query (&mysql_handle, tmp_sql))
-                                printf
-                                    ("DB server Error (UPdate `equ %s`)- %s\n",
-                                     tablename, mysql_error (&mysql_handle));
-                            mapitem.equip[i].flag = 1;
-                            dbitem.equip[j].flag = 1;
-                            //printf("not the same item : %d ; i : %d ; flag :  %d\n", mapitem.equip[i].nameid, i, mapitem.equip[i].flag);
-                        }
-                    }
-                }
-            }
-        }
-
-        //printf("dbeqcount = %d\n",dbeqcount);
-
-        for (i = 1; i < dbeqcount; i++)
-        {
-            //printf("dbitem.equip[i].flag = %d , dbitem.equip[i].id = %d\n",dbitem.equip[i].flag,dbitem.equip[i].id);
-            if (!(dbitem.equip[i].flag == 1))
-            {
-                sprintf (tmp_sql, "DELETE from `%s` where `id`='%d'",
-                         tablename, dbitem.equip[i].id);
-                //printf("%s", tmp_sql);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                    printf ("DB server Error (DELETE `equ %s`)- %s\n",
-                            tablename, mysql_error (&mysql_handle));
-            }
-        }
-        for (i = 1; i < eqcount; i++)
-        {
-            if (!(mapitem.equip[i].flag == 1))
-            {
-                sprintf (tmp_sql,
-                         "INSERT INTO `%s`(`%s`, `nameid`, `amount`, `equip`, `identify`, `refine`, `attribute`, `card0`, `card1`, `card2`, `card3`, `broken`)"
-                         " VALUES ( '%d','%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d')",
-                         tablename, selectoption, char_id,
-                         mapitem.equip[i].nameid, mapitem.equip[i].amount,
-                         mapitem.equip[i].equip, mapitem.equip[i].identify,
-                         mapitem.equip[i].refine, mapitem.equip[i].attribute,
-                         mapitem.equip[i].card[0], mapitem.equip[i].card[1],
-                         mapitem.equip[i].card[2], mapitem.equip[i].card[3],
-                         mapitem.equip[i].broken);
-                //printf("%s", tmp_sql);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                    printf ("DB server Error (INSERT `equ %s`)- %s\n",
-                            tablename, mysql_error (&mysql_handle));
-            }
-        }
-
-        //======================================DEBUG=================================================
-
-//      gettimeofday(&tv,NULL);
-//      strftime(tmpstr,24,"%Y-%m-%d %H:%M:%S",localtime(&(tv.tv_sec)));
-//      printf("\n\n");
-//      printf("Working Table Name : EQU %s,  Count : map %3d | db %3d \n",tablename ,eqcount ,dbeqcount);
-//      printf("*********************************************************************************\n");
-//      printf("======================================MAP===================Char ID %10d===\n",char_id);
-//      printf("==flag ===name ===equip===ident===amoun===attri===card0===card1===card2===card3==\n");
-//      for(j=1;j<eqcount;j++)
-//          printf("| %5d | %5d | %5d | %5d | %5d | %5d | %5d | %5d | %5d | %5d |\n", mapitem.equip[j].flag,mapitem.equip[j].nameid, mapitem.equip[j].equip, mapitem.equip[j].identify, mapitem.equip[j].refine,mapitem.equip[j].attribute, mapitem.equip[j].card[0], mapitem.equip[j].card[1], mapitem.equip[j].card[2], mapitem.equip[j].card[3]);
-//      printf("======================================DB=========================================\n");
-//      printf("==flag ===name ===equip===ident===refin===attri===card0===card1===card2===card3==\n");
-//      for(j=1;j<dbeqcount;j++)
-//          printf("| %5d | %5d | %5d | %5d | %5d | %5d | %5d | %5d | %5d | %5d |\n", dbitem.equip[j].flag ,dbitem.equip[j].nameid, dbitem.equip[j].equip, dbitem.equip[j].identify, dbitem.equip[j].amount,dbitem.equip[j].attribute, dbitem.equip[j].card[0], dbitem.equip[j].card[1], dbitem.equip[j].card[2], dbitem.equip[j].card[3]);
-//      printf("=================================================================================\n");
-//      printf("=================================================Data Time %s===\n", tmpstr);
-//      printf("=================================================================================\n");
-
-    }
-
-    //======================================DEBUG==================================================
-
-    //=============================Not Equip ITEM==========================================
-    if ((noteqcount == 1) && (dbnoteqcount == 1))
-    {
-        //printf("%s Not Equip Empty\n",tablename);
-        //item empty
-    }
-    else
-    {
-
-        for (i = 1; i < noteqcount; i++)
-        {
-            for (j = 1; j < dbnoteqcount; j++)
-            {
-                if (mapitem.notequip[i].flag == 1)
-                    break;
-                if (!(dbitem.notequip[j].flag == 1))
-                {
-                    if (mapitem.notequip[i].nameid ==
-                        dbitem.notequip[j].nameid)
-                    {
-                        if ((mapitem.notequip[i].amount ==
-                             dbitem.notequip[j].amount)
-                            && (mapitem.notequip[i].equip ==
-                                dbitem.notequip[j].equip)
-                            && (mapitem.notequip[i].identify ==
-                                dbitem.notequip[j].identify)
-                            && (mapitem.notequip[i].attribute ==
-                                dbitem.notequip[j].attribute))
-                        {
-                            mapitem.notequip[i].flag = 1;
-                            dbitem.notequip[j].flag = 1;
-                            //printf("the same item : %d ; i : %d ; flag :  %d\n", mapitem.notequip[i].nameid, i, mapitem.notequip[i].flag); //DEBUG-STRING
-                        }
-                        else
-                        {
-                            sprintf (tmp_sql,
-                                     "UPDATE `%s` SET `amount`='%d', `equip`='%d', `identify`='%d',"
-                                     "`attribute`='%d' WHERE `%s`='%d' AND `nameid`='%d'",
-                                     tablename, mapitem.notequip[i].amount,
-                                     mapitem.notequip[i].equip,
-                                     mapitem.notequip[i].identify,
-                                     mapitem.notequip[i].attribute,
-                                     selectoption, char_id,
-                                     mapitem.notequip[i].nameid);
-                            //printf("%s",tmp_sql);
-                            if (mysql_query (&mysql_handle, tmp_sql))
-                                printf
-                                    ("DB server Error (UPdate `notequ %s`)- %s\n",
-                                     tablename, mysql_error (&mysql_handle));
-
-                            mapitem.notequip[i].flag = 1;
-                            dbitem.notequip[j].flag = 1;
-                        }
-                    }
-                }
-            }
-        }
-
-        //printf("dbnoteqcount = %d\n",dbnoteqcount);
-
-        for (i = 1; i < dbnoteqcount; i++)
-        {
-            //printf("dbitem.notequip[i].flag = %d , dbitem.notequip[i].id = %d\n",dbitem.notequip[i].flag,dbitem.notequip[i].id);
-            if (!(dbitem.notequip[i].flag == 1))
-            {
-                sprintf (tmp_sql, "DELETE from `%s` where `id`='%d'",
-                         tablename, dbitem.notequip[i].id);
-                //printf("%s", tmp_sql);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                    printf ("DB server Error (DELETE `notequ %s`)- %s\n",
-                            tablename, mysql_error (&mysql_handle));
-            }
-        }
-        for (i = 1; i < noteqcount; i++)
-        {
-            if (!(mapitem.notequip[i].flag == 1))
-            {
-                sprintf (tmp_sql,
-                         "INSERT INTO `%s`( `%s`, `nameid`, `amount`, `equip`, `identify`, `refine`, `attribute`, `card0`, `card1`, `card2`, `card3`, `broken`)"
-                         " VALUES ('%d','%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d')",
-                         tablename, selectoption, char_id,
-                         mapitem.notequip[i].nameid,
-                         mapitem.notequip[i].amount,
-                         mapitem.notequip[i].equip,
-                         mapitem.notequip[i].identify,
-                         mapitem.notequip[i].refine,
-                         mapitem.notequip[i].attribute,
-                         mapitem.notequip[i].card[0],
-                         mapitem.notequip[i].card[1],
-                         mapitem.notequip[i].card[2],
-                         mapitem.notequip[i].card[3],
-                         mapitem.equip[i].broken);
-                //printf("%s", tmp_sql);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                    printf ("DB server Error (INSERT `notequ %s`)- %s\n",
-                            tablename, mysql_error (&mysql_handle));
-            }
-        }
-
-        //======================================DEBUG=================================================
-
-//      gettimeofday(&tv,NULL);
-//      strftime(tmpstr,24,"%Y-%m-%d %H:%M:%S",localtime(&(tv.tv_sec)));
-//      printf("\n\n");
-//      printf("Working Table Name : Not EQU %s,  Count : map %3d | db %3d \n",tablename ,noteqcount ,dbnoteqcount);
-//      printf("*********************************************************************************\n");
-//      printf("======================================MAP===================Char ID %10d===\n",char_id);
-//      printf("==flag ===name ===equip===ident===refin===attri===card0===card1===card2===card3==\n");
-//      for(j=1;j<noteqcount;j++)
-//          printf("| %5d | %5d | %5d | %5d | %5d | %5d | %5d | %5d | %5d | %5d |\n", mapitem.notequip[j].flag,mapitem.notequip[j].nameid, mapitem.notequip[j].equip, mapitem.notequip[j].identify, mapitem.notequip[j].refine,mapitem.notequip[j].attribute, mapitem.notequip[j].card[0], mapitem.notequip[j].card[1], mapitem.notequip[j].card[2], mapitem.notequip[j].card[3]);
-//      printf("======================================DB=========================================\n");
-//      printf("==flag ===name ===equip===ident===refin===attri===card0===card1===card2===card3==\n");
-//      for(j=1;j<dbnoteqcount;j++)
-//          printf("| %5d | %5d | %5d | %5d | %5d | %5d | %5d | %5d | %5d | %5d |\n", dbitem.notequip[j].flag ,dbitem.notequip[j].nameid, dbitem.notequip[j].equip, dbitem.notequip[j].identify, dbitem.notequip[j].refine,dbitem.notequip[j].attribute, dbitem.notequip[j].card[0], dbitem.notequip[j].card[1], dbitem.notequip[j].card[2], dbitem.notequip[j].card[3]);
-//      printf("=================================================================================\n");
-//      printf("=================================================Data Time %s===\n", tmpstr);
-//      printf("=================================================================================\n");
-//
-    }
-    return 0;
-}
-
-//=====================================================================================================
-int mmo_char_fromsql (int char_id, struct mmo_charstatus *p, int online)
-{
-    int  i, n;
-
-    memset (p, 0, sizeof (struct mmo_charstatus));
-
-    p->char_id = char_id;
-    printf ("Loaded: ");
-    //`char`( `char_id`,`account_id`,`char_num`,`name`,`class`,`base_level`,`job_level`,`base_exp`,`job_exp`,`zeny`, //9
-    //`str`,`agi`,`vit`,`int`,`dex`,`luk`, //15
-    //`max_hp`,`hp`,`max_sp`,`sp`,`status_point`,`skill_point`, //21
-    //`option`,`karma`,`manner`,`party_id`,`guild_id`,`pet_id`, //27
-    //`hair`,`hair_color`,`clothes_color`,`weapon`,`shield`,`head_top`,`head_mid`,`head_bottom`, //35
-    //`last_map`,`last_x`,`last_y`,`save_map`,`save_x`,`save_y`)
-    //splite 2 parts. cause veeeery long SQL syntax
-
-    sprintf (tmp_sql,
-             "SELECT `char_id`,`account_id`,`char_num`,`name`,`class`,`base_level`,`job_level`,`base_exp`,`job_exp`,`zeny`,"
-             "`str`,`agi`,`vit`,`int`,`dex`,`luk`, `max_hp`,`hp`,`max_sp`,`sp`,`status_point`,`skill_point` FROM `%s` WHERE `char_id` = '%d'",
-             char_db, char_id);
-
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `char`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    sql_res = mysql_store_result (&mysql_handle);
-
-    if (sql_res)
-    {
-        sql_row = mysql_fetch_row (sql_res);
-
-        p->char_id = char_id;
-        p->account_id = atoi (sql_row[1]);
-        p->char_num = atoi (sql_row[2]);
-        strcpy (p->name, sql_row[3]);
-        p->class = atoi (sql_row[4]);
-        p->base_level = atoi (sql_row[5]);
-        p->job_level = atoi (sql_row[6]);
-        p->base_exp = atoi (sql_row[7]);
-        p->job_exp = atoi (sql_row[8]);
-        p->zeny = atoi (sql_row[9]);
-        p->str = atoi (sql_row[10]);
-        p->agi = atoi (sql_row[11]);
-        p->vit = atoi (sql_row[12]);
-        p->int_ = atoi (sql_row[13]);
-        p->dex = atoi (sql_row[14]);
-        p->luk = atoi (sql_row[15]);
-        p->max_hp = atoi (sql_row[16]);
-        p->hp = atoi (sql_row[17]);
-        p->max_sp = atoi (sql_row[18]);
-        p->sp = atoi (sql_row[19]);
-        p->status_point = atoi (sql_row[20]);
-        p->skill_point = atoi (sql_row[21]);
-        //free mysql result.
-        mysql_free_result (sql_res);
-    }
-    else
-        printf ("char1 - failed\n");    //Error?! ERRRRRR WHAT THAT SAY!?
-    printf ("(\033[1;32m%d\033[0m)\033[1;32m%s\033[0m\t[", p->char_id,
-            p->name);
-    printf ("char1 ");
-
-    sprintf (tmp_sql,
-             "SELECT `option`,`karma`,`manner`,`party_id`,`guild_id`,`pet_id`,`hair`,`hair_color`,"
-             "`clothes_color`,`weapon`,`shield`,`head_top`,`head_mid`,`head_bottom`,"
-             "`last_map`,`last_x`,`last_y`,`save_map`,`save_x`,`save_y`, `partner_id` FROM `%s` WHERE `char_id` = '%d'",
-             char_db, char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `char2`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res)
-    {
-        sql_row = mysql_fetch_row (sql_res);
-
-        p->option = atoi (sql_row[0]);
-        p->karma = atoi (sql_row[1]);
-        p->manner = atoi (sql_row[2]);
-        p->party_id = atoi (sql_row[3]);
-        p->guild_id = atoi (sql_row[4]);
-        p->pet_id = atoi (sql_row[5]);
-
-        p->hair = atoi (sql_row[6]);
-        p->hair_color = atoi (sql_row[7]);
-        p->clothes_color = atoi (sql_row[8]);
-        p->weapon = atoi (sql_row[9]);
-        p->shield = atoi (sql_row[10]);
-        p->head_top = atoi (sql_row[11]);
-        p->head_mid = atoi (sql_row[12]);
-        p->head_bottom = atoi (sql_row[13]);
-        strcpy (p->last_point.map, sql_row[14]);
-        p->last_point.x = atoi (sql_row[15]);
-        p->last_point.y = atoi (sql_row[16]);
-        strcpy (p->save_point.map, sql_row[17]);
-        p->save_point.x = atoi (sql_row[18]);
-        p->save_point.y = atoi (sql_row[19]);
-        p->partner_id = atoi (sql_row[20]);
-
-        //free mysql result.
-        mysql_free_result (sql_res);
-    }
-    else
-        printf ("char2 - failed\n");    //Error?! ERRRRRR WHAT THAT SAY!?
-
-    printf ("char2 ");
-
-    //read memo data
-    //`memo` (`memo_id`,`char_id`,`map`,`x`,`y`)
-    sprintf (tmp_sql, "SELECT `map`,`x`,`y` FROM `%s` WHERE `char_id`='%d'",
-             memo_db, char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `memo`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-
-    if (sql_res)
-    {
-        for (i = 0; (sql_row = mysql_fetch_row (sql_res)); i++)
-        {
-            strcpy (p->memo_point[i].map, sql_row[0]);
-            p->memo_point[i].x = atoi (sql_row[1]);
-            p->memo_point[i].y = atoi (sql_row[2]);
-            //i ++;
-        }
-        mysql_free_result (sql_res);
-    }
-    printf ("memo ");
-
-    //read inventory
-    //`inventory` (`id`,`char_id`, `nameid`, `amount`, `equip`, `identify`, `refine`, `attribute`, `card0`, `card1`, `card2`, `card3`)
-    sprintf (tmp_sql,
-             "SELECT `id`, `nameid`, `amount`, `equip`, `identify`, `refine`, `attribute`, `card0`, `card1`, `card2`, `card3`, `broken` "
-             "FROM `%s` WHERE `char_id`='%d'", inventory_db, char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `inventory`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res)
-    {
-        for (i = 0; (sql_row = mysql_fetch_row (sql_res)); i++)
-        {
-            p->inventory[i].id = atoi (sql_row[0]);
-            p->inventory[i].nameid = atoi (sql_row[1]);
-            p->inventory[i].amount = atoi (sql_row[2]);
-            p->inventory[i].equip = atoi (sql_row[3]);
-            p->inventory[i].identify = atoi (sql_row[4]);
-            p->inventory[i].refine = atoi (sql_row[5]);
-            p->inventory[i].attribute = atoi (sql_row[6]);
-            p->inventory[i].card[0] = atoi (sql_row[7]);
-            p->inventory[i].card[1] = atoi (sql_row[8]);
-            p->inventory[i].card[2] = atoi (sql_row[9]);
-            p->inventory[i].card[3] = atoi (sql_row[10]);
-            p->inventory[i].broken = atoi (sql_row[11]);
-        }
-        mysql_free_result (sql_res);
-    }
-    printf ("inventory ");
-
-    //read cart.
-    //`cart_inventory` (`id`,`char_id`, `nameid`, `amount`, `equip`, `identify`, `refine`, `attribute`, `card0`, `card1`, `card2`, `card3`)
-    sprintf (tmp_sql,
-             "SELECT `id`, `nameid`, `amount`, `equip`, `identify`, `refine`, `attribute`, `card0`, `card1`, `card2`, `card3`, `broken` "
-             "FROM `%s` WHERE `char_id`='%d'", cart_db, char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `cart_inventory`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res)
-    {
-        for (i = 0; (sql_row = mysql_fetch_row (sql_res)); i++)
-        {
-            p->cart[i].id = atoi (sql_row[0]);
-            p->cart[i].nameid = atoi (sql_row[1]);
-            p->cart[i].amount = atoi (sql_row[2]);
-            p->cart[i].equip = atoi (sql_row[3]);
-            p->cart[i].identify = atoi (sql_row[4]);
-            p->cart[i].refine = atoi (sql_row[5]);
-            p->cart[i].attribute = atoi (sql_row[6]);
-            p->cart[i].card[0] = atoi (sql_row[7]);
-            p->cart[i].card[1] = atoi (sql_row[8]);
-            p->cart[i].card[2] = atoi (sql_row[9]);
-            p->cart[i].card[3] = atoi (sql_row[10]);
-            p->cart[i].broken = atoi (sql_row[11]);
-        }
-        mysql_free_result (sql_res);
-    }
-    printf ("cart ");
-
-    //read skill
-    //`skill` (`char_id`, `id`, `lv`)
-    sprintf (tmp_sql, "SELECT `id`, `lv` FROM `%s` WHERE `char_id`='%d'",
-             skill_db, char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `skill`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res)
-    {
-        for (i = 0; (sql_row = mysql_fetch_row (sql_res)); i++)
-        {
-            n = atoi (sql_row[0]);
-            p->skill[n].id = n; //memory!? shit!.
-            p->skill[n].lv = atoi (sql_row[1]);
-        }
-        mysql_free_result (sql_res);
-    }
-    printf ("skill ");
-
-    //global_reg
-    //`global_reg_value` (`char_id`, `str`, `value`)
-    sprintf (tmp_sql,
-             "SELECT `str`, `value` FROM `%s` WHERE `type`=3 AND `char_id`='%d'",
-             reg_db, char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `global_reg_value`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    i = 0;
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res)
-    {
-        for (i = 0; (sql_row = mysql_fetch_row (sql_res)); i++)
-        {
-            strcpy (p->global_reg[i].str, sql_row[0]);
-            p->global_reg[i].value = atoi (sql_row[1]);
-        }
-        mysql_free_result (sql_res);
-    }
-    p->global_reg_num = i;
-
-    if (online)
-    {
-        sprintf (tmp_sql,
-                 "UPDATE `%s` SET `online`='%d' WHERE `char_id`='%d'",
-                 char_db, online, char_id);
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error (set char online)- %s\n",
-                    mysql_error (&mysql_handle));
-        }
-    }
-
-    printf ("global_reg]\n");   //ok. all data load successfuly!
-
-    //printf("char cloade");
-
-    return 1;
-}
-
-//==========================================================================================================
-int mmo_char_sql_init (void)
-{
-    int  i;
-
-    printf ("init start.......\n");
-    // memory initialize
-    // no need to set twice size in this routine. but some cause segmentation error. :P
-    printf ("initializing char memory...(%d byte)\n",
-            sizeof (struct mmo_charstatus) * 2);
-    CREATE (char_dat, struct mmo_charstatus, 2);
-
-    memset (char_dat, 0, sizeof (struct mmo_charstatus) * 2);
-/*	Initialized in inter.c already [Wizputer]
-	// DB connection initialized
-	// for char-server session only
-	mysql_init(&mysql_handle);
-	printf("Connect DB server....(char server)\n");
-	if(!mysql_real_connect(&mysql_handle, char_server_ip, char_server_id, char_server_pw, char_server_db ,char_server_port, (char *)NULL, 0)) {
-		// SQL connection pointer check
-		printf("%s\n",mysql_error(&mysql_handle));
-		exit(1);
-	} else {
-		printf("connect success! (char server)\n");
-	}
-*/
-    sprintf (tmp_sql, "SELECT count(*) FROM `%s`", char_db);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    sql_row = mysql_fetch_row (sql_res);
-    printf ("total char data -> '%s'.......\n", sql_row[0]);
-    i = atoi (sql_row[0]);
-    mysql_free_result (sql_res);
-
-    if (i != 0)
-    {
-        sprintf (tmp_sql, "SELECT max(`char_id`) FROM `%s`", char_db);
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        }
-        sql_res = mysql_store_result (&mysql_handle);
-        sql_row = mysql_fetch_row (sql_res);
-        char_id_count = atoi (sql_row[0]);
-
-        mysql_free_result (sql_res);
-    }
-    else
-        printf ("set char_id_count: %d.......\n", char_id_count);
-
-    sprintf (tmp_sql, "UPDATE `%s` SET `online`='0' WHERE `online`='1'",
-             char_db);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (reset_online `%s`)- %s\n", char_db,
-                mysql_error (&mysql_handle));
-    }
-    printf ("init end.......\n");
-
-    return 0;
-}
-
-//==========================================================================================================
-
-int make_new_char_sql (int fd, unsigned char *dat)
-{
-    struct char_session_data *sd;
-    char t_name[100];
-    int  i;
-    //aphostropy error check! - fixed!
-    jstrescapecpy (t_name, dat);
-    printf ("making new char -");
-
-    sd = session[fd]->session_data;
-
-    // Check Authorised letters/symbols in the name of the character
-    if (char_name_option == 1)
-    {                           // only letters/symbols in char_name_letters are authorised
-        for (i = 0; i < strlen (dat); i++)
-            if (strchr (char_name_letters, dat[i]) == NULL)
-                return -1;
-    }
-    else if (char_name_option == 2)
-    {                           // letters/symbols in char_name_letters are forbidden
-        for (i = 0; i < strlen (dat); i++)
-            if (strchr (char_name_letters, dat[i]) != NULL)
-                return -1;
-    }                           // else, all letters/symbols are authorised (except control char removed before)
-
-    //check stat error
-    if ((dat[24] + dat[25] + dat[26] + dat[27] + dat[28] + dat[29] != 5 * 6)
-        || (dat[30] >= 9) || (dat[33] <= 0) || (dat[33] >= 20)
-        || (dat[31] >= 9))
-    {
-
-        // check individual stat value
-        for (i = 24; i <= 29; i++)
-        {
-            if (dat[i] < 1 || dat[i] > 9)
-            {
-                return -1;
-            }
-        }
-
-        // char.log to charlog
-        sprintf (tmp_sql,
-                 "INSERT INTO `%s` (`time`, `char_msg`,`account_id`,`char_num`,`name`,`str`,`agi`,`vit`,`int`,`dex`,`luk`,`hair`,`hair_color`)"
-                 "VALUES (NOW(), '%s', '%d', '%d', '%s', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d')",
-                 charlog_db, "make new char error", sd->account_id, dat[30],
-                 dat, dat[24], dat[25], dat[26], dat[27], dat[28], dat[29],
-                 dat[33], dat[31]);
-        //query
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        }
-        printf ("make new char error %d-%d %s %d, %d, %d, %d, %d, %d %d, %d"
-                RETCODE, fd, dat[30], dat, dat[24], dat[25], dat[26], dat[27],
-                dat[28], dat[29], dat[33], dat[31]);
-        return -1;
-    }
-
-    // char.log to charlog
-    sprintf (tmp_sql,
-             "INSERT INTO `%s`(`time`, `char_msg`,`account_id`,`char_num`,`name`,`str`,`agi`,`vit`,`int`,`dex`,`luk`,`hair`,`hair_color`)"
-             "VALUES (NOW(), '%s', '%d', '%d', '%s', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d')",
-             charlog_db, "make new char", sd->account_id, dat[30], dat,
-             dat[24], dat[25], dat[26], dat[27], dat[28], dat[29], dat[33],
-             dat[31]);
-    //query
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    printf ("make new char %d-%d %s %d, %d, %d, %d, %d, %d - %d, %d" RETCODE,
-            fd, dat[30], dat, dat[24], dat[25], dat[26], dat[27], dat[28],
-            dat[29], dat[33], dat[31]);
-
-    sprintf (tmp_sql, "SELECT count(*) FROM `%s` WHERE `name` = '%s'",
-             char_db, t_name);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        return -1;
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    sql_row = mysql_fetch_row (sql_res);
-    printf ("\033[1;32m name check result : %s -\033[0m ", sql_row[0]);
-    if (atoi (sql_row[0]) > 0)
-    {
-        mysql_free_result (sql_res);
-        return -1;
-    }
-    else
-        mysql_free_result (sql_res);
-
-    // check char slot.
-    sprintf (tmp_sql,
-             "SELECT count(*) FROM `%s` WHERE `account_id` = '%d' AND `char_num` = '%d'",
-             char_db, sd->account_id, dat[30]);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    sql_row = mysql_fetch_row (sql_res);
-
-    //printf("slot check result : %s\n",sql_row[0]);
-    if (atoi (sql_row[0]) > 0)
-    {
-        mysql_free_result (sql_res);
-        return -1;
-    }
-    else
-        mysql_free_result (sql_res);
-
-    char_id_count++;
-
-    // make new char.
-    sprintf (tmp_sql,
-             "INSERT INTO `%s` (`char_id`,`account_id`,`char_num`,`name`,`zeny`,`str`,`agi`,`vit`,`int`,`dex`,`luk`,`max_hp`,`hp`,`max_sp`,`sp`,`hair`,`hair_color`)"
-             " VALUES ('%d', '%d', '%d', '%s', '%d',  '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d','%d', '%d','%d', '%d')",
-             char_db, char_id_count, sd->account_id, dat[30], t_name,
-             start_zeny, dat[24], dat[25], dat[26], dat[27], dat[28], dat[29],
-             (40 * (100 + dat[26]) / 100), (40 * (100 + dat[26]) / 100),
-             (11 * (100 + dat[27]) / 100), (11 * (100 + dat[27]) / 100),
-             dat[33], dat[31]);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (insert `char`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    //`inventory` (`id`,`char_id`, `nameid`, `amount`, `equip`, `identify`, `refine`, `attribute`, `card0`, `card1`, `card2`, `card3`)
-    sprintf (tmp_sql, "INSERT INTO `%s` (`char_id`,`nameid`, `amount`, `equip`, `identify`) VALUES ('%d', '%d', '%d', '%d', '%d')", inventory_db, char_id_count, 1201, 1, 0x02, 1); //add Knife
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (insert `inventory`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    sprintf (tmp_sql, "INSERT INTO `%s` (`char_id`,`nameid`, `amount`, `equip`, `identify`) VALUES ('%d', '%d', '%d', '%d', '%d')", inventory_db, char_id_count, 2301, 1, 0x10, 1); //add Cotton Shirt
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (insert `inventory`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    // respawn map and start point set
-    sprintf (tmp_sql,
-             "UPDATE `%s` SET `last_map`='%s',`last_x`='%d',`last_y`='%d',`save_map`='%s',`save_x`='%d',`save_y`='%d'  WHERE  `char_id` = '%d'",
-             char_db, start_point.map, start_point.x, start_point.y,
-             start_point.map, start_point.x, start_point.y, char_id_count);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (update `char`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    printf
-        ("making new char success - id:(\033[1;32m%d\033[0m\tname:\033[1;32%s\033[0m\n",
-         char_id_count, t_name);
-    return char_id_count;
-}
-
-//==========================================================================================================
-
-void mmo_char_sync (void)
-{
-    printf ("mmo_char_sync() - nothing to do\n");
-}
-
-// to do
-///////////////////////////
-
-int mmo_char_sync_timer (int tid, unsigned int tick, int id, int data)
-{
-    printf ("mmo_char_sync_timer() tic - no works to do\n");
-    return 0;
-}
-
-int count_users (void)
-{
-    int  i, users;
-
-    if (login_fd > 0 && session[login_fd])
-    {
-        users = 0;
-        for (i = 0; i < MAX_MAP_SERVERS; i++)
-        {
-            if (server_fd[i] >= 0)
-            {
-                users += server[i].users;
-            }
-        }
-        return users;
-    }
-    return 0;
-}
-
-int mmo_char_send006b (int fd, struct char_session_data *sd)
-{
-    int  i, j, found_num = 0;
-    struct mmo_charstatus *p = NULL;
-// hehe. commented other. anyway there's no need to use older version.
-// if use older packet version just uncomment that!
-//#ifdef NEW_006b
-    const int offset = 24;
-//#else
-//  int offset = 4;
-//#endif
-
-    printf ("mmo_char_send006b start.. (account:%d)\n", sd->account_id);
-//  printf("offset -> %d...\n",offset);
-
-    //search char.
-    sprintf (tmp_sql, "SELECT `char_id` FROM `%s` WHERE `account_id` = '%d'",
-             char_db, sd->account_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res)
-    {
-        found_num = mysql_num_rows (sql_res);
-        printf ("number of chars: %d\n", found_num);
-        i = 0;
-        while ((sql_row = mysql_fetch_row (sql_res)))
-        {
-            sd->found_char[i] = atoi (sql_row[0]);
-            i++;
-        }
-        mysql_free_result (sql_res);
-    }
-
-//  printf("char fetching end (total: %d)....\n", found_num);
-
-    for (i = found_num; i < 9; i++)
-        sd->found_char[i] = -1;
-
-    memset (WFIFOP (fd, 0), 0, offset + found_num * 106);
-    WFIFOW (fd, 0) = 0x6b;
-    WFIFOW (fd, 2) = offset + found_num * 106;
-
-    printf ("(\033[1;13m%d\033[0m) Request Char Data:\n", sd->account_id);
-
-    for (i = 0; i < found_num; i++)
-    {
-        mmo_char_fromsql (sd->found_char[i], char_dat, 0);
-
-        p = &char_dat[0];
-
-        j = offset + (i * 106); // increase speed of code
-
-        WFIFOL (fd, j) = p->char_id;
-        WFIFOL (fd, j + 4) = p->base_exp;
-        WFIFOL (fd, j + 8) = p->zeny;
-        WFIFOL (fd, j + 12) = p->job_exp;
-        WFIFOL (fd, j + 16) = p->job_level;
-
-        WFIFOL (fd, j + 20) = 0;
-        WFIFOL (fd, j + 24) = 0;
-        WFIFOL (fd, j + 28) = p->option;
-
-        WFIFOL (fd, j + 32) = p->karma;
-        WFIFOL (fd, j + 36) = p->manner;
-
-        WFIFOW (fd, j + 40) = p->status_point;
-        WFIFOW (fd, j + 42) = (p->hp > 0x7fff) ? 0x7fff : p->hp;
-        WFIFOW (fd, j + 44) = (p->max_hp > 0x7fff) ? 0x7fff : p->max_hp;
-        WFIFOW (fd, j + 46) = (p->sp > 0x7fff) ? 0x7fff : p->sp;
-        WFIFOW (fd, j + 48) = (p->max_sp > 0x7fff) ? 0x7fff : p->max_sp;
-        WFIFOW (fd, j + 50) = DEFAULT_WALK_SPEED;   // p->speed;
-        WFIFOW (fd, j + 52) = p->class;
-        WFIFOW (fd, j + 54) = p->hair;
-        WFIFOW (fd, j + 56) = p->weapon;
-        WFIFOW (fd, j + 58) = p->base_level;
-        WFIFOW (fd, j + 60) = p->skill_point;
-        WFIFOW (fd, j + 62) = p->head_bottom;
-        WFIFOW (fd, j + 64) = p->shield;
-        WFIFOW (fd, j + 66) = p->head_top;
-        WFIFOW (fd, j + 68) = p->head_mid;
-        WFIFOW (fd, j + 70) = p->hair_color;
-        WFIFOW (fd, j + 72) = p->clothes_color;
-
-        memcpy (WFIFOP (fd, j + 74), p->name, 24);
-
-        WFIFOB (fd, j + 98) = (p->str > 255) ? 255 : p->str;
-        WFIFOB (fd, j + 99) = (p->agi > 255) ? 255 : p->agi;
-        WFIFOB (fd, j + 100) = (p->vit > 255) ? 255 : p->vit;
-        WFIFOB (fd, j + 101) = (p->int_ > 255) ? 255 : p->int_;
-        WFIFOB (fd, j + 102) = (p->dex > 255) ? 255 : p->dex;
-        WFIFOB (fd, j + 103) = (p->luk > 255) ? 255 : p->luk;
-        WFIFOB (fd, j + 104) = p->char_num;
-    }
-
-    WFIFOSET (fd, WFIFOW (fd, 2));
-//  printf("mmo_char_send006b end..\n");
-    return 0;
-}
-
-int parse_tologin (int fd)
-{
-    int  i;
-    struct char_session_data *sd;
-
-    // only login-server can have an access to here.
-    // so, if it isn't the login-server, we disconnect the session.
-    //session eof check!
-    if (fd != login_fd || session[fd]->eof)
-    {
-        if (fd == login_fd)
-        {
-            printf
-                ("Char-server can't connect to login-server (connection #%d).\n",
-                 fd);
-            login_fd = -1;
-        }
-        close (fd);
-        delete_session (fd);
-        return 0;
-    }
-
-    sd = session[fd]->session_data;
-
-    // hehe. no need to set user limite on SQL version. :P
-    // but char limitation is good way to maintain server. :D
-    while (RFIFOREST (fd) >= 2)
-    {
-//      printf("parse_tologin : %d %d %x\n", fd, RFIFOREST(fd), RFIFOW(fd, 0));
-
-        switch (RFIFOW (fd, 0))
-        {
-            case 0x2711:
-                if (RFIFOREST (fd) < 3)
-                    return 0;
-                if (RFIFOB (fd, 2))
-                {
-                    //printf("connect login server error : %d\n", RFIFOB(fd, 2));
-                    printf ("Can not connect to login-server.\n");
-                    printf
-                        ("The server communication passwords (default s1/p1) is probably invalid.\n");
-                    printf
-                        ("Also, please make sure your login db has the username/password present and the sex of the account is S.\n");
-                    printf
-                        ("If you changed the communication passwords, change them back at map_athena.conf and char_athena.conf\n");
-                    return 0;
-                    //exit(1); //fixed for server shutdown.
-                }
-                else
-                {
-                    printf ("Connected to login-server (connection #%d).\n",
-                            fd);
-                    // if no map-server already connected, display a message...
-                    for (i = 0; i < MAX_MAP_SERVERS; i++)
-                        if (server_fd[i] >= 0 && server[i].map[0][0])   // if map-server online and at least 1 map
-                            break;
-                    if (i == MAX_MAP_SERVERS)
-                        printf ("Awaiting maps from map-server.\n");
-                }
-                RFIFOSKIP (fd, 3);
-                break;
-
-            case 0x2713:
-                if (RFIFOREST (fd) < 51)
-                    return 0;
-                for (i = 0; i < fd_max; i++)
-                {
-                    if (session[i] && (sd = session[i]->session_data)
-                        && sd->account_id == RFIFOL (fd, 2))
-                    {
-                        if (RFIFOB (fd, 6) != 0)
-                        {
-                            WFIFOW (i, 0) = 0x6c;
-                            WFIFOB (i, 2) = 0x42;
-                            WFIFOSET (i, 3);
-                        }
-                        else if (max_connect_user == 0
-                                 || count_users () < max_connect_user)
-                        {
-//                      if (max_connect_user == 0)
-//                          printf("max_connect_user (unlimited) -> accepted.\n");
-//                      else
-//                          printf("count_users(): %d < max_connect_user (%d) -> accepted.\n", count_users(), max_connect_user);
-                            sd->connect_until_time = (time_t) RFIFOL (fd, 47);
-                            // send characters to player
-                            mmo_char_send006b (i, sd);
-                        }
-                        else
-                        {
-                            // refuse connection: too much online players
-//                      printf("count_users(): %d < max_connect_use (%d) -> fail...\n", count_users(), max_connect_user);
-                            WFIFOW (i, 0) = 0x6c;
-                            WFIFOW (i, 2) = 0;
-                            WFIFOSET (i, 3);
-                        }
-                    }
-                }
-                RFIFOSKIP (fd, 51);
-                break;
-
-            case 0x2717:
-                if (RFIFOREST (fd) < 50)
-                    return 0;
-                for (i = 0; i < fd_max; i++)
-                {
-                    if (session[i] && (sd = session[i]->session_data))
-                    {
-                        if (sd->account_id == RFIFOL (fd, 2))
-                        {
-                            sd->connect_until_time = (time_t) RFIFOL (fd, 46);
-                            break;
-                        }
-                    }
-                }
-                RFIFOSKIP (fd, 50);
-                break;
-
-/*		case 0x2721:	// gm reply. I don't want to support this function.
-			printf("0x2721:GM reply\n");
-		  {
-			int oldacc, newacc;
-			unsigned char buf[64];
-			if (RFIFOREST(fd) < 10)
-				return 0;
-			oldacc = RFIFOL(fd, 2);
-			newacc = RFIFOL(fd, 6);
-			RFIFOSKIP(fd, 10);
-			if (newacc > 0) {
-				for(i=0;i<char_num;i++){
-					if(char_dat[i].account_id==oldacc)
-						char_dat[i].account_id=newacc;
-				}
-			}
-			WBUFW(buf,0)=0x2b0b;
-			WBUFL(buf,2)=oldacc;
-			WBUFL(buf,6)=newacc;
-			mapif_sendall(buf,10);
-//			printf("char -> map\n");
-		  }
-			break;
-*/
-            case 0x2723:       // changesex reply (modified by [Yor])
-                if (RFIFOREST (fd) < 7)
-                    return 0;
-                {
-                    int  acc, sex;
-                    unsigned char buf[16];
-
-                    acc = RFIFOL (fd, 2);
-                    sex = RFIFOB (fd, 6);
-                    RFIFOSKIP (fd, 7);
-                    if (acc > 0)
-                    {
-                        sprintf (tmp_sql,
-                                 "SELECT `char_id`,`class`,`skill_point` FROM `%s` WHERE `account_id` = '%d'",
-                                 char_db, acc);
-                        if (mysql_query (&mysql_handle, tmp_sql))
-                        {
-                            printf ("DB server Error (select `char`)- %s\n",
-                                    mysql_error (&mysql_handle));
-                        }
-                        sql_res = mysql_store_result (&mysql_handle);
-
-                        if (sql_res)
-                        {
-                            sql_row = mysql_fetch_row (sql_res);
-                            int  char_id = atoi (sql_row[0]);
-                            int  jobclass = atoi (sql_row[1]);
-                            int  skill_point = atoi (sql_row[2]);
-                            int  class = jobclass;
-                            if (jobclass == 19 || jobclass == 20 ||
-                                jobclass == 4020 || jobclass == 4021 ||
-                                jobclass == 4042 || jobclass == 4043)
-                            {
-                                // job modification
-                                if (jobclass == 19 || jobclass == 20)
-                                {
-                                    class = (sex) ? 19 : 20;
-                                }
-                                else if (jobclass == 4020 || jobclass == 4021)
-                                {
-                                    class = (sex) ? 4020 : 4021;
-                                }
-                                else if (jobclass == 4042 || jobclass == 4043)
-                                {
-                                    class = (sex) ? 4042 : 4043;
-                                }
-                                // remove specifical skills of classes 19,20 4020,4021 and 4042,4043
-                                sprintf (tmp_sql,
-                                         "SELECT `lv` FROM `%s` WHERE `char_id` = '%d' AND `id` >= '315' AND `id` <= '330'",
-                                         skill_db, char_id);
-                                if (mysql_query (&mysql_handle, tmp_sql))
-                                {
-                                    printf
-                                        ("DB server Error (select `char`)- %s\n",
-                                         mysql_error (&mysql_handle));
-                                }
-                                sql_res = mysql_store_result (&mysql_handle);
-                                if (sql_res)
-                                {
-                                    while ((sql_row =
-                                            mysql_fetch_row (sql_res)))
-                                    {
-                                        skill_point += atoi (sql_row[0]);
-                                    }
-                                }
-                                sprintf (tmp_sql,
-                                         "DELETE FROM `%s` WHERE `char_id` = '%d' AND `id` >= '315' AND `id` <= '330'",
-                                         skill_db, char_id);
-                                if (mysql_query (&mysql_handle, tmp_sql))
-                                {
-                                    printf
-                                        ("DB server Error (select `char`)- %s\n",
-                                         mysql_error (&mysql_handle));
-                                }
-                            }
-                            // to avoid any problem with equipment and invalid sex, equipment is unequiped.
-                            sprintf (tmp_sql,
-                                     "UPDATE `%s` SET `equip` = '0' WHERE `char_id` = '%d'",
-                                     inventory_db, char_id);
-                            if (mysql_query (&mysql_handle, tmp_sql))
-                            {
-                                printf
-                                    ("DB server Error (select `char`)- %s\n",
-                                     mysql_error (&mysql_handle));
-                            }
-                            sprintf (tmp_sql,
-                                     "UPDATE `%s` SET `class`='%d' , `skill_point`='%d' , `weapon`='0' , `shield='0' , `head_top`='0' , `head_mid`='0' , `head_bottom`='0' WHERE `char_id` = '%d'",
-                                     char_db, class, skill_point, char_id);
-                            if (mysql_query (&mysql_handle, tmp_sql))
-                            {
-                                printf
-                                    ("DB server Error (select `char`)- %s\n",
-                                     mysql_error (&mysql_handle));
-                            }
-                        }
-                    }
-                    // disconnect player if online on char-server
-                    for (i = 0; i < fd_max; i++)
-                    {
-                        if (session[i] && (sd = session[i]->session_data))
-                        {
-                            if (sd->account_id == acc)
-                            {
-                                session[i]->eof = 1;
-                                break;
-                            }
-                        }
-                    }
-
-                    WBUFW (buf, 0) = 0x2b0d;
-                    WBUFL (buf, 2) = acc;
-                    WBUFB (buf, 6) = sex;
-
-                    mapif_sendall (buf, 7);
-                }
-                break;
-
-                // account_reg2
-            case 0x2729:
-                if (RFIFOREST (fd) < 4 || RFIFOREST (fd) < RFIFOW (fd, 2))
-                    return 0;
-                {
-                    struct global_reg reg[ACCOUNT_REG2_NUM];
-                    unsigned char buf[4096];
-                    int  j, p, acc;
-                    acc = RFIFOL (fd, 4);
-                    for (p = 8, j = 0;
-                         p < RFIFOW (fd, 2) && j < ACCOUNT_REG2_NUM;
-                         p += 36, j++)
-                    {
-                        memcpy (reg[j].str, RFIFOP (fd, p), 32);
-                        reg[j].value = RFIFOL (fd, p + 32);
-                    }
-                    // set_account_reg2(acc,j,reg);
-                    // 
-                    memcpy (buf, RFIFOP (fd, 0), RFIFOW (fd, 2));
-                    WBUFW (buf, 0) = 0x2b11;
-                    mapif_sendall (buf, WBUFW (buf, 2));
-                    RFIFOSKIP (fd, RFIFOW (fd, 2));
-//          printf("char: save_account_reg_reply\n");
-                }
-                break;
-
-                // State change of account/ban notification (from login-server) by [Yor]
-            case 0x2731:
-                if (RFIFOREST (fd) < 11)
-                    return 0;
-                // send to all map-servers to disconnect the player
-                {
-                    unsigned char buf[16];
-                    WBUFW (buf, 0) = 0x2b14;
-                    WBUFL (buf, 2) = RFIFOL (fd, 2);
-                    WBUFB (buf, 6) = RFIFOB (fd, 6);    // 0: change of statut, 1: ban
-                    WBUFL (buf, 7) = RFIFOL (fd, 7);    // status or final date of a banishment
-                    mapif_sendall (buf, 11);
-                }
-                // disconnect player if online on char-server
-                for (i = 0; i < fd_max; i++)
-                {
-                    if (session[i] && (sd = session[i]->session_data))
-                    {
-                        if (sd->account_id == RFIFOL (fd, 2))
-                        {
-                            session[i]->eof = 1;
-                            break;
-                        }
-                    }
-                }
-                RFIFOSKIP (fd, 11);
-                break;
-
-            default:
-                printf ("set eof.\n");
-                session[fd]->eof = 1;
-                return 0;
-        }
-    }
-
-    RFIFOFLUSH (fd);
-
-    return 0;
-}
-
-//--------------------------------
-// Map-server anti-freeze system
-//--------------------------------
-int map_anti_freeze_system (int tid, unsigned int tick, int id, int data)
-{
-    int  i;
-
-    for (i = 0; i < MAX_MAP_SERVERS; i++)
-    {
-        if (server_fd[i] >= 0)
-        {                       // if map-server is online
-            printf ("map_anti_freeze_system: server #%d, flag: %d.\n", i,
-                    server_freezeflag[i]);
-            if (server_freezeflag[i]-- < 1)
-            {                   // Map-server anti-freeze system. Counter. 5 ok, 4...0 freezed
-                printf
-                    ("Map-server anti-freeze system: char-server #%d is frozen -> disconnection.\n",
-                     i);
-                session[server_fd[i]]->eof = 1;
-                sprintf (tmp_sql,
-                         "DELETE FROM `ragsrvinfo` WHERE `index`='%d'",
-                         server_fd[i]);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error - %s\n",
-                            mysql_error (&mysql_handle));
-                }
-            }
-        }
-    }
-
-    return 0;
-}
-
-int parse_frommap (int fd)
-{
-    int  i = 0, j = 0;
-    int  id;
-
-    // Sometimes fd=0, and it will cause server crash. Don't know why. :(
-    if (fd <= 0)
-    {
-        printf ("parse_frommap error fd=0\n");
-        return 0;
-    }
-
-    for (id = 0; id < MAX_MAP_SERVERS; id++)
-        if (server_fd[id] == fd)
-            break;
-    if (id == MAX_MAP_SERVERS || session[fd]->eof)
-    {
-        if (id < MAX_MAP_SERVERS)
-        {
-            memset (&server[id], 0, sizeof (struct mmo_map_server));
-            printf ("Map-server %d (session #%d) has disconnected.\n", id,
-                    fd);
-            sprintf (tmp_sql, "DELETE FROM `ragsrvinfo` WHERE `index`='%d'",
-                     server_fd[id]);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error - %s\n",
-                        mysql_error (&mysql_handle));
-            }
-            server_fd[id] = -1;
-        }
-        close (fd);
-        delete_session (fd);
-        return 0;
-    }
-
-    while (RFIFOREST (fd) >= 2)
-    {
-//      printf("parse_frommap : %d %d %x\n", fd, RFIFOREST(fd), RFIFOW(fd,0));
-
-        switch (RFIFOW (fd, 0))
-        {
-            case 0x2af7:
-                RFIFOSKIP (fd, 2);
-                read_gm_account ();
-                break;
-
-                // mapserver -> map names recv.
-            case 0x2afa:
-                if (RFIFOREST (fd) < 4 || RFIFOREST (fd) < RFIFOW (fd, 2))
-                    return 0;
-                memset (server[id].map, 0, sizeof (server[id].map));
-                j = 0;
-                for (i = 4; i < RFIFOW (fd, 2); i += 16)
-                {
-                    memcpy (server[id].map[j], RFIFOP (fd, i), 16);
-//              printf("set map %d.%d : %s\n", id, j, server[id].map[j]);
-                    j++;
-                }
-                i = server[id].ip;
-                {
-                    unsigned char *p = (unsigned char *) &server[id].ip;
-                    printf
-                        ("Map-Server %d connected: %d maps, from IP %d.%d.%d.%d port %d.\n",
-                         id, j, p[0], p[1], p[2], p[3], server[id].port);
-                    printf ("Map-server %d loading complete.\n", id);
-                }
-                WFIFOW (fd, 0) = 0x2afb;
-                WFIFOB (fd, 2) = 0;
-                memcpy (WFIFOP (fd, 3), wisp_server_name, 24);  // name for wisp to player
-                WFIFOSET (fd, 27);
-                {
-                    unsigned char buf[16384];
-                    int  x;
-                    if (j == 0)
-                    {
-                        printf ("WARNING: Map-Server %d have NO maps.\n", id);
-                        // Transmitting maps information to the other map-servers
-                    }
-                    else
-                    {
-                        WBUFW (buf, 0) = 0x2b04;
-                        WBUFW (buf, 2) = j * 16 + 10;
-                        WBUFL (buf, 4) = server[id].ip;
-                        WBUFW (buf, 8) = server[id].port;
-                        memcpy (WBUFP (buf, 10), RFIFOP (fd, 4), j * 16);
-                        mapif_sendallwos (fd, buf, WBUFW (buf, 2));
-                    }
-                    // Transmitting the maps of the other map-servers to the new map-server
-                    for (x = 0; x < MAX_MAP_SERVERS; x++)
-                    {
-                        if (server_fd[x] >= 0 && x != id)
-                        {
-                            WFIFOW (fd, 0) = 0x2b04;
-                            WFIFOL (fd, 4) = server[x].ip;
-                            WFIFOW (fd, 8) = server[x].port;
-                            j = 0;
-                            for (i = 0; i < MAX_MAP_PER_SERVER; i++)
-                                if (server[x].map[i][0])
-                                    memcpy (WFIFOP (fd, 10 + (j++) * 16),
-                                            server[x].map[i], 16);
-                            if (j > 0)
-                            {
-                                WFIFOW (fd, 2) = j * 16 + 10;
-                                WFIFOSET (fd, WFIFOW (fd, 2));
-                            }
-                        }
-                    }
-                }
-                RFIFOSKIP (fd, RFIFOW (fd, 2));
-                break;
-
-                // auth request
-            case 0x2afc:
-                if (RFIFOREST (fd) < 22)
-                    return 0;
-//          printf("(AUTH request) auth_fifo search %d %d %d\n", RFIFOL(fd, 2), RFIFOL(fd, 6), RFIFOL(fd, 10));
-                for (i = 0; i < AUTH_FIFO_SIZE; i++)
-                {
-                    if (auth_fifo[i].account_id == RFIFOL (fd, 2) &&
-                        auth_fifo[i].char_id == RFIFOL (fd, 6) &&
-                        auth_fifo[i].login_id1 == RFIFOL (fd, 10) &&
-#if CMP_AUTHFIFO_LOGIN2 != 0
-                        // here, it's the only area where it's possible that we doesn't know login_id2 (map-server asks just after 0x72 packet, that doesn't given the value)
-                        (auth_fifo[i].login_id2 == RFIFOL (fd, 14) || RFIFOL (fd, 14) == 0) &&  // relate to the versions higher than 18
-#endif
-                        (!check_ip_flag || auth_fifo[i].ip == RFIFOL (fd, 18))
-                        && !auth_fifo[i].delflag)
-                    {
-                        auth_fifo[i].delflag = 1;
-                        WFIFOW (fd, 0) = 0x2afd;
-                        WFIFOW (fd, 2) = 16 + sizeof (struct mmo_charstatus);
-                        WFIFOL (fd, 4) = RFIFOL (fd, 2);
-                        WFIFOL (fd, 8) = auth_fifo[i].login_id2;
-                        WFIFOL (fd, 12) =
-                            (unsigned long) auth_fifo[i].connect_until_time;
-                        mmo_char_fromsql (auth_fifo[i].char_id, char_dat, 1);
-                        char_dat[0].sex = auth_fifo[i].sex;
-                        memcpy (WFIFOP (fd, 16), &char_dat[0],
-                                sizeof (struct mmo_charstatus));
-                        WFIFOSET (fd, WFIFOW (fd, 2));
-                        //printf("auth_fifo search success (auth #%d, account %d, character: %d).\n", i, RFIFOL(fd,2), RFIFOL(fd,6));
-                        break;
-                    }
-                }
-                if (i == AUTH_FIFO_SIZE)
-                {
-                    WFIFOW (fd, 0) = 0x2afe;
-                    WFIFOL (fd, 2) = RFIFOL (fd, 2);
-                    WFIFOSET (fd, 6);
-//              printf("(AUTH request) auth_fifo search error!\n");
-                }
-                RFIFOSKIP (fd, 22);
-                break;
-
-                // set MAP user
-            case 0x2aff:
-                if (RFIFOREST (fd) < 6 || RFIFOREST (fd) < RFIFOW (fd, 2))
-                    return 0;
-                if (RFIFOW (fd, 4) != server[id].users)
-                    printf ("map user: %d\n", RFIFOW (fd, 4));
-                server[id].users = RFIFOW (fd, 4);
-                if (anti_freeze_enable)
-                    server_freezeflag[id] = 5;  // Map anti-freeze system. Counter. 5 ok, 4...0 freezed
-                RFIFOSKIP (fd, RFIFOW (fd, 2));
-                break;
-
-                // char saving
-            case 0x2b01:
-                i = 0;
-                if (RFIFOREST (fd) < 4 || RFIFOREST (fd) < RFIFOW (fd, 2))
-                    return 0;
-                //check account
-                sprintf (tmp_sql,
-                         "SELECT count(*) FROM `%s` WHERE `account_id` = '%d' AND `char_id`='%d'",
-                         char_db, RFIFOL (fd, 4), RFIFOL (fd, 8));
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error - %s\n",
-                            mysql_error (&mysql_handle));
-                }
-                sql_res = mysql_store_result (&mysql_handle);
-                if (sql_res)
-                {
-                    sql_row = mysql_fetch_row (sql_res);
-                    if (sql_row)
-                        i = atoi (sql_row[0]);
-                }
-                mysql_free_result (sql_res);
-
-                if (i == 1)
-                {
-                    memcpy (&char_dat[0], RFIFOP (fd, 12),
-                            sizeof (struct mmo_charstatus));
-                    mmo_char_tosql (RFIFOL (fd, 8), char_dat);
-                    //save to DB
-                }
-                RFIFOSKIP (fd, RFIFOW (fd, 2));
-                break;
-
-                // req char selection
-            case 0x2b02:
-                if (RFIFOREST (fd) < 18)
-                    return 0;
-
-                if (auth_fifo_pos >= AUTH_FIFO_SIZE)
-                    auth_fifo_pos = 0;
-
-//          printf("(charselect) auth_fifo set %d - account_id:%08x login_id1:%08x\n", auth_fifo_pos, RFIFOL(fd, 2), RFIFOL(fd, 6));
-                auth_fifo[auth_fifo_pos].account_id = RFIFOL (fd, 2);
-                auth_fifo[auth_fifo_pos].char_id = 0;
-                auth_fifo[auth_fifo_pos].login_id1 = RFIFOL (fd, 6);
-                auth_fifo[auth_fifo_pos].login_id2 = RFIFOL (fd, 10);
-                auth_fifo[auth_fifo_pos].delflag = 2;
-                auth_fifo[auth_fifo_pos].char_pos = 0;
-                auth_fifo[auth_fifo_pos].connect_until_time = 0;    // unlimited/unknown time by default (not display in map-server)
-                auth_fifo[auth_fifo_pos].ip = RFIFOL (fd, 14);
-                auth_fifo_pos++;
-
-                WFIFOW (fd, 0) = 0x2b03;
-                WFIFOL (fd, 2) = RFIFOL (fd, 2);
-                WFIFOB (fd, 6) = 0;
-                WFIFOSET (fd, 7);
-
-                RFIFOSKIP (fd, 18);
-                break;
-
-                // request "change map server"
-            case 0x2b05:
-                if (RFIFOREST (fd) < 49)
-                    return 0;
-
-                if (auth_fifo_pos >= AUTH_FIFO_SIZE)
-                    auth_fifo_pos = 0;
-
-                WFIFOW (fd, 0) = 0x2b06;
-                memcpy (WFIFOP (fd, 2), RFIFOP (fd, 2), 42);
-//          printf("(map change) auth_fifo set %d - account_id:%08x login_id1:%08x\n", auth_fifo_pos, RFIFOL(fd, 2), RFIFOL(fd, 6));
-                auth_fifo[auth_fifo_pos].account_id = RFIFOL (fd, 2);
-                auth_fifo[auth_fifo_pos].login_id1 = RFIFOL (fd, 6);
-                auth_fifo[auth_fifo_pos].login_id2 = RFIFOL (fd, 10);
-                auth_fifo[auth_fifo_pos].char_id = RFIFOL (fd, 14);
-                auth_fifo[auth_fifo_pos].delflag = 0;
-                auth_fifo[auth_fifo_pos].sex = RFIFOB (fd, 44);
-                auth_fifo[auth_fifo_pos].ip = RFIFOL (fd, 45);
-
-                sprintf (tmp_sql,
-                         "SELECT count(*) FROM `%s` WHERE `account_id` = '%d' AND `char_id`='%d'",
-                         char_db, RFIFOL (fd, 2), RFIFOL (fd, 14));
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error - %s\n",
-                            mysql_error (&mysql_handle));
-                }
-                sql_res = mysql_store_result (&mysql_handle);
-
-                if ((sql_row = mysql_fetch_row (sql_res)))
-                {
-                    i = atoi (sql_row[0]);
-                    mysql_free_result (sql_res);
-
-                    auth_fifo[auth_fifo_pos].char_pos =
-                        auth_fifo[auth_fifo_pos].char_id;
-                    auth_fifo_pos++;
-
-                    WFIFOL (fd, 6) = 0;
-                    break;
-                }
-                if (i == 0)
-                    WFIFOW (fd, 6) = 1;
-
-                WFIFOSET (fd, 44);
-                RFIFOSKIP (fd, 49);
-                break;
-
-                // char name check
-            case 0x2b08:
-                if (RFIFOREST (fd) < 6)
-                    return 0;
-
-                sprintf (tmp_sql,
-                         "SELECT `name` FROM `%s` WHERE `char_id`='%d'",
-                         char_db, RFIFOL (fd, 2));
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error - %s\n",
-                            mysql_error (&mysql_handle));
-                }
-                sql_res = mysql_store_result (&mysql_handle);
-
-                sql_row = mysql_fetch_row (sql_res);
-
-                WFIFOW (fd, 0) = 0x2b09;
-                WFIFOL (fd, 2) = RFIFOL (fd, 2);
-
-                if (sql_row)
-                    memcpy (WFIFOP (fd, 6), sql_row[0], 24);
-                else
-                    memcpy (WFIFOP (fd, 6), unknown_char_name, 24);
-                mysql_free_result (sql_res);
-
-                WFIFOSET (fd, 30);
-
-                RFIFOSKIP (fd, 6);
-                break;
-
-/*		// I want become GM - fuck!
-		case 0x2b0a:
-			if(RFIFOREST(fd)<4)
-				return 0;
-			if(RFIFOREST(fd)<RFIFOW(fd,2))
-				return 0;
-			memcpy(WFIFOP(login_fd,2),RFIFOP(fd,2),RFIFOW(fd,2)-2);
-			WFIFOW(login_fd,0)=0x2720;
-			WFIFOSET(login_fd,RFIFOW(fd,2));
-//			printf("char : change gm -> login %d %s %d\n", RFIFOL(fd, 4), RFIFOP(fd, 8), RFIFOW(fd, 2));
-			RFIFOSKIP(fd, RFIFOW(fd, 2));
-			break;
-		*/
-
-                // account_reg
-            case 0x2b10:
-                if (RFIFOREST (fd) < 4 || RFIFOREST (fd) < RFIFOW (fd, 2))
-                    return 0;
-                {
-                    struct global_reg reg[ACCOUNT_REG2_NUM];
-                    int  j, p, acc;
-                    acc = RFIFOL (fd, 4);
-                    for (p = 8, j = 0;
-                         p < RFIFOW (fd, 2) && j < ACCOUNT_REG2_NUM;
-                         p += 36, j++)
-                    {
-                        memcpy (reg[j].str, RFIFOP (fd, p), 32);
-                        reg[j].value = RFIFOL (fd, p + 32);
-                    }
-                    // set_account_reg2(acc,j,reg);
-                    // login
-                    if (login_fd > 0)
-                    {           // don't send request if no login-server
-                        WFIFOW (login_fd, 0) = 0x2728;
-                        memcpy (WFIFOP (login_fd, 0), RFIFOP (fd, 0),
-                                RFIFOW (fd, 2));
-                        WFIFOSET (login_fd, WFIFOW (login_fd, 2));
-                    }
-                    // map
-                    //memcpy(buf,RFIFOP(fd,0),RFIFOW(fd,2));
-                    //WBUFW(buf,0)=0x2b11;
-                    //mapif_sendall(buf,WBUFW(buf,2));
-                    RFIFOSKIP (fd, RFIFOW (fd, 2));
-//          printf("char: save_account_reg (from map)\n");
-                }
-                break;
-
-                // Map server send information to change an email of an account -> login-server
-            case 0x2b0c:
-                if (RFIFOREST (fd) < 86)
-                    return 0;
-                if (login_fd > 0)
-                {               // don't send request if no login-server
-                    memcpy (WFIFOP (login_fd, 0), RFIFOP (fd, 0), 86);  // 0x2722 <account_id>.L <actual_e-mail>.40B <new_e-mail>.40B
-                    WFIFOW (login_fd, 0) = 0x2722;
-                    WFIFOSET (login_fd, 86);
-                }
-                RFIFOSKIP (fd, 86);
-                break;
-
-                // Receiving from map-server a status change resquest. Transmission to login-server (by Yor)
-            case 0x2b0e:
-                if (RFIFOREST (fd) < 44)
-                    return 0;
-                {
-                    char character_name[24];
-                    int  acc = RFIFOL (fd, 2);  // account_id of who ask (-1 if nobody)
-                    memcpy (character_name, RFIFOP (fd, 6), 24);
-                    character_name[sizeof (character_name) - 1] = '\0';
-                    // prepare answer
-                    WFIFOW (fd, 0) = 0x2b0f;    // answer
-                    WFIFOL (fd, 2) = acc;   // who want do operation
-                    WFIFOW (fd, 30) = RFIFOW (fd, 30);  // type of operation: 1-block, 2-ban, 3-unblock, 4-unban
-                    sprintf (tmp_sql,
-                             "SELECT `account_id`,`name` FROM `%s` WHERE `name` = '%s'",
-                             char_db, character_name);
-                    if (mysql_query (&mysql_handle, tmp_sql))
-                    {
-                        printf ("DB server Error (select `char`)- %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-
-                    sql_res = mysql_store_result (&mysql_handle);
-
-                    if (sql_res)
-                    {
-                        if (mysql_num_rows (sql_res))
-                        {
-                            sql_row = mysql_fetch_row (sql_res);
-                            memcpy (WFIFOP (fd, 6), sql_row[1], 24);    // put correct name if found
-                            WFIFOW (fd, 32) = 0;    // answer: 0-login-server resquest done, 1-player not found, 2-gm level too low, 3-login-server offline
-                            switch (RFIFOW (fd, 30))
-                            {
-                                case 1:    // block
-                                    if (acc == -1
-                                        || isGM (acc) >=
-                                        isGM (atoi (sql_row[0])))
-                                    {
-                                        if (login_fd > 0)
-                                        {   // don't send request if no login-server
-                                            WFIFOW (login_fd, 0) = 0x2724;
-                                            WFIFOL (login_fd, 2) = atoi (sql_row[0]);   // account value
-                                            WFIFOL (login_fd, 6) = 5;   // status of the account
-                                            WFIFOSET (login_fd, 10);
-//                              printf("char : status -> login: account %d, status: %d \n", char_dat[i].account_id, 5);
-                                        }
-                                        else
-                                            WFIFOW (fd, 32) = 3;    // answer: 0-login-server resquest done, 1-player not found, 2-gm level too low, 3-login-server offline
-                                    }
-                                    else
-                                        WFIFOW (fd, 32) = 2;    // answer: 0-login-server resquest done, 1-player not found, 2-gm level too low, 3-login-server offline
-                                    break;
-                                case 2:    // ban
-                                    if (acc == -1
-                                        || isGM (acc) >=
-                                        isGM (atoi (sql_row[0])))
-                                    {
-                                        if (login_fd > 0)
-                                        {   // don't send request if no login-server
-                                            WFIFOW (login_fd, 0) = 0x2725;
-                                            WFIFOL (login_fd, 2) = atoi (sql_row[0]);   // account value
-                                            WFIFOW (login_fd, 6) = RFIFOW (fd, 32); // year
-                                            WFIFOW (login_fd, 8) = RFIFOW (fd, 34); // month
-                                            WFIFOW (login_fd, 10) = RFIFOW (fd, 36);    // day
-                                            WFIFOW (login_fd, 12) = RFIFOW (fd, 38);    // hour
-                                            WFIFOW (login_fd, 14) = RFIFOW (fd, 40);    // minute
-                                            WFIFOW (login_fd, 16) = RFIFOW (fd, 42);    // second
-                                            WFIFOSET (login_fd, 18);
-//                              printf("char : status -> login: account %d, ban: %dy %dm %dd %dh %dmn %ds\n",
-//                                     char_dat[i].account_id, (short)RFIFOW(fd,32), (short)RFIFOW(fd,34), (short)RFIFOW(fd,36), (short)RFIFOW(fd,38), (short)RFIFOW(fd,40), (short)RFIFOW(fd,42));
-                                        }
-                                        else
-                                            WFIFOW (fd, 32) = 3;    // answer: 0-login-server resquest done, 1-player not found, 2-gm level too low, 3-login-server offline
-                                    }
-                                    else
-                                        WFIFOW (fd, 32) = 2;    // answer: 0-login-server resquest done, 1-player not found, 2-gm level too low, 3-login-server offline
-                                    break;
-                                case 3:    // unblock
-                                    if (acc == -1
-                                        || isGM (acc) >=
-                                        isGM (atoi (sql_row[0])))
-                                    {
-                                        if (login_fd > 0)
-                                        {   // don't send request if no login-server
-                                            WFIFOW (login_fd, 0) = 0x2724;
-                                            WFIFOL (login_fd, 2) = atoi (sql_row[0]);   // account value
-                                            WFIFOL (login_fd, 6) = 0;   // status of the account
-                                            WFIFOSET (login_fd, 10);
-//                              printf("char : status -> login: account %d, status: %d \n", char_dat[i].account_id, 0);
-                                        }
-                                        else
-                                            WFIFOW (fd, 32) = 3;    // answer: 0-login-server resquest done, 1-player not found, 2-gm level too low, 3-login-server offline
-                                    }
-                                    else
-                                        WFIFOW (fd, 32) = 2;    // answer: 0-login-server resquest done, 1-player not found, 2-gm level too low, 3-login-server offline
-                                    break;
-                                case 4:    // unban
-                                    if (acc == -1
-                                        || isGM (acc) >=
-                                        isGM (atoi (sql_row[0])))
-                                    {
-                                        if (login_fd > 0)
-                                        {   // don't send request if no login-server
-                                            WFIFOW (login_fd, 0) = 0x272a;
-                                            WFIFOL (login_fd, 2) = atoi (sql_row[0]);   // account value
-                                            WFIFOSET (login_fd, 6);
-//                              printf("char : status -> login: account %d, unban request\n", char_dat[i].account_id);
-                                        }
-                                        else
-                                            WFIFOW (fd, 32) = 3;    // answer: 0-login-server resquest done, 1-player not found, 2-gm level too low, 3-login-server offline
-                                    }
-                                    else
-                                        WFIFOW (fd, 32) = 2;    // answer: 0-login-server resquest done, 1-player not found, 2-gm level too low, 3-login-server offline
-                                    break;
-                                case 5:    // changesex
-                                    if (acc == -1
-                                        || isGM (acc) >=
-                                        isGM (atoi (sql_row[0])))
-                                    {
-                                        if (login_fd > 0)
-                                        {   // don't send request if no login-server
-                                            WFIFOW (login_fd, 0) = 0x2727;
-                                            WFIFOL (login_fd, 2) = atoi (sql_row[0]);   // account value
-                                            WFIFOSET (login_fd, 6);
-//                              printf("char : status -> login: account %d, change sex request\n", char_dat[i].account_id);
-                                        }
-                                        else
-                                            WFIFOW (fd, 32) = 3;    // answer: 0-login-server resquest done, 1-player not found, 2-gm level too low, 3-login-server offline
-                                    }
-                                    else
-                                        WFIFOW (fd, 32) = 2;    // answer: 0-login-server resquest done, 1-player not found, 2-gm level too low, 3-login-server offline
-                                    break;
-                            }
-                        }
-                        else
-                        {
-                            // character name not found
-                            memcpy (WFIFOP (fd, 6), character_name, 24);
-                            WFIFOW (fd, 32) = 1;    // answer: 0-login-server resquest done, 1-player not found, 2-gm level too low, 3-login-server offline
-                        }
-                        // send answer if a player ask, not if the server ask
-                        if (acc != -1)
-                        {
-                            WFIFOSET (fd, 34);
-                        }
-                    }
-                }
-                RFIFOSKIP (fd, 44);
-                break;
-
-                // Recieve rates [Wizputer]
-            case 0x2b16:
-                if (RFIFOREST (fd) < 6 || RFIFOREST (fd) < RFIFOW (fd, 8))
-                    return 0;
-                sprintf (tmp_sql,
-                         "INSERT INTO `ragsrvinfo` SET `index`='%d',`name`='%s',`exp`='%d',`jexp`='%d',`drop`='%d',`motd`='%s'",
-                         fd, server_name, RFIFOW (fd, 2), RFIFOW (fd, 4),
-                         RFIFOW (fd, 6), RFIFOP (fd, 10));
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error - %s\n",
-                            mysql_error (&mysql_handle));
-                }
-                RFIFOSKIP (fd, RFIFOW (fd, 8));
-                break;
-
-                // Character disconnected set online 0 [Wizputer]
-            case 0x2b17:
-                if (RFIFOREST (fd) < 6)
-                    return 0;
-                //printf("Setting %d char offline\n",RFIFOL(fd,2));
-                sprintf (tmp_sql,
-                         "UPDATE `%s` SET `online`='0' WHERE `char_id`='%d'",
-                         char_db, RFIFOL (fd, 2));
-                if (mysql_query (&mysql_handle, tmp_sql))
-                    printf ("DB server Error (update online `%s`)- %s\n",
-                            char_db, mysql_error (&mysql_handle));
-                RFIFOSKIP (fd, 6);
-                break;
-
-            default:
-                // inter server - packet
-            {
-                int  r = inter_parse_frommap (fd);
-                if (r == 1)
-                    break;      // processed
-                if (r == 2)
-                    return 0;   // need more packet
-            }
-
-                // no inter server packet. no char server packet -> disconnect
-                printf ("parse_frommap: unknown packet %x! \n",
-                        RFIFOW (fd, 0));
-                session[fd]->eof = 1;
-                return 0;
-        }
-    }
-    return 0;
-}
-
-int search_mapserver (char *map)
-{
-    int  i, j;
-    char temp_map[16];
-    int  temp_map_len;
-
-//  printf("Searching the map-server for map '%s'... ", map);
-    strncpy (temp_map, map, sizeof (temp_map));
-    temp_map[sizeof (temp_map) - 1] = '\0';
-    if (strchr (temp_map, '.') != NULL)
-        temp_map[strchr (temp_map, '.') - temp_map + 1] = '\0'; // suppress the '.gat', but conserve the '.' to be sure of the name of the map
-
-    temp_map_len = strlen (temp_map);
-    for (i = 0; i < MAX_MAP_SERVERS; i++)
-        if (server_fd[i] >= 0)
-            for (j = 0; server[i].map[j][0]; j++)
-                //printf("%s : %s = %d\n", server[i].map[j], map, strncmp(server[i].map[j], temp_map, temp_map_len));
-                if (strncmp (server[i].map[j], temp_map, temp_map_len) == 0)
-                {
-//                  printf("found -> server #%d.\n", i);
-                    return i;
-                }
-
-//  printf("not found.\n");
-    return -1;
-}
-
-int char_mapif_init (int fd)
-{
-    return inter_mapif_init (fd);
-}
-
-//-----------------------------------------------------
-// Test to know if an IP come from LAN or WAN. by [Yor]
-//-----------------------------------------------------
-int lan_ip_check (unsigned char *p)
-{
-    int  i;
-    int  lancheck = 1;
-    int  subneti[4];
-    unsigned int k0, k1, k2, k3;
-
-    sscanf (lan_map_ip, "%d.%d.%d.%d", &k0, &k1, &k2, &k3);
-    subneti[0] = k0;
-    subneti[1] = k1;
-    subneti[2] = k2;
-    subneti[3] = k3;
-
-//  printf("lan_ip_check: to compare: %d.%d.%d.%d, network: %d.%d.%d.%d/%d.%d.%d.%d\n",
-//         p[0], p[1], p[2], p[3],
-//         subneti[0], subneti[1], subneti[2], subneti[3],
-//         subnetmaski[0], subnetmaski[1], subnetmaski[2], subnetmaski[3]);
-    for (i = 0; i < 4; i++)
-    {
-        if ((subneti[i] & subnetmaski[i]) != (p[i] & subnetmaski[i]))
-        {
-            lancheck = 0;
-            break;
-        }
-    }
-//  printf("LAN test (result): %s source\033[0m.\n", (lancheck) ? "\033[1;36mLAN" : "\033[1;32mWAN");
-    return lancheck;
-}
-
-int parse_char (int fd)
-{
-    int  i, ch = 0;
-    char email[40];
-    struct char_session_data *sd;
-    unsigned char *p = (unsigned char *) &session[fd]->client_addr.sin_addr;
-
-    if (login_fd < 0 || session[fd]->eof)
-    {
-        if (fd == login_fd)
-            login_fd = -1;
-        close (fd);
-        delete_session (fd);
-        return 0;
-    }
-
-    sd = session[fd]->session_data;
-
-    while (RFIFOREST (fd) >= 2)
-    {
-//      if (RFIFOW(fd, 0) < 30000)
-//          printf("parse_char : %d %d %x\n", fd, RFIFOREST(fd), RFIFOW(fd, 0));
-
-        switch (RFIFOW (fd, 0))
-        {
-            case 0x20b:        //20040622 encryption ragexe correspondence
-                if (RFIFOREST (fd) < 19)
-                    return 0;
-                RFIFOSKIP (fd, 19);
-                break;
-
-            case 0x65:         // request to connect
-                printf
-                    ("request connect - account_id:%d/login_id1:%d/login_id2:%d\n",
-                     RFIFOL (fd, 2), RFIFOL (fd, 6), RFIFOL (fd, 10));
-                if (RFIFOREST (fd) < 17)
-                    return 0;
-                {
-/*removed from isGM setup
-			if (isGM(RFIFOL(fd,2)))
-				printf("Account Logged On; Account ID: %d (GM level %d).\n", RFIFOL(fd,2), isGM(RFIFOL(fd,2)));
-			else
-				printf("Account Logged On; Account ID: %d.\n", RFIFOL(fd,2));
-*/
-                    if (sd == NULL)
-                    {
-                        CREATE (session[fd]->session_data,
-                                struct char_session_data, 1);
-                        sd = session[fd]->session_data;
-                        sd->connect_until_time = 0; // unknow or illimited (not displaying on map-server)
-                    }
-                    sd->account_id = RFIFOL (fd, 2);
-                    sd->login_id1 = RFIFOL (fd, 6);
-                    sd->login_id2 = RFIFOL (fd, 10);
-                    sd->sex = RFIFOB (fd, 16);
-
-                    WFIFOL (fd, 0) = RFIFOL (fd, 2);
-                    WFIFOSET (fd, 4);
-
-                    for (i = 0; i < AUTH_FIFO_SIZE; i++)
-                    {
-                        if (auth_fifo[i].account_id == sd->account_id &&
-                            auth_fifo[i].login_id1 == sd->login_id1 &&
-#if CMP_AUTHFIFO_LOGIN2 != 0
-                            auth_fifo[i].login_id2 == sd->login_id2 &&  // relate to the versions higher than 18
-#endif
-                            (!check_ip_flag
-                             || auth_fifo[i].ip ==
-                             session[fd]->client_addr.sin_addr.s_addr)
-                            && auth_fifo[i].delflag == 2)
-                        {
-                            auth_fifo[i].delflag = 1;
-
-                            if (max_connect_user == 0
-                                || count_users () < max_connect_user)
-                            {
-                                if (login_fd > 0)
-                                {   // don't send request if no login-server
-                                    // request to login-server to obtain e-mail/time limit
-                                    WFIFOW (login_fd, 0) = 0x2716;
-                                    WFIFOL (login_fd, 2) = sd->account_id;
-                                    WFIFOSET (login_fd, 6);
-                                }
-                                // send characters to player
-                                mmo_char_send006b (fd, sd);
-                            }
-                            else
-                            {
-                                // refuse connection (over populated)
-                                WFIFOW (fd, 0) = 0x6c;
-                                WFIFOW (fd, 2) = 0;
-                                WFIFOSET (fd, 3);
-                            }
-//              printf("connection request> set delflag 1(o:2)- account_id:%d/login_id1:%d(fifo_id:%d)\n", sd->account_id, sd->login_id1, i);
-                            break;
-                        }
-                    }
-                    if (i == AUTH_FIFO_SIZE)
-                    {
-                        if (login_fd > 0)
-                        {       // don't send request if no login-server
-                            WFIFOW (login_fd, 0) = 0x2712;  // ask login-server to authentify an account
-                            WFIFOL (login_fd, 2) = sd->account_id;
-                            WFIFOL (login_fd, 6) = sd->login_id1;
-                            WFIFOL (login_fd, 10) = sd->login_id2;
-                            WFIFOB (login_fd, 14) = sd->sex;
-                            WFIFOL (login_fd, 15) =
-                                session[fd]->client_addr.sin_addr.s_addr;
-                            WFIFOSET (login_fd, 19);
-                        }
-                        else
-                        {       // if no login-server, we must refuse connection
-                            WFIFOW (fd, 0) = 0x6c;
-                            WFIFOW (fd, 2) = 0;
-                            WFIFOSET (fd, 3);
-                        }
-                    }
-                }
-                RFIFOSKIP (fd, 17);
-                break;
-
-            case 0x66:         // char select
-//          printf("0x66> request connect - account_id:%d/char_num:%d\n",sd->account_id,RFIFOB(fd, 2));
-                if (RFIFOREST (fd) < 3)
-                    return 0;
-
-                sprintf (tmp_sql,
-                         "SELECT `char_id` FROM `%s` WHERE `account_id`='%d' AND `char_num`='%d'",
-                         char_db, sd->account_id, RFIFOB (fd, 2));
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error - %s\n",
-                            mysql_error (&mysql_handle));
-                }
-                sql_res = mysql_store_result (&mysql_handle);
-
-                sql_row = mysql_fetch_row (sql_res);
-
-                if (sql_row)
-                    mmo_char_fromsql (atoi (sql_row[0]), char_dat, 0);
-                else
-                {
-                    mysql_free_result (sql_res);
-                    RFIFOSKIP (fd, 3);
-                    break;
-                }
-
-                sprintf (tmp_sql,
-                         "INSERT INTO `%s`(`time`, `account_id`,`char_num`,`name`) VALUES (NOW(), '%d', '%d', '%s')",
-                         charlog_db, sd->account_id, RFIFOB (fd, 2),
-                         char_dat[0].name);
-                //query
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error - %s\n",
-                            mysql_error (&mysql_handle));
-                }
-                printf
-                    ("(\033[1;64m%d\033[0m) char selected (\033[1;32m%d\033[0m) \033[1;32m%s\033[0m"
-                     RETCODE, sd->account_id, RFIFOB (fd, 2),
-                     char_dat[0].name);
-
-                i = search_mapserver (char_dat[0].last_point.map);
-
-                // if map is not found, we check major cities
-                if (i < 0)
-                {
-                    if ((i = search_mapserver ("prontera.gat")) >= 0)
-                    {           // check is done without 'gat'.
-                        memcpy (char_dat[0].last_point.map, "prontera.gat",
-                                16);
-                        char_dat[0].last_point.x = 273; // savepoint coordonates
-                        char_dat[0].last_point.y = 354;
-                    }
-                    else if ((i = search_mapserver ("geffen.gat")) >= 0)
-                    {           // check is done without 'gat'.
-                        memcpy (char_dat[0].last_point.map, "geffen.gat", 16);
-                        char_dat[0].last_point.x = 120; // savepoint coordonates
-                        char_dat[0].last_point.y = 100;
-                    }
-                    else if ((i = search_mapserver ("morocc.gat")) >= 0)
-                    {           // check is done without 'gat'.
-                        memcpy (char_dat[0].last_point.map, "morocc.gat", 16);
-                        char_dat[0].last_point.x = 160; // savepoint coordonates
-                        char_dat[0].last_point.y = 94;
-                    }
-                    else if ((i = search_mapserver ("alberta.gat")) >= 0)
-                    {           // check is done without 'gat'.
-                        memcpy (char_dat[0].last_point.map, "alberta.gat",
-                                16);
-                        char_dat[0].last_point.x = 116; // savepoint coordonates
-                        char_dat[0].last_point.y = 57;
-                    }
-                    else if ((i = search_mapserver ("payon.gat")) >= 0)
-                    {           // check is done without 'gat'.
-                        memcpy (char_dat[0].last_point.map, "payon.gat", 16);
-                        char_dat[0].last_point.x = 87;  // savepoint coordonates
-                        char_dat[0].last_point.y = 117;
-                    }
-                    else if ((i = search_mapserver ("izlude.gat")) >= 0)
-                    {           // check is done without 'gat'.
-                        memcpy (char_dat[0].last_point.map, "izlude.gat", 16);
-                        char_dat[0].last_point.x = 94;  // savepoint coordonates
-                        char_dat[0].last_point.y = 103;
-                    }
-                    else
-                    {
-                        int  j;
-                        // get first online server
-                        i = 0;
-                        for (j = 0; j < MAX_MAP_SERVERS; j++)
-                            if (server_fd[j] >= 0 && server[j].map[0][0])
-                            {
-                                i = j;
-                                printf
-                                    ("Map-server #%d found with a map: '%s'.\n",
-                                     j, server[j].map[0]);
-                                break;
-                            }
-                        // if no map-servers are connected, we send: server closed
-                        if (j == MAX_MAP_SERVERS)
-                        {
-                            WFIFOW (fd, 0) = 0x81;
-                            WFIFOL (fd, 2) = 1; // 01 = Server closed
-                            WFIFOSET (fd, 3);
-                            RFIFOSKIP (fd, 3);
-                            break;
-                        }
-                    }
-                }
-                WFIFOW (fd, 0) = 0x71;
-                WFIFOL (fd, 2) = char_dat[0].char_id;
-                memcpy (WFIFOP (fd, 6), char_dat[0].last_point.map, 16);
-                //Lan check added by Kashy
-                if (lan_ip_check (p))
-                    WFIFOL (fd, 22) = inet_addr (lan_map_ip);
-                else
-                    WFIFOL (fd, 22) = server[i].ip;
-                WFIFOW (fd, 26) = server[i].port;
-                WFIFOSET (fd, 28);
-
-                if (auth_fifo_pos >= AUTH_FIFO_SIZE)
-                {
-                    auth_fifo_pos = 0;
-                }
-//          printf("auth_fifo set (auth_fifo_pos:%d) - account_id:%d char_id:%d login_id1:%d\n", auth_fifo_pos, sd->account_id, char_dat[0].char_id, sd->login_id1);
-                auth_fifo[auth_fifo_pos].account_id = sd->account_id;
-                auth_fifo[auth_fifo_pos].char_id = char_dat[0].char_id;
-                auth_fifo[auth_fifo_pos].login_id1 = sd->login_id1;
-                auth_fifo[auth_fifo_pos].login_id2 = sd->login_id2;
-                auth_fifo[auth_fifo_pos].delflag = 0;
-                //auth_fifo[auth_fifo_pos].char_pos = sd->found_char[ch];
-                auth_fifo[auth_fifo_pos].char_pos = 0;
-                auth_fifo[auth_fifo_pos].sex = sd->sex;
-                auth_fifo[auth_fifo_pos].connect_until_time =
-                    sd->connect_until_time;
-                auth_fifo[auth_fifo_pos].ip =
-                    session[fd]->client_addr.sin_addr.s_addr;
-                auth_fifo_pos++;
-//          printf("0x66> end\n");
-                RFIFOSKIP (fd, 3);
-                break;
-
-            case 0x67:         // make new
-//          printf("0x67>request make new char\n");
-                if (RFIFOREST (fd) < 37)
-                    return 0;
-                i = make_new_char_sql (fd, RFIFOP (fd, 2));
-                if (i < 0)
-                {
-                    WFIFOW (fd, 0) = 0x6e;
-                    WFIFOB (fd, 2) = 0x00;
-                    WFIFOSET (fd, 3);
-                    RFIFOSKIP (fd, 37);
-                    break;
-                }
-
-                WFIFOW (fd, 0) = 0x6d;
-                memset (WFIFOP (fd, 2), 0x00, 106);
-
-                mmo_char_fromsql (i, char_dat, 0);
-                i = 0;
-                WFIFOL (fd, 2) = char_dat[i].char_id;
-                WFIFOL (fd, 2 + 4) = char_dat[i].base_exp;
-                WFIFOL (fd, 2 + 8) = char_dat[i].zeny;
-                WFIFOL (fd, 2 + 12) = char_dat[i].job_exp;
-                WFIFOL (fd, 2 + 16) = char_dat[i].job_level;
-
-                WFIFOL (fd, 2 + 28) = char_dat[i].karma;
-                WFIFOL (fd, 2 + 32) = char_dat[i].manner;
-
-                WFIFOW (fd, 2 + 40) = 0x30;
-                WFIFOW (fd, 2 + 42) =
-                    (char_dat[i].hp > 0x7fff) ? 0x7fff : char_dat[i].hp;
-                WFIFOW (fd, 2 + 44) =
-                    (char_dat[i].max_hp >
-                     0x7fff) ? 0x7fff : char_dat[i].max_hp;
-                WFIFOW (fd, 2 + 46) =
-                    (char_dat[i].sp > 0x7fff) ? 0x7fff : char_dat[i].sp;
-                WFIFOW (fd, 2 + 48) =
-                    (char_dat[i].max_sp >
-                     0x7fff) ? 0x7fff : char_dat[i].max_sp;
-                WFIFOW (fd, 2 + 50) = DEFAULT_WALK_SPEED;   // char_dat[i].speed;
-                WFIFOW (fd, 2 + 52) = char_dat[i].class;
-                WFIFOW (fd, 2 + 54) = char_dat[i].hair;
-
-                WFIFOW (fd, 2 + 58) = char_dat[i].base_level;
-                WFIFOW (fd, 2 + 60) = char_dat[i].skill_point;
-
-                WFIFOW (fd, 2 + 64) = char_dat[i].shield;
-                WFIFOW (fd, 2 + 66) = char_dat[i].head_top;
-                WFIFOW (fd, 2 + 68) = char_dat[i].head_mid;
-                WFIFOW (fd, 2 + 70) = char_dat[i].hair_color;
-
-                memcpy (WFIFOP (fd, 2 + 74), char_dat[i].name, 24);
-
-                WFIFOB (fd, 2 + 98) = char_dat[i].str;
-                WFIFOB (fd, 2 + 99) = char_dat[i].agi;
-                WFIFOB (fd, 2 + 100) = char_dat[i].vit;
-                WFIFOB (fd, 2 + 101) = char_dat[i].int_;
-                WFIFOB (fd, 2 + 102) = char_dat[i].dex;
-                WFIFOB (fd, 2 + 103) = char_dat[i].luk;
-                WFIFOB (fd, 2 + 104) = char_dat[i].char_num;
-
-                WFIFOSET (fd, 108);
-                RFIFOSKIP (fd, 37);
-                //to do
-                for (ch = 0; ch < 9; ch++)
-                {
-                    if (sd->found_char[ch] == -1)
-                    {
-                        sd->found_char[ch] = char_dat[i].char_id;
-                        break;
-                    }
-                }
-
-            case 0x68:         // delete
-                if (RFIFOREST (fd) < 46)
-                    return 0;
-                printf
-                    ("\033[1;31m Request Char Del:\033[0m \033[1;32m%d\033[0m(\033[1;32m%d\033[0m)\n",
-                     sd->account_id, RFIFOL (fd, 2));
-                memcpy (email, RFIFOP (fd, 6), 40);
-                sprintf (tmp_sql, "SELECT `email` FROM `%s` WHERE `%s`='%d'",
-                         login_db, login_db_account_id, sd->account_id);
-                if (mysql_query (&lmysql_handle, tmp_sql))
-                {
-                    printf
-                        ("\033[1;31m DB server Error Delete Char data - %s \033[0m  \n",
-                         mysql_error (&lmysql_handle));
-                }
-                sql_res = mysql_store_result (&lmysql_handle);
-                if (sql_res)
-                {
-                    sql_row = mysql_fetch_row (sql_res);
-                    if (strcmp (email, sql_row[0]) == 0)
-                    {
-                        mysql_free_result (sql_res);
-                    }
-                    else
-                    {
-                        WFIFOW (fd, 0) = 0x70;
-                        WFIFOB (fd, 2) = 0;
-                        WFIFOSET (fd, 3);
-                        RFIFOSKIP (fd, 46);
-                        mysql_free_result (sql_res);
-                        break;
-                    }
-                }
-                else
-                {
-                    WFIFOW (fd, 0) = 0x70;
-                    WFIFOB (fd, 2) = 0;
-                    WFIFOSET (fd, 3);
-                    RFIFOSKIP (fd, 46);
-                    mysql_free_result (sql_res);
-                    break;
-                }
-                sprintf (tmp_sql,
-                         "SELECT `name`,`partner_id` FROM `%s` WHERE `char_id`='%d'",
-                         char_db, RFIFOL (fd, 2));
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error - %s\n",
-                            mysql_error (&mysql_handle));
-                }
-                sql_res = mysql_store_result (&mysql_handle);
-                if (sql_res)
-                    sql_row = mysql_fetch_row (sql_res);
-
-                if (sql_res && sql_row[0])
-                {
-                    //delete char from SQL
-                    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `char_id`='%d'",
-                             pet_db, RFIFOL (fd, 2));
-                    if (mysql_query (&mysql_handle, tmp_sql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-                    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `char_id`='%d'",
-                             inventory_db, RFIFOL (fd, 2));
-                    if (mysql_query (&mysql_handle, tmp_sql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-
-                    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `char_id`='%d'",
-                             cart_db, RFIFOL (fd, 2));
-                    if (mysql_query (&mysql_handle, tmp_sql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-
-                    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `char_id`='%d'",
-                             memo_db, RFIFOL (fd, 2));
-                    if (mysql_query (&mysql_handle, tmp_sql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-
-                    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `char_id`='%d'",
-                             skill_db, RFIFOL (fd, 2));
-                    if (mysql_query (&mysql_handle, tmp_sql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-
-                    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `char_id`='%d'",
-                             char_db, RFIFOL (fd, 2));
-                    if (mysql_query (&mysql_handle, tmp_sql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-
-                    //Divorce [Wizputer]
-                    if (sql_row[1] != 0)
-                    {
-                        char buf[64];
-                        sprintf (tmp_sql,
-                                 "UPDATE `%s` SET `partner_id`='0' WHERE `char_id`='%d'",
-                                 char_db, atoi (sql_row[1]));
-                        if (mysql_query (&mysql_handle, tmp_sql))
-                        {
-                            printf ("DB server Error - %s\n",
-                                    mysql_error (&mysql_handle));
-                        }
-                        sprintf (tmp_sql,
-                                 "DELETE FROM `%s` WHERE (`nameid`='%d' OR `nameid`='%d') AND `char_id`='%d'",
-                                 inventory_db, WEDDING_RING_M, WEDDING_RING_F,
-                                 atoi (sql_row[1]));
-                        if (mysql_query (&mysql_handle, tmp_sql))
-                        {
-                            printf ("DB server Error - %s\n",
-                                    mysql_error (&mysql_handle));
-                        }
-                        WBUFW (buf, 0) = 0x2b12;
-                        WBUFL (buf, 2) = atoi (sql_row[0]);
-                        WBUFL (buf, 6) = atoi (sql_row[1]);
-                        mapif_sendall (buf, 10);
-                    }
-                    // Also delete info from guildtables.
-                    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `char_id`='%d'",
-                             guild_member_db, RFIFOL (fd, 2));
-                    if (mysql_query (&mysql_handle, tmp_sql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-
-                    sprintf (tmp_sql,
-                             "SELECT `guild_id` FROM `%s` WHERE `master` = '%s'",
-                             guild_db, sql_row[0]);
-
-                    if (mysql_query (&mysql_handle, tmp_sql) == 0)
-                    {
-                        sql_res = mysql_store_result (&mysql_handle);
-
-                        if (sql_res != NULL)
-                        {
-                            if (mysql_num_rows (sql_res) != 0)
-                            {
-                                sql_row = mysql_fetch_row (sql_res);
-
-                                sprintf (tmp_sql,
-                                         "DELETE FROM `%s` WHERE `guild_id` = '%d'",
-                                         guild_db, atoi (sql_row[0]));
-                                if (mysql_query (&mysql_handle, tmp_sql))
-                                {
-                                    printf ("DB server Error - %s\n",
-                                            mysql_error (&mysql_handle));
-                                }
-
-                                sprintf (tmp_sql,
-                                         "DELETE FROM `%s` WHERE `guild_id` = '%d'",
-                                         guild_member_db, atoi (sql_row[0]));
-                                if (mysql_query (&mysql_handle, tmp_sql))
-                                {
-                                    printf ("DB server Error - %s\n",
-                                            mysql_error (&mysql_handle));
-                                }
-
-                                sprintf (tmp_sql,
-                                         "DELETE FROM `%s` WHERE `guild_id` = '%d'",
-                                         guild_castle_db, atoi (sql_row[0]));
-                                if (mysql_query (&mysql_handle, tmp_sql))
-                                {
-                                    printf ("DB server Error - %s\n",
-                                            mysql_error (&mysql_handle));
-                                }
-
-                                sprintf (tmp_sql,
-                                         "DELETE FROM `%s` WHERE `guild_id` = '%d'",
-                                         guild_storage_db, atoi (sql_row[0]));
-                                if (mysql_query (&mysql_handle, tmp_sql))
-                                {
-                                    printf ("DB server Error - %s\n",
-                                            mysql_error (&mysql_handle));
-                                }
-
-                                sprintf (tmp_sql,
-                                         "DELETE FROM `%s` WHERE `guild_id` = '%d' OR `alliance_id` = '%d'",
-                                         guild_alliance_db, atoi (sql_row[0]),
-                                         atoi (sql_row[0]));
-                                if (mysql_query (&mysql_handle, tmp_sql))
-                                {
-                                    printf ("DB server Error - %s\n",
-                                            mysql_error (&mysql_handle));
-                                }
-
-                                sprintf (tmp_sql,
-                                         "DELETE FROM `%s` WHERE `guild_id` = '%d'",
-                                         guild_position_db,
-                                         atoi (sql_row[0]));
-                                if (mysql_query (&mysql_handle, tmp_sql))
-                                {
-                                    printf ("DB server Error - %s\n",
-                                            mysql_error (&mysql_handle));
-                                }
-
-                                sprintf (tmp_sql,
-                                         "DELETE FROM `%s` WHERE `guild_id` = '%d'",
-                                         guild_skill_db, atoi (sql_row[0]));
-                                if (mysql_query (&mysql_handle, tmp_sql))
-                                {
-                                    printf ("DB server Error - %s\n",
-                                            mysql_error (&mysql_handle));
-                                }
-
-                                sprintf (tmp_sql,
-                                         "DELETE FROM `%s` WHERE `guild_id` = '%d'",
-                                         guild_expulsion_db,
-                                         atoi (sql_row[0]));
-                                if (mysql_query (&mysql_handle, tmp_sql))
-                                {
-                                    printf ("DB server Error - %s\n",
-                                            mysql_error (&mysql_handle));
-                                }
-
-                                mysql_free_result (sql_res);
-                            }
-                        }
-                        else
-                        {
-                            if (mysql_errno (&mysql_handle) != 0)
-                            {
-                                printf ("Database server error: %s\n",
-                                        mysql_error (&mysql_handle));
-                            }
-                        }
-                    }
-                    else
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-                }
-
-                for (i = 0; i < 9; i++)
-                {
-                    printf ("char comp: %d - %d (%d)\n", sd->found_char[i],
-                            RFIFOL (fd, 2), sd->account_id);
-                    if (sd->found_char[i] == RFIFOL (fd, 2))
-                    {
-                        for (ch = i; ch < 9 - 1; ch++)
-                            sd->found_char[ch] = sd->found_char[ch + 1];
-                        sd->found_char[8] = -1;
-                        break;
-                    }
-                }
-                if (i == 9)
-                {               // reject
-                    WFIFOW (fd, 0) = 0x70;
-                    WFIFOB (fd, 2) = 0;
-                    WFIFOSET (fd, 3);
-                }
-                else
-                {               // deleted!
-                    WFIFOW (fd, 0) = 0x6f;
-                    WFIFOSET (fd, 2);
-                }
-                RFIFOSKIP (fd, 46);
-                break;
-
-            case 0x2af8:       // login as map-server
-                if (RFIFOREST (fd) < 60)
-                    return 0;
-                WFIFOW (fd, 0) = 0x2af9;
-                for (i = 0; i < MAX_MAP_SERVERS; i++)
-                {
-                    if (server_fd[i] < 0)
-                        break;
-                }
-                if (i == MAX_MAP_SERVERS || strcmp (RFIFOP (fd, 2), userid)
-                    || strcmp (RFIFOP (fd, 26), passwd))
-                {
-                    WFIFOB (fd, 2) = 3;
-                    WFIFOSET (fd, 3);
-                }
-                else
-                {
-//              int len;
-                    WFIFOB (fd, 2) = 0;
-                    WFIFOSET (fd, 3);
-                    session[fd]->func_parse = parse_frommap;
-                    server_fd[i] = fd;
-                    if (anti_freeze_enable)
-                        server_freezeflag[i] = 5;   // Map anti-freeze system. Counter. 5 ok, 4...0 freezed
-                    server[i].ip = RFIFOL (fd, 54);
-                    server[i].port = RFIFOW (fd, 58);
-                    server[i].users = 0;
-                    memset (server[i].map, 0, sizeof (server[i].map));
-                    realloc_fifo (fd, FIFOSIZE_SERVERLINK,
-                                  FIFOSIZE_SERVERLINK);
-                    char_mapif_init (fd);
-                    // send gm acccounts level to map-servers
-/* removed by CLOWNISIUS due to isGM
-				len = 4;
-				WFIFOW(fd,0) = 0x2b15;
-				for(i = 0; i < GM_num; i++) {
-					WFIFOL(fd,len) = gm_account[i].account_id;
-					WFIFOB(fd,len+4) = (unsigned char)gm_account[i].level;
-					len += 5;
-				}
-				WFIFOW(fd,2) = len;
-				WFIFOSET(fd,len);*/
-                }
-                RFIFOSKIP (fd, 60);
-                break;
-
-            case 0x187:        // Alive?
-                if (RFIFOREST (fd) < 6)
-                {
-                    return 0;
-                }
-                RFIFOSKIP (fd, 6);
-                break;
-
-            case 0x7530:       // Athena info get
-                WFIFOW (fd, 0) = 0x7531;
-                WFIFOB (fd, 2) = ATHENA_MAJOR_VERSION;
-                WFIFOB (fd, 3) = ATHENA_MINOR_VERSION;
-                WFIFOB (fd, 4) = ATHENA_REVISION;
-                WFIFOB (fd, 5) = ATHENA_RELEASE_FLAG;
-                WFIFOB (fd, 6) = ATHENA_OFFICIAL_FLAG;
-                WFIFOB (fd, 7) = ATHENA_SERVER_INTER | ATHENA_SERVER_CHAR;
-                WFIFOW (fd, 8) = ATHENA_MOD_VERSION;
-                WFIFOSET (fd, 10);
-                RFIFOSKIP (fd, 2);
-                return 0;
-
-            case 0x7532:       // disconnect(default also disconnect)
-            default:
-                session[fd]->eof = 1;
-                return 0;
-        }
-    }
-    RFIFOFLUSH (fd);
-
-    return 0;
-}
-
-// MAP send all
-int mapif_sendall (unsigned char *buf, unsigned int len)
-{
-    int  i, c;
-    int  fd;
-
-    c = 0;
-    for (i = 0; i < MAX_MAP_SERVERS; i++)
-    {
-        if ((fd = server_fd[i]) >= 0)
-        {
-            memcpy (WFIFOP (fd, 0), buf, len);
-            WFIFOSET (fd, len);
-            c++;
-        }
-    }
-
-    return c;
-}
-
-int mapif_sendallwos (int sfd, unsigned char *buf, unsigned int len)
-{
-    int  i, c;
-    int  fd;
-
-    c = 0;
-    for (i = 0, c = 0; i < MAX_MAP_SERVERS; i++)
-    {
-        if ((fd = server_fd[i]) >= 0 && fd != sfd)
-        {
-            memcpy (WFIFOP (fd, 0), buf, len);
-            WFIFOSET (fd, len);
-            c++;
-        }
-    }
-
-    return c;
-}
-
-int mapif_send (int fd, unsigned char *buf, unsigned int len)
-{
-    int  i;
-
-    if (fd >= 0)
-    {
-        for (i = 0; i < MAX_MAP_SERVERS; i++)
-        {
-            if (fd == server_fd[i])
-            {
-                memcpy (WFIFOP (fd, 0), buf, len);
-                WFIFOSET (fd, len);
-                return 1;
-            }
-        }
-    }
-    return 0;
-}
-
-int send_users_tologin (int tid, unsigned int tick, int id, int data)
-{
-    int  users = count_users ();
-    char buf[16];
-
-    if (login_fd > 0 && session[login_fd])
-    {
-        // send number of user to login server
-        WFIFOW (login_fd, 0) = 0x2714;
-        WFIFOL (login_fd, 2) = users;
-        WFIFOSET (login_fd, 6);
-    }
-    // send number of players to all map-servers
-    WBUFW (buf, 0) = 0x2b00;
-    WBUFL (buf, 2) = users;
-    mapif_sendall (buf, 6);
-
-    return 0;
-}
-
-int check_connect_login_server (int tid, unsigned int tick, int id, int data)
-{
-    if (login_fd <= 0 || session[login_fd] == NULL)
-    {
-        printf ("Attempt to connect to login-server...\n");
-        login_fd = make_connection (login_ip, login_port);
-        session[login_fd]->func_parse = parse_tologin;
-        realloc_fifo (login_fd, FIFOSIZE_SERVERLINK, FIFOSIZE_SERVERLINK);
-        WFIFOW (login_fd, 0) = 0x2710;
-        memset (WFIFOP (login_fd, 2), 0, 24);
-        memcpy (WFIFOP (login_fd, 2), userid,
-                strlen (userid) < 24 ? strlen (userid) : 24);
-        memset (WFIFOP (login_fd, 26), 0, 24);
-        memcpy (WFIFOP (login_fd, 26), passwd,
-                strlen (passwd) < 24 ? strlen (passwd) : 24);
-        WFIFOL (login_fd, 50) = 0;
-        WFIFOL (login_fd, 54) = char_ip;
-        WFIFOL (login_fd, 58) = char_port;
-        memset (WFIFOP (login_fd, 60), 0, 20);
-        memcpy (WFIFOP (login_fd, 60), server_name,
-                strlen (server_name) < 20 ? strlen (server_name) : 20);
-        WFIFOW (login_fd, 80) = 0;
-        WFIFOW (login_fd, 82) = char_maintenance;
-        WFIFOW (login_fd, 84) = char_new;
-        WFIFOSET (login_fd, 86);
-    }
-    return 0;
-}
-
-//----------------------------------------------------------
-// Return numerical value of a switch configuration by [Yor]
-// on/off, english, franis, deutsch, espal
-//----------------------------------------------------------
-int config_switch (const char *str)
-{
-    if (strcmpi (str, "on") == 0 || strcmpi (str, "yes") == 0
-        || strcmpi (str, "oui") == 0 || strcmpi (str, "ja") == 0
-        || strcmpi (str, "si") == 0)
-        return 1;
-    if (strcmpi (str, "off") == 0 || strcmpi (str, "no") == 0
-        || strcmpi (str, "non") == 0 || strcmpi (str, "nein") == 0)
-        return 0;
-
-    return atoi (str);
-}
-
-// Lan Support conf reading added by Kashy
-int char_lan_config_read (const char *lancfgName)
-{
-    char subnetmask[128];
-    char line[1024], w1[1024], w2[1024];
-    FILE *fp;
-    struct hostent *h = NULL;
-
-    if ((fp = fopen_ (lancfgName, "r")) == NULL)
-    {
-        printf ("file not found: %s\n", lancfgName);
-        return 1;
-    }
-
-    printf ("Start reading of Lan Support configuration file\n");
-
-    while (fgets (line, sizeof (line) - 1, fp))
-    {
-        if (line[0] == '/' && line[1] == '/')
-            continue;
-
-        if (sscanf (line, "%[^:]: %[^\r\n]", w1, w2) != 2)
-            continue;
-
-        else if (strcmpi (w1, "lan_map_ip") == 0)
-        {
-            h = gethostbyname (w2);
-            if (h != NULL)
-            {
-                sprintf (lan_map_ip, "%d.%d.%d.%d",
-                         (unsigned char) h->h_addr[0],
-                         (unsigned char) h->h_addr[1],
-                         (unsigned char) h->h_addr[2],
-                         (unsigned char) h->h_addr[3]);
-            }
-            else
-            {
-                strncpy (lan_map_ip, w2, sizeof (lan_map_ip));
-                lan_map_ip[sizeof (lan_map_ip) - 1] = 0;
-            }
-            printf ("set Lan_map_IP : %s\n", lan_map_ip);
-        }
-
-        else if (strcmpi (w1, "subnetmask") == 0)
-        {
-            unsigned int k0, k1, k2, k3;
-            strcpy (subnetmask, w2);
-            sscanf (subnetmask, "%d.%d.%d.%d", &k0, &k1, &k2, &k3);
-            subnetmaski[0] = k0;
-            subnetmaski[1] = k1;
-            subnetmaski[2] = k2;
-            subnetmaski[3] = k3;
-            printf ("set subnetmask : %s\n", w2);
-        }
-    }
-    fclose_ (fp);
-
-    printf ("End reading of Lan Support configuration file\n");
-    return 0;
-}
-
-void do_final (void)
-{
-    printf ("Doing final stage...\n");
-    //mmo_char_sync();
-    //inter_save();
-    do_final_itemdb ();
-    //check SQL save progress.
-    //wait until save char complete
-    printf ("waiting until char saving complete...\n");
-    do
-    {
-        sleep (0);
-    }
-    while (save_flag != 0);
-
-    sprintf (tmp_sql, "UPDATE `%s` SET `online`='0' WHERE `online`='1'",
-             char_db);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (insert `char`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    sprintf (tmp_sql, "DELETE FROM `ragsrvinfo");
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (insert `char`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    if (gm_account != NULL)
-        free (gm_account);
-
-    free (char_dat);
-    free (gm_account);
-    delete_session (login_fd);
-    delete_session (char_fd);
-
-    mysql_close (&mysql_handle);
-    mysql_close (&lmysql_handle);
-
-    printf ("ok! all done...\n");
-}
-
-void sql_config_read (const char *cfgName)
-{                               /* Kalaspuff, to get login_db */
-    char line[1024], w1[1024], w2[1024];
-    FILE *fp;
-
-    printf ("reading configure: %s\n", cfgName);
-
-    if ((fp = fopen_ (cfgName, "r")) == NULL)
-    {
-        printf ("file not found: %s\n", cfgName);
-        exit (1);
-    }
-
-    while (fgets (line, sizeof (line) - 1, fp))
-    {
-        if (line[0] == '/' && line[1] == '/')
-            continue;
-
-        if (sscanf (line, "%[^:]: %[^\r\n]", w1, w2) != 2)
-            continue;
-
-        if (strcmpi (w1, "login_db") == 0)
-        {
-            strcpy (login_db, w2);
-        }
-        else if (strcmpi (w1, "char_db") == 0)
-        {
-            strcpy (char_db, w2);
-        }
-        else if (strcmpi (w1, "cart_db") == 0)
-        {
-            strcpy (cart_db, w2);
-        }
-        else if (strcmpi (w1, "inventory_db") == 0)
-        {
-            strcpy (inventory_db, w2);
-        }
-        else if (strcmpi (w1, "charlog_db") == 0)
-        {
-            strcpy (charlog_db, w2);
-        }
-        else if (strcmpi (w1, "storage_db") == 0)
-        {
-            strcpy (storage_db, w2);
-        }
-        else if (strcmpi (w1, "reg_db") == 0)
-        {
-            strcpy (reg_db, w2);
-        }
-        else if (strcmpi (w1, "skill_db") == 0)
-        {
-            strcpy (skill_db, w2);
-        }
-        else if (strcmpi (w1, "interlog_db") == 0)
-        {
-            strcpy (interlog_db, w2);
-        }
-        else if (strcmpi (w1, "memo_db") == 0)
-        {
-            strcpy (memo_db, w2);
-        }
-        else if (strcmpi (w1, "guild_db") == 0)
-        {
-            strcpy (guild_db, w2);
-        }
-        else if (strcmpi (w1, "guild_alliance_db") == 0)
-        {
-            strcpy (guild_alliance_db, w2);
-        }
-        else if (strcmpi (w1, "guild_castle_db") == 0)
-        {
-            strcpy (guild_castle_db, w2);
-        }
-        else if (strcmpi (w1, "guild_expulsion_db") == 0)
-        {
-            strcpy (guild_expulsion_db, w2);
-        }
-        else if (strcmpi (w1, "guild_member_db") == 0)
-        {
-            strcpy (guild_member_db, w2);
-        }
-        else if (strcmpi (w1, "guild_skill_db") == 0)
-        {
-            strcpy (guild_skill_db, w2);
-        }
-        else if (strcmpi (w1, "guild_position_db") == 0)
-        {
-            strcpy (guild_position_db, w2);
-        }
-        else if (strcmpi (w1, "guild_storage_db") == 0)
-        {
-            strcpy (guild_storage_db, w2);
-        }
-        else if (strcmpi (w1, "party_db") == 0)
-        {
-            strcpy (party_db, w2);
-        }
-        else if (strcmpi (w1, "pet_db") == 0)
-        {
-            strcpy (pet_db, w2);
-            //Map server option to use SQL db or not
-        }
-        else if (strcmpi (w1, "use_sql_db") == 0)
-        {                       // added for sql item_db read for char server [Valaris]
-            if (strcmpi (w2, "yes"))
-            {
-                db_use_sqldbs = 1;
-            }
-            else if (strcmpi (w2, "no"))
-            {
-                db_use_sqldbs = 0;
-            }
-            printf ("Using SQL dbs: %s\n", w2);
-            //custom columns for login database
-        }
-        else if (strcmpi (w1, "login_db_level") == 0)
-        {
-            strcpy (login_db_level, w2);
-        }
-        else if (strcmpi (w1, "login_db_account_id") == 0)
-        {
-            strcpy (login_db_account_id, w2);
-        }
-        else if (strcmpi (w1, "lowest_gm_level") == 0)
-        {
-            lowest_gm_level = atoi (w2);
-            printf ("set lowest_gm_level : %s\n", w2);
-        }
-    }
-    fclose_ (fp);
-    printf ("reading configure done.....\n");
-}
-
-int char_config_read (const char *cfgName)
-{
-    struct hostent *h = NULL;
-    char line[1024], w1[1024], w2[1024];
-    FILE *fp;
-
-    if ((fp = fopen_ (cfgName, "r")) == NULL)
-    {
-        printf ("Configuration file not found: %s.\n", cfgName);
-        exit (1);
-    }
-
-    while (fgets (line, sizeof (line) - 1, fp))
-    {
-        if (line[0] == '/' && line[1] == '/')
-            continue;
-
-        line[sizeof (line) - 1] = '\0';
-        if (sscanf (line, "%[^:]: %[^\r\n]", w1, w2) != 2)
-            continue;
-
-        remove_control_chars (w1);
-        remove_control_chars (w2);
-        if (strcmpi (w1, "userid") == 0)
-        {
-            memcpy (userid, w2, 24);
-        }
-        else if (strcmpi (w1, "passwd") == 0)
-        {
-            memcpy (passwd, w2, 24);
-        }
-        else if (strcmpi (w1, "server_name") == 0)
-        {
-            memcpy (server_name, w2, 16);
-            printf ("%s server has been intialized\n", w2);
-        }
-        else if (strcmpi (w1, "wisp_server_name") == 0)
-        {
-            if (strlen (w2) >= 4)
-            {
-                memcpy (wisp_server_name, w2, sizeof (wisp_server_name));
-                wisp_server_name[sizeof (wisp_server_name) - 1] = '\0';
-            }
-        }
-        else if (strcmpi (w1, "login_ip") == 0)
-        {
-            h = gethostbyname (w2);
-            if (h != NULL)
-            {
-                printf ("Login server IP address : %s -> %d.%d.%d.%d\n", w2,
-                        (unsigned char) h->h_addr[0],
-                        (unsigned char) h->h_addr[1],
-                        (unsigned char) h->h_addr[2],
-                        (unsigned char) h->h_addr[3]);
-                sprintf (login_ip_str, "%d.%d.%d.%d",
-                         (unsigned char) h->h_addr[0],
-                         (unsigned char) h->h_addr[1],
-                         (unsigned char) h->h_addr[2],
-                         (unsigned char) h->h_addr[3]);
-            }
-            else
-                memcpy (login_ip_str, w2, 16);
-        }
-        else if (strcmpi (w1, "login_port") == 0)
-        {
-            login_port = atoi (w2);
-        }
-        else if (strcmpi (w1, "char_ip") == 0)
-        {
-            h = gethostbyname (w2);
-            if (h != NULL)
-            {
-                printf ("Character server IP address : %s -> %d.%d.%d.%d\n",
-                        w2, (unsigned char) h->h_addr[0],
-                        (unsigned char) h->h_addr[1],
-                        (unsigned char) h->h_addr[2],
-                        (unsigned char) h->h_addr[3]);
-                sprintf (char_ip_str, "%d.%d.%d.%d",
-                         (unsigned char) h->h_addr[0],
-                         (unsigned char) h->h_addr[1],
-                         (unsigned char) h->h_addr[2],
-                         (unsigned char) h->h_addr[3]);
-            }
-            else
-                memcpy (char_ip_str, w2, 16);
-        }
-        else if (strcmpi (w1, "char_port") == 0)
-        {
-            char_port = atoi (w2);
-        }
-        else if (strcmpi (w1, "char_maintenance") == 0)
-        {
-            char_maintenance = atoi (w2);
-        }
-        else if (strcmpi (w1, "char_new") == 0)
-        {
-            char_new = atoi (w2);
-        }
-        else if (strcmpi (w1, "max_connect_user") == 0)
-        {
-            max_connect_user = atoi (w2);
-            if (max_connect_user < 0)
-                max_connect_user = 0;   // unlimited online players
-        }
-        else if (strcmpi (w1, "check_ip_flag") == 0)
-        {
-            check_ip_flag = config_switch (w2);
-        }
-        else if (strcmpi (w1, "autosave_time") == 0)
-        {
-            autosave_interval = atoi (w2) * 1000;
-            if (autosave_interval <= 0)
-                autosave_interval = DEFAULT_AUTOSAVE_INTERVAL;
-        }
-        else if (strcmpi (w1, "start_point") == 0)
-        {
-            char map[32];
-            int  x, y;
-            if (sscanf (w2, "%[^,],%d,%d", map, &x, &y) < 3)
-                continue;
-            if (strstr (map, ".gat") != NULL)
-            {                   // Verify at least if '.gat' is in the map name
-                memcpy (start_point.map, map, 16);
-                start_point.x = x;
-                start_point.y = y;
-            }
-        }
-        else if (strcmpi (w1, "start_zeny") == 0)
-        {
-            start_zeny = atoi (w2);
-            if (start_zeny < 0)
-                start_zeny = 0;
-        }
-        else if (strcmpi (w1, "start_weapon") == 0)
-        {
-            start_zeny = atoi (w2);
-            if (start_weapon < 0)
-                start_weapon = 0;
-        }
-        else if (strcmpi (w1, "start_armor") == 0)
-        {
-            start_zeny = atoi (w2);
-            if (start_armor < 0)
-                start_armor = 0;
-        }
-        else if (strcmpi (w1, "unknown_char_name") == 0)
-        {
-            strcpy (unknown_char_name, w2);
-            unknown_char_name[24] = 0;
-        }
-        else if (strcmpi (w1, "name_ignoring_case") == 0)
-        {
-            name_ignoring_case = config_switch (w2);
-        }
-        else if (strcmpi (w1, "char_name_option") == 0)
-        {
-            char_name_option = atoi (w2);
-        }
-        else if (strcmpi (w1, "char_name_letters") == 0)
-        {
-            strcpy (char_name_letters, w2);
-        }
-        else if (strcmpi (w1, "check_ip_flag") == 0)
-        {
-            check_ip_flag = config_switch (w2);
-            // anti-freeze options [Valaris]
-        }
-        else if (strcmpi (w1, "anti_freeze_enable") == 0)
-        {
-            anti_freeze_enable = config_switch (w2);
-        }
-        else if (strcmpi (w1, "anti_freeze_interval") == 0)
-        {
-            ANTI_FREEZE_INTERVAL = atoi (w2);
-            if (ANTI_FREEZE_INTERVAL < 5)
-                ANTI_FREEZE_INTERVAL = 5;   // minimum 5 seconds
-        }
-        else if (strcmpi (w1, "import") == 0)
-        {
-            char_config_read (w2);
-        }
-    }
-    fclose_ (fp);
-
-//Read ItemDB
-    do_init_itemdb ();
-
-    return 0;
-}
-
-int do_init (int argc, char **argv)
-{
-    int  i;
-
-    for (i = 0; i < MAX_MAP_SERVERS; i++)
-    {
-        memset (&server[i], 0, sizeof (struct mmo_map_server));
-        server_fd[i] = -1;
-    }
-
-    char_config_read ((argc < 2) ? CHAR_CONF_NAME : argv[1]);
-    char_lan_config_read ((argc > 1) ? argv[1] : LAN_CONF_NAME);
-    sql_config_read (SQL_CONF_NAME);
-
-    printf ("charserver configuration reading done.....\n");
-
-    inter_init ((argc > 2) ? argv[2] : inter_cfgName);  // inter server 
-    printf ("interserver configuration reading done.....\n");
-
-    printf ("start char server initializing.....\n");
-    mmo_char_sql_init ();
-    printf ("char server initializing done.....\n");
-
-    printf ("set parser -> parse_char().....\n");
-    set_defaultparse (parse_char);
-
-    printf ("set terminate function -> do_final().....\n");
-    set_termfunc (do_final);
-
-    printf ("open port %d.....\n", char_port);
-    char_fd = make_listen_port (char_port);
-
-    login_ip = inet_addr (login_ip_str);
-    char_ip = inet_addr (char_ip_str);
-
-    // send ALIVE PING to login server.
-    printf ("add interval tic (check_connect_login_server)....\n");
-    i = add_timer_interval (gettick () + 10, check_connect_login_server, 0, 0,
-                            10 * 1000);
-
-    // send USER COUNT PING to login server.
-    printf ("add interval tic (send_users_tologin)....\n");
-    i = add_timer_interval (gettick () + 10, send_users_tologin, 0, 0,
-                            5 * 1000);
-
-    //no need to set sync timer on SQL version.
-    //printf("add interval tic (mmo_char_sync_timer)....\n");
-    //i = add_timer_interval(gettick() + 10, mmo_char_sync_timer, 0, 0, autosave_interval);
-
-    if (anti_freeze_enable > 0)
-    {
-        add_timer_func_list (map_anti_freeze_system,
-                             "map_anti_freeze_system");
-        i = add_timer_interval (gettick () + 1000, map_anti_freeze_system, 0, 0, ANTI_FREEZE_INTERVAL * 1000);  // checks every X seconds user specifies
-    }
-
-    read_gm_account ();
-
-    printf ("char server init func end (now unlimited loop start!)....\n");
-    printf
-        ("The char-server is \033[1;32mready\033[0m (Server is listening on the port %d).\n\n",
-         char_port);
-    return 0;
-}
diff --git a/src/char_sql/char.h b/src/char_sql/char.h
deleted file mode 100644
index b0b2770..0000000
--- a/src/char_sql/char.h
+++ /dev/null
@@ -1,87 +0,0 @@
-#include "../common/core.h"
-#include "../common/socket.h"
-#include "../common/timer.h"
-#include "../common/mmo.h"
-#include "../common/version.h"
-#include "../common/db.h"
-
-#ifndef _CHAR_H_
-#define _CHAR_H_
-
-#define MAX_MAP_SERVERS 30
-
-#define LAN_CONF_NAME	"conf/lan_support.conf"
-
-#define DEFAULT_AUTOSAVE_INTERVAL 300*1000
-
-struct mmo_map_server
-{
-    long ip;
-    short port;
-    int  users;
-    char map[MAX_MAP_PER_SERVER][16];
-};
-struct itemtmp
-{
-    int  flag;                  //checked = 1 else 0
-    int  id;
-    short nameid;
-    short amount;
-    unsigned short equip;
-    char identify;
-    char refine;
-    char attribute;
-    short card[4];
-    short broken;
-};
-enum
-{
-    TABLE_INVENTORY,
-    TABLE_CART,
-    TABLE_STORAGE,
-    TABLE_GUILD_STORAGE,
-};
-struct itemtemp
-{
-    struct itemtmp equip[MAX_GUILD_STORAGE], notequip[MAX_GUILD_STORAGE];
-};
-int  memitemdata_to_sql (struct itemtemp mapitem, int eqcount, int noteqcount,
-                         int char_id, int tableswitch);
-int  mapif_sendall (unsigned char *buf, unsigned int len);
-int  mapif_sendallwos (int fd, unsigned char *buf, unsigned int len);
-int  mapif_send (int fd, unsigned char *buf, unsigned int len);
-
-extern int autosave_interval;
-extern char char_db[256];
-extern char cart_db[256];
-extern char inventory_db[256];
-extern char charlog_db[256];
-extern char storage_db[256];
-extern char interlog_db[256];
-extern char reg_db[256];
-extern char skill_db[256];
-extern char memo_db[256];
-extern char guild_db[256];
-extern char guild_alliance_db[256];
-extern char guild_castle_db[256];
-extern char guild_expulsion_db[256];
-extern char guild_member_db[256];
-extern char guild_position_db[256];
-extern char guild_skill_db[256];
-extern char guild_storage_db[256];
-extern char party_db[256];
-extern char pet_db[256];
-
-int  db_use_sqldbs;             // added for sql item_db read for char server [Valaris]
-extern char login_db_level[32];
-extern char login_db_account_id[32];
-
-extern int lowest_gm_level;
-
-#endif
-
-#include "inter.h"
-#include "int_pet.h"
-#include "int_guild.h"
-#include "int_party.h"
-#include "int_storage.h"
diff --git a/src/char_sql/int_guild.c b/src/char_sql/int_guild.c
deleted file mode 100644
index 7b363a1..0000000
--- a/src/char_sql/int_guild.c
+++ /dev/null
@@ -1,2111 +0,0 @@
-//
-// original code from athena
-// SQL conversion by hack
-//
-
-#include "char.h"
-#include "strlib.h"
-#include "int_storage.h"
-#include "inter.h"
-#include "int_guild.h"
-#include "int_storage.h"
-#include "mmo.h"
-#include "socket.h"
-
-#include <string.h>
-#include <stdio.h>
-#include <stdlib.h>
-
-static struct guild *guild_pt;
-static struct guild *guild_pt2;
-static struct guild_castle *guildcastle_pt;
-static int guild_newid = 10000;
-
-static int guild_exp[100];
-
-int  mapif_parse_GuildLeave (int fd, int guild_id, int account_id,
-                             int char_id, int flag, const char *mes);
-int  mapif_guild_broken (int guild_id, int flag);
-int  guild_check_empty (struct guild *g);
-int  guild_calcinfo (struct guild *g);
-int  mapif_guild_basicinfochanged (int guild_id, int type, const void *data,
-                                   int len);
-int  mapif_guild_info (int fd, struct guild *g);
-int  guild_break_sub (void *key, void *data, va_list ap);
-
-// Save guild into sql
-int inter_guild_tosql (struct guild *g, int flag)
-{
-    // 1 `guild` (`guild_id`, `name`,`master`,`guild_lv`,`connect_member`,`max_member`,`average_lv`,`exp`,`next_exp`,`skill_point`,`castle_id`,`mes1`,`mes2`,`emblem_len`,`emblem_id`,`emblem_data`)
-    // 2 `guild_member` (`guild_id`,`account_id`,`char_id`,`hair`,`hair_color`,`gender`,`class`,`lv`,`exp`,`exp_payper`,`online`,`position`,`rsv1`,`rsv2`,`name`)
-    // 4 `guild_position` (`guild_id`,`position`,`name`,`mode`,`exp_mode`)
-    // 8 `guild_alliance` (`guild_id`,`opposition`,`alliance_id`,`name`)
-    // 16 `guild_expulsion` (`guild_id`,`name`,`mes`,`acc`,`account_id`,`rsv1`,`rsv2`,`rsv3`) 
-    // 32 `guild_skill` (`guild_id`,`id`,`lv`)
-
-    char t_name[100], t_master[24], t_mes1[60], t_mes2[120], t_member[24], t_position[24], t_alliance[24];  // temporay storage for str convertion;
-    char t_ename[24], t_emes[40];
-    char emblem_data[4096];
-    int  i = 0;
-    int  guild_exist = 0, guild_member = 0, guild_online_member = 0;
-
-    if (g->guild_id <= 0)
-        return -1;
-
-    printf ("(\033[1;35m%d\033[0m)  Request save guild - ", g->guild_id);
-
-    jstrescapecpy (t_name, g->name);
-
-    //printf("- Check if guild %d exists\n",g->guild_id);
-    sprintf (tmp_sql, "SELECT count(*) FROM `%s` WHERE `guild_id`='%d'",
-             guild_db, g->guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `guild`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        sql_row = mysql_fetch_row (sql_res);
-        guild_exist = atoi (sql_row[0]);
-        //printf("- Check if guild %d exists : %s\n",g->guild_id,((guild_exist==0)?"No":"Yes"));
-    }
-    mysql_free_result (sql_res);    //resource free
-
-    if (guild_exist > 0)
-    {
-        // Check members in party
-        sprintf (tmp_sql, "SELECT count(*) FROM `%s` WHERE `guild_id`='%d'",
-                 guild_member_db, g->guild_id);
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-            return -1;
-        }
-        sql_res = mysql_store_result (&mysql_handle);
-        if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-        {
-            sql_row = mysql_fetch_row (sql_res);
-
-            guild_member = atoi (sql_row[0]);
-            //  printf("- Check members in guild %d : %d \n",g->guild_id,guild_member);
-
-        }
-        mysql_free_result (sql_res);    //resource free
-
-        // Delete old guild from sql
-        if (flag & 1 || guild_member == 0)
-        {
-            //  printf("- Delete guild %d from guild\n",g->guild_id);
-            sprintf (tmp_sql, "DELETE FROM `%s` WHERE `guild_id`='%d'",
-                     guild_db, g->guild_id);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (delete `guild`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-        if (flag & 2 || guild_member == 0)
-        {
-            //  printf("- Delete guild %d from guild_member\n",g->guild_id);
-            sprintf (tmp_sql, "DELETE FROM `%s` WHERE `guild_id`='%d'",
-                     guild_member_db, g->guild_id);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (delete `guild_member`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-            sprintf (tmp_sql,
-                     "UPDATE `%s` SET `guild_id`='0' WHERE `guild_id`='%d'",
-                     char_db, g->guild_id);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (update `char`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-        if (flag & 32 || guild_member == 0)
-        {
-            //  printf("- Delete guild %d from guild_skill\n",g->guild_id);
-            sprintf (tmp_sql, "DELETE FROM `%s` WHERE `guild_id`='%d'",
-                     guild_skill_db, g->guild_id);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (delete `guild_skill`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-        if (flag & 4 || guild_member == 0)
-        {
-            //  printf("- Delete guild %d from guild_position\n",g->guild_id);
-            sprintf (tmp_sql, "DELETE FROM `%s` WHERE `guild_id`='%d'",
-                     guild_position_db, g->guild_id);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (delete `guild_position`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-        if (flag & 16 || guild_member == 0)
-        {
-            //  printf("- Delete guild %d from guild_expulsion\n",g->guild_id);
-            sprintf (tmp_sql, "DELETE FROM `%s` WHERE `guild_id`='%d'",
-                     guild_expulsion_db, g->guild_id);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (delete `guild_expulsion`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-        if (flag & 8 || guild_member == 0)
-        {
-            //  printf("- Delete guild %d from guild_alliance\n",g->guild_id);
-            sprintf (tmp_sql,
-                     "DELETE FROM `%s` WHERE `guild_id`='%d' OR `alliance_id`='%d'",
-                     guild_alliance_db, g->guild_id, g->guild_id);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (delete `guild_alliance`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-        if (flag & 2 || guild_member == 0)
-        {
-            //  printf("- Delete guild %d from char\n",g->guild_id);
-            sprintf (tmp_sql,
-                     "UPDATE `%s` SET `guild_id`='0' WHERE `guild_id`='%d'",
-                     char_db, g->guild_id);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (delete `guild_alliance`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-        if (guild_member == 0)
-        {
-            //  printf("- Delete guild %d from guild_castle\n",g->guild_id);
-            sprintf (tmp_sql, "DELETE FROM `%s` WHERE `guild_id`='%d'",
-                     guild_castle_db, g->guild_id);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (delete `guild_castle`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-    }
-
-    guild_online_member = 0;
-    i = 0;
-    while (i < g->max_member)
-    {
-        if (g->member[i].account_id > 0)
-            guild_online_member++;
-        i++;
-    }
-
-    // No member in guild , no need to create it in sql
-    if (guild_member <= 0 && guild_online_member <= 0)
-    {
-        inter_guild_storage_delete (g->guild_id);
-        printf ("No member in guild %d , break it! \n", g->guild_id);
-        return -2;
-    }
-
-    // Insert new guild to sqlserver
-    if (flag & 1 || guild_member == 0)
-    {
-        int  len = 0;
-        //printf("- Insert guild %d to guild\n",g->guild_id);
-        for (i = 0; i < g->emblem_len; i++)
-        {
-            len +=
-                sprintf (emblem_data + len, "%02x",
-                         (unsigned char) (g->emblem_data[i]));
-            //printf("%02x",(unsigned char)(g->emblem_data[i]));
-        }
-        emblem_data[len] = '\0';
-        //printf("- emblem_len = %d \n",g->emblem_len);
-        sprintf (tmp_sql, "INSERT INTO `%s` "
-                 "(`guild_id`, `name`,`master`,`guild_lv`,`connect_member`,`max_member`,`average_lv`,`exp`,`next_exp`,`skill_point`,`castle_id`,`mes1`,`mes2`,`emblem_len`,`emblem_id`,`emblem_data`) "
-                 "VALUES ('%d', '%s', '%s', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%s', '%s', '%d', '%d', '%s')",
-                 guild_db, g->guild_id, t_name, jstrescapecpy (t_master,
-                                                               g->master),
-                 g->guild_lv, g->connect_member, g->max_member, g->average_lv,
-                 g->exp, g->next_exp, g->skill_point, g->castle_id,
-                 jstrescapecpy (t_mes1, g->mes1), jstrescapecpy (t_mes2,
-                                                                 g->mes2),
-                 g->emblem_len, g->emblem_id, emblem_data);
-        //printf(" %s\n",tmp_sql);
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error (insert `guild`)- %s\n",
-                    mysql_error (&mysql_handle));
-        }
-    }
-
-    if (flag & 2 || guild_member == 0)
-    {
-        //printf("- Insert guild %d to guild_member\n",g->guild_id);
-        for (i = 0; i < g->max_member; i++)
-        {
-            if (g->member[i].account_id > 0)
-            {
-                struct guild_member *m = &g->member[i];
-                sprintf (tmp_sql, "DELETE FROM `%s` WHERE `char_id`='%d'",
-                         guild_member_db, m->char_id);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error (delete `guild_member`)- %s\n",
-                            mysql_error (&mysql_handle));
-                }
-                sprintf (tmp_sql, "INSERT INTO `%s` "
-                         "(`guild_id`,`account_id`,`char_id`,`hair`,`hair_color`,`gender`,`class`,`lv`,`exp`,`exp_payper`,`online`,`position`,`rsv1`,`rsv2`,`name`) "
-                         "VALUES ('%d','%d','%d','%d','%d', '%d','%d','%d','%d','%d','%d','%d','%d','%d','%s')",
-                         guild_member_db, g->guild_id,
-                         m->account_id, m->char_id,
-                         m->hair, m->hair_color, m->gender,
-                         m->class, m->lv, m->exp, m->exp_payper, m->online,
-                         m->position, 0, 0, jstrescapecpy (t_member,
-                                                           m->name));
-                //printf(" %s\n",tmp_sql);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error (insert `guild_member`)- %s\n",
-                            mysql_error (&mysql_handle));
-                }
-                sprintf (tmp_sql,
-                         "UPDATE `%s` SET `guild_id`='%d' WHERE `account_id`='%d' AND `char_id`='%d'",
-                         char_db, g->guild_id, m->account_id, m->char_id);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error (update `char`)- %s\n",
-                            mysql_error (&mysql_handle));
-                }
-            }
-        }
-    }
-
-    if (flag & 4 || guild_member == 0)
-    {
-        //printf("- Insert guild %d to guild_position\n",g->guild_id);
-        for (i = 0; i < MAX_GUILDPOSITION; i++)
-        {
-            struct guild_position *p = &g->position[i];
-            sprintf (tmp_sql,
-                     "INSERT INTO `%s` (`guild_id`,`position`,`name`,`mode`,`exp_mode`) VALUES ('%d','%d', '%s','%d','%d')",
-                     guild_position_db, g->guild_id, i,
-                     jstrescapecpy (t_position, p->name), p->mode,
-                     p->exp_mode);
-            //printf(" %s\n",tmp_sql);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (insert `guild_position`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-    }
-
-    if (flag & 8 || guild_member == 0)
-    {
-        //printf("- Insert guild %d to guild_alliance\n",g->guild_id);
-        for (i = 0; i < MAX_GUILDALLIANCE; i++)
-        {
-            struct guild_alliance *a = &g->alliance[i];
-            if (a->guild_id > 0)
-            {
-                sprintf (tmp_sql,
-                         "INSERT INTO `%s` (`guild_id`,`opposition`,`alliance_id`,`name`) "
-                         "VALUES ('%d','%d','%d','%s')", guild_alliance_db,
-                         g->guild_id, a->opposition, a->guild_id,
-                         jstrescapecpy (t_alliance, a->name));
-                //printf(" %s\n",tmp_sql);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error (insert `guild_alliance`)- %s\n",
-                            mysql_error (&mysql_handle));
-                }
-                sprintf (tmp_sql,
-                         "INSERT INTO `%s` (`guild_id`,`opposition`,`alliance_id`,`name`) "
-                         "VALUES ('%d','%d','%d','%s')", guild_alliance_db,
-                         a->guild_id, a->opposition, g->guild_id, t_name);
-                //printf(" %s\n",tmp_sql);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error (insert `guild_alliance`)- %s\n",
-                            mysql_error (&mysql_handle));
-                }
-            }
-        }
-    }
-
-    if (flag & 16 || guild_member == 0)
-    {
-        //printf("- Insert guild %d to guild_expulsion\n",g->guild_id);
-        for (i = 0; i < MAX_GUILDEXPLUSION; i++)
-        {
-            struct guild_explusion *e = &g->explusion[i];
-            if (e->account_id > 0)
-            {
-                sprintf (tmp_sql,
-                         "INSERT INTO `%s` (`guild_id`,`name`,`mes`,`acc`,`account_id`,`rsv1`,`rsv2`,`rsv3`) "
-                         "VALUES ('%d','%s','%s','%s','%d','%d','%d','%d')",
-                         guild_expulsion_db, g->guild_id,
-                         jstrescapecpy (t_ename, e->name),
-                         jstrescapecpy (t_emes, e->mes), e->acc,
-                         e->account_id, e->rsv1, e->rsv2, e->rsv3);
-                //printf(" %s\n",tmp_sql);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf
-                        ("DB server Error (insert `guild_expulsion`)- %s\n",
-                         mysql_error (&mysql_handle));
-                }
-            }
-        }
-    }
-
-    if (flag & 32 || guild_member == 0)
-    {
-        //printf("- Insert guild %d to guild_skill\n",g->guild_id);
-        for (i = 0; i < MAX_GUILDSKILL; i++)
-        {
-            if (g->skill[i].id > 0)
-            {
-                sprintf (tmp_sql,
-                         "INSERT INTO `%s` (`guild_id`,`id`,`lv`) VALUES ('%d','%d','%d')",
-                         guild_skill_db, g->guild_id, g->skill[i].id,
-                         g->skill[i].lv);
-                //printf("%s\n",tmp_sql);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error (insert `guild_skill`)- %s\n",
-                            mysql_error (&mysql_handle));
-                }
-            }
-        }
-    }
-
-    printf ("Save guild done\n");
-    return 0;
-}
-
-// Read guild from sql
-int inter_guild_fromsql (int guild_id, struct guild *g)
-{
-    int  i;
-    char emblem_data[4096];
-    char *pstr;
-
-    if (g == NULL)
-        return 0;
-    memset (g, 0, sizeof (struct guild));
-    if (guild_id == 0)
-        return 0;
-
-//  printf("Retrieve guild information from sql ......\n");
-//  printf("- Read guild %d from sql \n",guild_id);
-
-    sprintf (tmp_sql,
-             "SELECT `guild_id`, `name`,`master`,`guild_lv`,`connect_member`,`max_member`,`average_lv`,`exp`,`next_exp`,`skill_point`,`castle_id`,`mes1`,`mes2`,`emblem_len`,`emblem_id`,`emblem_data` "
-             "FROM `%s` WHERE `guild_id`='%d'", guild_db, guild_id);
-    //printf("  %s\n",tmp_sql);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `guild`)- %s\n",
-                mysql_error (&mysql_handle));
-        return 0;
-    }
-
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        sql_row = mysql_fetch_row (sql_res);
-        if (sql_row == NULL)
-        {
-            mysql_free_result (sql_res);
-            return 0;
-        }
-
-        g->guild_id = atoi (sql_row[0]);
-        strncpy (g->name, sql_row[1], 24);
-        strncpy (g->master, sql_row[2], 24);
-        g->guild_lv = atoi (sql_row[3]);
-        g->connect_member = atoi (sql_row[4]);
-        g->max_member = atoi (sql_row[5]);
-        g->average_lv = atoi (sql_row[6]);
-        g->exp = atoi (sql_row[7]);
-        g->next_exp = atoi (sql_row[8]);
-        g->skill_point = atoi (sql_row[9]);
-        g->castle_id = atoi (sql_row[10]);
-        strncpy (g->mes1, sql_row[11], 60);
-        strncpy (g->mes2, sql_row[12], 120);
-        g->emblem_len = atoi (sql_row[13]);
-        g->emblem_id = atoi (sql_row[14]);
-        strncpy (emblem_data, sql_row[15], 4096);
-        for (i = 0, pstr = emblem_data; i < g->emblem_len; i++, pstr += 2)
-        {
-            int  c1 = pstr[0], c2 = pstr[1], x1 = 0, x2 = 0;
-            if (c1 >= '0' && c1 <= '9')
-                x1 = c1 - '0';
-            if (c1 >= 'a' && c1 <= 'f')
-                x1 = c1 - 'a' + 10;
-            if (c1 >= 'A' && c1 <= 'F')
-                x1 = c1 - 'A' + 10;
-            if (c2 >= '0' && c2 <= '9')
-                x2 = c2 - '0';
-            if (c2 >= 'a' && c2 <= 'f')
-                x2 = c2 - 'a' + 10;
-            if (c2 >= 'A' && c2 <= 'F')
-                x2 = c2 - 'A' + 10;
-            g->emblem_data[i] = (x1 << 4) | x2;
-        }
-    }
-    mysql_free_result (sql_res);
-
-    //printf("- Read guild_member %d from sql \n",guild_id);
-    sprintf (tmp_sql,
-             "SELECT `guild_id`,`account_id`,`char_id`,`hair`,`hair_color`,`gender`,`class`,`lv`,`exp`,`exp_payper`,`online`,`position`,`rsv1`,`rsv2`,`name` "
-             "FROM `%s` WHERE `guild_id`='%d'  ORDER BY `position`",
-             guild_member_db, guild_id);
-    //printf("  %s\n",tmp_sql);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `guild_member`)- %s\n",
-                mysql_error (&mysql_handle));
-        return 0;
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        int  i;
-        for (i = 0;
-             ((sql_row = mysql_fetch_row (sql_res)) && i < g->max_member);
-             i++)
-        {
-            struct guild_member *m = &g->member[i];
-            m->account_id = atoi (sql_row[1]);
-            m->char_id = atoi (sql_row[2]);
-            m->hair = atoi (sql_row[3]);
-            m->hair_color = atoi (sql_row[4]);
-            m->gender = atoi (sql_row[5]);
-            m->class = atoi (sql_row[6]);
-            m->lv = atoi (sql_row[7]);
-            m->exp = atoi (sql_row[8]);
-            m->exp_payper = atoi (sql_row[9]);
-            m->online = atoi (sql_row[10]);
-            m->position = atoi (sql_row[11]);
-            strncpy (m->name, sql_row[14], 24);
-        }
-    }
-    mysql_free_result (sql_res);
-
-    //printf("- Read guild_position %d from sql \n",guild_id);
-    sprintf (tmp_sql,
-             "SELECT `guild_id`,`position`,`name`,`mode`,`exp_mode` FROM `%s` WHERE `guild_id`='%d'",
-             guild_position_db, guild_id);
-    //printf("  %s\n",tmp_sql);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `guild_position`)- %s\n",
-                mysql_error (&mysql_handle));
-        return 0;
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        int  i;
-        for (i = 0;
-             ((sql_row = mysql_fetch_row (sql_res)) && i < MAX_GUILDPOSITION);
-             i++)
-        {
-            int  position = atoi (sql_row[1]);
-            struct guild_position *p = &g->position[position];
-            strncpy (p->name, sql_row[2], 24);
-            p->mode = atoi (sql_row[3]);
-            p->exp_mode = atoi (sql_row[4]);
-        }
-    }
-    mysql_free_result (sql_res);
-
-    //printf("- Read guild_alliance %d from sql \n",guild_id);
-    sprintf (tmp_sql,
-             "SELECT `guild_id`,`opposition`,`alliance_id`,`name` FROM `%s` WHERE `guild_id`='%d'",
-             guild_alliance_db, guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `guild_alliance`)- %s\n",
-                mysql_error (&mysql_handle));
-        return 0;
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        int  i;
-        for (i = 0;
-             ((sql_row = mysql_fetch_row (sql_res)) && i < MAX_GUILDALLIANCE);
-             i++)
-        {
-            struct guild_alliance *a = &g->alliance[i];
-            a->opposition = atoi (sql_row[1]);
-            a->guild_id = atoi (sql_row[2]);
-            strncpy (a->name, sql_row[3], 24);
-        }
-    }
-    mysql_free_result (sql_res);
-
-    //printf("- Read guild_expulsion %d from sql \n",guild_id);
-    sprintf (tmp_sql,
-             "SELECT `guild_id`,`name`,`mes`,`acc`,`account_id`,`rsv1`,`rsv2`,`rsv3` FROM `%s` WHERE `guild_id`='%d'",
-             guild_expulsion_db, guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `guild_expulsion`)- %s\n",
-                mysql_error (&mysql_handle));
-        return 0;
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        int  i;
-        for (i = 0;
-             ((sql_row = mysql_fetch_row (sql_res))
-              && i < MAX_GUILDEXPLUSION); i++)
-        {
-            struct guild_explusion *e = &g->explusion[i];
-
-            strncpy (e->name, sql_row[1], 24);
-            strncpy (e->mes, sql_row[2], 40);
-            strncpy (e->acc, sql_row[3], 24);
-            e->account_id = atoi (sql_row[4]);
-            e->rsv1 = atoi (sql_row[5]);
-            e->rsv2 = atoi (sql_row[6]);
-            e->rsv3 = atoi (sql_row[7]);
-
-        }
-    }
-    mysql_free_result (sql_res);
-
-    //printf("- Read guild_skill %d from sql \n",guild_id);
-    sprintf (tmp_sql,
-             "SELECT `guild_id`,`id`,`lv` FROM `%s` WHERE `guild_id`='%d' ORDER BY `id`",
-             guild_skill_db, guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `guild_skill`)- %s\n",
-                mysql_error (&mysql_handle));
-        return 0;
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        int  i;
-        for (i = 0;
-             ((sql_row = mysql_fetch_row (sql_res)) && i < MAX_GUILDSKILL);
-             i++)
-        {
-            g->skill[i].id = atoi (sql_row[1]);
-            g->skill[i].lv = atoi (sql_row[2]);
-        }
-    }
-    mysql_free_result (sql_res);
-
-//  printf("Successfully retrieve guild information from sql!\n");
-
-    return 0;
-
-}
-
-// Save guild_castle to sql
-int inter_guildcastle_tosql (struct guild_castle *gc)
-{
-    // `guild_castle` (`castle_id`, `guild_id`, `economy`, `defense`, `triggerE`, `triggerD`, `nextTime`, `payTime`, `createTime`, `visibleC`, `visibleG0`, `visibleG1`, `visibleG2`, `visibleG3`, `visibleG4`, `visibleG5`, `visibleG6`, `visibleG7`)
-
-    if (gc == NULL)
-        return 0;
-    //printf("Save to guild_castle\n");
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `castle_id`='%d'",
-             guild_castle_db, gc->castle_id);
-    //printf(" %s\n",tmp_sql);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        return 0;
-    }
-
-    sprintf (tmp_sql, "INSERT INTO `%s` "
-             "(`castle_id`, `guild_id`, `economy`, `defense`, `triggerE`, `triggerD`, `nextTime`, `payTime`, `createTime`,"
-             "`visibleC`, `visibleG0`, `visibleG1`, `visibleG2`, `visibleG3`, `visibleG4`, `visibleG5`, `visibleG6`, `visibleG7`,"
-             "`Ghp0`, `Ghp1`, `Ghp2`, `Ghp3`, `Ghp4`, `Ghp5`, `Ghp6`, `Ghp7`)"
-             "VALUES ('%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d','%d')",
-             guild_castle_db, gc->castle_id, gc->guild_id, gc->economy,
-             gc->defense, gc->triggerE, gc->triggerD, gc->nextTime,
-             gc->payTime, gc->createTime, gc->visibleC, gc->visibleG0,
-             gc->visibleG1, gc->visibleG2, gc->visibleG3, gc->visibleG4,
-             gc->visibleG5, gc->visibleG6, gc->visibleG7, gc->Ghp0, gc->Ghp1,
-             gc->Ghp2, gc->Ghp3, gc->Ghp4, gc->Ghp5, gc->Ghp6, gc->Ghp7);
-    //printf(" %s\n",tmp_sql);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        return 0;
-    }
-
-    sprintf (tmp_sql,
-             "UPDATE `%s` SET `castle_id`='-1' WHERE `castle_id`='%d'",
-             guild_db, gc->castle_id);
-    //printf(" %s\n",tmp_sql);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        return 0;
-    }
-
-    sprintf (tmp_sql,
-             "UPDATE `%s` SET `castle_id`='%d' WHERE `guild_id`='%d'",
-             guild_db, gc->castle_id, gc->guild_id);
-    //printf(" %s\n",tmp_sql);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        return 0;
-    }
-
-    return 0;
-}
-
-// Read guild_castle from sql
-int inter_guildcastle_fromsql (int castle_id, struct guild_castle *gc)
-{
-
-    if (gc == NULL)
-        return 0;
-    //printf("Read from guild_castle\n");
-    memset (gc, 0, sizeof (struct guild_castle));
-    gc->castle_id = castle_id;
-    if (castle_id == -1)
-        return 0;
-    sprintf (tmp_sql,
-             "SELECT `castle_id`, `guild_id`, `economy`, `defense`, `triggerE`, `triggerD`, `nextTime`, `payTime`, `createTime`, "
-             "`visibleC`, `visibleG0`, `visibleG1`, `visibleG2`, `visibleG3`, `visibleG4`, `visibleG5`, `visibleG6`, `visibleG7`,"
-             "`Ghp0`, `Ghp1`, `Ghp2`, `Ghp3`, `Ghp4`, `Ghp5`, `Ghp6`, `Ghp7`"
-             " FROM `%s` WHERE `castle_id`='%d'", guild_castle_db, castle_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        return 0;
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        sql_row = mysql_fetch_row (sql_res);
-        if (sql_row == NULL)
-        {
-            mysql_free_result (sql_res);
-            return 0;
-        }
-
-        gc->guild_id = atoi (sql_row[1]);
-        gc->economy = atoi (sql_row[2]);
-        gc->defense = atoi (sql_row[3]);
-        gc->triggerE = atoi (sql_row[4]);
-        gc->triggerD = atoi (sql_row[5]);
-        gc->nextTime = atoi (sql_row[6]);
-        gc->payTime = atoi (sql_row[7]);
-        gc->createTime = atoi (sql_row[8]);
-        gc->visibleC = atoi (sql_row[9]);
-        gc->visibleG0 = atoi (sql_row[10]);
-        gc->visibleG1 = atoi (sql_row[11]);
-        gc->visibleG2 = atoi (sql_row[12]);
-        gc->visibleG3 = atoi (sql_row[13]);
-        gc->visibleG4 = atoi (sql_row[14]);
-        gc->visibleG5 = atoi (sql_row[15]);
-        gc->visibleG6 = atoi (sql_row[16]);
-        gc->visibleG7 = atoi (sql_row[17]);
-        gc->Ghp0 = atoi (sql_row[18]);
-        gc->Ghp1 = atoi (sql_row[19]);
-        gc->Ghp2 = atoi (sql_row[20]);
-        gc->Ghp3 = atoi (sql_row[21]);
-        gc->Ghp4 = atoi (sql_row[22]);
-        gc->Ghp5 = atoi (sql_row[23]);
-        gc->Ghp6 = atoi (sql_row[24]);
-        gc->Ghp7 = atoi (sql_row[25]);
-
-        //printf("Read Castle %d of guild %d from sql \n",castle_id,gc->guild_id);
-
-    }
-    mysql_free_result (sql_res);    //resource free
-    return 0;
-}
-
-// Read exp_guild.txt
-int inter_guild_readdb ()
-{
-    int  i;
-    FILE *fp;
-    char line[1024];
-    for (i = 0; i < 100; i++)
-        guild_exp[i] = 0;
-
-    fp = fopen_ ("db/exp_guild.txt", "r");
-    if (fp == NULL)
-    {
-        printf ("can't read db/exp_guild.txt\n");
-        return 1;
-    }
-    i = 0;
-    while (fgets (line, 256, fp) && i < 100)
-    {
-        if (line[0] == '/' && line[1] == '/')
-            continue;
-        guild_exp[i] = atoi (line);
-        i++;
-    }
-    fclose_ (fp);
-
-    return 0;
-}
-
-// Initialize guild sql
-int inter_guild_sql_init ()
-{
-    int  i;
-
-    printf ("interserver guild memory initialize.... (%d byte)\n",
-            sizeof (struct guild));
-    guild_pt = calloc (sizeof (struct guild), 1);
-    guild_pt2 = calloc (sizeof (struct guild), 1);
-    guildcastle_pt = calloc (sizeof (struct guild_castle), 1);
-
-    inter_guild_readdb ();      // Read exp
-
-    sprintf (tmp_sql, "UPDATE `%s` SET `online`='0'", guild_member_db);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (update `char`)- %s\n",
-                mysql_error (&mysql_handle));
-        exit (0);
-    }
-
-    sprintf (tmp_sql, "SELECT count(*) FROM `%s`", guild_db);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        exit (0);
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    sql_row = mysql_fetch_row (sql_res);
-    printf ("total guild data -> '%s'.......\n", sql_row[0]);
-    i = atoi (sql_row[0]);
-    mysql_free_result (sql_res);
-
-    if (i > 0)
-    {
-        //set party_newid
-        sprintf (tmp_sql, "SELECT max(`guild_id`) FROM `%s`", guild_db);
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-            exit (0);
-        }
-
-        sql_res = mysql_store_result (&mysql_handle);
-        sql_row = mysql_fetch_row (sql_res);
-        guild_newid = atoi (sql_row[0]) + 1;
-        mysql_free_result (sql_res);
-    }
-
-    printf ("set guild_newid: %d.......\n", guild_newid);
-
-    return 0;
-}
-
-// Get guild by its name
-struct guild *search_guildname (char *str)
-{
-    struct guild *g = guild_pt;
-    char t_name[24];
-    int  guild_id = 0;
-    printf ("search_guildname\n");
-    sprintf (tmp_sql, "SELECT `guild_id` FROM `%s` WHERE `name`='%s'",
-             guild_db, jstrescapecpy (t_name, str));
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        sql_row = mysql_fetch_row (sql_res);
-        guild_id = atoi (sql_row[0]);
-    }
-    mysql_free_result (sql_res);
-    inter_guild_fromsql (guild_id, g);
-    return g;
-}
-
-// Check if guild is empty
-int guild_check_empty (struct guild *g)
-{
-    int  i;
-    for (i = 0; i < g->max_member; i++)
-    {
-        if (g->member[i].account_id > 0)
-        {
-            return 0;
-        }
-    }
-
-    // 
-    mapif_guild_broken (g->guild_id, 0);
-    inter_guild_storage_delete (g->guild_id);
-    inter_guild_tosql (g, 255);
-    memset (g, 0, sizeof (struct guild));
-    return 1;
-}
-
-int guild_nextexp (int level)
-{
-    if (level < 100 && level > 0)   // Change by hack
-        return guild_exp[level - 1];
-
-    return 0;
-}
-
-// 
-int guild_checkskill (struct guild *g, int id)
-{
-    return g->skill[id - 10000].lv;
-}
-
-// 
-int guild_calcinfo (struct guild *g)
-{
-    int  i, c, nextexp;
-    struct guild before = *g;
-
-    // ID
-    for (i = 0; i < 5; i++)
-        g->skill[i].id = i + 10000;
-
-    // 
-    if (g->guild_lv <= 0)
-        g->guild_lv = 1;
-    nextexp = guild_nextexp (g->guild_lv);
-    if (nextexp > 0)
-    {
-        while (g->exp >= nextexp && nextexp > 0)
-        {                       // Change by hack
-            g->exp -= nextexp;
-            g->guild_lv++;
-            g->skill_point++;
-            nextexp = guild_nextexp (g->guild_lv);
-        }
-    }
-
-    // 
-    g->next_exp = guild_nextexp (g->guild_lv);
-
-    // 
-    g->max_member = 100 + guild_checkskill (g, 10004) * 2;   // Updated max_members [PoW]
-
-    // 
-    g->average_lv = 0;
-    g->connect_member = 0;
-    for (i = c = 0; i < g->max_member; i++)
-    {
-        if (g->member[i].account_id > 0)
-        {
-            g->average_lv += g->member[i].lv;
-            c++;
-
-            if (g->member[i].online > 0)
-                g->connect_member++;
-        }
-    }
-    g->average_lv /= c;
-
-    // 
-    if (g->max_member != before.max_member ||
-        g->guild_lv != before.guild_lv ||
-        g->skill_point != before.skill_point)
-    {
-        mapif_guild_info (-1, g);
-        return 1;
-    }
-
-    return 0;
-}
-
-//-------------------------------------------------------------------
-// map server
-
-// 
-int mapif_guild_created (int fd, int account_id, struct guild *g)
-{
-    WFIFOW (fd, 0) = 0x3830;
-    WFIFOL (fd, 2) = account_id;
-    if (g != NULL)
-    {
-        WFIFOL (fd, 6) = g->guild_id;
-        printf ("int_guild: created! %d %s\n", g->guild_id, g->name);
-    }
-    else
-    {
-        WFIFOL (fd, 6) = 0;
-    }
-    WFIFOSET (fd, 10);
-    return 0;
-}
-
-// 
-int mapif_guild_noinfo (int fd, int guild_id)
-{
-    WFIFOW (fd, 0) = 0x3831;
-    WFIFOW (fd, 2) = 8;
-    WFIFOL (fd, 4) = guild_id;
-    WFIFOSET (fd, 8);
-    printf ("int_guild: info not found %d\n", guild_id);
-    return 0;
-}
-
-// 
-int mapif_guild_info (int fd, struct guild *g)
-{
-    unsigned char buf[16384];
-    WBUFW (buf, 0) = 0x3831;
-    memcpy (buf + 4, g, sizeof (struct guild));
-    WBUFW (buf, 2) = 4 + sizeof (struct guild);
-//  printf("int_guild: sizeof(guild)=%d\n",sizeof(struct guild));
-    if (fd < 0)
-        mapif_sendall (buf, WBUFW (buf, 2));
-    else
-        mapif_send (fd, buf, WBUFW (buf, 2));
-//  printf("int_guild: info %d %s\n",p->guild_id,p->name);
-    return 0;
-}
-
-// 
-int mapif_guild_memberadded (int fd, int guild_id, int account_id,
-                             int char_id, int flag)
-{
-    WFIFOW (fd, 0) = 0x3832;
-    WFIFOL (fd, 2) = guild_id;
-    WFIFOL (fd, 6) = account_id;
-    WFIFOL (fd, 10) = char_id;
-    WFIFOB (fd, 14) = flag;
-    WFIFOSET (fd, 15);
-    return 0;
-}
-
-// /
-int mapif_guild_leaved (int guild_id, int account_id, int char_id, int flag,
-                        const char *name, const char *mes)
-{
-    unsigned char buf[128];
-    WBUFW (buf, 0) = 0x3834;
-    WBUFL (buf, 2) = guild_id;
-    WBUFL (buf, 6) = account_id;
-    WBUFL (buf, 10) = char_id;
-    WBUFB (buf, 14) = flag;
-    memcpy (WBUFP (buf, 15), mes, 40);
-    memcpy (WBUFP (buf, 55), name, 24);
-    mapif_sendall (buf, 79);
-    printf ("int_guild: guild leaved %d %d %s %s\n", guild_id, account_id,
-            name, mes);
-    return 0;
-}
-
-// Lv
-int mapif_guild_memberinfoshort (struct guild *g, int idx)
-{
-    unsigned char buf[32];
-    WBUFW (buf, 0) = 0x3835;
-    WBUFL (buf, 2) = g->guild_id;
-    WBUFL (buf, 6) = g->member[idx].account_id;
-    WBUFL (buf, 10) = g->member[idx].char_id;
-    WBUFB (buf, 14) = g->member[idx].online;
-    WBUFW (buf, 15) = g->member[idx].lv;
-    WBUFW (buf, 17) = g->member[idx].class;
-    mapif_sendall (buf, 19);
-    return 0;
-}
-
-// 
-int mapif_guild_broken (int guild_id, int flag)
-{
-    unsigned char buf[16];
-    WBUFW (buf, 0) = 0x3836;
-    WBUFL (buf, 2) = guild_id;
-    WBUFB (buf, 6) = flag;
-    mapif_sendall (buf, 7);
-    printf ("int_guild: broken %d\n", guild_id);
-    return 0;
-}
-
-// 
-int mapif_guild_message (int guild_id, int account_id, char *mes, int len)
-{
-    unsigned char buf[512];
-    WBUFW (buf, 0) = 0x3837;
-    WBUFW (buf, 2) = len + 12;
-    WBUFL (buf, 4) = guild_id;
-    WBUFL (buf, 8) = account_id;
-    memcpy (WBUFP (buf, 12), mes, len);
-    mapif_sendall (buf, len + 12);
-    return 0;
-}
-
-// 
-int mapif_guild_basicinfochanged (int guild_id, int type, const void *data,
-                                  int len)
-{
-    unsigned char buf[2048];
-    WBUFW (buf, 0) = 0x3839;
-    WBUFW (buf, 2) = len + 10;
-    WBUFL (buf, 4) = guild_id;
-    WBUFW (buf, 8) = type;
-    memcpy (WBUFP (buf, 10), data, len);
-    mapif_sendall (buf, len + 10);
-    return 0;
-}
-
-// 
-int mapif_guild_memberinfochanged (int guild_id, int account_id, int char_id,
-                                   int type, const void *data, int len)
-{
-    unsigned char buf[2048];
-    WBUFW (buf, 0) = 0x383a;
-    WBUFW (buf, 2) = len + 18;
-    WBUFL (buf, 4) = guild_id;
-    WBUFL (buf, 8) = account_id;
-    WBUFL (buf, 12) = char_id;
-    WBUFW (buf, 16) = type;
-    memcpy (WBUFP (buf, 18), data, len);
-    mapif_sendall (buf, len + 18);
-    return 0;
-}
-
-// 
-int mapif_guild_skillupack (int guild_id, int skill_num, int account_id)
-{
-    unsigned char buf[16];
-    WBUFW (buf, 0) = 0x383c;
-    WBUFL (buf, 2) = guild_id;
-    WBUFL (buf, 6) = skill_num;
-    WBUFL (buf, 10) = account_id;
-    mapif_sendall (buf, 14);
-    return 0;
-}
-
-// /
-int mapif_guild_alliance (int guild_id1, int guild_id2, int account_id1,
-                          int account_id2, int flag, const char *name1,
-                          const char *name2)
-{
-    unsigned char buf[128];
-    WBUFW (buf, 0) = 0x383d;
-    WBUFL (buf, 2) = guild_id1;
-    WBUFL (buf, 6) = guild_id2;
-    WBUFL (buf, 10) = account_id1;
-    WBUFL (buf, 14) = account_id2;
-    WBUFB (buf, 18) = flag;
-    memcpy (WBUFP (buf, 19), name1, 24);
-    memcpy (WBUFP (buf, 43), name2, 24);
-    mapif_sendall (buf, 67);
-    return 0;
-}
-
-// 
-int mapif_guild_position (struct guild *g, int idx)
-{
-    unsigned char buf[128];
-    WBUFW (buf, 0) = 0x383b;
-    WBUFW (buf, 2) = sizeof (struct guild_position) + 12;
-    WBUFL (buf, 4) = g->guild_id;
-    WBUFL (buf, 8) = idx;
-    memcpy (WBUFP (buf, 12), &g->position[idx],
-            sizeof (struct guild_position));
-    mapif_sendall (buf, WBUFW (buf, 2));
-    return 0;
-}
-
-// 
-int mapif_guild_notice (struct guild *g)
-{
-    unsigned char buf[256];
-    WBUFW (buf, 0) = 0x383e;
-    WBUFL (buf, 2) = g->guild_id;
-    memcpy (WBUFP (buf, 6), g->mes1, 60);
-    memcpy (WBUFP (buf, 66), g->mes2, 120);
-    mapif_sendall (buf, 186);
-    return 0;
-}
-
-// 
-int mapif_guild_emblem (struct guild *g)
-{
-    unsigned char buf[2048];
-    WBUFW (buf, 0) = 0x383f;
-    WBUFW (buf, 2) = g->emblem_len + 12;
-    WBUFL (buf, 4) = g->guild_id;
-    WBUFL (buf, 8) = g->emblem_id;
-    memcpy (WBUFP (buf, 12), g->emblem_data, g->emblem_len);
-    mapif_sendall (buf, WBUFW (buf, 2));
-    return 0;
-}
-
-int mapif_guild_castle_dataload (int castle_id, int index, int value)   // <Agit>
-{
-    unsigned char buf[16];
-    WBUFW (buf, 0) = 0x3840;
-    WBUFW (buf, 2) = castle_id;
-    WBUFB (buf, 4) = index;
-    WBUFL (buf, 5) = value;
-    mapif_sendall (buf, 9);
-    return 0;
-}
-
-int mapif_guild_castle_datasave (int castle_id, int index, int value)   // <Agit>
-{
-    unsigned char buf[16];
-    WBUFW (buf, 0) = 0x3841;
-    WBUFW (buf, 2) = castle_id;
-    WBUFB (buf, 4) = index;
-    WBUFL (buf, 5) = value;
-    mapif_sendall (buf, 9);
-    return 0;
-}
-
-int mapif_guild_castle_alldataload (int fd)
-{
-    struct guild_castle *gc = guildcastle_pt;
-    int  i, len = 4;
-
-    WFIFOW (fd, 0) = 0x3842;
-    sprintf (tmp_sql, "SELECT * FROM `%s` ORDER BY `castle_id`",
-             guild_castle_db);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        for (i = 0;
-             ((sql_row = mysql_fetch_row (sql_res)) && i < MAX_GUILDCASTLE);
-             i++)
-        {
-            memset (gc, 0, sizeof (struct guild_castle));
-            gc->castle_id = atoi (sql_row[0]);
-            gc->guild_id = atoi (sql_row[1]);
-            gc->economy = atoi (sql_row[2]);
-            gc->defense = atoi (sql_row[3]);
-            gc->triggerE = atoi (sql_row[4]);
-            gc->triggerD = atoi (sql_row[5]);
-            gc->nextTime = atoi (sql_row[6]);
-            gc->payTime = atoi (sql_row[7]);
-            gc->createTime = atoi (sql_row[8]);
-            gc->visibleC = atoi (sql_row[9]);
-            gc->visibleG0 = atoi (sql_row[10]);
-            gc->visibleG1 = atoi (sql_row[11]);
-            gc->visibleG2 = atoi (sql_row[12]);
-            gc->visibleG3 = atoi (sql_row[13]);
-            gc->visibleG4 = atoi (sql_row[14]);
-            gc->visibleG5 = atoi (sql_row[15]);
-            gc->visibleG6 = atoi (sql_row[16]);
-            gc->visibleG7 = atoi (sql_row[17]);
-            gc->Ghp0 = atoi (sql_row[18]);
-            gc->Ghp1 = atoi (sql_row[19]);
-            gc->Ghp2 = atoi (sql_row[20]);
-            gc->Ghp3 = atoi (sql_row[21]);
-            gc->Ghp4 = atoi (sql_row[22]);
-            gc->Ghp5 = atoi (sql_row[23]);
-            gc->Ghp6 = atoi (sql_row[24]);
-            gc->Ghp7 = atoi (sql_row[25]);
-            memcpy (WFIFOP (fd, len), gc, sizeof (struct guild_castle));
-            len += sizeof (struct guild_castle);
-        }
-    }
-    mysql_free_result (sql_res);
-    WFIFOW (fd, 2) = len;
-    WFIFOSET (fd, len);
-
-    return 0;
-}
-
-//-------------------------------------------------------------------
-// map server
-
-// 
-int mapif_parse_CreateGuild (int fd, int account_id, char *name,
-                             struct guild_member *master)
-{
-    struct guild *g;
-    int  i;
-
-    printf ("CreateGuild\n");
-    g = search_guildname (name);
-    if (g != NULL && g->guild_id > 0)
-    {
-        printf ("int_guild: same name guild exists [%s]\n", name);
-        mapif_guild_created (fd, account_id, NULL);
-        return 0;
-    }
-    g = guild_pt;
-    memset (g, 0, sizeof (struct guild));
-    g->guild_id = guild_newid++;
-    memcpy (g->name, name, 24);
-    memcpy (g->master, master->name, 24);
-    memcpy (&g->member[0], master, sizeof (struct guild_member));
-
-    g->position[0].mode = 0x11;
-    strcpy (g->position[0].name, "GuildMaster");
-    strcpy (g->position[MAX_GUILDPOSITION - 1].name, "Newbie");
-    for (i = 1; i < MAX_GUILDPOSITION - 1; i++)
-        sprintf (g->position[i].name, "Position %d", i + 1);
-
-    // Initialize guild property
-    g->max_member = 100;
-    g->average_lv = master->lv;
-    g->castle_id = -1;
-    for (i = 0; i < 5; i++)
-        g->skill[i].id = i + 10000;
-
-    // Save to sql
-    printf ("Create initialize OK!\n");
-    i = inter_guild_tosql (g, 255);
-
-    if (i < 0)
-    {
-        mapif_guild_created (fd, account_id, NULL);
-        return 0;
-    }
-
-    // Report to client
-    mapif_guild_created (fd, account_id, g);
-    mapif_guild_info (fd, g);
-
-    inter_log ("guild %s (id=%d) created by master %s (id=%d)" RETCODE,
-               name, g->guild_id, master->name, master->account_id);
-
-    return 0;
-}
-
-// Return guild info to client
-int mapif_parse_GuildInfo (int fd, int guild_id)
-{
-    struct guild *g;
-    g = guild_pt;
-    inter_guild_fromsql (guild_id, g);
-    if (g != NULL && g->guild_id > 0)
-    {
-        guild_calcinfo (g);
-        mapif_guild_info (fd, g);
-        //inter_guild_tosql(g,1); // Change guild
-    }
-    else
-        mapif_guild_noinfo (fd, guild_id);
-    return 0;
-}
-
-// Add member to guild
-int mapif_parse_GuildAddMember (int fd, int guild_id, struct guild_member *m)
-{
-    struct guild *g;
-    int  i;
-    g = guild_pt;
-    inter_guild_fromsql (guild_id, g);
-
-    if (g == NULL || g->guild_id <= 0)
-    {
-        mapif_guild_memberadded (fd, guild_id, m->account_id, m->char_id, 1);
-        return 0;
-    }
-
-    for (i = 0; i < g->max_member; i++)
-    {
-        if (g->member[i].account_id == 0)
-        {
-
-            memcpy (&g->member[i], m, sizeof (struct guild_member));
-            mapif_guild_memberadded (fd, guild_id, m->account_id, m->char_id,
-                                     0);
-            guild_calcinfo (g);
-            mapif_guild_info (-1, g);
-            inter_guild_tosql (g, 3);   // Change guild & guild_member
-            return 0;
-        }
-    }
-    mapif_guild_memberadded (fd, guild_id, m->account_id, m->char_id, 1);
-    //inter_guild_tosql(g,3); // Change guild & guild_member
-    return 0;
-}
-
-// Delete member from guild
-int mapif_parse_GuildLeave (int fd, int guild_id, int account_id, int char_id,
-                            int flag, const char *mes)
-{
-    struct guild *g = NULL;
-    g = guild_pt;
-    inter_guild_fromsql (guild_id, g);
-
-    if (g != NULL && g->guild_id > 0)
-    {
-        int  i;
-        for (i = 0; i < g->max_member; i++)
-        {
-            if (g->member[i].account_id == account_id &&
-                g->member[i].char_id == char_id)
-            {
-                printf ("%d %d\n", i, (int) (&g->member[i]));
-                printf ("%d %s\n", i, g->member[i].name);
-
-                if (flag)
-                {               // 
-                    int  j;
-                    for (j = 0; j < MAX_GUILDEXPLUSION; j++)
-                    {
-                        if (g->explusion[j].account_id == 0)
-                            break;
-                    }
-                    if (j == MAX_GUILDEXPLUSION)
-                    {           // 
-                        for (j = 0; j < MAX_GUILDEXPLUSION - 1; j++)
-                            g->explusion[j] = g->explusion[j + 1];
-                        j = MAX_GUILDEXPLUSION - 1;
-                    }
-                    g->explusion[j].account_id = account_id;
-                    memcpy (g->explusion[j].acc, "dummy", 24);
-                    memcpy (g->explusion[j].name, g->member[i].name, 24);
-                    memcpy (g->explusion[j].mes, mes, 40);
-                }
-
-                mapif_guild_leaved (guild_id, account_id, char_id, flag,
-                                    g->member[i].name, mes);
-                printf ("%d %d\n", i, (int) (&g->member[i]));
-                printf ("%d %s\n", i, (&g->member[i])->name);
-                memset (&g->member[i], 0, sizeof (struct guild_member));
-
-                if (guild_check_empty (g) == 0)
-                    mapif_guild_info (-1, g);   // 
-                /*
-                 * else
-                 * inter_guild_save();  // 
-                 * return 0; */
-            }
-        }
-        guild_calcinfo (g);
-        inter_guild_tosql (g, 19);  // Change guild & guild_member & guild_expulsion
-    }
-    else
-    {
-        sprintf (tmp_sql,
-                 "UPDATE `%s` SET `guild_id`='0' WHERE `account_id`='%d' AND `char_id`='%d'",
-                 char_db, account_id, char_id);
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error (update `char`)- %s\n",
-                    mysql_error (&mysql_handle));
-        }
-        /* mapif_guild_leaved(guild_id,account_id,char_id,flag,g->member[i].name,mes);  */
-    }
-
-    return 0;
-}
-
-// Change member info
-int mapif_parse_GuildChangeMemberInfoShort (int fd, int guild_id,
-                                            int account_id, int char_id,
-                                            int online, int lv, int class)
-{
-    // Could speed up by manipulating only guild_member
-    struct guild *g;
-    int  i, alv, c;
-    g = guild_pt;
-    inter_guild_fromsql (guild_id, g);
-
-    if (g == NULL || g->guild_id <= 0)
-    {
-        return 0;
-    }
-
-    g->connect_member = 0;
-
-    for (i = 0, alv = 0, c = 0; i < g->max_member; i++)
-    {
-        if (g->member[i].account_id == account_id &&
-            g->member[i].char_id == char_id)
-        {
-
-            g->member[i].online = online;
-            g->member[i].lv = lv;
-            g->member[i].class = class;
-            mapif_guild_memberinfoshort (g, i);
-        }
-        if (g->member[i].account_id > 0)
-        {
-            alv += g->member[i].lv;
-            c++;
-        }
-        if (g->member[i].online)
-            g->connect_member++;
-    }
-    // 
-    g->average_lv = alv / c;
-
-    inter_guild_tosql (g, 3);   // Change guild & guild_member
-
-    return 0;
-}
-
-// BreakGuild
-int mapif_parse_BreakGuild (int fd, int guild_id)
-{
-    struct guild *g;
-    g = guild_pt;
-    inter_guild_fromsql (guild_id, g);
-    if (g == NULL)
-    {
-        return 0;
-    }
-
-    // Delete guild from sql
-    //printf("- Delete guild %d from guild\n",guild_id);
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `guild_id`='%d'", guild_db,
-             guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `guild`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    //printf("- Delete guild %d from guild_member\n",guild_id);
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `guild_id`='%d'",
-             guild_member_db, guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `guild_member`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    //printf("- Delete guild %d from guild_skill\n",guild_id);
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `guild_id`='%d'",
-             guild_skill_db, guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `guild_skill`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    //printf("- Delete guild %d from guild_position\n",guild_id);
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `guild_id`='%d'",
-             guild_position_db, guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `guild_position`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    //printf("- Delete guild %d from guild_expulsion\n",guild_id);
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `guild_id`='%d'",
-             guild_expulsion_db, guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `guild_expulsion`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    //printf("- Delete guild %d from guild_alliance\n",guild_id);
-    sprintf (tmp_sql,
-             "DELETE FROM `%s` WHERE `guild_id`='%d' OR `alliance_id`='%d'",
-             guild_alliance_db, guild_id, guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `guild_position`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    //printf("- Delete guild %d from guild_castle\n",guild_id);
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `guild_id`='%d'",
-             guild_castle_db, guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `guild_position`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    //printf("- Update guild %d of char\n",guild_id);
-    sprintf (tmp_sql, "UPDATE `%s` SET `guild_id`='0' WHERE `guild_id`='%d'",
-             char_db, guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `guild_position`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    inter_guild_storage_delete (guild_id);
-    mapif_guild_broken (guild_id, 0);
-
-    inter_log ("guild %s (id=%d) broken" RETCODE, g->name, guild_id);
-
-    return 0;
-}
-
-// 
-int mapif_parse_GuildMessage (int fd, int guild_id, int account_id, char *mes,
-                              int len)
-{
-    return mapif_guild_message (guild_id, account_id, mes, len);
-}
-
-// 
-int mapif_parse_GuildBasicInfoChange (int fd, int guild_id,
-                                      int type, const char *data, int len)
-{
-    struct guild *g;
-//  int dd=*((int *)data);
-    short dw = *((short *) data);
-    g = guild_pt;
-    inter_guild_fromsql (guild_id, g);
-
-    if (g == NULL || g->guild_id <= 0)
-    {
-        return 0;
-    }
-    switch (type)
-    {
-        case GBI_GUILDLV:
-        {
-            printf ("GBI_GUILDLV\n");
-            if (dw > 0 && g->guild_lv + dw <= 50)
-            {
-                g->guild_lv += dw;
-                g->skill_point += dw;
-            }
-            else if (dw < 0 && g->guild_lv + dw >= 1)
-                g->guild_lv += dw;
-            mapif_guild_info (-1, g);
-            inter_guild_tosql (g, 1);
-        }
-            return 0;
-        default:
-            printf ("int_guild: GuildBasicInfoChange: Unknown type %d\n",
-                    type);
-            break;
-    }
-    mapif_guild_basicinfochanged (guild_id, type, data, len);
-    //inter_guild_tosql(g,1); // Change guild
-    return 0;
-}
-
-// 
-int mapif_parse_GuildMemberInfoChange (int fd, int guild_id, int account_id,
-                                       int char_id, int type,
-                                       const char *data, int len)
-{
-    // Could make some improvement in speed, because only change guild_member
-    int  i;
-    struct guild *g;
-    g = guild_pt;
-    inter_guild_fromsql (guild_id, g);
-    //printf("GuildMemberInfoChange %s \n",(type==GMI_EXP)?"GMI_EXP":"OTHER");
-
-    if (g == NULL)
-    {
-        return 0;
-    }
-    for (i = 0; i < g->max_member; i++)
-        if (g->member[i].account_id == account_id &&
-            g->member[i].char_id == char_id)
-            break;
-    if (i == g->max_member)
-    {
-        printf ("int_guild: GuildMemberChange: Not found %d,%d in %d[%s]\n",
-                account_id, char_id, guild_id, g->name);
-        return 0;
-    }
-    switch (type)
-    {
-        case GMI_POSITION:     // 
-            g->member[i].position = *((int *) data);
-            break;
-        case GMI_EXP:
-        {                       // EXP
-            int  exp, oldexp = g->member[i].exp;
-            exp = g->member[i].exp = *((unsigned int *) data);
-            g->exp += (exp - oldexp);
-            guild_calcinfo (g); // Lv
-            mapif_guild_basicinfochanged (guild_id, GBI_EXP, &g->exp, 4);
-        } break;
-        default:
-            printf ("int_guild: GuildMemberInfoChange: Unknown type %d\n",
-                    type);
-            break;
-    }
-    mapif_guild_memberinfochanged (guild_id, account_id, char_id, type, data,
-                                   len);
-    inter_guild_tosql (g, 3);   // Change guild & guild_member
-    return 0;
-}
-
-// 
-int mapif_parse_GuildPosition (int fd, int guild_id, int idx,
-                               struct guild_position *p)
-{
-    // Could make some improvement in speed, because only change guild_position
-    struct guild *g;
-    g = guild_pt;
-    inter_guild_fromsql (guild_id, g);
-
-    if (g == NULL || idx < 0 || idx >= MAX_GUILDPOSITION)
-    {
-        return 0;
-    }
-    memcpy (&g->position[idx], p, sizeof (struct guild_position));
-    mapif_guild_position (g, idx);
-    printf ("int_guild: position changed %d\n", idx);
-    inter_guild_tosql (g, 4);   // Change guild_position
-    return 0;
-}
-
-// 
-int mapif_parse_GuildSkillUp (int fd, int guild_id, int skill_num,
-                              int account_id)
-{
-    // Could make some improvement in speed, because only change guild_position
-    struct guild *g;
-    g = guild_pt;
-    inter_guild_fromsql (guild_id, g);
-    int  idx = skill_num - 10000;
-    if (g == NULL || skill_num < 10000)
-        return 0;
-    //printf("GuildSkillUp\n");
-
-    if (g->skill_point > 0 && g->skill[idx].id > 0 && g->skill[idx].lv < 10)
-    {
-        g->skill[idx].lv++;
-        g->skill_point--;
-        if (guild_calcinfo (g) == 0)
-            mapif_guild_info (-1, g);
-        mapif_guild_skillupack (guild_id, skill_num, account_id);
-        printf ("int_guild: skill %d up\n", skill_num);
-        inter_guild_tosql (g, 33);  // Change guild & guild_skill
-    }
-
-    return 0;
-}
-
-// 
-int mapif_parse_GuildAlliance (int fd, int guild_id1, int guild_id2,
-                               int account_id1, int account_id2, int flag)
-{
-    // Could speed up
-    struct guild *g[2];
-    int  j, i;
-    g[0] = guild_pt;
-    g[1] = guild_pt2;
-    inter_guild_fromsql (guild_id1, g[0]);
-    inter_guild_fromsql (guild_id2, g[1]);
-
-    if (g[0] == NULL || g[1] == NULL || g[0]->guild_id == 0
-        || g[1]->guild_id == 0)
-        return 0;
-
-    if (!(flag & 0x8))
-    {
-        for (i = 0; i < 2 - (flag & 1); i++)
-        {
-            for (j = 0; j < MAX_GUILDALLIANCE; j++)
-                if (g[i]->alliance[j].guild_id == 0)
-                {
-                    g[i]->alliance[j].guild_id = g[1 - i]->guild_id;
-                    memcpy (g[i]->alliance[j].name, g[1 - i]->name, 24);
-                    g[i]->alliance[j].opposition = flag & 1;
-                    break;
-                }
-        }
-    }
-    else
-    {                           // 
-        for (i = 0; i < 2 - (flag & 1); i++)
-        {
-            for (j = 0; j < MAX_GUILDALLIANCE; j++)
-                if (g[i]->alliance[j].guild_id == g[1 - i]->guild_id &&
-                    g[i]->alliance[j].opposition == (flag & 1))
-                {
-                    g[i]->alliance[j].guild_id = 0;
-                    break;
-                }
-        }
-    }
-    mapif_guild_alliance (guild_id1, guild_id2, account_id1, account_id2,
-                          flag, g[0]->name, g[1]->name);
-    inter_guild_tosql (g[0], 8);    // Change guild_alliance
-    inter_guild_tosql (g[1], 8);    // Change guild_alliance
-    return 0;
-}
-
-// 
-int mapif_parse_GuildNotice (int fd, int guild_id, const char *mes1,
-                             const char *mes2)
-{
-    struct guild *g;
-    g = guild_pt;
-    inter_guild_fromsql (guild_id, g);
-
-    if (g == NULL || g->guild_id <= 0)
-        return 0;
-    memcpy (g->mes1, mes1, 60);
-    memcpy (g->mes2, mes2, 120);
-    inter_guild_tosql (g, 1);   // Change mes of guild
-    return mapif_guild_notice (g);
-}
-
-// 
-int mapif_parse_GuildEmblem (int fd, int len, int guild_id, int dummy,
-                             const char *data)
-{
-    struct guild *g;
-    g = guild_pt;
-    inter_guild_fromsql (guild_id, g);
-
-    if (g == NULL || g->guild_id <= 0)
-        return 0;
-    memcpy (g->emblem_data, data, len);
-    g->emblem_len = len;
-    g->emblem_id++;
-    inter_guild_tosql (g, 1);   // Change guild
-    return mapif_guild_emblem (g);
-}
-
-int mapif_parse_GuildCastleDataLoad (int fd, int castle_id, int index)  // <Agit>
-{
-    struct guild_castle *gc = guildcastle_pt;
-    inter_guildcastle_fromsql (castle_id, gc);
-    if (gc == NULL || gc->castle_id == -1)
-    {
-        return mapif_guild_castle_dataload (castle_id, 0, 0);
-    }
-    switch (index)
-    {
-        case 1:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->guild_id);
-            break;
-        case 2:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->economy);
-            break;
-        case 3:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->defense);
-            break;
-        case 4:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->triggerE);
-            break;
-        case 5:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->triggerD);
-            break;
-        case 6:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->nextTime);
-            break;
-        case 7:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->payTime);
-            break;
-        case 8:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->createTime);
-            break;
-        case 9:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->visibleC);
-            break;
-        case 10:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->visibleG0);
-            break;
-        case 11:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->visibleG1);
-            break;
-        case 12:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->visibleG2);
-            break;
-        case 13:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->visibleG3);
-            break;
-        case 14:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->visibleG4);
-            break;
-        case 15:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->visibleG5);
-            break;
-        case 16:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->visibleG6);
-            break;
-        case 17:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->visibleG7);
-            break;
-        case 18:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->Ghp0);
-            break;              // guardian HP [Valaris]
-        case 19:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->Ghp1);
-            break;
-        case 20:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->Ghp2);
-            break;
-        case 21:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->Ghp3);
-            break;
-        case 22:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->Ghp4);
-            break;
-        case 23:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->Ghp5);
-            break;
-        case 24:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->Ghp6);
-            break;
-        case 25:
-            return mapif_guild_castle_dataload (gc->castle_id, index,
-                                                gc->Ghp7);
-            break;              // end additions [Valaris]
-        default:
-            printf
-                ("mapif_parse_GuildCastleDataLoad ERROR!! (Not found index=%d)\n",
-                 index);
-            return 0;
-    }
-}
-
-int mapif_parse_GuildCastleDataSave (int fd, int castle_id, int index, int value)   // <Agit>
-{
-    struct guild_castle *gc = guildcastle_pt;
-    inter_guildcastle_fromsql (castle_id, gc);
-    if (gc == NULL || gc->castle_id == -1)
-    {
-        return mapif_guild_castle_datasave (castle_id, index, value);
-    }
-    switch (index)
-    {
-        case 1:
-            if (gc->guild_id != value)
-            {
-                int  gid = (value) ? value : gc->guild_id;
-                struct guild *g = guild_pt;
-                inter_guild_fromsql (gid, g);
-                inter_log ("guild %s (id=%d) %s castle id=%d" RETCODE,
-                           (g) ? g->name : "??", gid,
-                           (value) ? "occupy" : "abandon", index);
-            }
-            gc->guild_id = value;
-            break;
-        case 2:
-            gc->economy = value;
-            break;
-        case 3:
-            gc->defense = value;
-            break;
-        case 4:
-            gc->triggerE = value;
-            break;
-        case 5:
-            gc->triggerD = value;
-            break;
-        case 6:
-            gc->nextTime = value;
-            break;
-        case 7:
-            gc->payTime = value;
-            break;
-        case 8:
-            gc->createTime = value;
-            break;
-        case 9:
-            gc->visibleC = value;
-            break;
-        case 10:
-            gc->visibleG0 = value;
-            break;
-        case 11:
-            gc->visibleG1 = value;
-            break;
-        case 12:
-            gc->visibleG2 = value;
-            break;
-        case 13:
-            gc->visibleG3 = value;
-            break;
-        case 14:
-            gc->visibleG4 = value;
-            break;
-        case 15:
-            gc->visibleG5 = value;
-            break;
-        case 16:
-            gc->visibleG6 = value;
-            break;
-        case 17:
-            gc->visibleG7 = value;
-            break;
-        case 18:
-            gc->Ghp0 = value;
-            break;              // guardian HP [Valaris]
-        case 19:
-            gc->Ghp1 = value;
-            break;
-        case 20:
-            gc->Ghp2 = value;
-            break;
-        case 21:
-            gc->Ghp3 = value;
-            break;
-        case 22:
-            gc->Ghp4 = value;
-            break;
-        case 23:
-            gc->Ghp5 = value;
-            break;
-        case 24:
-            gc->Ghp6 = value;
-            break;
-        case 25:
-            gc->Ghp7 = value;
-            break;              // end additions [Valaris]
-        default:
-            printf
-                ("mapif_parse_GuildCastleDataSave ERROR!! (Not found index=%d)\n",
-                 index);
-            return 0;
-    }
-    inter_guildcastle_tosql (gc);
-    return mapif_guild_castle_datasave (gc->castle_id, index, value);
-}
-
-// 
-int mapif_parse_GuildCheck (int fd, int guild_id, int account_id, int char_id)
-{
-    // What does this mean? Check if belong to another guild?
-    return 0;
-}
-
-// map server 
-// 
-// inter.c
-// RFIFOSKIP
-// 0(false)1(true)
-int inter_guild_parse_frommap (int fd)
-{
-    switch (RFIFOW (fd, 0))
-    {
-        case 0x3030:
-            mapif_parse_CreateGuild (fd, RFIFOL (fd, 4), RFIFOP (fd, 8),
-                                     (struct guild_member *) RFIFOP (fd, 32));
-            break;
-        case 0x3031:
-            mapif_parse_GuildInfo (fd, RFIFOL (fd, 2));
-            break;
-        case 0x3032:
-            mapif_parse_GuildAddMember (fd, RFIFOL (fd, 4),
-                                        (struct guild_member *) RFIFOP (fd,
-                                                                        8));
-            break;
-        case 0x3034:
-            mapif_parse_GuildLeave (fd, RFIFOL (fd, 2), RFIFOL (fd, 6),
-                                    RFIFOL (fd, 10), RFIFOB (fd, 14),
-                                    RFIFOP (fd, 15));
-            break;
-        case 0x3035:
-            mapif_parse_GuildChangeMemberInfoShort (fd, RFIFOL (fd, 2),
-                                                    RFIFOL (fd, 6),
-                                                    RFIFOL (fd, 10),
-                                                    RFIFOB (fd, 14),
-                                                    RFIFOW (fd, 15),
-                                                    RFIFOW (fd, 17));
-            break;
-        case 0x3036:
-            mapif_parse_BreakGuild (fd, RFIFOL (fd, 2));
-            break;
-        case 0x3037:
-            mapif_parse_GuildMessage (fd, RFIFOL (fd, 4), RFIFOL (fd, 8),
-                                      RFIFOP (fd, 12), RFIFOW (fd, 2) - 12);
-            break;
-        case 0x3038:
-            mapif_parse_GuildCheck (fd, RFIFOL (fd, 2), RFIFOL (fd, 6),
-                                    RFIFOL (fd, 10));
-            break;
-        case 0x3039:
-            mapif_parse_GuildBasicInfoChange (fd, RFIFOL (fd, 4),
-                                              RFIFOW (fd, 8), RFIFOP (fd, 10),
-                                              RFIFOW (fd, 2) - 10);
-            break;
-        case 0x303A:
-            mapif_parse_GuildMemberInfoChange (fd, RFIFOL (fd, 4),
-                                               RFIFOL (fd, 8), RFIFOL (fd,
-                                                                       12),
-                                               RFIFOW (fd, 16), RFIFOP (fd,
-                                                                        18),
-                                               RFIFOW (fd, 2) - 18);
-            break;
-        case 0x303B:
-            mapif_parse_GuildPosition (fd, RFIFOL (fd, 4), RFIFOL (fd, 8),
-                                       (struct guild_position *) RFIFOP (fd,
-                                                                         12));
-            break;
-        case 0x303C:
-            mapif_parse_GuildSkillUp (fd, RFIFOL (fd, 2), RFIFOL (fd, 6),
-                                      RFIFOL (fd, 10));
-            break;
-        case 0x303D:
-            mapif_parse_GuildAlliance (fd, RFIFOL (fd, 2), RFIFOL (fd, 6),
-                                       RFIFOL (fd, 10), RFIFOL (fd, 14),
-                                       RFIFOB (fd, 18));
-            break;
-        case 0x303E:
-            mapif_parse_GuildNotice (fd, RFIFOL (fd, 2), RFIFOP (fd, 6),
-                                     RFIFOP (fd, 66));
-            break;
-        case 0x303F:
-            mapif_parse_GuildEmblem (fd, RFIFOW (fd, 2) - 12, RFIFOL (fd, 4),
-                                     RFIFOL (fd, 8), RFIFOP (fd, 12));
-            break;
-        case 0x3040:
-            mapif_parse_GuildCastleDataLoad (fd, RFIFOW (fd, 2),
-                                             RFIFOB (fd, 4));
-            break;
-        case 0x3041:
-            mapif_parse_GuildCastleDataSave (fd, RFIFOW (fd, 2),
-                                             RFIFOB (fd, 4), RFIFOL (fd, 5));
-            break;
-
-        default:
-            return 0;
-    }
-    return 1;
-}
-
-int inter_guild_mapif_init (int fd)
-{
-    return mapif_guild_castle_alldataload (fd);
-}
-
-// 
-int inter_guild_leave (int guild_id, int account_id, int char_id)
-{
-    return mapif_parse_GuildLeave (-1, guild_id, account_id, char_id, 0,
-                                   "****");
-}
diff --git a/src/char_sql/int_guild.h b/src/char_sql/int_guild.h
deleted file mode 100644
index 9fa439c..0000000
--- a/src/char_sql/int_guild.h
+++ /dev/null
@@ -1,10 +0,0 @@
-#ifndef _INT_GUILD_H_
-#define _INT_GUILD_H_
-
-int  inter_guild_parse_frommap (int fd);
-int  inter_guild_sql_init ();
-int  inter_guild_mapif_init (int fd);
-
-int  inter_guild_leave (int guild_id, int account_id, int char_id);
-
-#endif
diff --git a/src/char_sql/int_party.c b/src/char_sql/int_party.c
deleted file mode 100644
index 45237de..0000000
--- a/src/char_sql/int_party.c
+++ /dev/null
@@ -1,935 +0,0 @@
-//
-// original code from athena
-// SQL conversion by hack
-//
-
-#include "char.h"
-#include "strlib.h"
-#include "socket.h"
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-
-static struct party *party_pt;
-static int party_newid = 100;
-
-int  mapif_party_broken (int party_id, int flag);
-int  party_check_empty (struct party *p);
-int  mapif_parse_PartyLeave (int fd, int party_id, int account_id);
-
-// Save party to mysql
-int inter_party_tosql (int party_id, struct party *p)
-{
-    // 'party' ('party_id','name','exp','item','leader')
-
-    char t_name[100];
-    char t_member[24];
-    int  party_member = 0, party_online_member = 0;
-    int  party_exist = 0;
-    int  leader_id = 0;
-    int  i = 0;
-
-    printf ("(\033[1;64m%d\033[0m)    Request save party - ", party_id);
-
-    jstrescapecpy (t_name, p->name);
-
-    if (p == NULL || party_id == 0 || p->party_id == 0
-        || party_id != p->party_id)
-    {
-        printf ("- Party pointer or party_id error \n");
-        return 0;
-    }
-
-    // Check if party exists    
-    sprintf (tmp_sql, "SELECT count(*) FROM `%s` WHERE `party_id`='%d'",
-             party_db, party_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        return 0;
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        sql_row = mysql_fetch_row (sql_res);
-        party_exist = atoi (sql_row[0]);
-        //printf("- Check if party %d exists : %s\n",party_id,party_exist==0?"No":"Yes");
-    }
-    mysql_free_result (sql_res);    //resource free
-
-    if (party_exist > 0)
-    {
-        // Check members in party
-        sprintf (tmp_sql, "SELECT count(*) FROM `%s` WHERE `party_id`='%d'",
-                 char_db, party_id);
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-            return 0;
-        }
-        sql_res = mysql_store_result (&mysql_handle);
-        if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-        {
-            sql_row = mysql_fetch_row (sql_res);
-
-            party_member = atoi (sql_row[0]);
-            //  printf("- Check members in party %d : %d \n",party_id,party_member);
-
-        }
-        mysql_free_result (sql_res);    //resource free
-
-        party_online_member = 0;
-        i = 0;
-        while (i < MAX_PARTY)
-        {
-            if (p->member[i].account_id > 0)
-                party_online_member++;
-            i++;
-        }
-
-        //if (party_online_member==0) printf("- No member online \n"); else printf("- Some member %d online \n", party_online_member);
-
-        if (party_member <= 0 && party_online_member == 0)
-        {
-
-            // Delete the party, if has no member.
-            sprintf (tmp_sql, "DELETE FROM `%s` WHERE `party_id`='%d'",
-                     party_db, party_id);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error - %s\n",
-                        mysql_error (&mysql_handle));
-            }
-            //  printf("No member in party %d, break it \n",party_id);
-            memset (p, 0, sizeof (struct party));
-            return 0;
-        }
-        else
-        {
-            // Update party information, if exists
-
-            int  i = 0;
-
-            for (i = 0; i < MAX_PARTY; i++)
-            {
-
-                if (p->member[i].account_id > 0)
-                {
-                    sprintf (tmp_sql,
-                             "UPDATE `%s` SET `party_id`='%d', `online`='%d' WHERE `account_id`='%d' AND `name`='%s'",
-                             char_db, party_id, p->member[i].online,
-                             p->member[i].account_id, jstrescapecpy (t_member,
-                                                                     p->member
-                                                                     [i].name));
-                    //printf("%s",tmp_sql);
-                    if (mysql_query (&mysql_handle, tmp_sql))
-                    {
-                        printf ("DB server Error (update `char`)- %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-                }
-            }
-
-            sprintf (tmp_sql,
-                     "UPDATE `%s` SET `name`='%s', `exp`='%d', `item`='%d', `leader_id`=`leader_id` WHERE `party_id`='%d'",
-                     party_db, t_name, p->exp, p->item, party_id);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (inset/update `party`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-
-            //  printf("- Update party %d information \n",party_id);
-        }
-    }
-    else
-    {
-        // Add new party, if not exist
-        int  i = 0;
-        while (i < MAX_PARTY
-               && ((p->member[i].account_id > 0 && p->member[i].leader == 0)
-                   || (p->member[i].account_id < 0)))
-            i++;
-        if (i < MAX_PARTY)
-            leader_id = p->member[i].account_id;
-        sprintf (tmp_sql,
-                 "INSERT INTO `%s`  (`party_id`, `name`, `exp`, `item`, `leader_id`) VALUES ('%d', '%s', '%d', '%d', '%d')",
-                 party_db, party_id, t_name, p->exp, p->item, leader_id);
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error (inset/update `party`)- %s\n",
-                    mysql_error (&mysql_handle));
-            return 0;
-        }
-
-        sprintf (tmp_sql,
-                 "UPDATE `%s` SET `party_id`='%d', `online`='1'  WHERE `account_id`='%d' AND `name`='%s'",
-                 char_db, party_id, leader_id, jstrescapecpy (t_member,
-                                                              p->
-                                                              member
-                                                              [i].name));
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error (inset/update `party`)- %s\n",
-                    mysql_error (&mysql_handle));
-        }
-
-        //printf("- Insert new party %d  \n",party_id); 
-    }
-
-    printf ("Party save success\n");
-    return 0;
-
-}
-
-// Read party from mysql
-int inter_party_fromsql (int party_id, struct party *p)
-{
-    int  leader_id = 0;
-    printf ("(\033[1;64m%d\033[0m)    Request load party - ", party_id);
-
-    memset (p, 0, sizeof (struct party));
-
-    sprintf (tmp_sql,
-             "SELECT `party_id`, `name`,`exp`,`item`, `leader_id` FROM `%s` WHERE `party_id`='%d'",
-             party_db, party_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `party`)- %s\n",
-                mysql_error (&mysql_handle));
-        return 0;
-    }
-
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        sql_row = mysql_fetch_row (sql_res);
-        //  printf("- Read party %d from MySQL\n",party_id);
-        p->party_id = party_id;
-        strcpy (p->name, sql_row[1]);
-        p->exp = atoi (sql_row[2]);
-        p->item = atoi (sql_row[3]);
-        leader_id = atoi (sql_row[4]);
-    }
-    else
-    {
-        mysql_free_result (sql_res);
-        //  printf("- Cannot find party %d \n",party_id);
-        return 0;
-    }
-
-    mysql_free_result (sql_res);
-
-    // Load members
-    sprintf (tmp_sql,
-             "SELECT `account_id`, `name`,`base_level`,`last_map`,`online` FROM `%s` WHERE `party_id`='%d'",
-             char_db, party_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `party`)- %s\n",
-                mysql_error (&mysql_handle));
-        return 0;
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        int  i;
-        for (i = 0; (sql_row = mysql_fetch_row (sql_res)); i++)
-        {
-            struct party_member *m = &p->member[i];
-            m->account_id = atoi (sql_row[0]);
-            if (m->account_id == leader_id)
-                m->leader = 1;
-            else
-                m->leader = 0;
-            strncpy (m->name, sql_row[1], sizeof (m->name));
-            m->lv = atoi (sql_row[2]);
-            strncpy (m->map, sql_row[3], sizeof (m->map));
-            m->online = atoi (sql_row[4]);
-        }
-        //  printf("- %d members found in party %d \n",i,party_id);
-    }
-    mysql_free_result (sql_res);
-
-    printf ("Party load success\n");
-    return 0;
-
-}
-
-int inter_party_sql_init ()
-{
-    int  i;
-
-    //memory alloc
-    printf ("interserver party memory initialize.... (%d byte)\n",
-            sizeof (struct party));
-    party_pt = calloc (sizeof (struct party), 1);
-
-    sprintf (tmp_sql, "UPDATE `%s` SET `online`='0'", char_db);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (update `char`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    sprintf (tmp_sql, "SELECT count(*) FROM `%s`", party_db);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    sql_row = mysql_fetch_row (sql_res);
-    printf ("total party data -> '%s'.......\n", sql_row[0]);
-    i = atoi (sql_row[0]);
-    mysql_free_result (sql_res);
-
-    if (i > 0)
-    {
-        //set party_newid
-        sprintf (tmp_sql, "SELECT max(`party_id`) FROM `%s`", party_db);
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        }
-
-        sql_res = mysql_store_result (&mysql_handle);
-
-        sql_row = mysql_fetch_row (sql_res);
-        party_newid = atoi (sql_row[0]) + 1;
-        mysql_free_result (sql_res);
-    }
-
-    printf ("set party_newid: %d.......\n", party_newid);
-
-    return 0;
-}
-
-// Search for the party according to its name
-struct party *search_partyname (char *str)
-{
-    struct party *p = NULL;
-    int  leader_id = 0;
-    char t_name[24];
-
-    sprintf (tmp_sql,
-             "SELECT `party_id`, `name`,`exp`,`item`,`leader_id` FROM `%s` WHERE `name`='%s'",
-             party_db, jstrescapecpy (t_name, str));
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `party`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res == NULL || mysql_num_rows (sql_res) <= 0)
-    {
-        mysql_free_result (sql_res);
-        return p;
-    }
-    sql_row = mysql_fetch_row (sql_res);
-    p = party_pt;
-    p->party_id = atoi (sql_row[0]);
-    strcpy (p->name, sql_row[1]);
-    p->exp = atoi (sql_row[2]);
-    p->item = atoi (sql_row[3]);
-    leader_id = atoi (sql_row[4]);
-    mysql_free_result (sql_res);
-
-    // Load members
-    sprintf (tmp_sql,
-             "SELECT `account_id`, `name`,`base_level`,`last_map`,`online` FROM `%s` WHERE `party_id`='%d'",
-             char_db, p->party_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `party`)- %s\n",
-                mysql_error (&mysql_handle));
-        return 0;
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        int  i;
-        for (i = 0; (sql_row = mysql_fetch_row (sql_res)); i++)
-        {
-            struct party_member *m = &p->member[i];
-            m->account_id = atoi (sql_row[0]);
-            if (m->account_id == leader_id)
-                m->leader = 1;
-            else
-                m->leader = 0;
-            strncpy (m->name, sql_row[1], sizeof (m->name));
-            m->lv = atoi (sql_row[2]);
-            strncpy (m->map, sql_row[3], sizeof (m->map));
-            m->online = atoi (sql_row[4]);
-        }
-        printf ("- %d members found in party %d \n", i, p->party_id);
-    }
-    mysql_free_result (sql_res);
-
-    return p;
-}
-
-// EXP
-int party_check_exp_share (struct party *p)
-{
-    int  i;
-    int  maxlv = 0, minlv = 0x7fffffff;
-    for (i = 0; i < MAX_PARTY; i++)
-    {
-        int  lv = p->member[i].lv;
-        if (p->member[i].online)
-        {
-            if (lv < minlv)
-                minlv = lv;
-            if (maxlv < lv)
-                maxlv = lv;
-        }
-    }
-    return (maxlv == 0 || maxlv - minlv <= party_share_level);
-}
-
-// Is there any member in the party?
-int party_check_empty (struct party *p)
-{
-    int  i;
-    if (p == NULL || p->party_id == 0)
-        return 1;
-//  printf("party check empty %08X\n",(int)p);
-    for (i = 0; i < MAX_PARTY; i++)
-    {
-//      printf("%d acc=%d\n",i,p->member[i].account_id);
-        if (p->member[i].account_id > 0)
-        {
-            return 0;
-        }
-    }
-    // If there is no member, then break the party
-    mapif_party_broken (p->party_id, 0);
-    inter_party_tosql (p->party_id, p);
-    return 1;
-}
-
-// Check if a member is in two party, not necessary :)
-int party_check_conflict (int party_id, int account_id, char *nick)
-{
-    return 0;
-}
-
-//-------------------------------------------------------------------
-// map server
-
-// 
-int mapif_party_created (int fd, int account_id, struct party *p)
-{
-    WFIFOW (fd, 0) = 0x3820;
-    WFIFOL (fd, 2) = account_id;
-    if (p != NULL)
-    {
-        WFIFOB (fd, 6) = 0;
-        WFIFOL (fd, 7) = p->party_id;
-        memcpy (WFIFOP (fd, 11), p->name, 24);
-        printf ("int_party: created! %d %s\n", p->party_id, p->name);
-    }
-    else
-    {
-        WFIFOB (fd, 6) = 1;
-        WFIFOL (fd, 7) = 0;
-        memcpy (WFIFOP (fd, 11), "error", 24);
-    }
-    WFIFOSET (fd, 35);
-    return 0;
-}
-
-// 
-int mapif_party_noinfo (int fd, int party_id)
-{
-    WFIFOW (fd, 0) = 0x3821;
-    WFIFOW (fd, 2) = 8;
-    WFIFOL (fd, 4) = party_id;
-    WFIFOSET (fd, 8);
-    printf ("int_party: info not found %d\n", party_id);
-    return 0;
-}
-
-// 
-int mapif_party_info (int fd, struct party *p)
-{
-    unsigned char buf[1024];
-    WBUFW (buf, 0) = 0x3821;
-    memcpy (buf + 4, p, sizeof (struct party));
-    WBUFW (buf, 2) = 4 + sizeof (struct party);
-    if (fd < 0)
-        mapif_sendall (buf, WBUFW (buf, 2));
-    else
-        mapif_send (fd, buf, WBUFW (buf, 2));
-//  printf("int_party: info %d %s\n",p->party_id,p->name);
-    return 0;
-}
-
-// 
-int mapif_party_memberadded (int fd, int party_id, int account_id, int flag)
-{
-    WFIFOW (fd, 0) = 0x3822;
-    WFIFOL (fd, 2) = party_id;
-    WFIFOL (fd, 6) = account_id;
-    WFIFOB (fd, 10) = flag;
-    WFIFOSET (fd, 11);
-    return 0;
-}
-
-// 
-int mapif_party_optionchanged (int fd, struct party *p, int account_id,
-                               int flag)
-{
-    unsigned char buf[16];
-    WBUFW (buf, 0) = 0x3823;
-    WBUFL (buf, 2) = p->party_id;
-    WBUFL (buf, 6) = account_id;
-    WBUFW (buf, 10) = p->exp;
-    WBUFW (buf, 12) = p->item;
-    WBUFB (buf, 14) = flag;
-    if (flag == 0)
-        mapif_sendall (buf, 15);
-    else
-        mapif_send (fd, buf, 15);
-    //printf("int_party: option changed %d %d %d %d %d\n",p->party_id,account_id,p->exp,p->item,flag);
-    return 0;
-}
-
-// 
-int mapif_party_leaved (int party_id, int account_id, char *name)
-{
-    unsigned char buf[64];
-    WBUFW (buf, 0) = 0x3824;
-    WBUFL (buf, 2) = party_id;
-    WBUFL (buf, 6) = account_id;
-    memcpy (WBUFP (buf, 10), name, 24);
-    mapif_sendall (buf, 34);
-    //printf("int_party: party leaved %d %d %s\n",party_id,account_id,name);
-    return 0;
-}
-
-// 
-int mapif_party_membermoved (struct party *p, int idx)
-{
-    unsigned char buf[32];
-    WBUFW (buf, 0) = 0x3825;
-    WBUFL (buf, 2) = p->party_id;
-    WBUFL (buf, 6) = p->member[idx].account_id;
-    memcpy (WBUFP (buf, 10), p->member[idx].map, 16);
-    WBUFB (buf, 26) = p->member[idx].online;
-    WBUFW (buf, 27) = p->member[idx].lv;
-    mapif_sendall (buf, 29);
-    return 0;
-}
-
-// 
-int mapif_party_broken (int party_id, int flag)
-{
-    unsigned char buf[16];
-    WBUFW (buf, 0) = 0x3826;
-    WBUFL (buf, 2) = party_id;
-    WBUFB (buf, 6) = flag;
-    mapif_sendall (buf, 7);
-    //printf("int_party: broken %d\n",party_id);
-    return 0;
-}
-
-// 
-int mapif_party_message (int party_id, int account_id, char *mes, int len)
-{
-    unsigned char buf[512];
-    WBUFW (buf, 0) = 0x3827;
-    WBUFW (buf, 2) = len + 12;
-    WBUFL (buf, 4) = party_id;
-    WBUFL (buf, 8) = account_id;
-    memcpy (WBUFP (buf, 12), mes, len);
-    mapif_sendall (buf, len + 12);
-    return 0;
-}
-
-//-------------------------------------------------------------------
-// map server
-
-// Create Party
-int mapif_parse_CreateParty (int fd, int account_id, char *name, char *nick,
-                             char *map, int lv)
-{
-    struct party *p;
-    if ((p = search_partyname (name)) != NULL)
-    {
-//      printf("int_party: same name party exists [%s]\n",name);
-        mapif_party_created (fd, account_id, NULL);
-        return 0;
-    }
-    p = party_pt;
-    if (p == NULL)
-    {
-        printf ("int_party: out of memory !\n");
-        mapif_party_created (fd, account_id, NULL);
-        return 0;
-    }
-    memset (p, 0, sizeof (struct party));
-    p->party_id = party_newid++;
-    memcpy (p->name, name, 24);
-    p->exp = 0;
-    p->item = 0;
-    p->member[0].account_id = account_id;
-    memcpy (p->member[0].name, nick, 24);
-    memcpy (p->member[0].map, map, 16);
-    p->member[0].leader = 1;
-    p->member[0].online = 1;
-    p->member[0].lv = lv;
-
-    inter_party_tosql (p->party_id, p);
-
-    mapif_party_created (fd, account_id, p);
-    mapif_party_info (fd, p);
-
-    return 0;
-}
-
-// 
-int mapif_parse_PartyInfo (int fd, int party_id)
-{
-    struct party *p = party_pt;
-    if (p == NULL)
-    {
-        printf ("int_party: out of memory !\n");
-        return 0;
-    }
-    inter_party_fromsql (party_id, p);
-
-    if (p->party_id >= 0)
-        mapif_party_info (fd, p);
-    else
-        mapif_party_noinfo (fd, party_id);
-    return 0;
-}
-
-// 
-int mapif_parse_PartyAddMember (int fd, int party_id, int account_id,
-                                char *nick, char *map, int lv)
-{
-    struct party *p;
-    int  i;
-
-    p = party_pt;
-    if (p == NULL)
-    {
-        printf ("int_party: out of memory !\n");
-        return 0;
-    }
-    inter_party_fromsql (party_id, p);
-
-    if (p->party_id <= 0)
-    {
-        mapif_party_memberadded (fd, party_id, account_id, 1);
-        return 0;
-    }
-
-    for (i = 0; i < MAX_PARTY; i++)
-    {
-        if (p->member[i].account_id == 0)
-        {
-            int  flag = 0;
-
-            p->member[i].account_id = account_id;
-            memcpy (p->member[i].name, nick, 24);
-            memcpy (p->member[i].map, map, 16);
-            p->member[i].leader = 0;
-            p->member[i].online = 1;
-            p->member[i].lv = lv;
-            mapif_party_memberadded (fd, party_id, account_id, 0);
-            mapif_party_info (-1, p);
-
-            if (p->exp > 0 && !party_check_exp_share (p))
-            {
-                p->exp = 0;
-                flag = 0x01;
-            }
-            if (flag)
-                mapif_party_optionchanged (fd, p, 0, 0);
-
-            inter_party_tosql (party_id, p);
-            return 0;
-        }
-    }
-    mapif_party_memberadded (fd, party_id, account_id, 1);
-    //inter_party_tosql(party_id, p);
-    return 0;
-}
-
-// 
-int mapif_parse_PartyChangeOption (int fd, int party_id, int account_id,
-                                   int exp, int item)
-{
-    struct party *p;
-    int  flag = 0;
-
-    p = party_pt;
-    if (p == NULL)
-    {
-        printf ("int_party: out of memory !\n");
-        return 0;
-    }
-
-    inter_party_fromsql (party_id, p);
-
-    if (p->party_id <= 0)
-    {
-        return 0;
-    }
-
-    p->exp = exp;
-    if (exp > 0 && !party_check_exp_share (p))
-    {
-        flag |= 0x01;
-        p->exp = 0;
-    }
-
-    p->item = item;
-
-    mapif_party_optionchanged (fd, p, account_id, flag);
-    inter_party_tosql (party_id, p);
-    return 0;
-}
-
-// 
-int mapif_parse_PartyLeave (int fd, int party_id, int account_id)
-{
-    char t_member[24];
-    struct party *p = party_pt;
-    if (p == NULL)
-    {
-        printf ("int_party: out of memory !\n");
-        return 0;
-    }
-
-    inter_party_fromsql (party_id, p);
-
-    if (p->party_id >= 0)
-    {
-        int  i, j;
-        for (i = 0; i < MAX_PARTY; i++)
-        {
-
-            if (p->member[i].account_id == account_id)
-            {
-                //printf("p->member[i].account_id = %d , account_id = %d \n",p->member[i].account_id,account_id);
-                mapif_party_leaved (party_id, account_id, p->member[i].name);
-
-                // Update char information, does the name need encoding?
-                sprintf (tmp_sql,
-                         "UPDATE `%s` SET `party_id`='0', `online`='1' WHERE `party_id`='%d' AND `name`='%s'",
-                         char_db, party_id, jstrescapecpy (t_member,
-                                                           p->
-                                                           member[i].name));
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error (update `char`)- %s\n",
-                            mysql_error (&mysql_handle));
-                }
-//              printf("Delete member %s from MySQL \n", p->member[i].name);    
-
-                if (p->member[i].leader == 1)
-                {
-                    for (j = 0; j < MAX_PARTY; j++)
-                    {
-                        //printf("j = %d , p->member[j].account_id = %d , p->member[j].account_id = %d \n",j,p->member[j].account_id,p->member[j].account_id);
-                        if (p->member[j].account_id > 0 && j != i)
-                        {
-                            mapif_party_leaved (party_id,
-                                                p->member[j].account_id,
-                                                p->member[j].name);
-                            // Update char information, does the name need encoding?
-                            sprintf (tmp_sql,
-                                     "UPDATE `%s` SET `party_id`='0', `online`='1' WHERE `party_id`='%d' AND `name`='%s'",
-                                     char_db, party_id,
-                                     jstrescapecpy (t_member,
-                                                    p->member[i].name));
-                            if (mysql_query (&mysql_handle, tmp_sql))
-                            {
-                                printf
-                                    ("DB server Error (update `char`)- %s\n",
-                                     mysql_error (&mysql_handle));
-                            }
-//                          printf("Delete member %s from MySQL \n", p->member[j].name);    
-                        }
-                    }
-                    // Delete the party, if has no member.
-                    sprintf (tmp_sql,
-                             "DELETE FROM `%s` WHERE `party_id`='%d'",
-                             party_db, party_id);
-                    if (mysql_query (&mysql_handle, tmp_sql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-//                  printf("Leader breaks party %d \n",party_id);
-                    memset (p, 0, sizeof (struct party));
-                }
-                else
-                    memset (&p->member[i], 0, sizeof (struct party_member));
-
-                break;
-
-            }
-        }
-        if (party_check_empty (p) == 0)
-            mapif_party_info (-1, p);   // 
-        /*
-         * else
-         * inter_party_tosql(party_id,p);   // Break the party if no member
-         */
-    }
-    else
-    {
-        sprintf (tmp_sql,
-                 "UPDATE `%s` SET `party_id`='0' WHERE `party_id`='%d' AND `account_id`='%d' AND `online`='1'",
-                 char_db, party_id, account_id);
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error (update `char`)- %s\n",
-                    mysql_error (&mysql_handle));
-        }
-    }
-    return 0;
-}
-
-// When member goes to other map
-int mapif_parse_PartyChangeMap (int fd, int party_id, int account_id,
-                                char *map, int online, int lv)
-{
-    struct party *p;
-    int  i;
-
-    p = party_pt;
-    if (p == NULL)
-    {
-        printf ("int_party: out of memory !\n");
-        return 0;
-    }
-    inter_party_fromsql (party_id, p);
-
-    if (p->party_id <= 0)
-    {
-        return 0;
-    }
-    for (i = 0; i < MAX_PARTY; i++)
-    {
-        if (p->member[i].account_id == account_id)
-        {
-            int  flag = 0;
-
-            memcpy (p->member[i].map, map, 16);
-            p->member[i].online = online;
-            p->member[i].lv = lv;
-            mapif_party_membermoved (p, i);
-
-            if (p->exp > 0 && !party_check_exp_share (p))
-            {
-                p->exp = 0;
-                flag = 1;
-            }
-            if (flag)
-                mapif_party_optionchanged (fd, p, 0, 0);
-            break;
-        }
-    }
-    inter_party_tosql (party_id, p);
-    return 0;
-}
-
-// 
-int mapif_parse_BreakParty (int fd, int party_id)
-{
-    struct party *p;
-
-    p = party_pt;
-    if (p == NULL)
-    {
-        printf ("int_party: out of memory !\n");
-        return 0;
-    }
-
-    inter_party_fromsql (party_id, p);
-
-    if (p->party_id <= 0)
-    {
-        return 0;
-    }
-    inter_party_tosql (party_id, p);
-
-    mapif_party_broken (fd, party_id);
-    return 0;
-}
-
-// 
-int mapif_parse_PartyMessage (int fd, int party_id, int account_id, char *mes,
-                              int len)
-{
-    return mapif_party_message (party_id, account_id, mes, len);
-}
-
-// 
-int mapif_parse_PartyCheck (int fd, int party_id, int account_id, char *nick)
-{
-    return party_check_conflict (party_id, account_id, nick);
-}
-
-// map server 
-// 
-// inter.c
-// RFIFOSKIP
-// 0(false)1(true)
-int inter_party_parse_frommap (int fd)
-{
-    switch (RFIFOW (fd, 0))
-    {
-        case 0x3020:
-            mapif_parse_CreateParty (fd, RFIFOL (fd, 2), RFIFOP (fd, 6),
-                                     RFIFOP (fd, 30), RFIFOP (fd, 54),
-                                     RFIFOW (fd, 70));
-            break;
-        case 0x3021:
-            mapif_parse_PartyInfo (fd, RFIFOL (fd, 2));
-            break;
-        case 0x3022:
-            mapif_parse_PartyAddMember (fd, RFIFOL (fd, 2), RFIFOL (fd, 6),
-                                        RFIFOP (fd, 10), RFIFOP (fd, 34),
-                                        RFIFOW (fd, 50));
-            break;
-        case 0x3023:
-            mapif_parse_PartyChangeOption (fd, RFIFOL (fd, 2), RFIFOL (fd, 6),
-                                           RFIFOW (fd, 10), RFIFOW (fd, 12));
-            break;
-        case 0x3024:
-            mapif_parse_PartyLeave (fd, RFIFOL (fd, 2), RFIFOL (fd, 6));
-            break;
-        case 0x3025:
-            mapif_parse_PartyChangeMap (fd, RFIFOL (fd, 2), RFIFOL (fd, 6),
-                                        RFIFOP (fd, 10), RFIFOB (fd, 26),
-                                        RFIFOW (fd, 27));
-            break;
-        case 0x3026:
-            mapif_parse_BreakParty (fd, RFIFOL (fd, 2));
-            break;
-        case 0x3027:
-            mapif_parse_PartyMessage (fd, RFIFOL (fd, 4), RFIFOL (fd, 8),
-                                      RFIFOP (fd, 12), RFIFOW (fd, 2) - 12);
-            break;
-        case 0x3028:
-            mapif_parse_PartyCheck (fd, RFIFOL (fd, 2), RFIFOL (fd, 6),
-                                    RFIFOP (fd, 10));
-            break;
-        default:
-            return 0;
-    }
-    return 1;
-}
-
-// 
-int inter_party_leave (int party_id, int account_id)
-{
-    return mapif_parse_PartyLeave (-1, party_id, account_id);
-}
diff --git a/src/char_sql/int_party.h b/src/char_sql/int_party.h
deleted file mode 100644
index 264ef8b..0000000
--- a/src/char_sql/int_party.h
+++ /dev/null
@@ -1,8 +0,0 @@
-#ifndef _INT_PARTY_H_
-#define _INT_PARTY_H_
-
-int  inter_party_parse_frommap (int fd);
-int  inter_party_sql_init ();
-int  inter_party_leave (int party_id, int account_id);
-
-#endif
diff --git a/src/char_sql/int_pet.c b/src/char_sql/int_pet.c
deleted file mode 100644
index 78e499d..0000000
--- a/src/char_sql/int_pet.c
+++ /dev/null
@@ -1,383 +0,0 @@
-//
-// original code from athena
-// SQL conversion by Jioh L. Jung
-//
-#include "char.h"
-#include "strlib.h"
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-
-struct s_pet *pet_pt;
-static int pet_newid = 100;
-
-//---------------------------------------------------------
-int inter_pet_tosql (int pet_id, struct s_pet *p)
-{
-    //`pet` (`pet_id`, `class`,`name`,`account_id`,`char_id`,`level`,`egg_id`,`equip`,`intimate`,`hungry`,`rename_flag`,`incuvate`)
-    char t_name[100];
-
-    printf ("request save pet: %d.......\n", pet_id);
-
-    jstrescapecpy (t_name, p->name);
-
-    if (p->hungry < 0)
-        p->hungry = 0;
-    else if (p->hungry > 100)
-        p->hungry = 100;
-    if (p->intimate < 0)
-        p->intimate = 0;
-    else if (p->intimate > 1000)
-        p->intimate = 1000;
-    sprintf (tmp_sql, "SELECT * FROM `%s` WHERE `pet_id`='%d'", pet_db,
-             pet_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-        //row reside -> updating
-        sprintf (tmp_sql,
-                 "UPDATE `%s` SET `class`='%d',`name`='%s',`account_id`='%d',`char_id`='%d',`level`='%d',`egg_id`='%d',`equip`='%d',`intimate`='%d',`hungry`='%d',`rename_flag`='%d',`incuvate`='%d' WHERE `pet_id`='%d'",
-                 pet_db, p->class, t_name, p->account_id, p->char_id,
-                 p->level, p->egg_id, p->equip, p->intimate, p->hungry,
-                 p->rename_flag, p->incuvate, p->pet_id);
-    else                        //no row -> insert
-        sprintf (tmp_sql,
-                 "INSERT INTO `%s` (`pet_id`, `class`,`name`,`account_id`,`char_id`,`level`,`egg_id`,`equip`,`intimate`,`hungry`,`rename_flag`,`incuvate`) VALUES ('%d', '%d', '%s', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d')",
-                 pet_db, pet_id, p->class, t_name, p->account_id, p->char_id,
-                 p->level, p->egg_id, p->equip, p->intimate, p->hungry,
-                 p->rename_flag, p->incuvate);
-    mysql_free_result (sql_res);    //resource free
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (inset/update `pet`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    printf ("pet save success.......\n");
-    return 0;
-}
-
-int inter_pet_fromsql (int pet_id, struct s_pet *p)
-{
-
-    printf ("request load pet: %d.......\n", pet_id);
-
-    memset (p, 0, sizeof (struct s_pet));
-
-    //`pet` (`pet_id`, `class`,`name`,`account_id`,`char_id`,`level`,`egg_id`,`equip`,`intimate`,`hungry`,`rename_flag`,`incuvate`)
-
-    sprintf (tmp_sql,
-             "SELECT `pet_id`, `class`,`name`,`account_id`,`char_id`,`level`,`egg_id`,`equip`,`intimate`,`hungry`,`rename_flag`,`incuvate` FROM `%s` WHERE `pet_id`='%d'",
-             pet_db, pet_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `pet`)- %s\n",
-                mysql_error (&mysql_handle));
-        return 0;
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        sql_row = mysql_fetch_row (sql_res);
-
-        p->pet_id = pet_id;
-        p->class = atoi (sql_row[1]);
-        memcpy (p->name, sql_row[2], 24);
-        p->account_id = atoi (sql_row[3]);
-        p->char_id = atoi (sql_row[4]);
-        p->level = atoi (sql_row[5]);
-        p->egg_id = atoi (sql_row[6]);
-        p->equip = atoi (sql_row[7]);
-        p->intimate = atoi (sql_row[8]);
-        p->hungry = atoi (sql_row[9]);
-        p->rename_flag = atoi (sql_row[10]);
-        p->incuvate = atoi (sql_row[11]);
-    }
-    if (p->hungry < 0)
-        p->hungry = 0;
-    else if (p->hungry > 100)
-        p->hungry = 100;
-    if (p->intimate < 0)
-        p->intimate = 0;
-    else if (p->intimate > 1000)
-        p->intimate = 1000;
-
-    mysql_free_result (sql_res);
-
-    printf ("pet load success.......\n");
-    return 0;
-}
-
-//----------------------------------------------
-
-int inter_pet_sql_init ()
-{
-    int  i;
-
-    //memory alloc
-    printf ("interserver pet memory initialize.... (%d byte)\n",
-            sizeof (struct s_pet));
-    pet_pt = calloc (sizeof (struct s_pet), 1);
-
-    sprintf (tmp_sql, "SELECT count(*) FROM `%s`", pet_db);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        exit (0);
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    sql_row = mysql_fetch_row (sql_res);
-    printf ("total pet data -> '%s'.......\n", sql_row[0]);
-    i = atoi (sql_row[0]);
-    mysql_free_result (sql_res);
-
-    if (i > 0)
-    {
-        //set pet_newid
-        sprintf (tmp_sql, "SELECT max(`pet_id`) FROM `%s`", pet_db);
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        }
-
-        sql_res = mysql_store_result (&mysql_handle);
-
-        sql_row = mysql_fetch_row (sql_res);
-        pet_newid = atoi (sql_row[0]);
-        mysql_free_result (sql_res);
-    }
-
-    printf ("set pet_newid: %d.......\n", pet_newid);
-
-    return 0;
-}
-
-//----------------------------------
-int inter_pet_delete (int pet_id)
-{
-    printf ("request delete pet: %d.......\n", pet_id);
-
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `pet_id`='%d'", pet_db, pet_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    return 0;
-}
-
-//------------------------------------------------------
-int mapif_pet_created (int fd, int account_id, struct s_pet *p)
-{
-    WFIFOW (fd, 0) = 0x3880;
-    WFIFOL (fd, 2) = account_id;
-    if (p != NULL)
-    {
-        WFIFOB (fd, 6) = 0;
-        WFIFOL (fd, 7) = p->pet_id;
-        printf ("int_pet: created! %d %s\n", p->pet_id, p->name);
-    }
-    else
-    {
-        WFIFOB (fd, 6) = 1;
-        WFIFOL (fd, 7) = 0;
-    }
-    WFIFOSET (fd, 11);
-
-    return 0;
-}
-
-int mapif_pet_info (int fd, int account_id, struct s_pet *p)
-{
-    WFIFOW (fd, 0) = 0x3881;
-    WFIFOW (fd, 2) = sizeof (struct s_pet) + 9;
-    WFIFOL (fd, 4) = account_id;
-    WFIFOB (fd, 8) = 0;
-    memcpy (WFIFOP (fd, 9), p, sizeof (struct s_pet));
-    WFIFOSET (fd, WFIFOW (fd, 2));
-
-    return 0;
-}
-
-int mapif_pet_noinfo (int fd, int account_id)
-{
-    WFIFOW (fd, 0) = 0x3881;
-    WFIFOW (fd, 2) = sizeof (struct s_pet) + 9;
-    WFIFOL (fd, 4) = account_id;
-    WFIFOB (fd, 8) = 1;
-    memset (WFIFOP (fd, 9), 0, sizeof (struct s_pet));
-    WFIFOSET (fd, WFIFOW (fd, 2));
-
-    return 0;
-}
-
-int mapif_save_pet_ack (int fd, int account_id, int flag)
-{
-    WFIFOW (fd, 0) = 0x3882;
-    WFIFOL (fd, 2) = account_id;
-    WFIFOB (fd, 6) = flag;
-    WFIFOSET (fd, 7);
-
-    return 0;
-}
-
-int mapif_delete_pet_ack (int fd, int flag)
-{
-    WFIFOW (fd, 0) = 0x3883;
-    WFIFOB (fd, 2) = flag;
-    WFIFOSET (fd, 3);
-
-    return 0;
-}
-
-int mapif_create_pet (int fd, int account_id, int char_id, short pet_class,
-                      short pet_lv, short pet_egg_id, short pet_equip,
-                      short intimate, short hungry, char rename_flag,
-                      char incuvate, char *pet_name)
-{
-
-    memset (pet_pt, 0, sizeof (struct s_pet));
-    pet_pt->pet_id = pet_newid++;
-    memcpy (pet_pt->name, pet_name, 24);
-    if (incuvate == 1)
-        pet_pt->account_id = pet_pt->char_id = 0;
-    else
-    {
-        pet_pt->account_id = account_id;
-        pet_pt->char_id = char_id;
-    }
-    pet_pt->class = pet_class;
-    pet_pt->level = pet_lv;
-    pet_pt->egg_id = pet_egg_id;
-    pet_pt->equip = pet_equip;
-    pet_pt->intimate = intimate;
-    pet_pt->hungry = hungry;
-    pet_pt->rename_flag = rename_flag;
-    pet_pt->incuvate = incuvate;
-
-    if (pet_pt->hungry < 0)
-        pet_pt->hungry = 0;
-    else if (pet_pt->hungry > 100)
-        pet_pt->hungry = 100;
-    if (pet_pt->intimate < 0)
-        pet_pt->intimate = 0;
-    else if (pet_pt->intimate > 1000)
-        pet_pt->intimate = 1000;
-
-    inter_pet_tosql (pet_pt->pet_id, pet_pt);
-
-    mapif_pet_created (fd, account_id, pet_pt);
-
-    return 0;
-}
-
-int mapif_load_pet (int fd, int account_id, int char_id, int pet_id)
-{
-    memset (pet_pt, 0, sizeof (struct s_pet));
-
-    inter_pet_fromsql (pet_id, pet_pt);
-
-    if (pet_pt != NULL)
-    {
-        if (pet_pt->incuvate == 1)
-        {
-            pet_pt->account_id = pet_pt->char_id = 0;
-            mapif_pet_info (fd, account_id, pet_pt);
-        }
-        else if (account_id == pet_pt->account_id
-                 && char_id == pet_pt->char_id)
-            mapif_pet_info (fd, account_id, pet_pt);
-        else
-            mapif_pet_noinfo (fd, account_id);
-    }
-    else
-        mapif_pet_noinfo (fd, account_id);
-
-    return 0;
-}
-
-int mapif_save_pet (int fd, int account_id, struct s_pet *data)
-{
-    //here process pet save request.
-    int  len = RFIFOW (fd, 2);
-    if (sizeof (struct s_pet) != len - 8)
-    {
-        printf ("inter pet: data size error %d %d\n", sizeof (struct s_pet),
-                len - 8);
-    }
-
-    else
-    {
-        if (data->hungry < 0)
-            data->hungry = 0;
-        else if (data->hungry > 100)
-            data->hungry = 100;
-        if (data->intimate < 0)
-            data->intimate = 0;
-        else if (data->intimate > 1000)
-            data->intimate = 1000;
-        inter_pet_tosql (data->pet_id, data);
-        mapif_save_pet_ack (fd, account_id, 0);
-    }
-
-    return 0;
-}
-
-int mapif_delete_pet (int fd, int pet_id)
-{
-    mapif_delete_pet_ack (fd, inter_pet_delete (pet_id));
-
-    return 0;
-}
-
-int mapif_parse_CreatePet (int fd)
-{
-    mapif_create_pet (fd, RFIFOL (fd, 2), RFIFOL (fd, 6), RFIFOW (fd, 10),
-                      RFIFOW (fd, 12), RFIFOW (fd, 14), RFIFOW (fd, 16),
-                      RFIFOL (fd, 18), RFIFOL (fd, 20), RFIFOB (fd, 22),
-                      RFIFOB (fd, 23), RFIFOP (fd, 24));
-    return 0;
-}
-
-int mapif_parse_LoadPet (int fd)
-{
-    mapif_load_pet (fd, RFIFOL (fd, 2), RFIFOL (fd, 6), RFIFOL (fd, 10));
-    return 0;
-}
-
-int mapif_parse_SavePet (int fd)
-{
-    mapif_save_pet (fd, RFIFOL (fd, 4), (struct s_pet *) RFIFOP (fd, 8));
-    return 0;
-}
-
-int mapif_parse_DeletePet (int fd)
-{
-    mapif_delete_pet (fd, RFIFOL (fd, 2));
-    return 0;
-}
-
-int inter_pet_parse_frommap (int fd)
-{
-    switch (RFIFOW (fd, 0))
-    {
-        case 0x3080:
-            mapif_parse_CreatePet (fd);
-            break;
-        case 0x3081:
-            mapif_parse_LoadPet (fd);
-            break;
-        case 0x3082:
-            mapif_parse_SavePet (fd);
-            break;
-        case 0x3083:
-            mapif_parse_DeletePet (fd);
-            break;
-        default:
-            return 0;
-    }
-    return 1;
-}
diff --git a/src/char_sql/int_pet.h b/src/char_sql/int_pet.h
deleted file mode 100644
index 0941dbc..0000000
--- a/src/char_sql/int_pet.h
+++ /dev/null
@@ -1,12 +0,0 @@
-#ifndef _INT_PET_H_
-#define _INT_PET_H_
-
-int  inter_pet_init ();
-int  inter_pet_save ();
-int  inter_pet_delete (int pet_id);
-
-int  inter_pet_parse_frommap (int fd);
-int  inter_pet_sql_init ();
-//extern char pet_txt[256];
-
-#endif
diff --git a/src/char_sql/int_storage.c b/src/char_sql/int_storage.c
deleted file mode 100644
index 63198b1..0000000
--- a/src/char_sql/int_storage.c
+++ /dev/null
@@ -1,441 +0,0 @@
-//
-// original code from athena
-// SQL conversion by Jioh L. Jung
-//
-#include "char.h"
-#include "itemdb.h"
-#include <string.h>
-#include <stdlib.h>
-
-#define STORAGE_MEMINC	16
-
-// reset by inter_config_read()
-struct storage *storage_pt = NULL;
-struct guild_storage *guild_storage_pt = NULL;
-
-// storage data -> DB conversion
-int storage_tosql (int account_id, struct storage *p)
-{
-    int  i;
-    int  eqcount = 1;
-    int  noteqcount = 1;
-    struct itemtemp mapitem;
-    for (i = 0; i < MAX_STORAGE; i++)
-    {
-        if (p->storage[i].nameid > 0)
-        {
-            if (itemdb_isequip (p->storage[i].nameid) == 1)
-            {
-                mapitem.equip[eqcount].flag = 0;
-                mapitem.equip[eqcount].id = p->storage[i].id;
-                mapitem.equip[eqcount].nameid = p->storage[i].nameid;
-                mapitem.equip[eqcount].amount = p->storage[i].amount;
-                mapitem.equip[eqcount].equip = p->storage[i].equip;
-                mapitem.equip[eqcount].identify = p->storage[i].identify;
-                mapitem.equip[eqcount].refine = p->storage[i].refine;
-                mapitem.equip[eqcount].attribute = p->storage[i].attribute;
-                mapitem.equip[eqcount].card[0] = p->storage[i].card[0];
-                mapitem.equip[eqcount].card[1] = p->storage[i].card[1];
-                mapitem.equip[eqcount].card[2] = p->storage[i].card[2];
-                mapitem.equip[eqcount].card[3] = p->storage[i].card[3];
-                mapitem.equip[eqcount].broken = p->storage[i].broken;
-                eqcount++;
-            }
-            else if (itemdb_isequip (p->storage[i].nameid) == 0)
-            {
-                mapitem.notequip[noteqcount].flag = 0;
-                mapitem.notequip[noteqcount].id = p->storage[i].id;
-                mapitem.notequip[noteqcount].nameid = p->storage[i].nameid;
-                mapitem.notequip[noteqcount].amount = p->storage[i].amount;
-                mapitem.notequip[noteqcount].equip = p->storage[i].equip;
-                mapitem.notequip[noteqcount].identify =
-                    p->storage[i].identify;
-                mapitem.notequip[noteqcount].refine = p->storage[i].refine;
-                mapitem.notequip[noteqcount].attribute =
-                    p->storage[i].attribute;
-                mapitem.notequip[noteqcount].card[0] = p->storage[i].card[0];
-                mapitem.notequip[noteqcount].card[1] = p->storage[i].card[1];
-                mapitem.notequip[noteqcount].card[2] = p->storage[i].card[2];
-                mapitem.notequip[noteqcount].card[3] = p->storage[i].card[3];
-                mapitem.notequip[noteqcount].broken = p->storage[i].broken;
-                noteqcount++;
-            }
-        }
-    }
-
-    memitemdata_to_sql (mapitem, eqcount, noteqcount, account_id,
-                        TABLE_STORAGE);
-
-    //printf ("storage dump to DB - id: %d (total: %d)\n", account_id, j);
-    return 0;
-}
-
-// DB -> storage data conversion
-int storage_fromsql (int account_id, struct storage *p)
-{
-    int  i = 0;
-
-    memset (p, 0, sizeof (struct storage)); //clean up memory
-    p->storage_amount = 0;
-    p->account_id = account_id;
-
-    // storage {`account_id`/`id`/`nameid`/`amount`/`equip`/`identify`/`refine`/`attribute`/`card0`/`card1`/`card2`/`card3`}
-    sprintf (tmp_sql,
-             "SELECT `id`,`nameid`,`amount`,`equip`,`identify`,`refine`,`attribute`,`card0`,`card1`,`card2`,`card3`,`broken` FROM `%s` WHERE `account_id`='%d'",
-             storage_db, account_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-
-    if (sql_res)
-    {
-        while ((sql_row = mysql_fetch_row (sql_res)))
-        {                       //start to fetch
-            p->storage[i].id = atoi (sql_row[0]);
-            p->storage[i].nameid = atoi (sql_row[1]);
-            p->storage[i].amount = atoi (sql_row[2]);
-            p->storage[i].equip = atoi (sql_row[3]);
-            p->storage[i].identify = atoi (sql_row[4]);
-            p->storage[i].refine = atoi (sql_row[5]);
-            p->storage[i].attribute = atoi (sql_row[6]);
-            p->storage[i].card[0] = atoi (sql_row[7]);
-            p->storage[i].card[1] = atoi (sql_row[8]);
-            p->storage[i].card[2] = atoi (sql_row[9]);
-            p->storage[i].card[3] = atoi (sql_row[10]);
-            p->storage[i].broken = atoi (sql_row[11]);
-            p->storage_amount = ++i;
-        }
-        mysql_free_result (sql_res);
-    }
-
-    printf ("storage load complete from DB - id: %d (total: %d)\n",
-            account_id, p->storage_amount);
-    return 1;
-}
-
-// Save guild_storage data to sql
-int guild_storage_tosql (int guild_id, struct guild_storage *p)
-{
-    int  i;
-    int  eqcount = 1;
-    int  noteqcount = 1;
-    struct itemtemp mapitem;
-    for (i = 0; i < MAX_GUILD_STORAGE; i++)
-    {
-        if (p->storage[i].nameid > 0)
-        {
-            if (itemdb_isequip (p->storage[i].nameid) == 1)
-            {
-                mapitem.equip[eqcount].flag = 0;
-                mapitem.equip[eqcount].id = p->storage[i].id;
-                mapitem.equip[eqcount].nameid = p->storage[i].nameid;
-                mapitem.equip[eqcount].amount = p->storage[i].amount;
-                mapitem.equip[eqcount].equip = p->storage[i].equip;
-                mapitem.equip[eqcount].identify = p->storage[i].identify;
-                mapitem.equip[eqcount].refine = p->storage[i].refine;
-                mapitem.equip[eqcount].attribute = p->storage[i].attribute;
-                mapitem.equip[eqcount].card[0] = p->storage[i].card[0];
-                mapitem.equip[eqcount].card[1] = p->storage[i].card[1];
-                mapitem.equip[eqcount].card[2] = p->storage[i].card[2];
-                mapitem.equip[eqcount].card[3] = p->storage[i].card[3];
-                mapitem.equip[eqcount].broken = p->storage[i].broken;
-                eqcount++;
-            }
-            else if (itemdb_isequip (p->storage[i].nameid) == 0)
-            {
-                mapitem.notequip[noteqcount].flag = 0;
-                mapitem.notequip[noteqcount].id = p->storage[i].id;
-                mapitem.notequip[noteqcount].nameid = p->storage[i].nameid;
-                mapitem.notequip[noteqcount].amount = p->storage[i].amount;
-                mapitem.notequip[noteqcount].equip = p->storage[i].equip;
-                mapitem.notequip[noteqcount].identify =
-                    p->storage[i].identify;
-                mapitem.notequip[noteqcount].refine = p->storage[i].refine;
-                mapitem.notequip[noteqcount].attribute =
-                    p->storage[i].attribute;
-                mapitem.notequip[noteqcount].card[0] = p->storage[i].card[0];
-                mapitem.notequip[noteqcount].card[1] = p->storage[i].card[1];
-                mapitem.notequip[noteqcount].card[2] = p->storage[i].card[2];
-                mapitem.notequip[noteqcount].card[3] = p->storage[i].card[3];
-                mapitem.notequip[noteqcount].broken = p->storage[i].broken;
-                noteqcount++;
-            }
-        }
-    }
-
-    memitemdata_to_sql (mapitem, eqcount, noteqcount, guild_id,
-                        TABLE_GUILD_STORAGE);
-
-    printf ("guild storage save to DB - id: %d (total: %d)\n", guild_id, i);
-    return 0;
-}
-
-// Load guild_storage data to mem
-int guild_storage_fromsql (int guild_id, struct guild_storage *p)
-{
-    int  i = 0;
-    struct guild_storage *gs = guild_storage_pt;
-    p = gs;
-
-    memset (p, 0, sizeof (struct guild_storage));   //clean up memory
-    p->storage_amount = 0;
-    p->guild_id = guild_id;
-
-    // storage {`guild_id`/`id`/`nameid`/`amount`/`equip`/`identify`/`refine`/`attribute`/`card0`/`card1`/`card2`/`card3`}
-    sprintf (tmp_sql,
-             "SELECT `id`,`nameid`,`amount`,`equip`,`identify`,`refine`,`attribute`,`card0`,`card1`,`card2`,`card3`,`broken` FROM `%s` WHERE `guild_id`='%d'",
-             guild_storage_db, guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-
-    if (sql_res)
-    {
-        while ((sql_row = mysql_fetch_row (sql_res)))
-        {                       //start to fetch
-            p->storage[i].id = atoi (sql_row[0]);
-            p->storage[i].nameid = atoi (sql_row[1]);
-            p->storage[i].amount = atoi (sql_row[2]);
-            p->storage[i].equip = atoi (sql_row[3]);
-            p->storage[i].identify = atoi (sql_row[4]);
-            p->storage[i].refine = atoi (sql_row[5]);
-            p->storage[i].attribute = atoi (sql_row[6]);
-            p->storage[i].card[0] = atoi (sql_row[7]);
-            p->storage[i].card[1] = atoi (sql_row[8]);
-            p->storage[i].card[2] = atoi (sql_row[9]);
-            p->storage[i].card[3] = atoi (sql_row[10]);
-            p->storage[i].broken = atoi (sql_row[11]);
-            p->storage_amount = ++i;
-        }
-        mysql_free_result (sql_res);
-    }
-    printf ("guild storage load complete from DB - id: %d (total: %d)\n",
-            guild_id, p->storage_amount);
-    return 0;
-}
-
-//---------------------------------------------------------
-// storage data initialize
-int inter_storage_sql_init ()
-{
-
-    //memory alloc
-    printf ("interserver storage memory initialize....(%d byte)\n",
-            sizeof (struct storage));
-    storage_pt = calloc (sizeof (struct storage), 1);
-    guild_storage_pt = calloc (sizeof (struct guild_storage), 1);
-    memset (storage_pt, 0, sizeof (struct storage));
-    memset (guild_storage_pt, 0, sizeof (struct guild_storage));
-
-    return 1;
-}
-
-// 
-int inter_storage_delete (int account_id)
-{
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `account_id`='%d'", storage_db,
-             account_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `storage`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    return 0;
-}
-
-int inter_guild_storage_delete (int guild_id)
-{
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `guild_id`='%d'",
-             guild_storage_db, guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `guild_storage`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    return 0;
-}
-
-//---------------------------------------------------------
-// packet from map server
-
-// recive packet about storage data
-int mapif_load_storage (int fd, int account_id)
-{
-    //load from DB
-    storage_fromsql (account_id, storage_pt);
-    WFIFOW (fd, 0) = 0x3810;
-    WFIFOW (fd, 2) = sizeof (struct storage) + 8;
-    WFIFOL (fd, 4) = account_id;
-    memcpy (WFIFOP (fd, 8), storage_pt, sizeof (struct storage));
-    WFIFOSET (fd, WFIFOW (fd, 2));
-    return 0;
-}
-
-// send ack to map server which is "storage data save ok."
-int mapif_save_storage_ack (int fd, int account_id)
-{
-    WFIFOW (fd, 0) = 0x3811;
-    WFIFOL (fd, 2) = account_id;
-    WFIFOB (fd, 6) = 0;
-    WFIFOSET (fd, 7);
-    return 0;
-}
-
-int mapif_load_guild_storage (int fd, int account_id, int guild_id)
-{
-    int  guild_exist = 0;
-    WFIFOW (fd, 0) = 0x3818;
-
-    // Check if guild exists, I may write a function for this later, coz I use it several times.
-    //printf("- Check if guild %d exists\n",g->guild_id);
-    sprintf (tmp_sql, "SELECT count(*) FROM `%s` WHERE `guild_id`='%d'",
-             guild_db, guild_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `guild`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-    {
-        sql_row = mysql_fetch_row (sql_res);
-        guild_exist = atoi (sql_row[0]);
-        //printf("- Check if guild %d exists : %s\n",g->guild_id,((guild_exist==0)?"No":"Yes"));
-    }
-    mysql_free_result (sql_res);    //resource free
-
-    if (guild_exist == 1)
-    {
-        guild_storage_fromsql (guild_id, guild_storage_pt);
-        WFIFOW (fd, 2) = sizeof (struct guild_storage) + 12;
-        WFIFOL (fd, 4) = account_id;
-        WFIFOL (fd, 8) = guild_id;
-        memcpy (WFIFOP (fd, 12), guild_storage_pt,
-                sizeof (struct guild_storage));
-    }
-    else
-    {
-        WFIFOW (fd, 2) = 12;
-        WFIFOL (fd, 4) = account_id;
-        WFIFOL (fd, 8) = 0;
-    }
-    WFIFOSET (fd, WFIFOW (fd, 2));
-
-    return 0;
-}
-
-int mapif_save_guild_storage_ack (int fd, int account_id, int guild_id,
-                                  int fail)
-{
-    WFIFOW (fd, 0) = 0x3819;
-    WFIFOL (fd, 2) = account_id;
-    WFIFOL (fd, 6) = guild_id;
-    WFIFOB (fd, 10) = fail;
-    WFIFOSET (fd, 11);
-    return 0;
-}
-
-//---------------------------------------------------------
-// packet from map server
-
-// recive request about storage data
-int mapif_parse_LoadStorage (int fd)
-{
-    mapif_load_storage (fd, RFIFOL (fd, 2));
-    return 0;
-}
-
-// storage data recive and save
-int mapif_parse_SaveStorage (int fd)
-{
-    int  account_id = RFIFOL (fd, 4);
-    int  len = RFIFOW (fd, 2);
-
-    if (sizeof (struct storage) != len - 8)
-    {
-        printf ("inter storage: data size error %d %d\n",
-                sizeof (struct storage), len - 8);
-    }
-    else
-    {
-        memcpy (&storage_pt[0], RFIFOP (fd, 8), sizeof (struct storage));
-        storage_tosql (account_id, storage_pt);
-        mapif_save_storage_ack (fd, account_id);
-    }
-    return 0;
-}
-
-int mapif_parse_LoadGuildStorage (int fd)
-{
-    mapif_load_guild_storage (fd, RFIFOL (fd, 2), RFIFOL (fd, 6));
-    return 0;
-}
-
-int mapif_parse_SaveGuildStorage (int fd)
-{
-    int  guild_exist = 0;
-    int  guild_id = RFIFOL (fd, 8);
-    int  len = RFIFOW (fd, 2);
-    if (sizeof (struct guild_storage) != len - 12)
-    {
-        printf ("inter storage: data size error %d %d\n",
-                sizeof (struct guild_storage), len - 12);
-    }
-    else
-    {
-        // Check if guild exists, I may write a function for this later, coz I use it several times.
-        //printf("- Check if guild %d exists\n",g->guild_id);
-        sprintf (tmp_sql, "SELECT count(*) FROM `%s` WHERE `guild_id`='%d'",
-                 guild_db, guild_id);
-        if (mysql_query (&mysql_handle, tmp_sql))
-        {
-            printf ("DB server Error (delete `guild`)- %s\n",
-                    mysql_error (&mysql_handle));
-        }
-        sql_res = mysql_store_result (&mysql_handle);
-        if (sql_res != NULL && mysql_num_rows (sql_res) > 0)
-        {
-            sql_row = mysql_fetch_row (sql_res);
-            guild_exist = atoi (sql_row[0]);
-            //printf("- Check if guild %d exists : %s\n",g->guild_id,((guild_exist==0)?"No":"Yes"));
-        }
-        mysql_free_result (sql_res);    //resource free
-
-        if (guild_exist == 1)
-        {
-            memcpy (guild_storage_pt, RFIFOP (fd, 12),
-                    sizeof (struct guild_storage));
-            guild_storage_tosql (guild_id, guild_storage_pt);
-            mapif_save_guild_storage_ack (fd, RFIFOL (fd, 4), guild_id, 0);
-        }
-        else
-            mapif_save_guild_storage_ack (fd, RFIFOL (fd, 4), guild_id, 1);
-    }
-    return 0;
-}
-
-int inter_storage_parse_frommap (int fd)
-{
-    switch (RFIFOW (fd, 0))
-    {
-        case 0x3010:
-            mapif_parse_LoadStorage (fd);
-            break;
-        case 0x3011:
-            mapif_parse_SaveStorage (fd);
-            break;
-        case 0x3018:
-            mapif_parse_LoadGuildStorage (fd);
-            break;
-        case 0x3019:
-            mapif_parse_SaveGuildStorage (fd);
-            break;
-        default:
-            return 0;
-    }
-    return 1;
-}
diff --git a/src/char_sql/int_storage.h b/src/char_sql/int_storage.h
deleted file mode 100644
index 2a7efee..0000000
--- a/src/char_sql/int_storage.h
+++ /dev/null
@@ -1,12 +0,0 @@
-#ifndef _INT_STORAGE_H_
-#define _INT_STORAGE_H_
-
-int  inter_storage_sql_init ();
-int  inter_storage_delete (int account_id);
-int  inter_guild_storage_delete (int guild_id);
-
-int  inter_storage_parse_frommap (int fd);
-
-//extern char storage_txt[256];
-
-#endif
diff --git a/src/char_sql/inter.c b/src/char_sql/inter.c
deleted file mode 100644
index 800beaf..0000000
--- a/src/char_sql/inter.c
+++ /dev/null
@@ -1,662 +0,0 @@
-//
-// original code from athena
-// SQL conversion by Jioh L. Jung
-//
-
-#include <string.h>
-#include <stdlib.h>
-
-#include "char.h"
-#include "strlib.h"
-#include "inter.h"
-#include "int_party.h"
-#include "int_guild.h"
-#include "int_storage.h"
-#include "int_pet.h"
-#include "lock.h"
-
-#define WISDATA_TTL		(60*1000)   // Wis(60)
-#define WISDELLIST_MAX	256     // Wis
-
-struct accreg
-{
-    int  account_id, reg_num;
-    struct global_reg reg[ACCOUNT_REG_NUM];
-};
-
-static struct accreg *accreg_pt;
-
-int  party_share_level = 10;
-MYSQL mysql_handle;
-MYSQL_RES *sql_res;
-MYSQL_ROW sql_row;
-int  sql_fields, sql_cnt;
-char tmp_sql[65535];
-
-MYSQL lmysql_handle;
-char tmp_lsql[65535];
-MYSQL_RES *lsql_res;
-MYSQL_ROW lsql_row;
-
-int  char_server_port = 3306;
-char char_server_ip[32] = "127.0.0.1";
-char char_server_id[32] = "ragnarok";
-char char_server_pw[32] = "ragnarok";
-char char_server_db[32] = "ragnarok";
-
-int  login_server_port = 3306;
-char login_server_ip[32] = "127.0.0.1";
-char login_server_id[32] = "ragnarok";
-char login_server_pw[32] = "ragnarok";
-char login_server_db[32] = "ragnarok";
-
-// sending packet list
-int  inter_send_packet_length[] = {
-    -1, -1, 27, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-    -1, 7, 0, 0, 0, 0, 0, 0, -1, 11, 0, 0, 0, 0, 0, 0,
-    35, -1, 11, 15, 34, 29, 7, -1, 0, 0, 0, 0, 0, 0, 0, 0,
-    10, -1, 15, 0, 79, 19, 7, -1, 0, -1, -1, -1, 14, 67, 186, -1,
-    9, 9, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-    11, -1, 7, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-};
-
-// recv. packet list
-int  inter_recv_packet_length[] = {
-    -1, -1, 7, 0, -1, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-    6, -1, 0, 0, 0, 0, 0, 0, 10, -1, 0, 0, 0, 0, 0, 0,
-    72, 6, 52, 14, 10, 29, 6, -1, 34, 0, 0, 0, 0, 0, 0, 0,
-    -1, 6, -1, 0, 55, 19, 6, -1, 14, -1, -1, -1, 14, 19, 186, -1,
-    5, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-    48, 14, -1, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-};
-
-struct WisData
-{
-    int  id, fd, count, len;
-    unsigned long tick;
-    unsigned char src[24], dst[24], msg[512];
-};
-static struct dbt *wis_db = NULL;
-static int wis_dellist[WISDELLIST_MAX], wis_delnum;
-
-//--------------------------------------------------------
-// Save account_reg to sql (type=2)
-int inter_accreg_tosql (int account_id, struct accreg *reg)
-{
-
-    int  j;
-    char temp_str[32];
-    if (account_id <= 0)
-        return 0;
-    reg->account_id = account_id;
-
-    //`global_reg_value` (`type`, `account_id`, `char_id`, `str`, `value`)
-    sprintf (tmp_sql, "DELETE FROM `%s` WHERE `type`=2 AND `account_id`='%d'",
-             reg_db, account_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `global_reg_value`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    if (reg->reg_num <= 0)
-        return 0;
-
-    for (j = 0; j < reg->reg_num; j++)
-    {
-        if (reg->reg[j].str != NULL)
-        {
-            sprintf (tmp_sql,
-                     "INSERT INTO `%s` (`type`, `account_id`, `str`, `value`) VALUES (2,'%d', '%s','%d')",
-                     reg_db, reg->account_id, jstrescapecpy (temp_str,
-                                                             reg->reg[j].str),
-                     reg->reg[j].value);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (insert `global_reg_value`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-    }
-    return 0;
-}
-
-// Load account_reg from sql (type=2)
-int inter_accreg_fromsql (int account_id, struct accreg *reg)
-{
-    int  j = 0;
-    if (reg == NULL)
-        return 0;
-    memset (reg, 0, sizeof (struct accreg));
-    reg->account_id = account_id;
-
-    //`global_reg_value` (`type`, `account_id`, `char_id`, `str`, `value`)
-    sprintf (tmp_sql,
-             "SELECT `str`, `value` FROM `%s` WHERE `type`=2 AND `account_id`='%d'",
-             reg_db, reg->account_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (select `global_reg_value`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-
-    if (sql_res)
-    {
-        for (j = 0; (sql_row = mysql_fetch_row (sql_res)); j++)
-        {
-            memcpy (reg->reg[j].str, sql_row[0], 32);
-            reg->reg[j].value = atoi (sql_row[1]);
-        }
-        mysql_free_result (sql_res);
-    }
-    reg->reg_num = j;
-    return 0;
-}
-
-// Initialize
-int inter_accreg_sql_init ()
-{
-    CREATE (accreg_pt, struct accreg, 1);
-    return 0;
-
-}
-
-/*==========================================
- * read config file
- *------------------------------------------
- */
-int inter_config_read (const char *cfgName)
-{
-    printf ("start reading interserver configuration: %s\n", cfgName);
-    int  i;
-    char line[1024], w1[1024], w2[1024];
-    FILE *fp;
-
-    fp = fopen_ (cfgName, "r");
-    if (fp == NULL)
-    {
-        printf ("file not found: %s\n", cfgName);
-        return 1;
-    }
-    while (fgets (line, 1020, fp))
-    {
-        i = sscanf (line, "%[^:]: %[^\r\n]", w1, w2);
-        if (i != 2)
-            continue;
-
-        if (strcmpi (w1, "char_server_ip") == 0)
-        {
-            strcpy (char_server_ip, w2);
-            printf ("set char_server_ip : %s\n", w2);
-        }
-        else if (strcmpi (w1, "char_server_port") == 0)
-        {
-            char_server_port = atoi (w2);
-            printf ("set char_server_port : %s\n", w2);
-        }
-        else if (strcmpi (w1, "char_server_id") == 0)
-        {
-            strcpy (char_server_id, w2);
-            printf ("set char_server_id : %s\n", w2);
-        }
-        else if (strcmpi (w1, "char_server_pw") == 0)
-        {
-            strcpy (char_server_pw, w2);
-            printf ("set char_server_pw : %s\n", w2);
-        }
-        else if (strcmpi (w1, "char_server_db") == 0)
-        {
-            strcpy (char_server_db, w2);
-            printf ("set char_server_db : %s\n", w2);
-        }
-        //Logins information to be read from the inter_athena.conf
-        //for character deletion (checks email in the loginDB)
-
-        else if (strcmpi (w1, "login_server_ip") == 0)
-        {
-            strcpy (login_server_ip, w2);
-            printf ("set login_server_ip : %s\n", w2);
-        }
-        else if (strcmpi (w1, "login_server_port") == 0)
-        {
-            login_server_port = atoi (w2);
-            printf ("set login_server_port : %s\n", w2);
-        }
-        else if (strcmpi (w1, "login_server_id") == 0)
-        {
-            strcpy (login_server_id, w2);
-            printf ("set login_server_id : %s\n", w2);
-        }
-        else if (strcmpi (w1, "login_server_pw") == 0)
-        {
-            strcpy (login_server_pw, w2);
-            printf ("set login_server_pw : %s\n", w2);
-        }
-        else if (strcmpi (w1, "login_server_db") == 0)
-        {
-            strcpy (login_server_db, w2);
-            printf ("set login_server_db : %s\n", w2);
-        }
-        else if (strcmpi (w1, "party_share_level") == 0)
-        {
-            party_share_level = atoi (w2);
-            if (party_share_level < 0)
-                party_share_level = 0;
-        }
-        else if (strcmpi (w1, "import") == 0)
-        {
-            inter_config_read (w2);
-        }
-        else if (strcmpi (w1, "login_server_db") == 0)
-        {
-            strcpy (login_server_db, w2);
-            printf ("set login_server_db : %s\n", w2);
-        }
-    }
-    fclose_ (fp);
-
-    printf ("success reading interserver configuration\n");
-
-    return 0;
-}
-
-// Save interlog into sql
-int inter_log (char *fmt, ...)
-{
-    char str[255];
-    char temp_str[255];
-    va_list ap;
-    va_start (ap, fmt);
-
-    vsprintf (str, fmt, ap);
-    sprintf (tmp_sql,
-             "INSERT INTO `%s` (`time`, `log`) VALUES (NOW(),  '%s')",
-             interlog_db, jstrescapecpy (temp_str, str));
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (insert `interlog`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    va_end (ap);
-    return 0;
-}
-
-// initialize
-int inter_init (const char *file)
-{
-    //int i;
-
-    printf ("interserver initialize...\n");
-    inter_config_read (file);
-
-    //DB connection initialized
-    mysql_init (&mysql_handle);
-    printf ("Connect Character DB server.... (Character Server)\n");
-    if (!mysql_real_connect
-        (&mysql_handle, char_server_ip, char_server_id, char_server_pw,
-         char_server_db, char_server_port, (char *) NULL, 0))
-    {
-        //pointer check
-        printf ("%s\n", mysql_error (&mysql_handle));
-        exit (1);
-    }
-    else
-    {
-        printf ("Connect Success! (Character Server)\n");
-    }
-
-    mysql_init (&lmysql_handle);
-    printf ("Connect Character DB server.... (login server)\n");
-    if (!mysql_real_connect
-        (&lmysql_handle, login_server_ip, login_server_id, login_server_pw,
-         login_server_db, login_server_port, (char *) NULL, 0))
-    {
-        //pointer check
-        printf ("%s\n", mysql_error (&lmysql_handle));
-        exit (1);
-    }
-    else
-    {
-        printf ("Connect Success! (Login Server)");
-    }
-    wis_db = numdb_init ();
-    inter_guild_sql_init ();
-    inter_storage_sql_init ();
-    inter_party_sql_init ();
-
-    inter_pet_sql_init ();
-    inter_accreg_sql_init ();
-
-    //printf ("interserver timer initializing : %d sec...\n",autosave_interval);
-    //i=add_timer_interval(gettick()+autosave_interval,inter_save_timer,0,0,autosave_interval);
-
-    return 0;
-}
-
-int inter_mapif_init (int fd)
-{
-    inter_guild_mapif_init (fd);
-
-    return 0;
-}
-
-//--------------------------------------------------------
-
-// GM message sending
-int mapif_GMmessage (unsigned char *mes, int len)
-{
-    unsigned char buf[len];
-
-    WBUFW (buf, 0) = 0x3800;
-    WBUFW (buf, 2) = len;
-    memcpy (WBUFP (buf, 4), mes, len - 4);
-    mapif_sendall (buf, len);
-    printf ("\033[1;34m inter server: GM[len:%d] - '%s' \033[0m\n", len, mes);
-    return 0;
-}
-
-// Wis sending
-int mapif_wis_message (struct WisData *wd)
-{
-    unsigned char buf[56 + wd->len];
-
-    WBUFW (buf, 0) = 0x3801;
-    WBUFW (buf, 2) = 56 + wd->len;
-    WBUFL (buf, 4) = wd->id;
-    memcpy (WBUFP (buf, 8), wd->src, 24);
-    memcpy (WBUFP (buf, 32), wd->dst, 24);
-    memcpy (WBUFP (buf, 56), wd->msg, wd->len);
-    wd->count = mapif_sendall (buf, WBUFW (buf, 2));
-
-    return 0;
-}
-
-// Wis sending result
-int mapif_wis_end (struct WisData *wd, int flag)
-{
-    unsigned char buf[27];
-
-    WBUFW (buf, 0) = 0x3802;
-    memcpy (WBUFP (buf, 2), wd->src, 24);
-    WBUFB (buf, 26) = flag;
-    mapif_send (wd->fd, buf, 27);
-//  printf("inter server wis_end %d\n",flag);
-    return 0;
-}
-
-int mapif_account_reg (int fd, unsigned char *src)
-{
-    unsigned char buf[WBUFW (src, 2)];
-    memcpy (WBUFP (buf, 0), src, WBUFW (src, 2));
-    WBUFW (buf, 0) = 0x3804;
-    mapif_sendallwos (fd, buf, WBUFW (buf, 2));
-    return 0;
-}
-
-// Send the requested account_reg
-int mapif_account_reg_reply (int fd, int account_id)
-{
-    struct accreg *reg = accreg_pt;
-    inter_accreg_fromsql (account_id, reg);
-
-    WFIFOW (fd, 0) = 0x3804;
-    WFIFOL (fd, 4) = account_id;
-    if (reg->reg_num == 0)
-    {
-        WFIFOW (fd, 2) = 8;
-    }
-    else
-    {
-        int  j, p;
-        for (j = 0, p = 8; j < reg->reg_num; j++, p += 36)
-        {
-            memcpy (WFIFOP (fd, p), reg->reg[j].str, 32);
-            WFIFOL (fd, p + 32) = reg->reg[j].value;
-        }
-        WFIFOW (fd, 2) = p;
-    }
-    WFIFOSET (fd, WFIFOW (fd, 2));
-    return 0;
-}
-
-//--------------------------------------------------------
-
-// Existence check of WISP data
-int check_ttl_wisdata_sub (void *key, void *data, va_list ap)
-{
-    unsigned long tick;
-    struct WisData *wd = (struct WisData *) data;
-    tick = va_arg (ap, unsigned long);
-
-    if (DIFF_TICK (tick, wd->tick) > WISDATA_TTL
-        && wis_delnum < WISDELLIST_MAX)
-        wis_dellist[wis_delnum++] = wd->id;
-
-    return 0;
-}
-
-int check_ttl_wisdata ()
-{
-    unsigned long tick = gettick ();
-    int  i;
-
-    do
-    {
-        wis_delnum = 0;
-        numdb_foreach (wis_db, check_ttl_wisdata_sub, tick);
-        for (i = 0; i < wis_delnum; i++)
-        {
-            struct WisData *wd = numdb_search (wis_db, wis_dellist[i]);
-            printf ("inter: wis data id=%d time out : from %s to %s\n",
-                    wd->id, wd->src, wd->dst);
-            // removed. not send information after a timeout. Just no answer for the player
-            //mapif_wis_end(wd, 1); // flag: 0: success to send wisper, 1: target character is not loged in?, 2: ignored by target
-            numdb_erase (wis_db, wd->id);
-            free (wd);
-        }
-    }
-    while (wis_delnum >= WISDELLIST_MAX);
-
-    return 0;
-}
-
-//--------------------------------------------------------
-
-// GM message sending
-int mapif_parse_GMmessage (int fd)
-{
-    mapif_GMmessage (RFIFOP (fd, 4), RFIFOW (fd, 2));
-    return 0;
-}
-
-// Wisp/page request to send
-int mapif_parse_WisRequest (int fd)
-{
-    struct WisData *wd;
-    static int wisid = 0;
-
-    if (RFIFOW (fd, 2) - 52 >= sizeof (wd->msg))
-    {
-        printf ("inter: Wis message size too long.\n");
-        return 0;
-    }
-    else if (RFIFOW (fd, 2) - 52 <= 0)
-    {                           // normaly, impossible, but who knows...
-        printf ("inter: Wis message doesn't exist.\n");
-        return 0;
-    }
-    sprintf (tmp_sql, "SELECT `name` FROM `%s` WHERE `char_id`='%d'", char_db,
-             (int) RFIFOP (fd, 28));
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-
-    // search if character exists before to ask all map-servers
-    if (!(sql_row = mysql_fetch_row (sql_res)))
-    {
-        unsigned char buf[27];
-        WBUFW (buf, 0) = 0x3802;
-        memcpy (WBUFP (buf, 2), RFIFOP (fd, 4), 24);
-        WBUFB (buf, 26) = 1;    // flag: 0: success to send wisper, 1: target character is not loged in?, 2: ignored by target
-        mapif_send (fd, buf, 27);
-        // Character exists. So, ask all map-servers
-    }
-    else
-    {
-        // to be sure of the correct name, rewrite it
-        memset (RFIFOP (fd, 28), 0, 24);
-        strncpy (RFIFOP (fd, 28), sql_row[0], 24);
-        // if source is destination, don't ask other servers.
-        if (strcmp (RFIFOP (fd, 4), RFIFOP (fd, 28)) == 0)
-        {
-            unsigned char buf[27];
-            WBUFW (buf, 0) = 0x3802;
-            memcpy (WBUFP (buf, 2), RFIFOP (fd, 4), 24);
-            WBUFB (buf, 26) = 1;    // flag: 0: success to send wisper, 1: target character is not loged in?, 2: ignored by target
-            mapif_send (fd, buf, 27);
-        }
-        else
-        {
-
-            CREATE (wd, struct WisData, 1);
-
-            // Whether the failure of previous wisp/page transmission (timeout)
-            check_ttl_wisdata ();
-
-            wd->id = ++wisid;
-            wd->fd = fd;
-            wd->len = RFIFOW (fd, 2) - 52;
-            memcpy (wd->src, RFIFOP (fd, 4), 24);
-            memcpy (wd->dst, RFIFOP (fd, 28), 24);
-            memcpy (wd->msg, RFIFOP (fd, 52), wd->len);
-            wd->tick = gettick ();
-            numdb_insert (wis_db, wd->id, wd);
-            mapif_wis_message (wd);
-        }
-    }
-
-    return 0;
-}
-
-// Wisp/page transmission result
-int mapif_parse_WisReply (int fd)
-{
-    int  id = RFIFOL (fd, 2), flag = RFIFOB (fd, 6);
-    struct WisData *wd = numdb_search (wis_db, id);
-
-    if (wd == NULL)
-        return 0;               // This wisp was probably suppress before, because it was timeout of because of target was found on another map-server
-
-    if ((--wd->count) <= 0 || flag != 1)
-    {
-        mapif_wis_end (wd, flag);   // flag: 0: success to send wisper, 1: target character is not loged in?, 2: ignored by target
-        numdb_erase (wis_db, id);
-        free (wd);
-    }
-
-    return 0;
-}
-
-// Save account_reg into sql (type=2)
-int mapif_parse_AccReg (int fd)
-{
-    int  j, p;
-    struct accreg *reg = accreg_pt;
-    int  account_id = RFIFOL (fd, 4);
-    memset (accreg_pt, 0, sizeof (struct accreg));
-
-    for (j = 0, p = 8; j < ACCOUNT_REG_NUM && p < RFIFOW (fd, 2);
-         j++, p += 36)
-    {
-        memcpy (reg->reg[j].str, RFIFOP (fd, p), 32);
-        reg->reg[j].value = RFIFOL (fd, p + 32);
-    }
-    reg->reg_num = j;
-
-    inter_accreg_tosql (account_id, reg);
-    mapif_account_reg (fd, RFIFOP (fd, 0)); // Send confirm message to map
-    return 0;
-}
-
-// Request the value of account_reg
-int mapif_parse_AccRegRequest (int fd)
-{
-//  printf("mapif: accreg request\n");
-    return mapif_account_reg_reply (fd, RFIFOL (fd, 2));
-}
-
-//--------------------------------------------------------
-int inter_parse_frommap (int fd)
-{
-    int  cmd = RFIFOW (fd, 0);
-    int  len = 0;
-
-    // inter
-    if (cmd < 0x3000 || cmd >= 0x3000 + (sizeof (inter_recv_packet_length) /
-                                         sizeof (inter_recv_packet_length
-                                                 [0])))
-        return 0;
-
-    // 
-    if ((len =
-         inter_check_length (fd,
-                             inter_recv_packet_length[cmd - 0x3000])) == 0)
-        return 2;
-
-    switch (cmd)
-    {
-        case 0x3000:
-            mapif_parse_GMmessage (fd);
-            break;
-        case 0x3001:
-            mapif_parse_WisRequest (fd);
-            break;
-        case 0x3002:
-            mapif_parse_WisReply (fd);
-            break;
-        case 0x3004:
-            mapif_parse_AccReg (fd);
-            break;
-        case 0x3005:
-            mapif_parse_AccRegRequest (fd);
-            break;
-        default:
-            if (inter_party_parse_frommap (fd))
-                break;
-            if (inter_guild_parse_frommap (fd))
-                break;
-            if (inter_storage_parse_frommap (fd))
-                break;
-            if (inter_pet_parse_frommap (fd))
-                break;
-            return 0;
-    }
-    RFIFOSKIP (fd, len);
-    return 1;
-}
-
-// RFIFO check
-int inter_check_length (int fd, int length)
-{
-    if (length == -1)
-    {                           // v-len packet
-        if (RFIFOREST (fd) < 4) // packet not yet
-            return 0;
-        length = RFIFOW (fd, 2);
-    }
-
-    if (RFIFOREST (fd) < length)    // packet not yet
-        return 0;
-
-    return length;
-}
diff --git a/src/char_sql/inter.h b/src/char_sql/inter.h
deleted file mode 100644
index 3a31f4b..0000000
--- a/src/char_sql/inter.h
+++ /dev/null
@@ -1,43 +0,0 @@
-#ifndef _INTER_H_
-#define _INTER_H_
-
-int  inter_init (const char *file);
-int  inter_parse_frommap (int fd);
-int  inter_mapif_init (int fd);
-
-int  inter_check_length (int fd, int length);
-
-int  inter_log (char *fmt, ...);
-
-#define inter_cfgName "conf/inter_athena.conf"
-
-extern int party_share_level;
-extern char inter_log_filename[1024];
-
-//add include for DBMS(mysql)
-#include <mysql.h>
-
-extern MYSQL mysql_handle;
-extern char tmp_sql[65535];
-extern MYSQL_RES *sql_res;
-extern MYSQL_ROW sql_row;
-extern int sql_cnt;
-
-extern MYSQL lmysql_handle;
-extern char tmp_lsql[65535];
-extern MYSQL_RES *lsql_res;
-extern MYSQL_ROW lsql_row;
-
-extern int char_server_port;
-extern char char_server_ip[32];
-extern char char_server_id[32];
-extern char char_server_pw[32];
-extern char char_server_db[32];
-
-extern int login_db_server_port;
-extern char login_db_server_ip[32];
-extern char login_db_server_id[32];
-extern char login_db_server_pw[32];
-extern char login_db_server_db[32];
-
-#endif
diff --git a/src/char_sql/itemdb.c b/src/char_sql/itemdb.c
deleted file mode 100644
index ee0801f..0000000
--- a/src/char_sql/itemdb.c
+++ /dev/null
@@ -1,265 +0,0 @@
-// $Id: itemdb.c,v 1.1.1.1 2004/09/10 17:44:48 MagicalTux Exp $
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-
-#include "itemdb.h"
-#include "db.h"
-#include "inter.h"
-#include "char.h"
-#include "utils.h"
-
-#ifdef MEMWATCH
-#include "memwatch.h"
-#endif
-
-#define MAX_RANDITEM	2000
-
-// ** ITEMDB_OVERRIDE_NAME_VERBOSE **
-//   itemdb.txtgrf.
-//#define ITEMDB_OVERRIDE_NAME_VERBOSE  1
-
-char item_db_db[256] = "item_db";   // added to specify item_db sql table [Valaris]
-
-static struct dbt *item_db;
-
-/*==========================================
- * DB
- *------------------------------------------
- */
-struct item_data *itemdb_search (int nameid)
-{
-    struct item_data *id;
-
-    id = numdb_search (item_db, nameid);
-    if (id)
-        return id;
-
-    CREATE (id, struct item_data, 1);
-
-    numdb_insert (item_db, nameid, id);
-
-    if (nameid > 500 && nameid < 600)
-        id->type = 0;           //heal item
-    else if (nameid > 600 && nameid < 700)
-        id->type = 2;           //use item
-    else if ((nameid > 700 && nameid < 1100) ||
-             (nameid > 7000 && nameid < 8000))
-        id->type = 3;           //correction
-    else if (nameid >= 1750 && nameid < 1771)
-        id->type = 10;          //arrow
-    else if (nameid > 1100 && nameid < 2000)
-        id->type = 4;           //weapon
-    else if ((nameid > 2100 && nameid < 3000) ||
-             (nameid > 5000 && nameid < 6000))
-        id->type = 5;           //armor
-    else if (nameid > 4000 && nameid < 5000)
-        id->type = 6;           //card
-    else if (nameid > 9000 && nameid < 10000)
-        id->type = 7;           //egg
-    else if (nameid > 10000)
-        id->type = 8;           //petequip
-
-    return id;
-}
-
-/*==========================================
- *
- *------------------------------------------
- */
-int itemdb_isequip (int nameid)
-{
-    int  type = itemdb_type (nameid);
-    if (type == 0 || type == 2 || type == 3 || type == 6 || type == 10)
-        return 0;
-    return 1;
-}
-
-/*==========================================
- *
- *------------------------------------------
- */
-int itemdb_isequip2 (struct item_data *data)
-{
-    if (data)
-    {
-        int  type = data->type;
-        if (type == 0 || type == 2 || type == 3 || type == 6 || type == 10)
-            return 0;
-        else
-            return 1;
-    }
-    return 0;
-}
-
-/*==========================================
- * 
- *------------------------------------------
- */
-static int itemdb_readdb (void)
-{
-    FILE *fp;
-    char line[1024];
-    int  ln = 0;
-    int  nameid, j;
-    char *str[32], *p, *np;
-    struct item_data *id;
-
-    fp = fopen_ ("db/item_db.txt", "r");
-    if (fp == NULL)
-    {
-        printf ("can't read db/item_db.txt\n");
-        exit (1);
-    }
-    while (fgets (line, 1020, fp))
-    {
-        if (line[0] == '/' && line[1] == '/')
-            continue;
-        memset (str, 0, sizeof (str));
-        for (j = 0, np = p = line; j < 17 && p; j++)
-        {
-            str[j] = p;
-            p = strchr (p, ',');
-            if (p)
-            {
-                *p++ = 0;
-                np = p;
-            }
-        }
-        if (str[0] == NULL)
-            continue;
-
-        nameid = atoi (str[0]);
-        if (nameid <= 0 || nameid >= 20000)
-            continue;
-        ln++;
-
-        //ID,Name,Jname,Type,Price,Sell,Weight,ATK,DEF,Range,Slot,Job,Gender,Loc,wLV,eLV,View
-        id = itemdb_search (nameid);
-        memcpy (id->name, str[1], 24);
-        memcpy (id->jname, str[2], 24);
-        id->type = atoi (str[3]);
-
-    }
-    fclose_ (fp);
-    printf ("read db/item_db.txt done (count=%d)\n", ln);
-    return 0;
-}
-
-static int itemdb_read_sqldb (void) // sql item_db read, shortened version of map-server item_db read [Valaris]
-{
-    unsigned int nameid;        // Type should be "unsigned short int", but currently isn't for compatibility with numdb_insert()
-    struct item_data *id;
-
-    // ----------
-
-    // Output query to retrieve all rows from the item database table
-    sprintf (tmp_sql, "SELECT * FROM `%s`", item_db_db);
-
-    // Execute the query; if the query execution fails, output an error
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("Database server error (executing query for %s): %s\n",
-                item_db_db, mysql_error (&mysql_handle));
-    }
-
-    // Store the query result
-    sql_res = mysql_store_result (&mysql_handle);
-
-    // If the storage of the query result succeeded
-    if (sql_res)
-    {
-        // Parse each row in the query result into sql_row
-        while ((sql_row = mysql_fetch_row (sql_res)))
-        {
-            nameid = atoi (sql_row[0]);
-
-            // If the identifier is not within the valid range, process the next row
-            if (nameid == 0 || nameid >= 20000)
-            {                   // Should ">= 20000" be "> 20000"?
-                continue;
-            }
-
-            // ----------
-
-            // Insert a new row into the item database
-/*
-			id = calloc(sizeof(struct item_data), 1);
-
-			if (id == NULL) {
-				printf("out of memory : itemdb_read_sqldb\n");
-				exit(1);
-			}
-
-			memset(id, 0, sizeof(struct item_data));
-			numdb_insert(item_db, nameid, id);
-
-			// ----------
-*/
-            id = itemdb_search (nameid);
-
-            memcpy (id->name, sql_row[1], 24);
-            memcpy (id->jname, sql_row[2], 24);
-
-            id->type = atoi (sql_row[3]);
-        }
-
-        // If the retrieval failed, output an error
-        if (mysql_errno (&mysql_handle))
-        {
-            printf ("Database server error (retrieving rows from %s): %s\n",
-                    item_db_db, mysql_error (&mysql_handle));
-        }
-
-        printf ("read %s done (count = %lu)\n", item_db_db,
-                (unsigned long) mysql_num_rows (sql_res));
-
-        // Free the query result
-        mysql_free_result (sql_res);
-    }
-    else
-    {
-        printf ("MySQL error (storing query result for %s): %s\n", item_db_db,
-                mysql_error (&mysql_handle));
-    }
-
-    return 0;
-}
-
-static int itemdb_final (void *key, void *data, va_list ap)
-{
-    struct item_data *id;
-
-    id = data;
-    if (id->use_script)
-        free (id->use_script);
-    if (id->equip_script)
-        free (id->equip_script);
-    free (id);
-
-    return 0;
-}
-
-/*==========================================
- *
- *------------------------------------------
- */
-void do_final_itemdb (void)
-{
-    if (item_db)
-    {
-        numdb_final (item_db, itemdb_final);
-        item_db = NULL;
-    }
-}
-
-int do_init_itemdb (void)
-{
-    item_db = numdb_init ();
-
-    if (db_use_sqldbs)          // it db_use_sqldbs in inter config are yes, will read from item_db for char server display [Valaris]
-        itemdb_read_sqldb ();
-    else
-        itemdb_readdb ();
-    return 0;
-}
diff --git a/src/char_sql/itemdb.h b/src/char_sql/itemdb.h
deleted file mode 100644
index 5d55c1b..0000000
--- a/src/char_sql/itemdb.h
+++ /dev/null
@@ -1,35 +0,0 @@
-#ifndef _ITEMDB_H_
-#define _ITEMDB_H_
-
-struct item_data
-{
-    int  nameid;
-    char name[24], jname[24];
-    int  value_buy, value_sell, value_notdc, value_notoc;
-    int  type;
-    int  class;
-    int  sex;
-    int  equip;
-    int  weight;
-    int  atk;
-    int  def;
-    int  range;
-    int  slot;
-    int  look;
-    int  elv;
-    int  wlv;
-    char *use_script;           // 
-    char *equip_script;         // ,?
-    char available;
-};
-
-struct item_data *itemdb_search (int nameid);
-#define itemdb_type(n) itemdb_search(n)->type
-
-int  itemdb_isequip (int);
-int  itemdb_isequip2 (struct item_data *);
-
-void do_final_itemdb (void);
-int  do_init_itemdb (void);
-
-#endif
diff --git a/src/char_sql/make.sh b/src/char_sql/make.sh
deleted file mode 100644
index a4ca8b5..0000000
--- a/src/char_sql/make.sh
+++ /dev/null
@@ -1,11 +0,0 @@
-#!/bin/sh
-	rsqlt=`rm -rf *.o`
-	gcc -c char.c -I/usr/local/include/mysql/
-	gcc -c int_guild.c -I/usr/local/include/mysql/
-	gcc -c int_party.c -I/usr/local/include/mysql/
-	gcc -c int_pet.c -I/usr/local/include/mysql/
-	gcc -c int_storage.c -I/usr/local/include/mysql/
-	gcc -c inter.c -I/usr/local/include/mysql/
-	gcc -c strlib.c
-	gcc -c itemdb.c -I../common/
-	gcc -o ../char-server inter.o char.o int_pet.o int_storage.o int_guild.o int_party.o strlib.o itemdb.o ../common/core.o ../common/socket.o ../common/timer.o ../common/db.o -L/usr/local/lib/mysql -lmysqlclient -lz
diff --git a/src/char_sql/readme.txt b/src/char_sql/readme.txt
deleted file mode 100644
index 41b1144..0000000
--- a/src/char_sql/readme.txt
+++ /dev/null
@@ -1,250 +0,0 @@
-//Encoded with UTF-8 (UNICODE)
-//---------------------------------------------
-// V.018 - Aarlex
-1. ADD Makefile & GNUmakefile
-2. fix guild_leave.
-3. fix char select windows HP & SP value error.
-
-// V.017 - Aarlex
-1. fix guild member view job update.(For mod-0728)
-   inter.c
-   int_guild.c
-
-// V.016 - by Aarlex
-1. Add e-mail check when you Delete char data.
-2. modify storage save func like 014.
-2. remove Lan_support func.
-
-// v.014 - by Aarlex
-I rewrite save function.
-besause myfriend find that Mysql will use more than 40% CPU.
-And log file is too big (4 days 22G ..= =+)
-(maybe he sets autosave_time less then 1 min.)
-but. i still rewrite save func.
-char server will delete all of user item(inventory & Cart) data then insert them again before.
-so i use two struct to save item data from map & database.
-then compare two struct to get different .
-AND add some debug message.but message maybe too much XD.
-
-
-1. ADDED itemdb.c itemdb.h
-2. modify mmo_char_tosql().
-3. ADDED memitemdata_to_sql().
-4. ADDED some debug message in memitemdata_to_sql().
-5. modify make.sh 
-
-// v.013 - by Aarlex
-1. some SQL sentance fix in old version Mysql .
-
-2. in_guild.c mapif_guild_leaved() 
-   unsigned char buf[64] -> unsigned char buf[128]
-
-3. in_pet.c inter_pet_tosql()
-   if (sql_res) - > if (mysql_num_rows(sql_res)!=0)
-
-4. in_char.c mmo_char_send006b()
-
-   WFIFOW(fd, offset+(i*106)+42) = char_dat[0].hp     -> WFIFOW(fd,offset+(i*106)+42) = (char_dat[j].hp > 0x7fff)? 0x7fff:char_dat[j].hp;
-   WFIFOW(fd, offset+(i*106)+44) = char_dat[0].max_hp -> WFIFOW(fd,offset+(i*106)+44) = (char_dat[j].max_hp > 0x7fff)? 0x7fff:char_dat[j].max_hp;
-   WFIFOW(fd, offset+(i*106)+46) = char_dat[0].sp     -> WFIFOW(fd,offset+(i*106)+46) = (char_dat[j].sp > 0x7fff)? 0x7fff:char_dat[j].sp
-   WFIFOW(fd, offset+(i*106)+48) = char_dat[0].max_sp -> WFIFOW(fd,offset+(i*106)+48) = (char_dat[j].max_sp > 0x7fff)? 0x7fff:char_dat[j].max_sp;
-
-   in_char.c parse_char()  
-
-   WFIFOW(fd, offset+(i*106)+42) = char_dat[0].hp     -> WFIFOW(fd,offset+(i*106)+42) = (char_dat[j].hp > 0x7fff)? 0x7fff:char_dat[j].hp;
-   WFIFOW(fd, offset+(i*106)+44) = char_dat[0].max_hp -> WFIFOW(fd,offset+(i*106)+44) = (char_dat[j].max_hp > 0x7fff)? 0x7fff:char_dat[j].max_hp;
-   WFIFOW(fd, offset+(i*106)+46) = char_dat[0].sp     -> WFIFOW(fd,offset+(i*106)+46) = (char_dat[j].sp > 0x7fff)? 0x7fff:char_dat[j].sp
-   WFIFOW(fd, offset+(i*106)+48) = char_dat[0].max_sp -> WFIFOW(fd,offset+(i*106)+48) = (char_dat[j].max_sp > 0x7fff)? 0x7fff:char_dat[j].max_sp;
-
-// v.012 - by Jazz
-1. 0627 official version.
-2. no more binary files are supplied.
-
-//---------------------------------------------
-// v.011 - by Mark
-1. Fixed a couple bugs which would cause segfaults under linux :)
-
-//---------------------------------------------
-// v.010 - by Jazz
-1. added some debug info - for reporting.
-
-//---------------------------------------------
-// v.009 - by Jazz
-1. code added for debug.
-2. some SQL sentance fix.
-
-//---------------------------------------------
-// v.009 - by Jazz
-1. fix crash bug. - pet db.
-
-//---------------------------------------------
-// v.008 - by Jazz
-1. DB table fix. - char.fix-from.007.to.008.sql
-
- table .
-
-item.equip 'unsigned short' . 
- SQL table.
-
- char.fix-from.007.to.008.sql .
-MySQL. .
-
-//---------------------------------------------
-// v.007 - by Jazz
-1. domain .
-
-//---------------------------------------------
-// v.006 - by Jazz
-1. crash bug fix. - when your pet DB is empty
-
-//---------------------------------------------
-// v.005 - by Jazz
-1. 0590 official version.
-
-//---------------------------------------------
-// v.004 - by Jazz
-1. 0586 official version.
-
-//---------------------------------------------
-// v.003 - by Jazz
-1. official guild.c  party.c .
-
-//---------------------------------------------
-// v.002 - by Jazz
-1. aphostropy . .
-2. SQL.
-
-//---------------------------------------------
-// v.001 - by Jazz
-1.  version. alpha version.
-
-//------------------------------------------------------------------------
-//For JAPANESE USER
-Athena Char-Server for MySQL. 005
-
- guild party athena char-server file .
-, ,  file.
- char , lost.
-
-MySQL compile MySQL Clients Library. windows(cygwin)  binary.
-
-:
- text->DB converter. .
- upload.
-
-1. char.sql MySQL dump.
-
-2. inter_athena.conf.  DB.
- windows(cygwin) localhost. ip.
-localhost UNIX domain socket.
-
-//3306 is default
-db_server_port: 3306
-//DB ip
-db_server_ip: 127.0.0.1
-//DB id
-db_server_id: ragnarok
-//DB pass
-db_server_pw: ragnarok
-//DB name
-db_server_logindb: ragnarok
-
-3. MySQL  2 MySQL connect session.
-,  inter server.
-
- P4 2.4a/1024MB/WinXP pro(MediaCenter Edition 2K4 KR)/Cygwin GCC .
-.
-. .
-
- DarkWeiss login server MySQL.
- athena DarkWeiss .
-
-contact : jazz@creper.com
-
-//------------------------------------------------------------------------
-//For KOREAN USER
-Athena Char-Server for MySQL. 005
-
- guild party     athena char-server   file    .
- ,    ,    file      .
- char  , lost       .
-
-MySQL compile MySQL Clients Library . windows(cygwin)   binary .
-
-:
- text->DB converter   .      .
-  upload .
-
-1. char.sql MySQL dump.
-
-2. inter_athena.conf   .   DB   .
- windows(cygwin)  localhost  . ip  .
-localhost   UNIX domain socket      .
-
-//3306 is default
-db_server_port: 3306
-//DB ip
-db_server_ip: 127.0.0.1
-//DB id
-db_server_id: ragnarok
-//DB pass
-db_server_pw: ragnarok
-//DB name
-db_server_logindb: ragnarok
-
-3. MySQL  2 MySQL connect session .
-     ,  inter server  .
-
-   P4 2.4a/1024MB/WinXP pro(MediaCenter Edition 2K4 KR)/Cygwin GCC .
-      .
-     .     .
-
- DarkWeiss login server MySQL  .
- athena  DarkWeiss     .
-
-contact : jazz@creper.com
-
-//------------------------------------------------------------------------
-//For ENGLISH USER
-Athena Char-Server for MySQL. alpha 005
-
-= hehe. My English is poor. and I have no time to write. :)
-
-anyway this version use guild and party data on text file base system.
-It accesses many times, so memory dumping is useful for less cpu consume.
-
-MySQL version need MySQL Clients Library to compile. This include Win32-binary compiled by cygwin-gcc.
-
-Install:
-not yet text->DB converter. I found some bug on it, so It's under debug progress.
-
-1. dump char.sql to MySQL.
-
-2. add below on inter_athena.conf. and set your own information.
-do not use 'localhost' as domain on cygwin. you must set as ip.
-if you use localhost on cygwin, cygwin tries to connect MySQL as UNIX domain socket.
-but, MySQL does not support UNIX domain socket on windows.
-
-//3306 is default
-db_server_port: 3306
-//DB ip
-db_server_ip: 127.0.0.1
-//DB id
-db_server_id: ragnarok
-//DB pass
-db_server_pw: ragnarok
-//DB name
-db_server_logindb: ragnarok
-
-3. MySQL version has 2 MySQL connect session.
-one is for char-server and the other one is for inter-server.
-
-developement enviroment)
- P4 2.4a/1024MB/WinXP pro(MediaCenter Edition 2K4 KR)/Cygwin GCC
-
-I'm korean, so contect if U're Korean developer.
-Please contact me, If U can use Korean & Japanese well.
-
-DarkWeiss starts to support MySQL version of login server, but Athena's one works better, I thnik.
-
-contact : jazz@creper.com
diff --git a/src/char_sql/strlib.c b/src/char_sql/strlib.c
deleted file mode 100644
index 02911d1..0000000
--- a/src/char_sql/strlib.c
+++ /dev/null
@@ -1,89 +0,0 @@
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-
-#include "strlib.h"
-#include "utils.h"
-
-//-----------------------------------------------
-// string lib.
-unsigned char *jstrescape (unsigned char *pt)
-{
-    //copy from here
-    unsigned char *ptr;
-    int  i = 0, j = 0;
-
-    //copy string to temporary
-    CREATE (ptr, char, J_MAX_MALLOC_SIZE);
-    strcpy (ptr, pt);
-
-    while (ptr[i] != '\0')
-    {
-        switch (ptr[i])
-        {
-            case '\'':
-                pt[j++] = '\\';
-                pt[j++] = ptr[i++];
-                break;
-            case '\\':
-                pt[j++] = '\\';
-                pt[j++] = ptr[i++];
-                break;
-            default:
-                pt[j++] = ptr[i++];
-        }
-    }
-    pt[j++] = '\0';
-    free (ptr);
-    return (unsigned char *) &pt[0];
-}
-
-unsigned char *jstrescapecpy (unsigned char *pt, unsigned char *spt)
-{
-    //copy from here
-    int  i = 0, j = 0;
-
-    while (spt[i] != '\0')
-    {
-        switch (spt[i])
-        {
-            case '\'':
-                pt[j++] = '\\';
-                pt[j++] = spt[i++];
-                break;
-            case '\\':
-                pt[j++] = '\\';
-                pt[j++] = spt[i++];
-                break;
-            default:
-                pt[j++] = spt[i++];
-        }
-    }
-    pt[j++] = '\0';
-    return (unsigned char *) &pt[0];
-}
-
-int jmemescapecpy (unsigned char *pt, unsigned char *spt, int size)
-{
-    //copy from here
-    int  i = 0, j = 0;
-
-    while (i < size)
-    {
-        switch (spt[i])
-        {
-            case '\'':
-                pt[j++] = '\\';
-                pt[j++] = spt[i++];
-                break;
-            case '\\':
-                pt[j++] = '\\';
-                pt[j++] = spt[i++];
-                break;
-            default:
-                pt[j++] = spt[i++];
-        }
-    }
-    // copy size is 0 ~ (j-1)
-    return j;
-}
diff --git a/src/char_sql/strlib.h b/src/char_sql/strlib.h
deleted file mode 100644
index f8da756..0000000
--- a/src/char_sql/strlib.h
+++ /dev/null
@@ -1,10 +0,0 @@
-#ifndef _J_STR_LIB_H_
-#define _J_STR_LIB_H_
-#define J_MAX_MALLOC_SIZE 65535
-// String function library.
-// code by Jioh L. Jung (ziozzang@4wish.net)
-// This code is under license "BSD"
-unsigned char *jstrescape (unsigned char *pt);
-unsigned char *jstrescapecpy (unsigned char *pt, unsigned char *spt);
-int  jmemescapecpy (unsigned char *pt, unsigned char *spt, int size);
-#endif
diff --git a/src/ladmin/Makefile b/src/ladmin/Makefile
deleted file mode 100644
index d81d0dc..0000000
--- a/src/ladmin/Makefile
+++ /dev/null
@@ -1,16 +0,0 @@
-include ../../make.defs
-
-all: ladmin
-txt: ladmin
-sql: ladmin
-
-COMMON_OBJ = ../common/core.o ../common/socket.o ../common/timer.o ../common/db.o ../common/malloc.o ../common/showmsg.o ../common/strlib.o ../common/mt_rand.o
-COMMON_H = ../common/core.h ../common/socket.h ../common/timer.h ../common/mmo.h ../common/version.h ../common/db.h ../common/malloc.h ../common/showmsg.h ../common/strlib.h ../common/mt_rand.h
-
-ladmin: ladmin.o md5calc.o $(COMMON_OBJ)
-	$(CC) -o ../../$@ ladmin.o md5calc.o $(COMMON_OBJ)
-ladmin.o: ladmin.c ladmin.h md5calc.h $(COMMON_H)
-md5calc.o: md5calc.c md5calc.h
-
-clean:
-	rm -f *.o ../../ladmin
diff --git a/src/ladmin/ladmin.c b/src/ladmin/ladmin.c
deleted file mode 100644
index 5ef9b6c..0000000
--- a/src/ladmin/ladmin.c
+++ /dev/null
@@ -1,6651 +0,0 @@
-// $Id: ladmin.c,v 1.1.1.1 2004/09/10 17:26:52 MagicalTux Exp $
-///////////////////////////////////////////////////////////////////////////
-// EAthena login-server remote administration tool
-// Ladamin in C by [Yor]
-// if you modify this software, modify ladmin in tool too.
-///////////////////////////////////////////////////////////////////////////
-
-#include <sys/types.h>
-#include <sys/socket.h>
-#include <stdio.h>
-#include <stdlib.h>
-#include <netinet/in.h>
-#include <sys/time.h>           // gettimeofday
-#include <time.h>
-#include <sys/ioctl.h>
-#include <unistd.h>             // close
-#include <signal.h>
-#include <fcntl.h>
-#include <string.h>             // str*
-#include <arpa/inet.h>          // inet_addr
-#include <netdb.h>              // gethostbyname
-#include <stdarg.h>             // valist
-#include <ctype.h>              // tolower
-
-#include "core.h"
-#include "socket.h"
-#include "ladmin.h"
-#include "version.h"
-#include "mmo.h"
-
-#ifdef PASSWORDENC
-#include "md5calc.h"
-#endif
-
-#ifdef MEMWATCH
-#include "memwatch.h"
-#endif
-
-extern int eathena_interactive_session; // from core.c
-#define Iprintf if (eathena_interactive_session) printf
-
-//-------------------------------INSTRUCTIONS------------------------------
-// Set the variables below:
-//   IP of the login server.
-//   Port where the login-server listens incoming packets.
-//   Password of administration (same of config_athena.conf).
-//   Displayed language of the sofware (if not correct, english is used).
-// IMPORTANT:
-//   Be sure that you authorize remote administration in login-server
-//   (see login_athena.conf, 'admin_state' parameter)
-//-------------------------------------------------------------------------
-char loginserverip[16] = "127.0.0.1";   // IP of login-server
-int  loginserverport = 6900;    // Port of login-server
-char loginserveradminpassword[24] = "admin";    // Administration password
-#ifdef PASSWORDENC
-int  passenc = 2;               // Encoding type of the password
-#else
-int  passenc = 0;               // Encoding type of the password
-#endif
-char defaultlanguage = 'E';     // Default language (F: Franais/E: English)
-                                             // (if it's not 'F', default is English)
-char ladmin_log_filename[1024] = "log/ladmin.log";
-char date_format[32] = "%Y-%m-%d %H:%M:%S";
-//-------------------------------------------------------------------------
-//  LIST of COMMANDs that you can type at the prompt:
-//    To use these commands you can only type only the first letters.
-//    You must type a minimum of letters (you can not type 'a',
-//      because ladmin doesn't know if it's for 'aide' or for 'add')
-//    <Example> q <= quit, li <= list, pass <= passwd, etc.
-//
-//  Note: every time you must give a account_name, you can use "" or '' (spaces can be included)
-//
-//  aide/help/?
-//    Display the description of the commands
-//  aide/help/? [command]
-//    Display the description of the specified command
-//
-//  add <account_name> <sex> <password>
-//    Create an account with the default email (a@a.com).
-//    Concerning the sex, only the first letter is used (F or M).
-//    The e-mail is set to a@a.com (default e-mail). It's like to have no e-mail.
-//    When the password is omitted, the input is done without displaying of the pressed keys.
-//    <example> add testname Male testpass
-//
-//  ban/banish yyyy/mm/dd hh:mm:ss <account name>
-//    Changes the final date of a banishment of an account.
-//    Like banset, but <account name> is at end.
-//
-//  banadd <account_name> <modifier>
-//    Adds or substracts time from the final date of a banishment of an account.
-//    Modifier is done as follows:
-//      Adjustment value (-1, 1, +1, etc...)
-//      Modified element:
-//        a or y: year
-//        m:  month
-//        j or d: day
-//        h:  hour
-//        mn: minute
-//        s:  second
-//    <example> banadd testname +1m-2mn1s-6y
-//              this example adds 1 month and 1 second, and substracts 2 minutes and 6 years at the same time.
-//  NOTE: If you modify the final date of a non-banished account,
-//        you fix the final date to (actual time +- adjustments)
-//
-//  banset <account_name> yyyy/mm/dd [hh:mm:ss]
-//    Changes the final date of a banishment of an account.
-//    Default time [hh:mm:ss]: 23:59:59.
-//  banset <account_name> 0
-//    Set a non-banished account (0 = unbanished).
-//
-//  block <account name>
-//    Set state 5 (You have been blocked by the GM Team) to an account.
-//    Like state <account name> 5.
-//
-//  check <account_name> <password>
-//    Check the validity of a password for an account
-//    NOTE: Server will never sends back a password.
-//          It's the only method you have to know if a password is correct.
-//          The other method is to have a ('physical') access to the accounts file.
-//
-//  create <account_name> <sex> <email> <password>
-//    Like the 'add' command, but with e-mail moreover.
-//    <example> create testname Male my@mail.com testpass
-//
-//  del <account name>
-//    Remove an account.
-//    This order requires confirmation. After confirmation, the account is deleted.
-//
-//  email <account_name> <email>
-//    Modify the e-mail of an account.
-//
-//  getcount
-//    Give the number of players online on all char-servers.
-//
-//  gm <account_name> [GM_level]
-//    Modify the GM level of an account.
-//    Default value remove GM level (GM level = 0).
-//    <example> gm testname 80
-//
-//  id <account name>
-//    Give the id of an account.
-//
-//  info <account_id>
-//    Display complete information of an account.
-//
-//  kami <message>
-//    Sends a broadcast message on all map-server (in yellow).
-//  kamib <message>
-//    Sends a broadcast message on all map-server (in blue).
-//
-//  language <language>
-//    Change the language of displaying.
-//
-//  list/ls [start_id [end_id]]
-//    Display a list of accounts.
-//    'start_id', 'end_id': indicate end and start identifiers.
-//    Research by name is not possible with this command.
-//    <example> list 10 9999999
-//
-//  listBan/lsBan [start_id [end_id]]
-//    Like list/ls, but only for accounts with state or banished
-//
-//  listGM/lsGM [start_id [end_id]]
-//    Like list/ls, but only for GM accounts
-//
-//  listOK/lsOK [start_id [end_id]]
-//    Like list/ls, but only for accounts without state and not banished
-//
-//  memo <account_name> <memo>
-//    Modify the memo of an account.
-//    'memo': it can have until 253 characters (with spaces or not).
-//
-//  name <account_id>
-//    Give the name of an account.
-//
-//  passwd <account_name> <new_password>
-//    Change the password of an account.
-//    When new password is omitted, the input is done without displaying of the pressed keys.
-//
-//  quit/end/exit
-//    End of the program of administration
-//
-//  reloadGM
-//    Reload GM configuration file
-//
-//  search <expression>
-//    Seek accounts.
-//    Displays the accounts whose names correspond.
-//  search -r/-e/--expr/--regex <expression>
-//    Seek accounts by regular expression.
-//    Displays the accounts whose names correspond.
-//
-//  sex <account_name> <sex>
-//    Modify the sex of an account.
-//    <example> sex testname Male
-//
-//  state <account_name> <new_state> <error_message_#7>
-//    Change the state of an account.
-//    'new_state': state is the state of the packet 0x006a + 1. The possibilities are:
-//                 0 = Account ok            6 = Your Game's EXE file is not the latest version
-//                 1 = Unregistered ID       7 = You are Prohibited to log in until %s
-//                 2 = Incorrect Password    8 = Server is jammed due to over populated
-//                 3 = This ID is expired    9 = No MSG
-//                 4 = Rejected from Server  100 = This ID has been totally erased
-//                 5 = You have been blocked by the GM Team
-//                 all other values are 'No MSG', then use state 9 please.
-//    'error_message_#7': message of the code error 6 = Your are Prohibited to log in until %s (packet 0x006a)
-//
-//  timeadd <account_name> <modifier>
-//    Adds or substracts time from the validity limit of an account.
-//    Modifier is done as follows:
-//      Adjustment value (-1, 1, +1, etc...)
-//      Modified element:
-//        a or y: year
-//        m:  month
-//        j or d: day
-//        h:  hour
-//        mn: minute
-//        s:  second
-//    <example> timeadd testname +1m-2mn1s-6y
-//              this example adds 1 month and 1 second, and substracts 2 minutes and 6 years at the same time.
-//  NOTE: You can not modify a unlimited validity limit.
-//        If you want modify it, you want probably create a limited validity limit.
-//        So, at first, you must set the validity limit to a date/time.
-//
-//  timeset <account_name> yyyy/mm/dd [hh:mm:ss]
-//    Changes the validity limit of an account.
-//    Default time [hh:mm:ss]: 23:59:59.
-//  timeset <account_name> 0
-//    Gives an unlimited validity limit (0 = unlimited).
-//
-//  unban/unbanish <account name>
-//    Unban an account.
-//    Like banset <account name> 0.
-//
-//  unblock <account name>
-//    Set state 0 (Account ok) to an account.
-//    Like state <account name> 0.
-//
-//  version
-//    Display the version of the login-server.
-//
-//  who <account name>
-//    Displays complete information of an account.
-//
-//-------------------------------------------------------------------------
-int  login_fd;
-int  login_ip;
-int  bytes_to_read = 0;         // flag to know if we waiting bytes from login-server
-char command[1024];
-char parameters[1024];
-int  list_first, list_last, list_type, list_count;  // parameter to display a list of accounts
-int  already_exit_function = 0; // sometimes, the exit function is called twice... so, don't log twice the message
-
-//------------------------------
-// Writing function of logs file
-//------------------------------
-int ladmin_log (char *fmt, ...)
-{
-    FILE *logfp;
-    va_list ap;
-    struct timeval tv;
-    char tmpstr[2048];
-
-    va_start (ap, fmt);
-
-    logfp = fopen_ (ladmin_log_filename, "a");
-    if (logfp)
-    {
-        if (fmt[0] == '\0')     // jump a line if no message
-            fprintf (logfp, RETCODE);
-        else
-        {
-            gettimeofday (&tv, NULL);
-            strftime (tmpstr, 24, date_format, localtime (&(tv.tv_sec)));
-            sprintf (tmpstr + strlen (tmpstr), ".%03d: %s",
-                     (int) tv.tv_usec / 1000, fmt);
-            vfprintf (logfp, tmpstr, ap);
-        }
-        fclose_ (logfp);
-    }
-
-    va_end (ap);
-    return 0;
-}
-
-//-----------------------------------------------------
-// Function to suppress control characters in a string.
-//-----------------------------------------------------
-int remove_control_chars (unsigned char *str)
-{
-    int  i;
-    int  change = 0;
-
-    for (i = 0; str[i]; i++)
-    {
-        if (str[i] < 32)
-        {
-            str[i] = '_';
-            change = 1;
-        }
-    }
-
-    return change;
-}
-
-//---------------------------------------------
-// Function to return ordonal text of a number.
-//---------------------------------------------
-char *makeordinal (int number)
-{
-    if (defaultlanguage == 'F')
-    {
-        if (number == 0)
-            return "";
-        else if (number == 1)
-            return "er";
-        else
-            return "me";
-    }
-    else
-    {
-        if ((number % 10) < 4 && (number % 10) != 0
-            && (number < 10 || number > 20))
-        {
-            if ((number % 10) == 1)
-                return "st";
-            else if ((number % 10) == 2)
-                return "nd";
-            else
-                return "rd";
-        }
-        else
-        {
-            return "th";
-        }
-    }
-    return "";
-}
-
-//-----------------------------------------------------------------------------------------
-// Function to test of the validity of an account name (return 0 if incorrect, and 1 if ok)
-//-----------------------------------------------------------------------------------------
-int verify_accountname (char *account_name)
-{
-    int  i;
-
-    for (i = 0; account_name[i]; i++)
-    {
-        if (account_name[i] < 32)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf
-                    ("Caractre interdit trouv dans le nom du compte (%d%s caractre).\n",
-                     i + 1, makeordinal (i + 1));
-                ladmin_log
-                    ("Caractre interdit trouv dans le nom du compte (%d%s caractre)."
-                     RETCODE, i + 1, makeordinal (i + 1));
-            }
-            else
-            {
-                printf
-                    ("Illegal character found in the account name (%d%s character).\n",
-                     i + 1, makeordinal (i + 1));
-                ladmin_log
-                    ("Illegal character found in the account name (%d%s character)."
-                     RETCODE, i + 1, makeordinal (i + 1));
-            }
-            return 0;
-        }
-    }
-
-    if (strlen (account_name) < 4)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Nom du compte trop court. Entrez un nom de compte de 4-23 caractres.\n");
-            ladmin_log
-                ("Nom du compte trop court. Entrez un nom de compte de 4-23 caractres."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Account name is too short. Please input an account name of 4-23 bytes.\n");
-            ladmin_log
-                ("Account name is too short. Please input an account name of 4-23 bytes."
-                 RETCODE);
-        }
-        return 0;
-    }
-
-    if (strlen (account_name) > 23)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Nom du compte trop long. Entrez un nom de compte de 4-23 caractres.\n");
-            ladmin_log
-                ("Nom du compte trop long. Entrez un nom de compte de 4-23 caractres."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Account name is too long. Please input an account name of 4-23 bytes.\n");
-            ladmin_log
-                ("Account name is too long. Please input an account name of 4-23 bytes."
-                 RETCODE);
-        }
-        return 0;
-    }
-
-    return 1;
-}
-
-//---------------------------------------------------
-// E-mail check: return 0 (not correct) or 1 (valid).
-//---------------------------------------------------
-int e_mail_check (unsigned char *email)
-{
-    char ch;
-    unsigned char *last_arobas;
-
-    // athena limits
-    if (strlen (email) < 3 || strlen (email) > 39)
-        return 0;
-
-    // part of RFC limits (official reference of e-mail description)
-    if (strchr (email, '@') == NULL || email[strlen (email) - 1] == '@')
-        return 0;
-
-    if (email[strlen (email) - 1] == '.')
-        return 0;
-
-    last_arobas = strrchr (email, '@');
-
-    if (strstr (last_arobas, "@.") != NULL ||
-        strstr (last_arobas, "..") != NULL)
-        return 0;
-
-    for (ch = 1; ch < 32; ch++)
-    {
-        if (strchr (last_arobas, ch) != NULL)
-        {
-            return 0;
-            break;
-        }
-    }
-
-    if (strchr (last_arobas, ' ') != NULL ||
-        strchr (last_arobas, ';') != NULL)
-        return 0;
-
-    // all correct
-    return 1;
-}
-
-//----------------------------------
-// Sub-function: Input of a password
-//----------------------------------
-int typepasswd (char *password)
-{
-    char password1[1023], password2[1023];
-    int  letter;
-    int  i;
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Aucun mot de passe n'a t donn. Demande d'un mot de passe."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("No password was given. Request to obtain a password."
-                    RETCODE);
-    }
-
-    memset (password1, '\0', sizeof (password1));
-    memset (password2, '\0', sizeof (password2));
-    if (defaultlanguage == 'F')
-        printf ("\033[1;36m Entrez le mot de passe > \033[0;32;42m");
-    else
-        printf ("\033[1;36m Type the password > \033[0;32;42m");
-    i = 0;
-    while ((letter = getchar ()) != '\n')
-        password1[i++] = letter;
-    if (defaultlanguage == 'F')
-        printf
-            ("\033[0m\033[1;36m R-entrez le mot de passe > \033[0;32;42m");
-    else
-        printf ("\033[0m\033[1;36m Verify the password > \033[0;32;42m");
-    i = 0;
-    while ((letter = getchar ()) != '\n')
-        password2[i++] = letter;
-
-    printf ("\033[0m");
-    fflush (stdout);
-    fflush (stdin);
-
-    if (strcmp (password1, password2) != 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Erreur de vrification du mot de passe: Saisissez le mme mot de passe svp.\n");
-            ladmin_log
-                ("Erreur de vrification du mot de passe: Saisissez le mme mot de passe svp."
-                 RETCODE);
-            ladmin_log ("  Premier mot de passe: %s, second mot de passe: %s."
-                        RETCODE, password1, password2);
-        }
-        else
-        {
-            printf
-                ("Password verification failed. Please input same password.\n");
-            ladmin_log
-                ("Password verification failed. Please input same password."
-                 RETCODE);
-            ladmin_log ("  First password: %s, second password: %s." RETCODE,
-                        password1, password2);
-        }
-        return 0;
-    }
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log ("Mot de passe saisi: %s." RETCODE, password1);
-    }
-    else
-    {
-        ladmin_log ("Typed password: %s." RETCODE, password1);
-    }
-    strcpy (password, password1);
-    return 1;
-}
-
-//------------------------------------------------------------------------------------
-// Sub-function: Test of the validity of password (return 0 if incorrect, and 1 if ok)
-//------------------------------------------------------------------------------------
-int verify_password (char *password)
-{
-    int  i;
-
-    for (i = 0; password[i]; i++)
-    {
-        if (password[i] < 32)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf
-                    ("Caractre interdit trouv dans le mot de passe (%d%s caractre).\n",
-                     i + 1, makeordinal (i + 1));
-                ladmin_log
-                    ("Caractre interdit trouv dans le nom du compte (%d%s caractre)."
-                     RETCODE, i + 1, makeordinal (i + 1));
-            }
-            else
-            {
-                printf
-                    ("Illegal character found in the password (%d%s character).\n",
-                     i + 1, makeordinal (i + 1));
-                ladmin_log
-                    ("Illegal character found in the password (%d%s character)."
-                     RETCODE, i + 1, makeordinal (i + 1));
-            }
-            return 0;
-        }
-    }
-
-    if (strlen (password) < 4)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Nom du compte trop court. Entrez un nom de compte de 4-23 caractres.\n");
-            ladmin_log
-                ("Nom du compte trop court. Entrez un nom de compte de 4-23 caractres."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Account name is too short. Please input an account name of 4-23 bytes.\n");
-            ladmin_log
-                ("Account name is too short. Please input an account name of 4-23 bytes."
-                 RETCODE);
-        }
-        return 0;
-    }
-
-    if (strlen (password) > 23)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Mot de passe trop long. Entrez un mot de passe de 4-23 caractres.\n");
-            ladmin_log
-                ("Mot de passe trop long. Entrez un mot de passe de 4-23 caractres."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Password is too long. Please input a password of 4-23 bytes.\n");
-            ladmin_log
-                ("Password is too long. Please input a password of 4-23 bytes."
-                 RETCODE);
-        }
-        return 0;
-    }
-
-    return 1;
-}
-
-//------------------------------------------------------------------
-// Sub-function: Check the name of a command (return complete name)
-//-----------------------------------------------------------------
-int check_command (char *command)
-{
-// help
-    if (strncmp (command, "aide", 2) == 0 && strncmp (command, "aide", strlen (command)) == 0)  // not 1 letter command: 'aide' or 'add'?
-        strcpy (command, "aide");
-    else if (strncmp (command, "help", 1) == 0
-             && strncmp (command, "help", strlen (command)) == 0)
-        strcpy (command, "help");
-// general commands
-    else if (strncmp (command, "add", 2) == 0 && strncmp (command, "add", strlen (command)) == 0)   // not 1 letter command: 'aide' or 'add'?
-        strcpy (command, "add");
-    else if ((strncmp (command, "ban", 3) == 0
-              && strncmp (command, "ban", strlen (command)) == 0)
-             || (strncmp (command, "banish", 4) == 0
-                 && strncmp (command, "banish", strlen (command)) == 0))
-        strcpy (command, "ban");
-    else if ((strncmp (command, "banadd", 4) == 0 && strncmp (command, "banadd", strlen (command)) == 0) || // not 1 letter command: 'ba' or 'bs'? 'banadd' or 'banset' ?
-             strcmp (command, "ba") == 0)
-        strcpy (command, "banadd");
-    else if ((strncmp (command, "banset", 4) == 0 && strncmp (command, "banset", strlen (command)) == 0) || // not 1 letter command: 'ba' or 'bs'? 'banadd' or 'banset' ?
-             strcmp (command, "bs") == 0)
-        strcpy (command, "banset");
-    else if (strncmp (command, "block", 2) == 0
-             && strncmp (command, "block", strlen (command)) == 0)
-        strcpy (command, "block");
-    else if (strncmp (command, "check", 2) == 0 && strncmp (command, "check", strlen (command)) == 0)   // not 1 letter command: 'check' or 'create'?
-        strcpy (command, "check");
-    else if (strncmp (command, "create", 2) == 0 && strncmp (command, "create", strlen (command)) == 0) // not 1 letter command: 'check' or 'create'?
-        strcpy (command, "create");
-    else if (strncmp (command, "delete", 1) == 0
-             && strncmp (command, "delete", strlen (command)) == 0)
-        strcpy (command, "delete");
-    else if ((strncmp (command, "email", 2) == 0 && strncmp (command, "email", strlen (command)) == 0) ||   // not 1 letter command: 'email', 'end' or 'exit'?
-             (strncmp (command, "e-mail", 2) == 0
-              && strncmp (command, "e-mail", strlen (command)) == 0))
-        strcpy (command, "email");
-    else if (strncmp (command, "getcount", 2) == 0 && strncmp (command, "getcount", strlen (command)) == 0) // not 1 letter command: 'getcount' or 'gm'?
-        strcpy (command, "getcount");
-//  else if (strncmp(command, "gm", 2) == 0 && strncmp(command, "gm", strlen(command)) == 0) // not 1 letter command: 'getcount' or 'gm'?
-//      strcpy(command, "gm");
-//  else if (strncmp(command, "id", 2) == 0 && strncmp(command, "id", strlen(command)) == 0) // not 1 letter command: 'id' or 'info'?
-//      strcpy(command, "id");
-    else if (strncmp (command, "info", 2) == 0 && strncmp (command, "info", strlen (command)) == 0) // not 1 letter command: 'id' or 'info'?
-        strcpy (command, "info");
-//  else if (strncmp(command, "kami", 4) == 0 && strncmp(command, "kami", strlen(command)) == 0) // only all letters command: 'kami' or 'kamib'?
-//      strcpy(command, "kami");
-//  else if (strncmp(command, "kamib", 5) == 0 && strncmp(command, "kamib", strlen(command)) == 0) // only all letters command: 'kami' or 'kamib'?
-//      strcpy(command, "kamib");
-    else if ((strncmp (command, "language", 2) == 0 && strncmp (command, "language", strlen (command)) == 0))   // not 1 letter command: 'language' or 'list'?
-        strcpy (command, "language");
-    else if ((strncmp (command, "list", 2) == 0 && strncmp (command, "list", strlen (command)) == 0) || // 'list' is default list command // not 1 letter command: 'language' or 'list'?
-             strcmp (command, "ls") == 0)
-        strcpy (command, "list");
-    else if (strncmp (command, "itemfrob", 6) == 0)
-        strcpy (command, "itemfrob");
-    else if ((strncmp (command, "listban", 5) == 0
-              && strncmp (command, "listban", strlen (command)) == 0)
-             || (strncmp (command, "lsban", 3) == 0
-                 && strncmp (command, "lsban", strlen (command)) == 0)
-             || strcmp (command, "lb") == 0)
-        strcpy (command, "listban");
-    else if ((strncmp (command, "listgm", 5) == 0
-              && strncmp (command, "listgm", strlen (command)) == 0)
-             || (strncmp (command, "lsgm", 3) == 0
-                 && strncmp (command, "lsgm", strlen (command)) == 0)
-             || strcmp (command, "lg") == 0)
-        strcpy (command, "listgm");
-    else if ((strncmp (command, "listok", 5) == 0
-              && strncmp (command, "listok", strlen (command)) == 0)
-             || (strncmp (command, "lsok", 3) == 0
-                 && strncmp (command, "lsok", strlen (command)) == 0)
-             || strcmp (command, "lo") == 0)
-        strcpy (command, "listok");
-    else if (strncmp (command, "memo", 1) == 0
-             && strncmp (command, "memo", strlen (command)) == 0)
-        strcpy (command, "memo");
-    else if (strncmp (command, "name", 1) == 0
-             && strncmp (command, "name", strlen (command)) == 0)
-        strcpy (command, "name");
-    else if ((strncmp (command, "password", 1) == 0
-              && strncmp (command, "password", strlen (command)) == 0)
-             || strcmp (command, "passwd") == 0)
-        strcpy (command, "password");
-    else if (strncmp (command, "reloadgm", 1) == 0
-             && strncmp (command, "reloadgm", strlen (command)) == 0)
-        strcpy (command, "reloadgm");
-    else if (strncmp (command, "search", 3) == 0 && strncmp (command, "search", strlen (command)) == 0) // not 1 letter command: 'search', 'state' or 'sex'?
-        strcpy (command, "search"); // not 2 letters command: 'search' or 'sex'?
-//  else if (strncmp(command, "sex", 3) == 0 && strncmp(command, "sex", strlen(command)) == 0) // not 1 letter command: 'search', 'state' or 'sex'?
-//      strcpy(command, "sex"); // not 2 letters command: 'search' or 'sex'?
-    else if (strncmp (command, "state", 2) == 0 && strncmp (command, "state", strlen (command)) == 0)   // not 1 letter command: 'search', 'state' or 'sex'?
-        strcpy (command, "state");
-    else if ((strncmp (command, "timeadd", 5) == 0 && strncmp (command, "timeadd", strlen (command)) == 0) ||   // not 1 letter command: 'ta' or 'ts'? 'timeadd' or 'timeset'?
-             strcmp (command, "ta") == 0)
-        strcpy (command, "timeadd");
-    else if ((strncmp (command, "timeset", 5) == 0 && strncmp (command, "timeset", strlen (command)) == 0) ||   // not 1 letter command: 'ta' or 'ts'? 'timeadd' or 'timeset'?
-             strcmp (command, "ts") == 0)
-        strcpy (command, "timeset");
-    else if ((strncmp (command, "unban", 5) == 0
-              && strncmp (command, "unban", strlen (command)) == 0)
-             || (strncmp (command, "unbanish", 4) == 0
-                 && strncmp (command, "unbanish", strlen (command)) == 0))
-        strcpy (command, "unban");
-    else if (strncmp (command, "unblock", 4) == 0
-             && strncmp (command, "unblock", strlen (command)) == 0)
-        strcpy (command, "unblock");
-    else if (strncmp (command, "version", 1) == 0
-             && strncmp (command, "version", strlen (command)) == 0)
-        strcpy (command, "version");
-    else if (strncmp (command, "who", 1) == 0
-             && strncmp (command, "who", strlen (command)) == 0)
-        strcpy (command, "who");
-// quit
-    else if (strncmp (command, "quit", 1) == 0
-             && strncmp (command, "quit", strlen (command)) == 0)
-        strcpy (command, "quit");
-    else if (strncmp (command, "exit", 2) == 0 && strncmp (command, "exit", strlen (command)) == 0) // not 1 letter command: 'email', 'end' or 'exit'?
-        strcpy (command, "exit");
-    else if (strncmp (command, "end", 2) == 0 && strncmp (command, "end", strlen (command)) == 0)   // not 1 letter command: 'email', 'end' or 'exit'?
-        strcpy (command, "end");
-
-    return 0;
-}
-
-//-----------------------------------------
-// Sub-function: Display commands of ladmin
-//-----------------------------------------
-void display_help (char *param, int language)
-{
-    char command[1023];
-    int  i;
-
-    memset (command, '\0', sizeof (command));
-
-    if (sscanf (param, "%s ", command) < 1 || strlen (command) == 0)
-        strcpy (command, "");   // any value that is not a command
-
-    if (command[0] == '?')
-    {
-        if (defaultlanguage == 'F')
-            strcpy (command, "aide");
-        else
-            strcpy (command, "help");
-    }
-
-    // lowercase for command
-    for (i = 0; command[i]; i++)
-        command[i] = tolower (command[i]);
-
-    // Analyse of the command
-    check_command (command);    // give complete name to the command
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log ("Affichage des commandes ou d'une commande." RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Displaying of the commands or a command." RETCODE);
-    }
-
-    if (language == 1)
-    {
-        if (strcmp (command, "aide") == 0)
-        {
-            printf ("aide/help/?\n");
-            printf ("  Affiche la description des commandes\n");
-            printf ("aide/help/? [commande]\n");
-            printf ("  Affiche la description de la commande specifie\n");
-        }
-        else if (strcmp (command, "help") == 0)
-        {
-            printf ("aide/help/?\n");
-            printf ("  Display the description of the commands\n");
-            printf ("aide/help/? [command]\n");
-            printf ("  Display the description of the specified command\n");
-// general commands
-        }
-        else if (strcmp (command, "add") == 0)
-        {
-            printf ("add <nomcompte> <sexe> <motdepasse>\n");
-            printf ("  Cre un compte avec l'email par dfaut (a@a.com).\n");
-            printf
-                ("  Concernant le sexe, seule la premire lettre compte (F ou M).\n");
-            printf
-                ("  L'e-mail est a@a.com (e-mail par dfaut). C'est comme n'avoir aucun e-mail.\n");
-            printf
-                ("  Lorsque motdepasse est omis, la saisie se fait sans que la frappe se voit.\n");
-            printf ("  <exemple> add testname Male testpass\n");
-        }
-        else if (strcmp (command, "ban") == 0)
-        {
-            printf ("ban/banish aaaa/mm/jj hh:mm:ss <nom compte>\n");
-            printf ("  Change la date de fin de bannissement d'un compte.\n");
-            printf ("  Comme banset, mais <nom compte> est  la fin.\n");
-        }
-        else if (strcmp (command, "banadd") == 0)
-        {
-            printf ("banadd <nomcompte> <Modificateur>\n");
-            printf
-                ("  Ajoute ou soustrait du temps  la date de banissement d'un compte.\n");
-            printf ("  Les modificateurs sont construits comme suit:\n");
-            printf ("    Valeur d'ajustement (-1, 1, +1, etc...)\n");
-            printf ("    Elment modifi:\n");
-            printf ("      a ou y: anne\n");
-            printf ("      m:      mois\n");
-            printf ("      j ou d: jour\n");
-            printf ("      h:      heure\n");
-            printf ("      mn:     minute\n");
-            printf ("      s:      seconde\n");
-            printf ("  <exemple> banadd testname +1m-2mn1s-6a\n");
-            printf
-                ("            Cette exemple ajoute 1 mois et une seconde, et soustrait 2 minutes\n");
-            printf ("            et 6 ans dans le mme temps.\n");
-            printf
-                ("NOTE: Si vous modifez la date de banissement d'un compte non bani,\n");
-            printf
-                ("      vous indiquez comme date (le moment actuel +- les ajustements)\n");
-        }
-        else if (strcmp (command, "banset") == 0)
-        {
-            printf ("banset <nomcompte> aaaa/mm/jj [hh:mm:ss]\n");
-            printf ("  Change la date de fin de bannissement d'un compte.\n");
-            printf ("  Heure par dfaut [hh:mm:ss]: 23:59:59.\n");
-            printf ("banset <nomcompte> 0\n");
-            printf ("  Dbanni un compte (0 = de-banni).\n");
-        }
-        else if (strcmp (command, "block") == 0)
-        {
-            printf ("block <nom compte>\n");
-            printf
-                ("  Place le status d'un compte  5 (You have been blocked by the GM Team).\n");
-            printf
-                ("  La commande est l'quivalent de state <nom_compte> 5.\n");
-        }
-        else if (strcmp (command, "check") == 0)
-        {
-            printf ("check <nomcompte> <motdepasse>\n");
-            printf
-                ("  Vrifie la validit d'un mot de passe pour un compte\n");
-            printf ("  NOTE: Le serveur n'enverra jamais un mot de passe.\n");
-            printf
-                ("        C'est la seule mthode que vous possdez pour savoir\n");
-            printf
-                ("        si un mot de passe est le bon. L'autre mthode est\n");
-            printf
-                ("        d'avoir un accs ('physique') au fichier des comptes.\n");
-        }
-        else if (strcmp (command, "create") == 0)
-        {
-            printf ("create <nomcompte> <sexe> <email> <motdepasse>\n");
-            printf ("  Comme la commande add, mais avec l'e-mail en plus.\n");
-            printf
-                ("  <exemple> create testname Male mon@mail.com testpass\n");
-        }
-        else if (strcmp (command, "delete") == 0)
-        {
-            printf ("del <nom compte>\n");
-            printf ("  Supprime un compte.\n");
-            printf
-                ("  La commande demande confirmation. Aprs confirmation, le compte est dtruit.\n");
-        }
-        else if (strcmp (command, "email") == 0)
-        {
-            printf ("email <nomcompte> <email>\n");
-            printf ("  Modifie l'e-mail d'un compte.\n");
-        }
-        else if (strcmp (command, "getcount") == 0)
-        {
-            printf ("getcount\n");
-            printf
-                ("  Donne le nombre de joueurs en ligne par serveur de char.\n");
-        }
-        else if (strcmp (command, "gm") == 0)
-        {
-            printf ("gm <nomcompte> [Niveau_GM]\n");
-            printf ("  Modifie le niveau de GM d'un compte.\n");
-            printf
-                ("  Valeur par dfaut: 0 (suppression du niveau de GM).\n");
-            printf ("  <exemple> gm nomtest 80\n");
-        }
-        else if (strcmp (command, "id") == 0)
-        {
-            printf ("id <nom compte>\n");
-            printf ("  Donne l'id d'un compte.\n");
-        }
-        else if (strcmp (command, "info") == 0)
-        {
-            printf ("info <idcompte>\n");
-            printf ("  Affiche les informations sur un compte.\n");
-        }
-        else if (strcmp (command, "kami") == 0)
-        {
-            printf ("kami <message>\n");
-            printf
-                ("  Envoi un message gnral sur tous les serveurs de map (en jaune).\n");
-        }
-        else if (strcmp (command, "kamib") == 0)
-        {
-            printf ("kamib <message>\n");
-            printf
-                ("  Envoi un message gnral sur tous les serveurs de map (en bleu).\n");
-        }
-        else if (strcmp (command, "language") == 0)
-        {
-            printf ("language <langue>\n");
-            printf ("  Change la langue d'affichage.\n");
-            printf ("  Langues possibles: 'Franais' ou 'English'.\n");
-        }
-        else if (strcmp (command, "list") == 0)
-        {
-            printf ("list/ls [Premier_id [Dernier_id]]\n");
-            printf ("  Affiche une liste de comptes.\n");
-            printf
-                ("  'Premier_id', 'Dernier_id': indique les identifiants de dpart et de fin.\n");
-            printf
-                ("  La recherche par nom n'est pas possible avec cette commande.\n");
-            printf ("  <example> list 10 9999999\n");
-        }
-        else if (strcmp (command, "itemfrob") == 0)
-        {
-            printf ("Not localised yet.\n");
-        }
-        else if (strcmp (command, "listban") == 0)
-        {
-            printf ("listBan/lsBan [Premier_id [Dernier_id]]\n");
-            printf
-                ("  Comme list/ls, mais seulement pour les comptes avec statut ou bannis.\n");
-        }
-        else if (strcmp (command, "listgm") == 0)
-        {
-            printf ("listGM/lsGM [Premier_id [Dernier_id]]\n");
-            printf ("  Comme list/ls, mais seulement pour les comptes GM.\n");
-        }
-        else if (strcmp (command, "listok") == 0)
-        {
-            printf ("listOK/lsOK [Premier_id [Dernier_id]]\n");
-            printf
-                ("  Comme list/ls, mais seulement pour les comptes sans statut et non bannis.\n");
-        }
-        else if (strcmp (command, "memo") == 0)
-        {
-            printf ("memo <nomcompte> <memo>\n");
-            printf ("  Modifie le mmo d'un compte.\n");
-            printf
-                ("  'memo': Il peut avoir jusqu' 253 caractres (avec des espaces ou non).\n");
-        }
-        else if (strcmp (command, "name") == 0)
-        {
-            printf ("name <idcompte>\n");
-            printf ("  Donne le nom d'un compte.\n");
-        }
-        else if (strcmp (command, "password") == 0)
-        {
-            printf ("passwd <nomcompte> <nouveaumotdepasse>\n");
-            printf ("  Change le mot de passe d'un compte.\n");
-            printf ("  Lorsque nouveaumotdepasse est omis,\n");
-            printf ("  la saisie se fait sans que la frappe ne se voit.\n");
-        }
-        else if (strcmp (command, "reloadgm") == 0)
-        {
-            printf ("reloadGM\n");
-            printf ("  Reload GM configuration file\n");
-        }
-        else if (strcmp (command, "search") == 0)
-        {
-            printf ("search <expression>\n");
-            printf ("  Cherche des comptes.\n");
-            printf ("  Affiche les comptes dont les noms correspondent.\n");
-//          printf("search -r/-e/--expr/--regex <expression>\n");
-//          printf("  Cherche des comptes par expression regulire.\n");
-//          printf("  Affiche les comptes dont les noms correspondent.\n");
-        }
-        else if (strcmp (command, "sex") == 0)
-        {
-            printf ("sex <nomcompte> <sexe>\n");
-            printf ("  Modifie le sexe d'un compte.\n");
-            printf ("  <exemple> sex testname Male\n");
-        }
-        else if (strcmp (command, "state") == 0)
-        {
-            printf ("state <nomcompte> <nouveaustatut> <message_erreur_7>\n");
-            printf ("  Change le statut d'un compte.\n");
-            printf
-                ("  'nouveaustatut': Le statut est le mme que celui du packet 0x006a + 1.\n");
-            printf ("               les possibilits sont:\n");
-            printf ("               0 = Compte ok\n");
-            printf ("               1 = Unregistered ID\n");
-            printf ("               2 = Incorrect Password\n");
-            printf ("               3 = This ID is expired\n");
-            printf ("               4 = Rejected from Server\n");
-            printf
-                ("               5 = You have been blocked by the GM Team\n");
-            printf
-                ("               6 = Your Game's EXE file is not the latest version\n");
-            printf
-                ("               7 = You are Prohibited to log in until...\n");
-            printf
-                ("               8 = Server is jammed due to over populated\n");
-            printf ("               9 = No MSG\n");
-            printf ("               100 = This ID has been totally erased\n");
-            printf
-                ("               all other values are 'No MSG', then use state 9 please.\n");
-            printf ("  'message_erreur_7': message du code erreur 6 =\n");
-            printf
-                ("                      = Your are Prohibited to log in until... (packet 0x006a)\n");
-        }
-        else if (strcmp (command, "timeadd") == 0)
-        {
-            printf ("timeadd <nomcompte> <modificateur>\n");
-            printf
-                ("  Ajoute/soustrait du temps  la limite de validit d'un compte.\n");
-            printf ("  Le modificateur est compos comme suit:\n");
-            printf ("    Valeur modificatrice (-1, 1, +1, etc...)\n");
-            printf ("    Elment modifi:\n");
-            printf ("      a ou y: anne\n");
-            printf ("      m:      mois\n");
-            printf ("      j ou d: jour\n");
-            printf ("      h:      heure\n");
-            printf ("      mn:     minute\n");
-            printf ("      s:      seconde\n");
-            printf ("  <exemple> timeadd testname +1m-2mn1s-6a\n");
-            printf
-                ("            Cette exemple ajoute 1 mois et une seconde, et soustrait 2 minutes\n");
-            printf ("            et 6 ans dans le mme temps.\n");
-            printf
-                ("NOTE: Vous ne pouvez pas modifier une limite de validit illimite. Si vous\n");
-            printf
-                ("      dsirez le faire, c'est que vous voulez probablement crer un limite de\n");
-            printf
-                ("      validit limite. Donc, en premier, fix une limite de valitid.\n");
-        }
-        else if (strcmp (command, "timeadd") == 0)
-        {
-            printf ("timeset <nomcompte> aaaa/mm/jj [hh:mm:ss]\n");
-            printf ("  Change la limite de validit d'un compte.\n");
-            printf ("  Heure par dfaut [hh:mm:ss]: 23:59:59.\n");
-            printf ("timeset <nomcompte> 0\n");
-            printf
-                ("  Donne une limite de validit illimite (0 = illimite).\n");
-        }
-        else if (strcmp (command, "unban") == 0)
-        {
-            printf ("unban/unbanish <nom compte>\n");
-            printf ("  Ote le banissement d'un compte.\n");
-            printf
-                ("  La commande est l'quivalent de banset <nom_compte> 0.\n");
-        }
-        else if (strcmp (command, "unblock") == 0)
-        {
-            printf ("unblock <nom compte>\n");
-            printf ("  Place le status d'un compte  0 (Compte ok).\n");
-            printf
-                ("  La commande est l'quivalent de state <nom_compte> 0.\n");
-        }
-        else if (strcmp (command, "version") == 0)
-        {
-            printf ("version\n");
-            printf ("  Affiche la version du login-serveur.\n");
-        }
-        else if (strcmp (command, "who") == 0)
-        {
-            printf ("who <nom compte>\n");
-            printf ("  Affiche les informations sur un compte.\n");
-// quit
-        }
-        else if (strcmp (command, "quit") == 0 ||
-                 strcmp (command, "exit") == 0 ||
-                 strcmp (command, "end") == 0)
-        {
-            printf ("quit/end/exit\n");
-            printf ("  Fin du programme d'administration.\n");
-// unknown command
-        }
-        else
-        {
-            if (strlen (command) > 0)
-                printf
-                    ("Commande inconnue [%s] pour l'aide. Affichage de toutes les commandes.\n",
-                     command);
-            printf
-                (" aide/help/?                             -- Affiche cet aide\n");
-            printf
-                (" aide/help/? [commande]                  -- Affiche l'aide de la commande\n");
-            printf
-                (" add <nomcompte> <sexe> <motdepasse>     -- Cre un compte (sans email)\n");
-            printf
-                (" ban/banish aaaa/mm/jj hh:mm:ss <nom compte> -- Fixe la date finale de banismnt\n");
-            printf
-                (" banadd/ba <nomcompte> <modificateur>    -- Ajout/soustrait du temps  la\n");
-            printf
-                ("   exemple: ba moncompte +1m-2mn1s-2y       date finale de banissement\n");
-            printf
-                (" banset/bs <nomcompte> aaaa/mm/jj [hh:mm:ss] -- Change la date fin de banisemnt\n");
-            printf
-                (" banset/bs <nomcompte> 0                 -- D-banis un compte.\n");
-            printf
-                (" block <nom compte>  -- Mets le status d'un compte  5 (blocked by the GM Team)\n");
-            printf
-                (" check <nomcompte> <motdepasse>          -- Vrifie un mot de passe d'un compte\n");
-            printf
-                (" create <nomcompte> <sexe> <email> <motdepasse> -- Cre un compte (avec email)\n");
-            printf
-                (" del <nom compte>                        -- Supprime un compte\n");
-            printf
-                (" email <nomcompte> <email>               -- Modifie l'e-mail d'un compte\n");
-            printf
-                (" getcount                                -- Donne le nb de joueurs en ligne\n");
-            printf
-                ("  gm <nomcompte> [Niveau_GM]              -- Modifie le niveau de GM d'un compte\n");
-            printf
-                (" id <nom compte>                         -- Donne l'id d'un compte\n");
-            printf
-                (" info <idcompte>                         -- Affiche les infos sur un compte\n");
-            printf
-                (" kami <message>                          -- Envoi un message gnral (en jaune)\n");
-            printf
-                (" kamib <message>                         -- Envoi un message gnral (en bleu)\n");
-            printf
-                (" language <langue>                       -- Change la langue d'affichage.\n");
-            printf
-                (" list/ls [Premier_id [Dernier_id] ]      -- Affiche une liste de comptes\n");
-            printf
-                (" listBan/lsBan [Premier_id [Dernier_id] ] -- Affiche une liste de comptes\n");
-            printf
-                ("                                             avec un statut ou bannis\n");
-            printf
-                (" listGM/lsGM [Premier_id [Dernier_id] ]  -- Affiche une liste de comptes GM\n");
-            printf
-                (" listOK/lsOK [Premier_id [Dernier_id] ]  -- Affiche une liste de comptes\n");
-            printf
-                ("                                            sans status et non bannis\n");
-            printf
-                (" memo <nomcompte> <memo>                 -- Modifie le memo d'un compte\n");
-            printf
-                (" name <idcompte>                         -- Donne le nom d'un compte\n");
-            printf
-                (" passwd <nomcompte> <nouveaumotdepasse>  -- Change le mot de passe d'un compte\n");
-            printf
-                (" quit/end/exit                           -- Fin du programme d'administation\n");
-            printf
-                (" reloadGM                              -- Recharger le fichier de config des GM\n");
-            printf
-                (" search <expression>                     -- Cherche des comptes\n");
-//          printf(" search -e/-r/--expr/--regex <expression> -- Cherche des comptes par REGEX\n");
-            printf
-                (" sex <nomcompte> <sexe>                  -- Modifie le sexe d'un compte\n");
-            printf
-                (" state <nomcompte> <nouveaustatut> <messageerr7> -- Change le statut d'1 compte\n");
-            printf
-                (" timeadd/ta <nomcompte> <modificateur>   -- Ajout/soustrait du temps  la\n");
-            printf
-                ("   exemple: ta moncompte +1m-2mn1s-2y       limite de validit\n");
-            printf
-                (" timeset/ts <nomcompte> aaaa/mm/jj [hh:mm:ss] -- Change la limite de validit\n");
-            printf
-                (" timeset/ts <nomcompte> 0                -- limite de validit = illimite\n");
-            printf
-                (" unban/unbanish <nom compte>             -- Ote le banissement d'un compte\n");
-            printf
-                (" unblock <nom compte>             -- Mets le status d'un compte  0 (Compte ok)\n");
-            printf
-                (" version                                 -- Donne la version du login-serveur\n");
-            printf
-                (" who <nom compte>                        -- Affiche les infos sur un compte\n");
-            printf
-                (" Note: Pour les noms de compte avec des espaces, tapez \"<nom compte>\" (ou ').\n");
-        }
-    }
-    else
-    {
-        if (strcmp (command, "aide") == 0)
-        {
-            printf ("aide/help/?\n");
-            printf ("  Display the description of the commands\n");
-            printf ("aide/help/? [command]\n");
-            printf ("  Display the description of the specified command\n");
-        }
-        else if (strcmp (command, "help") == 0)
-        {
-            printf ("aide/help/?\n");
-            printf ("  Display the description of the commands\n");
-            printf ("aide/help/? [command]\n");
-            printf ("  Display the description of the specified command\n");
-// general commands
-        }
-        else if (strcmp (command, "add") == 0)
-        {
-            printf ("add <account_name> <sex> <password>\n");
-            printf
-                ("  Create an account with the default email (a@a.com).\n");
-            printf
-                ("  Concerning the sex, only the first letter is used (F or M).\n");
-            printf
-                ("  The e-mail is set to a@a.com (default e-mail). It's like to have no e-mail.\n");
-            printf ("  When the password is omitted,\n");
-            printf
-                ("  the input is done without displaying of the pressed keys.\n");
-            printf ("  <example> add testname Male testpass\n");
-        }
-        else if (strcmp (command, "ban") == 0)
-        {
-            printf ("ban/banish yyyy/mm/dd hh:mm:ss <account name>\n");
-            printf
-                ("  Changes the final date of a banishment of an account.\n");
-            printf ("  Like banset, but <account name> is at end.\n");
-        }
-        else if (strcmp (command, "banadd") == 0)
-        {
-            printf ("banadd <account_name> <modifier>\n");
-            printf
-                ("  Adds or substracts time from the final date of a banishment of an account.\n");
-            printf ("  Modifier is done as follows:\n");
-            printf ("    Adjustment value (-1, 1, +1, etc...)\n");
-            printf ("    Modified element:\n");
-            printf ("      a or y: year\n");
-            printf ("      m:  month\n");
-            printf ("      j or d: day\n");
-            printf ("      h:  hour\n");
-            printf ("      mn: minute\n");
-            printf ("      s:  second\n");
-            printf ("  <example> banadd testname +1m-2mn1s-6y\n");
-            printf
-                ("            this example adds 1 month and 1 second, and substracts 2 minutes\n");
-            printf ("            and 6 years at the same time.\n");
-            printf
-                ("NOTE: If you modify the final date of a non-banished account,\n");
-            printf
-                ("      you fix the final date to (actual time +- adjustments)\n");
-        }
-        else if (strcmp (command, "banset") == 0)
-        {
-            printf ("banset <account_name> yyyy/mm/dd [hh:mm:ss]\n");
-            printf
-                ("  Changes the final date of a banishment of an account.\n");
-            printf ("  Default time [hh:mm:ss]: 23:59:59.\n");
-            printf ("banset <account_name> 0\n");
-            printf ("  Set a non-banished account (0 = unbanished).\n");
-        }
-        else if (strcmp (command, "block") == 0)
-        {
-            printf ("block <account name>\n");
-            printf
-                ("  Set state 5 (You have been blocked by the GM Team) to an account.\n");
-            printf ("  This command works like state <account_name> 5.\n");
-        }
-        else if (strcmp (command, "check") == 0)
-        {
-            printf ("check <account_name> <password>\n");
-            printf ("  Check the validity of a password for an account.\n");
-            printf ("  NOTE: Server will never sends back a password.\n");
-            printf
-                ("        It's the only method you have to know if a password is correct.\n");
-            printf
-                ("        The other method is to have a ('physical') access to the accounts file.\n");
-        }
-        else if (strcmp (command, "create") == 0)
-        {
-            printf ("create <account_name> <sex> <email> <password>\n");
-            printf ("  Like the 'add' command, but with e-mail moreover.\n");
-            printf
-                ("  <example> create testname Male my@mail.com testpass\n");
-        }
-        else if (strcmp (command, "delete") == 0)
-        {
-            printf ("del <account name>\n");
-            printf ("  Remove an account.\n");
-            printf
-                ("  This order requires confirmation. After confirmation, the account is deleted.\n");
-        }
-        else if (strcmp (command, "email") == 0)
-        {
-            printf ("email <account_name> <email>\n");
-            printf ("  Modify the e-mail of an account.\n");
-        }
-        else if (strcmp (command, "getcount") == 0)
-        {
-            printf ("getcount\n");
-            printf
-                ("  Give the number of players online on all char-servers.\n");
-        }
-        else if (strcmp (command, "gm") == 0)
-        {
-            printf ("gm <account_name> [GM_level]\n");
-            printf ("  Modify the GM level of an account.\n");
-            printf ("  Default value remove GM level (GM level = 0).\n");
-            printf ("  <example> gm testname 80\n");
-        }
-        else if (strcmp (command, "id") == 0)
-        {
-            printf ("id <account name>\n");
-            printf ("  Give the id of an account.\n");
-        }
-        else if (strcmp (command, "info") == 0)
-        {
-            printf ("info <account_id>\n");
-            printf ("  Display complete information of an account.\n");
-        }
-        else if (strcmp (command, "kami") == 0)
-        {
-            printf ("kami <message>\n");
-            printf
-                ("  Sends a broadcast message on all map-server (in yellow).\n");
-        }
-        else if (strcmp (command, "kamib") == 0)
-        {
-            printf ("kamib <message>\n");
-            printf
-                ("  Sends a broadcast message on all map-server (in blue).\n");
-        }
-        else if (strcmp (command, "language") == 0)
-        {
-            printf ("language <language>\n");
-            printf ("  Change the language of displaying.\n");
-            printf ("  Possible languages: Franais or English.\n");
-        }
-        else if (strcmp (command, "list") == 0)
-        {
-            printf ("list/ls [start_id [end_id]]\n");
-            printf ("  Display a list of accounts.\n");
-            printf
-                ("  'start_id', 'end_id': indicate end and start identifiers.\n");
-            printf
-                ("  Research by name is not possible with this command.\n");
-            printf ("  <example> list 10 9999999\n");
-        }
-        else if (strcmp (command, "itemfrob") == 0)
-        {
-            printf ("itemfrob <source-id> <dest-id>\n");
-            printf ("  Translates item IDs for all accounts.\n");
-            printf
-                ("  Any items matching the source item ID will be mapped to the dest-id.\n");
-            printf ("  <example> itemfrob 500 700\n");
-        }
-        else if (strcmp (command, "listban") == 0)
-        {
-            printf ("listBan/lsBan [start_id [end_id]]\n");
-            printf
-                ("  Like list/ls, but only for accounts with state or banished.\n");
-        }
-        else if (strcmp (command, "listgm") == 0)
-        {
-            printf ("listGM/lsGM [start_id [end_id]]\n");
-            printf ("  Like list/ls, but only for GM accounts.\n");
-        }
-        else if (strcmp (command, "listok") == 0)
-        {
-            printf ("listOK/lsOK [start_id [end_id]]\n");
-            printf
-                ("  Like list/ls, but only for accounts without state and not banished.\n");
-        }
-        else if (strcmp (command, "memo") == 0)
-        {
-            printf ("memo <account_name> <memo>\n");
-            printf ("  Modify the memo of an account.\n");
-            printf
-                ("  'memo': it can have until 253 characters (with spaces or not).\n");
-        }
-        else if (strcmp (command, "name") == 0)
-        {
-            printf ("name <account_id>\n");
-            printf ("  Give the name of an account.\n");
-        }
-        else if (strcmp (command, "password") == 0)
-        {
-            printf ("passwd <account_name> <new_password>\n");
-            printf ("  Change the password of an account.\n");
-            printf ("  When new password is omitted,\n");
-            printf
-                ("  the input is done without displaying of the pressed keys.\n");
-        }
-        else if (strcmp (command, "reloadgm") == 0)
-        {
-            printf ("reloadGM\n");
-            printf ("  Reload GM configuration file\n");
-        }
-        else if (strcmp (command, "search") == 0)
-        {
-            printf ("search <expression>\n");
-            printf ("  Seek accounts.\n");
-            printf ("  Displays the accounts whose names correspond.\n");
-//          printf("search -r/-e/--expr/--regex <expression>\n");
-//          printf("  Seek accounts by regular expression.\n");
-//          printf("  Displays the accounts whose names correspond.\n");
-        }
-        else if (strcmp (command, "sex") == 0)
-        {
-            printf ("sex <account_name> <sex>\n");
-            printf ("  Modify the sex of an account.\n");
-            printf ("  <example> sex testname Male\n");
-        }
-        else if (strcmp (command, "state") == 0)
-        {
-            printf ("state <account_name> <new_state> <error_message_#7>\n");
-            printf ("  Change the state of an account.\n");
-            printf
-                ("  'new_state': state is the state of the packet 0x006a + 1.\n");
-            printf ("               The possibilities are:\n");
-            printf ("               0 = Account ok\n");
-            printf ("               1 = Unregistered ID\n");
-            printf ("               2 = Incorrect Password\n");
-            printf ("               3 = This ID is expired\n");
-            printf ("               4 = Rejected from Server\n");
-            printf
-                ("               5 = You have been blocked by the GM Team\n");
-            printf
-                ("               6 = Your Game's EXE file is not the latest version\n");
-            printf
-                ("               7 = You are Prohibited to log in until...\n");
-            printf
-                ("               8 = Server is jammed due to over populated\n");
-            printf ("               9 = No MSG\n");
-            printf ("               100 = This ID has been totally erased\n");
-            printf
-                ("               all other values are 'No MSG', then use state 9 please.\n");
-            printf ("  'error_message_#7': message of the code error 6\n");
-            printf
-                ("                      = Your are Prohibited to log in until... (packet 0x006a)\n");
-        }
-        else if (strcmp (command, "timeadd") == 0)
-        {
-            printf ("timeadd <account_name> <modifier>\n");
-            printf
-                ("  Adds or substracts time from the validity limit of an account.\n");
-            printf ("  Modifier is done as follows:\n");
-            printf ("    Adjustment value (-1, 1, +1, etc...)\n");
-            printf ("    Modified element:\n");
-            printf ("      a or y: year\n");
-            printf ("      m:  month\n");
-            printf ("      j or d: day\n");
-            printf ("      h:  hour\n");
-            printf ("      mn: minute\n");
-            printf ("      s:  second\n");
-            printf ("  <example> timeadd testname +1m-2mn1s-6y\n");
-            printf
-                ("            this example adds 1 month and 1 second, and substracts 2 minutes\n");
-            printf ("            and 6 years at the same time.\n");
-            printf ("NOTE: You can not modify a unlimited validity limit.\n");
-            printf
-                ("      If you want modify it, you want probably create a limited validity limit.\n");
-            printf
-                ("      So, at first, you must set the validity limit to a date/time.\n");
-        }
-        else if (strcmp (command, "timeadd") == 0)
-        {
-            printf ("timeset <account_name> yyyy/mm/dd [hh:mm:ss]\n");
-            printf ("  Changes the validity limit of an account.\n");
-            printf ("  Default time [hh:mm:ss]: 23:59:59.\n");
-            printf ("timeset <account_name> 0\n");
-            printf ("  Gives an unlimited validity limit (0 = unlimited).\n");
-        }
-        else if (strcmp (command, "unban") == 0)
-        {
-            printf ("unban/unbanish <account name>\n");
-            printf ("  Remove the banishment of an account.\n");
-            printf ("  This command works like banset <account_name> 0.\n");
-        }
-        else if (strcmp (command, "unblock") == 0)
-        {
-            printf ("unblock <account name>\n");
-            printf ("  Set state 0 (Account ok) to an account.\n");
-            printf ("  This command works like state <account_name> 0.\n");
-        }
-        else if (strcmp (command, "version") == 0)
-        {
-            printf ("version\n");
-            printf ("  Display the version of the login-server.\n");
-        }
-        else if (strcmp (command, "who") == 0)
-        {
-            printf ("who <account name>\n");
-            printf ("  Displays complete information of an account.\n");
-// quit
-        }
-        else if (strcmp (command, "quit") == 0 ||
-                 strcmp (command, "exit") == 0 ||
-                 strcmp (command, "end") == 0)
-        {
-            printf ("quit/end/exit\n");
-            printf ("  End of the program of administration.\n");
-// unknown command
-        }
-        else
-        {
-            if (strlen (command) > 0)
-                printf
-                    ("Unknown command [%s] for help. Displaying of all commands.\n",
-                     command);
-            printf
-                (" aide/help/?                          -- Display this help\n");
-            printf
-                (" aide/help/? [command]                -- Display the help of the command\n");
-            printf
-                (" add <account_name> <sex> <password>  -- Create an account with default email\n");
-            printf
-                (" ban/banish yyyy/mm/dd hh:mm:ss <account name> -- Change final date of a ban\n");
-            printf
-                (" banadd/ba <account_name> <modifier>  -- Add or substract time from the final\n");
-            printf
-                ("   example: ba apple +1m-2mn1s-2y        date of a banishment of an account\n");
-            printf
-                (" banset/bs <account_name> yyyy/mm/dd [hh:mm:ss] -- Change final date of a ban\n");
-            printf
-                (" banset/bs <account_name> 0           -- Un-banish an account\n");
-            printf
-                (" block <account name>     -- Set state 5 (blocked by the GM Team) to an account\n");
-            printf
-                (" check <account_name> <password>      -- Check the validity of a password\n");
-            printf
-                (" create <account_name> <sex> <email> <passwrd> -- Create an account with email\n");
-            printf
-                (" del <account name>                   -- Remove an account\n");
-            printf
-                (" email <account_name> <email>         -- Modify an email of an account\n");
-            printf
-                (" getcount                             -- Give the number of players online\n");
-            printf
-                (" gm <account_name> [GM_level]         -- Modify the GM level of an account\n");
-            printf
-                (" id <account name>                    -- Give the id of an account\n");
-            printf
-                (" info <account_id>                    -- Display all information of an account\n");
-            printf
-                (" itemfrob <source-id> <dest-id>       -- Map all items from one item ID to another\n");
-            printf
-                (" kami <message>                       -- Sends a broadcast message (in yellow)\n");
-            printf
-                (" kamib <message>                      -- Sends a broadcast message (in blue)\n");
-            printf
-                (" language <language>                  -- Change the language of displaying.\n");
-            printf
-                (" list/ls [First_id [Last_id]]         -- Display a list of accounts\n");
-            printf
-                (" listBan/lsBan [First_id [Last_id] ]  -- Display a list of accounts\n");
-            printf
-                ("                                         with state or banished\n");
-            printf
-                (" listGM/lsGM [First_id [Last_id]]     -- Display a list of GM accounts\n");
-            printf
-                (" listOK/lsOK [First_id [Last_id] ]    -- Display a list of accounts\n");
-            printf
-                ("                                         without state and not banished\n");
-            printf
-                (" memo <account_name> <memo>           -- Modify the memo of an account\n");
-            printf
-                (" name <account_id>                    -- Give the name of an account\n");
-            printf
-                (" passwd <account_name> <new_password> -- Change the password of an account\n");
-            printf
-                (" quit/end/exit                        -- End of the program of administation\n");
-            printf
-                (" reloadGM                             -- Reload GM configuration file\n");
-            printf
-                (" search <expression>                  -- Seek accounts\n");
-//          printf(" search -e/-r/--expr/--regex <expressn> -- Seek accounts by regular-expression\n");
-            printf
-                (" sex <nomcompte> <sexe>               -- Modify the sex of an account\n");
-            printf
-                (" state <account_name> <new_state> <error_message_#7> -- Change the state\n");
-            printf
-                (" timeadd/ta <account_name> <modifier> -- Add or substract time from the\n");
-            printf
-                ("   example: ta apple +1m-2mn1s-2y        validity limit of an account\n");
-            printf
-                (" timeset/ts <account_name> yyyy/mm/dd [hh:mm:ss] -- Change the validify limit\n");
-            printf
-                (" timeset/ts <account_name> 0          -- Give a unlimited validity limit\n");
-            printf
-                (" unban/unbanish <account name>        -- Remove the banishment of an account\n");
-            printf
-                (" unblock <account name>               -- Set state 0 (Account ok) to an account\n");
-            printf
-                (" version                              -- Gives the version of the login-server\n");
-            printf
-                (" who <account name>                   -- Display all information of an account\n");
-            printf
-                (" who <account name>                   -- Display all information of an account\n");
-            printf
-                (" Note: To use spaces in an account name, type \"<account name>\" (or ').\n");
-        }
-    }
-}
-
-//-----------------------------
-// Sub-function: add an account
-//-----------------------------
-int addaccount (char *param, int emailflag)
-{
-    char name[1023], sex[1023], email[1023], password[1023];
-//  int i;
-
-    memset (name, '\0', sizeof (name));
-    memset (sex, '\0', sizeof (sex));
-    memset (email, '\0', sizeof (email));
-    memset (password, '\0', sizeof (password));
-
-    if (emailflag == 0)
-    {                           // add command
-        if (sscanf (param, "\"%[^\"]\" %s %[^\r\n]", name, sex, password) < 2 &&    // password can be void
-            sscanf (param, "'%[^']' %s %[^\r\n]", name, sex, password) < 2 &&   // password can be void
-            sscanf (param, "%s %s %[^\r\n]", name, sex, password) < 2)
-        {                       // password can be void
-            if (defaultlanguage == 'F')
-            {
-                printf
-                    ("Entrez un nom de compte, un sexe et un mot de passe svp.\n");
-                printf ("<exemple> add nomtest Male motdepassetest\n");
-                ladmin_log
-                    ("Nombre incorrect de paramtres pour crer un compte (commande 'add')."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please input an account name, a sex and a password.\n");
-                printf ("<example> add testname Male testpass\n");
-                ladmin_log
-                    ("Incomplete parameters to create an account ('add' command)."
-                     RETCODE);
-            }
-            return 136;
-        }
-        strcpy (email, "a@a.com");  // default email
-    }
-    else
-    {                           // 1: create command
-        if (sscanf (param, "\"%[^\"]\" %s %s %[^\r\n]", name, sex, email, password) < 3 &&  // password can be void
-            sscanf (param, "'%[^']' %s %s %[^\r\n]", name, sex, email, password) < 3 && // password can be void
-            sscanf (param, "%s %s %s %[^\r\n]", name, sex, email,
-                    password) < 3)
-        {                       // password can be void
-            if (defaultlanguage == 'F')
-            {
-                printf
-                    ("Entrez un nom de compte, un sexe et un mot de passe svp.\n");
-                printf
-                    ("<exemple> create nomtest Male mo@mail.com motdepassetest\n");
-                ladmin_log
-                    ("Nombre incorrect de paramtres pour crer un compte (commande 'create')."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please input an account name, a sex and a password.\n");
-                printf
-                    ("<example> create testname Male my@mail.com testpass\n");
-                ladmin_log
-                    ("Incomplete parameters to create an account ('create' command)."
-                     RETCODE);
-            }
-            return 136;
-        }
-    }
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-/*	for(i = 0; name[i]; i++) {
-		if (strchr("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_", name[i]) == NULL) {
-			if (defaultlanguage == 'F') {
-				printf("Caractre interdit (%c) trouv dans le nom du compte (%d%s caractre).\n", name[i], i+1, makeordinal(i+1));
-				ladmin_log("Caractre interdit (%c) trouv dans le nom du compte (%d%s caractre)." RETCODE, name[i], i+1, makeordinal(i+1));
-			} else {
-				printf("Illegal character (%c) found in the account name (%d%s character).\n", name[i], i+1, makeordinal(i+1));
-				ladmin_log("Illegal character (%c) found in the account name (%d%s character)." RETCODE, name[i], i+1, makeordinal(i+1));
-			}
-			return 101;
-		}
-	}*/
-
-    sex[0] = toupper (sex[0]);
-    if (strchr ("MF", sex[0]) == NULL)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Sexe incorrect [%s]. Entrez M ou F svp.\n", sex);
-            ladmin_log ("Sexe incorrect [%s]. Entrez M ou F svp." RETCODE,
-                        sex);
-        }
-        else
-        {
-            printf ("Illegal gender [%s]. Please input M or F.\n", sex);
-            ladmin_log ("Illegal gender [%s]. Please input M or F." RETCODE,
-                        sex);
-        }
-        return 103;
-    }
-
-    if (strlen (email) < 3)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Email trop courte [%s]. Entrez une e-mail valide svp.\n",
-                    email);
-            ladmin_log
-                ("Email trop courte [%s]. Entrez une e-mail valide svp."
-                 RETCODE, email);
-        }
-        else
-        {
-            printf ("Email is too short [%s]. Please input a valid e-mail.\n",
-                    email);
-            ladmin_log
-                ("Email is too short [%s]. Please input a valid e-mail."
-                 RETCODE, email);
-        }
-        return 109;
-    }
-    if (strlen (email) > 39)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Email trop longue [%s]. Entrez une e-mail de 39 caractres maximum svp.\n",
-                 email);
-            ladmin_log
-                ("Email trop longue [%s]. Entrez une e-mail de 39 caractres maximum svp."
-                 RETCODE, email);
-        }
-        else
-        {
-            printf
-                ("Email is too long [%s]. Please input an e-mail with 39 bytes at the most.\n",
-                 email);
-            ladmin_log
-                ("Email is too long [%s]. Please input an e-mail with 39 bytes at the most."
-                 RETCODE, email);
-        }
-        return 109;
-    }
-    if (e_mail_check (email) == 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Email incorrecte [%s]. Entrez une e-mail valide svp.\n",
-                    email);
-            ladmin_log ("Email incorrecte [%s]. Entrez une e-mail valide svp."
-                        RETCODE, email);
-        }
-        else
-        {
-            printf ("Invalid email [%s]. Please input a valid e-mail.\n",
-                    email);
-            ladmin_log ("Invalid email [%s]. Please input a valid e-mail."
-                        RETCODE, email);
-        }
-        return 109;
-    }
-
-    if (strlen (password) == 0)
-    {
-        if (typepasswd (password) == 0)
-            return 108;
-    }
-    if (verify_password (password) == 0)
-        return 104;
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour crer un compte."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to create an account." RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x7930;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    memcpy (WFIFOP (login_fd, 26), password, 24);
-    WFIFOB (login_fd, 50) = sex[0];
-    memcpy (WFIFOP (login_fd, 51), email, 40);
-    WFIFOSET (login_fd, 91);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//---------------------------------------------------------------------------------
-// Sub-function: Add/substract time to the final date of a banishment of an account
-//---------------------------------------------------------------------------------
-int banaddaccount (char *param)
-{
-    char name[1023], modif[1023];
-    int  year, month, day, hour, minute, second;
-    char *p_modif;
-    int  value, i;
-
-    memset (name, '\0', sizeof (name));
-    memset (modif, '\0', sizeof (modif));
-    year = month = day = hour = minute = second = 0;
-
-    if (sscanf (param, "\"%[^\"]\" %[^\r\n]", name, modif) < 2 &&
-        sscanf (param, "'%[^']' %[^\r\n]", name, modif) < 2 &&
-        sscanf (param, "%s %[^\r\n]", name, modif) < 2)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte et un modificateur svp.\n");
-            printf ("  <exemple> banadd nomtest +1m-2mn1s-6y\n");
-            printf
-                ("            Cette exemple ajoute 1 mois et 1 seconde, et soustrait 2 minutes\n");
-            printf ("            et 6 ans dans le mme temps.\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour modifier la fin de ban d'un compte (commande 'banadd')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name and a modifier.\n");
-            printf ("  <example>: banadd testname +1m-2mn1s-6y\n");
-            printf
-                ("             this example adds 1 month and 1 second, and substracts 2 minutes\n");
-            printf ("             and 6 years at the same time.\n");
-            ladmin_log
-                ("Incomplete parameters to modify the ban date/time of an account ('banadd' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    // lowercase for modif
-    for (i = 0; modif[i]; i++)
-        modif[i] = tolower (modif[i]);
-    p_modif = modif;
-    while (strlen (p_modif) > 0)
-    {
-        value = atoi (p_modif);
-        if (value == 0)
-        {
-            p_modif++;
-        }
-        else
-        {
-            if (p_modif[0] == '-' || p_modif[0] == '+')
-                p_modif++;
-            while (strlen (p_modif) > 0 && p_modif[0] >= '0'
-                   && p_modif[0] <= '9')
-            {
-                p_modif++;
-            }
-            if (p_modif[0] == 's')
-            {
-                second = value;
-                p_modif++;
-            }
-            else if (p_modif[0] == 'm' && p_modif[1] == 'n')
-            {
-                minute = value;
-                p_modif += 2;
-            }
-            else if (p_modif[0] == 'h')
-            {
-                hour = value;
-                p_modif++;
-            }
-            else if (p_modif[0] == 'd' || p_modif[0] == 'j')
-            {
-                day = value;
-                p_modif += 2;
-            }
-            else if (p_modif[0] == 'm')
-            {
-                month = value;
-                p_modif++;
-            }
-            else if (p_modif[0] == 'y' || p_modif[0] == 'a')
-            {
-                year = value;
-                p_modif++;
-            }
-            else
-            {
-                p_modif++;
-            }
-        }
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        printf (" anne:   %d\n", year);
-        printf (" mois:    %d\n", month);
-        printf (" jour:    %d\n", day);
-        printf (" heure:   %d\n", hour);
-        printf (" minute:  %d\n", minute);
-        printf (" seconde: %d\n", second);
-    }
-    else
-    {
-        printf (" year:   %d\n", year);
-        printf (" month:  %d\n", month);
-        printf (" day:    %d\n", day);
-        printf (" hour:   %d\n", hour);
-        printf (" minute: %d\n", minute);
-        printf (" second: %d\n", second);
-    }
-
-    if (year == 0 && month == 0 && day == 0 && hour == 0 && minute == 0
-        && second == 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Vous devez entrer un ajustement avec cette commande, svp:\n");
-            printf ("  Valeur d'ajustement (-1, 1, +1, etc...)\n");
-            printf ("  Element modifi:\n");
-            printf ("    a ou y: anne\n");
-            printf ("    m:      mois\n");
-            printf ("    j ou d: jour\n");
-            printf ("    h:      heure\n");
-            printf ("    mn:     minute\n");
-            printf ("    s:      seconde\n");
-            printf ("  <exemple> banadd nomtest +1m-2mn1s-6y\n");
-            printf
-                ("            Cette exemple ajoute 1 mois et 1 seconde, et soustrait 2 minutes\n");
-            printf ("            et 6 ans dans le mme temps.\n");
-            ladmin_log
-                ("Aucun ajustement n'est pas un ajustement (commande 'banadd')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please give an adjustment with this command:\n");
-            printf ("  Adjustment value (-1, 1, +1, etc...)\n");
-            printf ("  Modified element:\n");
-            printf ("    a or y: year\n");
-            printf ("    m: month\n");
-            printf ("    j or d: day\n");
-            printf ("    h: hour\n");
-            printf ("    mn: minute\n");
-            printf ("    s: second\n");
-            printf ("  <example> banadd testname +1m-2mn1s-6y\n");
-            printf
-                ("            this example adds 1 month and 1 second, and substracts 2 minutes\n");
-            printf ("            and 6 years at the same time.\n");
-            ladmin_log
-                ("No adjustment isn't an adjustment ('banadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-    if (year > 127 || year < -127)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez un ajustement d'annes correct (de -127  127), svp.\n");
-            ladmin_log
-                ("Ajustement de l'anne hors norme (commande 'banadd')."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please give a correct adjustment for the years (from -127 to 127).\n");
-            ladmin_log
-                ("Abnormal adjustement for the year ('banadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-    if (month > 255 || month < -255)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez un ajustement de mois correct (de -255  255), svp.\n");
-            ladmin_log ("Ajustement du mois hors norme (commande 'banadd')."
-                        RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please give a correct adjustment for the months (from -255 to 255).\n");
-            ladmin_log
-                ("Abnormal adjustement for the month ('banadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-    if (day > 32767 || day < -32767)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez un ajustement de jours correct (de -32767  32767), svp.\n");
-            ladmin_log ("Ajustement des jours hors norme (commande 'banadd')."
-                        RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please give a correct adjustment for the days (from -32767 to 32767).\n");
-            ladmin_log
-                ("Abnormal adjustement for the days ('banadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-    if (hour > 32767 || hour < -32767)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez un ajustement d'heures correct (de -32767  32767), svp.\n");
-            ladmin_log
-                ("Ajustement des heures hors norme (commande 'banadd')."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please give a correct adjustment for the hours (from -32767 to 32767).\n");
-            ladmin_log
-                ("Abnormal adjustement for the hours ('banadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-    if (minute > 32767 || minute < -32767)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez un ajustement de minutes correct (de -32767  32767), svp.\n");
-            ladmin_log
-                ("Ajustement des minutes hors norme (commande 'banadd')."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please give a correct adjustment for the minutes (from -32767 to 32767).\n");
-            ladmin_log
-                ("Abnormal adjustement for the minutes ('banadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-    if (second > 32767 || second < -32767)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez un ajustement de secondes correct (de -32767  32767), svp.\n");
-            ladmin_log
-                ("Ajustement des secondes hors norme (commande 'banadd')."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please give a correct adjustment for the seconds (from -32767 to 32767).\n");
-            ladmin_log
-                ("Abnormal adjustement for the seconds ('banadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour modifier la date d'un bannissement."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to modify a ban date/time."
-                    RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x794c;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    WFIFOW (login_fd, 26) = (short) year;
-    WFIFOW (login_fd, 28) = (short) month;
-    WFIFOW (login_fd, 30) = (short) day;
-    WFIFOW (login_fd, 32) = (short) hour;
-    WFIFOW (login_fd, 34) = (short) minute;
-    WFIFOW (login_fd, 36) = (short) second;
-    WFIFOSET (login_fd, 38);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//-----------------------------------------------------------------------
-// Sub-function of sub-function banaccount, unbanaccount or bansetaccount
-// Set the final date of a banishment of an account
-//-----------------------------------------------------------------------
-int bansetaccountsub (char *name, char *date, char *time)
-{
-    int  year, month, day, hour, minute, second;
-    time_t ban_until_time;      // # of seconds 1/1/1970 (timestamp): ban time limit of the account (0 = no ban)
-    struct tm *tmtime;
-
-    year = month = day = hour = minute = second = 0;
-    ban_until_time = 0;
-    tmtime = localtime (&ban_until_time);   // initialize
-
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    if (atoi (date) != 0 &&
-        ((sscanf (date, "%d/%d/%d", &year, &month, &day) < 3 &&
-          sscanf (date, "%d-%d-%d", &year, &month, &day) < 3 &&
-          sscanf (date, "%d.%d.%d", &year, &month, &day) < 3) ||
-         sscanf (time, "%d:%d:%d", &hour, &minute, &second) < 3))
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez une date et une heure svp (format: aaaa/mm/jj hh:mm:ss).\n");
-            printf
-                ("Vous pouvez aussi mettre 0  la place si vous utilisez la commande 'banset'.\n");
-            ladmin_log
-                ("Format incorrect pour la date/heure (commande'banset' ou 'ban')."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please input a date and a time (format: yyyy/mm/dd hh:mm:ss).\n");
-            printf
-                ("You can imput 0 instead of if you use 'banset' command.\n");
-            ladmin_log
-                ("Invalid format for the date/time ('banset' or 'ban' command)."
-                 RETCODE);
-        }
-        return 102;
-    }
-
-    if (atoi (date) == 0)
-    {
-        ban_until_time = 0;
-    }
-    else
-    {
-        if (year < 70)
-        {
-            year = year + 100;
-        }
-        if (year >= 1900)
-        {
-            year = year - 1900;
-        }
-        if (month < 1 || month > 12)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf ("Entrez un mois correct svp (entre 1 et 12).\n");
-                ladmin_log
-                    ("Mois incorrect pour la date (command 'banset' ou 'ban')."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please give a correct value for the month (from 1 to 12).\n");
-                ladmin_log
-                    ("Invalid month for the date ('banset' or 'ban' command)."
-                     RETCODE);
-            }
-            return 102;
-        }
-        month = month - 1;
-        if (day < 1 || day > 31)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf ("Entrez un jour correct svp (entre 1 et 31).\n");
-                ladmin_log
-                    ("Jour incorrect pour la date (command 'banset' ou 'ban')."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please give a correct value for the day (from 1 to 31).\n");
-                ladmin_log
-                    ("Invalid day for the date ('banset' or 'ban' command)."
-                     RETCODE);
-            }
-            return 102;
-        }
-        if (((month == 3 || month == 5 || month == 8 || month == 10)
-             && day > 30) || (month == 1 && day > 29))
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf
-                    ("Entrez un jour correct en fonction du mois (%d) svp.\n",
-                     month);
-                ladmin_log
-                    ("Jour incorrect pour ce mois correspondant (command 'banset' ou 'ban')."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please give a correct value for a day of this month (%d).\n",
-                     month);
-                ladmin_log
-                    ("Invalid day for this month ('banset' or 'ban' command)."
-                     RETCODE);
-            }
-            return 102;
-        }
-        if (hour < 0 || hour > 23)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf ("Entrez une heure correcte svp (entre 0 et 23).\n");
-                ladmin_log
-                    ("Heure incorrecte pour l'heure (command 'banset' ou 'ban')."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please give a correct value for the hour (from 0 to 23).\n");
-                ladmin_log
-                    ("Invalid hour for the time ('banset' or 'ban' command)."
-                     RETCODE);
-            }
-            return 102;
-        }
-        if (minute < 0 || minute > 59)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf
-                    ("Entrez des minutes correctes svp (entre 0 et 59).\n");
-                ladmin_log
-                    ("Minute incorrecte pour l'heure (command 'banset' ou 'ban')."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please give a correct value for the minutes (from 0 to 59).\n");
-                ladmin_log
-                    ("Invalid minute for the time ('banset' or 'ban' command)."
-                     RETCODE);
-            }
-            return 102;
-        }
-        if (second < 0 || second > 59)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf
-                    ("Entrez des secondes correctes svp (entre 0 et 59).\n");
-                ladmin_log
-                    ("Seconde incorrecte pour l'heure (command 'banset' ou 'ban')."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please give a correct value for the seconds (from 0 to 59).\n");
-                ladmin_log
-                    ("Invalid second for the time ('banset' or 'ban' command)."
-                     RETCODE);
-            }
-            return 102;
-        }
-        tmtime->tm_year = year;
-        tmtime->tm_mon = month;
-        tmtime->tm_mday = day;
-        tmtime->tm_hour = hour;
-        tmtime->tm_min = minute;
-        tmtime->tm_sec = second;
-        tmtime->tm_isdst = -1;  // -1: no winter/summer time modification
-        ban_until_time = timegm (tmtime);
-        if (ban_until_time == -1)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf ("Date incorrecte.\n");
-                printf
-                    ("Entrez une date et une heure svp (format: aaaa/mm/jj hh:mm:ss).\n");
-                printf
-                    ("Vous pouvez aussi mettre 0  la place si vous utilisez la commande 'banset'.\n");
-                ladmin_log ("Date incorrecte. (command 'banset' ou 'ban')."
-                            RETCODE);
-            }
-            else
-            {
-                printf ("Invalid date.\n");
-                printf
-                    ("Please input a date and a time (format: yyyy/mm/dd hh:mm:ss).\n");
-                printf
-                    ("You can imput 0 instead of if you use 'banset' command.\n");
-                ladmin_log ("Invalid date. ('banset' or 'ban' command)."
-                            RETCODE);
-            }
-            return 102;
-        }
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour fixer un ban."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to set a ban." RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x794a;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    WFIFOL (login_fd, 26) = (int) ban_until_time;
-    WFIFOSET (login_fd, 30);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//---------------------------------------------------------------------
-// Sub-function: Set the final date of a banishment of an account (ban)
-//---------------------------------------------------------------------
-int banaccount (char *param)
-{
-    char name[1023], date[1023], time[1023];
-
-    memset (name, '\0', sizeof (name));
-    memset (date, '\0', sizeof (date));
-    memset (time, '\0', sizeof (time));
-
-    if (sscanf (param, "%s %s \"%[^\"]\"", date, time, name) < 3 &&
-        sscanf (param, "%s %s '%[^']'", date, time, name) < 3 &&
-        sscanf (param, "%s %s %[^\r\n]", date, time, name) < 3)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte, une date et une heure svp.\n");
-            printf
-                ("<exemple>: banset <nom_du_compte> aaaa/mm/jj [hh:mm:ss]\n");
-            printf ("           banset <nom_du_compte> 0    (0 = d-bani)\n");
-            printf
-                ("           ban/banish aaaa/mm/jj hh:mm:ss <nom du compte>\n");
-            printf ("           unban/unbanish <nom du compte>\n");
-            printf ("           Heure par dfaut [hh:mm:ss]: 23:59:59.\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour fixer un ban (commande 'banset' ou 'ban')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name, a date and a hour.\n");
-            printf
-                ("<example>: banset <account_name> yyyy/mm/dd [hh:mm:ss]\n");
-            printf
-                ("           banset <account_name> 0   (0 = un-banished)\n");
-            printf
-                ("           ban/banish yyyy/mm/dd hh:mm:ss <account name>\n");
-            printf ("           unban/unbanish <account name>\n");
-            printf ("           Default time [hh:mm:ss]: 23:59:59.\n");
-            ladmin_log
-                ("Incomplete parameters to set a ban ('banset' or 'ban' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    return bansetaccountsub (name, date, time);
-}
-
-//------------------------------------------------------------------------
-// Sub-function: Set the final date of a banishment of an account (banset)
-//------------------------------------------------------------------------
-int bansetaccount (char *param)
-{
-    char name[1023], date[1023], time[1023];
-
-    memset (name, '\0', sizeof (name));
-    memset (date, '\0', sizeof (date));
-    memset (time, '\0', sizeof (time));
-
-    if (sscanf (param, "\"%[^\"]\" %s %[^\r\n]", name, date, time) < 2 &&   // if date = 0, time can be void
-        sscanf (param, "'%[^']' %s %[^\r\n]", name, date, time) < 2 &&  // if date = 0, time can be void
-        sscanf (param, "%s %s %[^\r\n]", name, date, time) < 2)
-    {                           // if date = 0, time can be void
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte, une date et une heure svp.\n");
-            printf
-                ("<exemple>: banset <nom_du_compte> aaaa/mm/jj [hh:mm:ss]\n");
-            printf ("           banset <nom_du_compte> 0    (0 = d-bani)\n");
-            printf
-                ("           ban/banish aaaa/mm/jj hh:mm:ss <nom du compte>\n");
-            printf ("           unban/unbanish <nom du compte>\n");
-            printf ("           Heure par dfaut [hh:mm:ss]: 23:59:59.\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour fixer un ban (commande 'banset' ou 'ban')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name, a date and a hour.\n");
-            printf
-                ("<example>: banset <account_name> yyyy/mm/dd [hh:mm:ss]\n");
-            printf
-                ("           banset <account_name> 0   (0 = un-banished)\n");
-            printf
-                ("           ban/banish yyyy/mm/dd hh:mm:ss <account name>\n");
-            printf ("           unban/unbanish <account name>\n");
-            printf ("           Default time [hh:mm:ss]: 23:59:59.\n");
-            ladmin_log
-                ("Incomplete parameters to set a ban ('banset' or 'ban' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    if (time[0] == '\0')
-        strcpy (time, "23:59:59");
-
-    return bansetaccountsub (name, date, time);
-}
-
-//-------------------------------------------------
-// Sub-function: unbanishment of an account (unban)
-//-------------------------------------------------
-int unbanaccount (char *param)
-{
-    char name[1023];
-
-    memset (name, '\0', sizeof (name));
-
-    if (strlen (param) == 0 ||
-        (sscanf (param, "\"%[^\"]\"", name) < 1 &&
-         sscanf (param, "'%[^']'", name) < 1 &&
-         sscanf (param, "%[^\r\n]", name) < 1) || strlen (name) == 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte svp.\n");
-            printf
-                ("<exemple>: banset <nom_du_compte> aaaa/mm/jj [hh:mm:ss]\n");
-            printf ("           banset <nom_du_compte> 0    (0 = d-bani)\n");
-            printf
-                ("           ban/banish aaaa/mm/jj hh:mm:ss <nom du compte>\n");
-            printf ("           unban/unbanish <nom du compte>\n");
-            printf ("           Heure par dfaut [hh:mm:ss]: 23:59:59.\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour fixer un ban (commande 'unban')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name.\n");
-            printf
-                ("<example>: banset <account_name> yyyy/mm/dd [hh:mm:ss]\n");
-            printf
-                ("           banset <account_name> 0   (0 = un-banished)\n");
-            printf
-                ("           ban/banish yyyy/mm/dd hh:mm:ss <account name>\n");
-            printf ("           unban/unbanish <account name>\n");
-            printf ("           Default time [hh:mm:ss]: 23:59:59.\n");
-            ladmin_log
-                ("Incomplete parameters to set a ban ('unban' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    return bansetaccountsub (name, "0", "");
-}
-
-//---------------------------------------------------------
-// Sub-function: Asking to check the validity of a password
-// (Note: never send back a password with login-server!! security of passwords)
-//---------------------------------------------------------
-int checkaccount (char *param)
-{
-    char name[1023], password[1023];
-
-    memset (name, '\0', sizeof (name));
-    memset (password, '\0', sizeof (password));
-
-    if (sscanf (param, "\"%[^\"]\" %[^\r\n]", name, password) < 1 &&    // password can be void
-        sscanf (param, "'%[^']' %[^\r\n]", name, password) < 1 &&   // password can be void
-        sscanf (param, "%s %[^\r\n]", name, password) < 1)
-    {                           // password can be void
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte svp.\n");
-            printf ("<exemple> check testname motdepasse\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour tester le mot d'un passe d'un compte (commande 'check')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name.\n");
-            printf ("<example> check testname password\n");
-            ladmin_log
-                ("Incomplete parameters to check the password of an account ('check' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    if (strlen (password) == 0)
-    {
-        if (typepasswd (password) == 0)
-            return 134;
-    }
-    if (verify_password (password) == 0)
-        return 131;
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour test un mot de passe."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to check a password." RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x793a;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    memcpy (WFIFOP (login_fd, 26), password, 24);
-    WFIFOSET (login_fd, 50);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//------------------------------------------------
-// Sub-function: Asking for deletion of an account
-//------------------------------------------------
-int delaccount (char *param)
-{
-    char name[1023];
-    char letter;
-    char confirm[1023];
-    int  i;
-
-    memset (name, '\0', sizeof (name));
-
-    if (strlen (param) == 0 ||
-        (sscanf (param, "\"%[^\"]\"", name) < 1 &&
-         sscanf (param, "'%[^']'", name) < 1 &&
-         sscanf (param, "%[^\r\n]", name) < 1) || strlen (name) == 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte svp.\n");
-            printf ("<exemple> del nomtestasupprimer\n");
-            ladmin_log
-                ("Aucun nom donn pour supprimer un compte (commande 'delete')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name.\n");
-            printf ("<example> del testnametodelete\n");
-            ladmin_log
-                ("No name given to delete an account ('delete' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    memset (confirm, '\0', sizeof (confirm));
-    while ((confirm[0] != 'o' || defaultlanguage != 'F') && confirm[0] != 'n'
-           && (confirm[0] != 'y' || defaultlanguage == 'F'))
-    {
-        if (defaultlanguage == 'F')
-            printf
-                ("\033[1;36m ** Etes-vous vraiment sr de vouloir SUPPRIMER le compte [$userid]? (o/n) > \033[0m");
-        else
-            printf
-                ("\033[1;36m ** Are you really sure to DELETE account [$userid]? (y/n) > \033[0m");
-        fflush (stdout);
-        memset (confirm, '\0', sizeof (confirm));
-        i = 0;
-        while ((letter = getchar ()) != '\n')
-            confirm[i++] = letter;
-    }
-
-    if (confirm[0] == 'n')
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Suppression annule.\n");
-            ladmin_log
-                ("Suppression annule par l'utilisateur (commande 'delete')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Deletion canceled.\n");
-            ladmin_log ("Deletion canceled by user ('delete' command)."
-                        RETCODE);
-        }
-        return 121;
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour dtruire un compte."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to delete an acount." RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x7932;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    WFIFOSET (login_fd, 26);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//----------------------------------------------------------
-// Sub-function: Asking to modification of an account e-mail
-//----------------------------------------------------------
-int changeemail (char *param)
-{
-    char name[1023], email[1023];
-
-    memset (name, '\0', sizeof (name));
-    memset (email, '\0', sizeof (email));
-
-    if (sscanf (param, "\"%[^\"]\" %[^\r\n]", name, email) < 2 &&
-        sscanf (param, "'%[^']' %[^\r\n]", name, email) < 2 &&
-        sscanf (param, "%s %[^\r\n]", name, email) < 2)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte et une email svp.\n");
-            printf ("<exemple> email testname nouveauemail\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour changer l'email d'un compte (commande 'email')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name and an email.\n");
-            printf ("<example> email testname newemail\n");
-            ladmin_log
-                ("Incomplete parameters to change the email of an account ('email' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    if (strlen (email) < 3)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Email trop courte [%s]. Entrez une e-mail valide svp.\n",
-                    email);
-            ladmin_log
-                ("Email trop courte [%s]. Entrez une e-mail valide svp."
-                 RETCODE, email);
-        }
-        else
-        {
-            printf ("Email is too short [%s]. Please input a valid e-mail.\n",
-                    email);
-            ladmin_log
-                ("Email is too short [%s]. Please input a valid e-mail."
-                 RETCODE, email);
-        }
-        return 109;
-    }
-    if (strlen (email) > 39)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Email trop longue [%s]. Entrez une e-mail de 39 caractres maximum svp.\n",
-                 email);
-            ladmin_log
-                ("Email trop longue [%s]. Entrez une e-mail de 39 caractres maximum svp."
-                 RETCODE, email);
-        }
-        else
-        {
-            printf
-                ("Email is too long [%s]. Please input an e-mail with 39 bytes at the most.\n",
-                 email);
-            ladmin_log
-                ("Email is too long [%s]. Please input an e-mail with 39 bytes at the most."
-                 RETCODE, email);
-        }
-        return 109;
-    }
-    if (e_mail_check (email) == 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Email incorrecte [%s]. Entrez une e-mail valide svp.\n",
-                    email);
-            ladmin_log ("Email incorrecte [%s]. Entrez une e-mail valide svp."
-                        RETCODE, email);
-        }
-        else
-        {
-            printf ("Invalid email [%s]. Please input a valid e-mail.\n",
-                    email);
-            ladmin_log ("Invalid email [%s]. Please input a valid e-mail."
-                        RETCODE, email);
-        }
-        return 109;
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour changer une email."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to change an email." RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x7940;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    memcpy (WFIFOP (login_fd, 26), email, 40);
-    WFIFOSET (login_fd, 66);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//-----------------------------------------------------
-// Sub-function: Asking of the number of online players
-//-----------------------------------------------------
-int getlogincount ()
-{
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour obtenir le nombre de joueurs en jeu."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log
-            ("Request to login-server to obtain the # of online players."
-             RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x7938;
-    WFIFOSET (login_fd, 2);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//----------------------------------------------------------
-// Sub-function: Asking to modify the GM level of an account
-//----------------------------------------------------------
-int changegmlevel (char *param)
-{
-    char name[1023];
-    int  GM_level;
-
-    memset (name, '\0', sizeof (name));
-    GM_level = 0;
-
-    if (sscanf (param, "\"%[^\"]\" %d", name, &GM_level) < 1 &&
-        sscanf (param, "'%[^']' %d", name, &GM_level) < 1 &&
-        sscanf (param, "%s %d", name, &GM_level) < 1)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte et un niveau de GM svp.\n");
-            printf ("<exemple> gm nomtest 80\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour changer le Niveau de GM d'un compte (commande 'gm')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name and a GM level.\n");
-            printf ("<example> gm testname 80\n");
-            ladmin_log
-                ("Incomplete parameters to change the GM level of an account ('gm' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    if (GM_level < 0 || GM_level > 99)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Niveau de GM incorrect [%d]. Entrez une valeur de 0  99 svp.\n",
-                 GM_level);
-            ladmin_log
-                ("Niveau de GM incorrect [%d]. La valeur peut tre de 0  99."
-                 RETCODE, GM_level);
-        }
-        else
-        {
-            printf
-                ("Illegal GM level [%d]. Please input a value from 0 to 99.\n",
-                 GM_level);
-            ladmin_log
-                ("Illegal GM level [%d]. The value can be from 0 to 99."
-                 RETCODE, GM_level);
-        }
-        return 103;
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour changer un niveau de GM."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to change a GM level." RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x793e;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    WFIFOB (login_fd, 26) = GM_level;
-    WFIFOSET (login_fd, 27);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//---------------------------------------------
-// Sub-function: Asking to obtain an account id
-//---------------------------------------------
-int idaccount (char *param)
-{
-    char name[1023];
-
-    memset (name, '\0', sizeof (name));
-
-    if (strlen (param) == 0 ||
-        (sscanf (param, "\"%[^\"]\"", name) < 1 &&
-         sscanf (param, "'%[^']'", name) < 1 &&
-         sscanf (param, "%[^\r\n]", name) < 1) || strlen (name) == 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte svp.\n");
-            printf ("<exemple> id nomtest\n");
-            ladmin_log
-                ("Aucun nom donn pour rechecher l'id d'un compte (commande 'id')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name.\n");
-            printf ("<example> id testname\n");
-            ladmin_log
-                ("No name given to search an account id ('id' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour connatre l'id d'un compte."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to know an account id." RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x7944;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    WFIFOSET (login_fd, 26);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//----------------------------------------------------------------------------
-// Sub-function: Asking to displaying information about an account (by its id)
-//----------------------------------------------------------------------------
-int infoaccount (int account_id)
-{
-    if (account_id < 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un id ayant une valeur positive svp.\n");
-            ladmin_log
-                ("Une valeur ngative a t donn pour trouver le compte."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input a positive value for the id.\n");
-            ladmin_log ("Negative value was given to found the account."
-                        RETCODE);
-        }
-        return 136;
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour obtenir le information d'un compte (par l'id)."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log
-            ("Request to login-server to obtain information about an account (by its id)."
-             RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x7954;
-    WFIFOL (login_fd, 2) = account_id;
-    WFIFOSET (login_fd, 6);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//---------------------------------------
-// Sub-function: Send a broadcast message
-//---------------------------------------
-int sendbroadcast (short type, char *message)
-{
-    if (strlen (message) == 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un message svp.\n");
-            if (type == 0)
-            {
-                printf ("<exemple> kami un message\n");
-            }
-            else
-            {
-                printf ("<exemple> kamib un message\n");
-            }
-            ladmin_log ("Le message est vide (commande 'kami(b)')." RETCODE);
-        }
-        else
-        {
-            printf ("Please input a message.\n");
-            if (type == 0)
-            {
-                printf ("<example> kami a message\n");
-            }
-            else
-            {
-                printf ("<example> kamib a message\n");
-            }
-            ladmin_log ("The message is void ('kami(b)' command)." RETCODE);
-        }
-        return 136;
-    }
-
-    WFIFOW (login_fd, 0) = 0x794e;
-    WFIFOW (login_fd, 2) = type;
-    WFIFOL (login_fd, 4) = strlen (message) + 1;
-    memcpy (WFIFOP (login_fd, 8), message, strlen (message) + 1);
-    WFIFOSET (login_fd, 8 + strlen (message) + 1);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//--------------------------------------------
-// Sub-function: Change language of displaying
-//--------------------------------------------
-int changelanguage (char *language)
-{
-    if (strlen (language) == 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez une langue svp.\n");
-            printf ("<exemple> language english\n");
-            printf ("          language franais\n");
-            ladmin_log ("La langue est vide (commande 'language')." RETCODE);
-        }
-        else
-        {
-            printf ("Please input a language.\n");
-            printf ("<example> language english\n");
-            printf ("          language franais\n");
-            ladmin_log ("The language is void ('language' command)." RETCODE);
-        }
-        return 136;
-    }
-
-    language[0] = toupper (language[0]);
-    if (language[0] == 'F' || language[0] == 'E')
-    {
-        defaultlanguage = language[0];
-        if (defaultlanguage == 'F')
-        {
-            printf ("Changement de la langue d'affichage en Franais.\n");
-            ladmin_log ("Changement de la langue d'affichage en Franais."
-                        RETCODE);
-        }
-        else
-        {
-            printf ("Displaying language changed to English.\n");
-            ladmin_log ("Displaying language changed to English." RETCODE);
-        }
-    }
-    else
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Langue non paramtre (langues possibles: 'Franais' ou 'English').\n");
-            ladmin_log
-                ("Langue non paramtre (Franais ou English ncessaire)."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Undefined language (possible languages: Franais or English).\n");
-            ladmin_log ("Undefined language (must be Franais or English)."
-                        RETCODE);
-        }
-    }
-
-    return 0;
-}
-
-//--------------------------------------------------------
-// Sub-function: Asking to Displaying of the accounts list
-//--------------------------------------------------------
-int listaccount (char *param, int type)
-{
-//int list_first, list_last, list_type; // parameter to display a list of accounts
-    int  i;
-
-    list_type = type;
-
-    // set default values
-    list_first = 0;
-    list_last = 0;
-
-    if (list_type == 1)
-    {                           // if listgm
-        // get all accounts = use default
-    }
-    else if (list_type == 2)
-    {                           // if search
-        for (i = 0; param[i]; i++)
-            param[i] = tolower (param[i]);
-        // get all accounts = use default
-    }
-    else if (list_type == 3)
-    {                           // if listban
-        // get all accounts = use default
-    }
-    else if (list_type == 4)
-    {                           // if listok
-        // get all accounts = use default
-    }
-    else
-    {                           // if list (list_type == 0)
-        switch (sscanf (param, "%d %d", &list_first, &list_last))
-        {
-            case 0:
-                // get all accounts = use default
-                break;
-            case 1:
-                list_last = 0;
-                // use tests of the following value
-            default:
-                if (list_first < 0)
-                    list_first = 0;
-                if (list_last < list_first || list_last < 0)
-                    list_last = 0;
-                break;
-        }
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour obtenir la liste des comptes de %d  %d."
-             RETCODE, list_first, list_last);
-    }
-    else
-    {
-        ladmin_log
-            ("Request to login-server to obtain the list of accounts from %d to %d."
-             RETCODE, list_first, list_last);
-    }
-
-    WFIFOW (login_fd, 0) = 0x7920;
-    WFIFOL (login_fd, 2) = list_first;
-    WFIFOL (login_fd, 6) = list_last;
-    WFIFOSET (login_fd, 10);
-    bytes_to_read = 1;
-
-    //          0123456789 01 01234567890123456789012301234 012345 0123456789012345678901234567
-    if (defaultlanguage == 'F')
-    {
-        Iprintf
-            (" id_compte GM nom_utilisateur         sexe   count statut\n");
-    }
-    else
-    {
-        Iprintf
-            ("account_id GM user_name               sex    count state\n");
-    }
-    Iprintf
-        ("-------------------------------------------------------------------------------\n");
-    list_count = 0;
-
-    return 0;
-}
-
-//--------------------------------------------------------
-// Sub-function: Frobnicate items
-//--------------------------------------------------------
-int itemfrob (char *param)
-{
-    int  source_id, dest_id;
-
-    if (sscanf (param, "%d %d", &source_id, &dest_id) < 2)
-    {
-        printf ("You must provide the source and destination item IDs.\n");
-        return 1;
-    }
-
-    WFIFOW (login_fd, 0) = 0x7924;
-    WFIFOL (login_fd, 2) = source_id;
-    WFIFOL (login_fd, 6) = dest_id;
-    WFIFOSET (login_fd, 10);
-    bytes_to_read = 1;          // all logging is done to the three main servers
-
-    return 0;
-}
-
-//--------------------------------------------
-// Sub-function: Asking to modify a memo field
-//--------------------------------------------
-int changememo (char *param)
-{
-    char name[1023], memo[1023];
-
-    memset (name, '\0', sizeof (name));
-    memset (memo, '\0', sizeof (memo));
-
-    if (sscanf (param, "\"%[^\"]\" %[^\r\n]", name, memo) < 1 &&    // memo can be void
-        sscanf (param, "'%[^']' %[^\r\n]", name, memo) < 1 &&   // memo can be void
-        sscanf (param, "%s %[^\r\n]", name, memo) < 1)
-    {                           // memo can be void
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte et un mmo svp.\n");
-            printf ("<exemple> memo nomtest nouveau memo\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour changer le mmo d'un compte (commande 'email')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name and a memo.\n");
-            printf ("<example> memo testname new memo\n");
-            ladmin_log
-                ("Incomplete parameters to change the memo of an account ('email' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    if (strlen (memo) > 254)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Mmo trop long (%d caractres).\n", strlen (memo));
-            printf ("Entrez un mmo de 254 caractres maximum svp.\n");
-            ladmin_log
-                ("Mmo trop long (%d caractres). Entrez un mmo de 254 caractres maximum svp."
-                 RETCODE, strlen (memo));
-        }
-        else
-        {
-            printf ("Memo is too long (%d characters).\n", strlen (memo));
-            printf ("Please input a memo of 254 bytes at the maximum.\n");
-            ladmin_log
-                ("Email is too long (%d characters). Please input a memo of 254 bytes at the maximum."
-                 RETCODE, strlen (memo));
-        }
-        return 102;
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour changer un mmo."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to change a memo." RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x7942;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    WFIFOW (login_fd, 26) = strlen (memo);
-    if (strlen (memo) > 0)
-        memcpy (WFIFOP (login_fd, 28), memo, strlen (memo));
-    WFIFOSET (login_fd, 28 + strlen (memo));
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//-----------------------------------------------
-// Sub-function: Asking to obtain an account name
-//-----------------------------------------------
-int nameaccount (int id)
-{
-    if (id < 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un id ayant une valeur positive svp.\n");
-            ladmin_log
-                ("Id ngatif donn pour rechecher le nom d'un compte (commande 'name')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input a positive value for the id.\n");
-            ladmin_log
-                ("Negativ id given to search an account name ('name' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    if (defaultlanguage == 'F')
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour connatre le nom d'un compte."
-             RETCODE);
-    else
-        ladmin_log ("Request to login-server to know an account name."
-                    RETCODE);
-
-    WFIFOW (login_fd, 0) = 0x7946;
-    WFIFOL (login_fd, 2) = id;
-    WFIFOSET (login_fd, 6);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//------------------------------------------
-// Sub-function: Asking to modify a password
-// (Note: never send back a password with login-server!! security of passwords)
-//------------------------------------------
-int changepasswd (char *param)
-{
-    char name[1023], password[1023];
-
-    memset (name, '\0', sizeof (name));
-    memset (password, '\0', sizeof (password));
-
-    if (sscanf (param, "\"%[^\"]\" %[^\r\n]", name, password) < 1 &&
-        sscanf (param, "'%[^']' %[^\r\n]", name, password) < 1 &&
-        sscanf (param, "%s %[^\r\n]", name, password) < 1)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte svp.\n");
-            printf ("<exemple> passwd nomtest nouveaumotdepasse\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour changer le mot d'un passe d'un compte (commande 'password')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name.\n");
-            printf ("<example> passwd testname newpassword\n");
-            ladmin_log
-                ("Incomplete parameters to change the password of an account ('password' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    if (strlen (password) == 0)
-    {
-        if (typepasswd (password) == 0)
-            return 134;
-    }
-    if (verify_password (password) == 0)
-        return 131;
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour changer un mot de passe."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to change a password." RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x7934;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    memcpy (WFIFOP (login_fd, 26), password, 24);
-    WFIFOSET (login_fd, 50);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//----------------------------------------------------------------------
-// Sub-function: Request to login-server to reload GM configuration file
-// this function have no answer
-//----------------------------------------------------------------------
-int reloadGM ()
-{
-    WFIFOW (login_fd, 0) = 0x7955;
-    WFIFOSET (login_fd, 2);
-    bytes_to_read = 0;
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Demande de recharger le fichier de configuration des GM envoye."
-             RETCODE);
-        printf
-            ("Demande de recharger le fichier de configuration des GM envoye.\n");
-        printf ("Vrifiez les comptes GM actuels (aprs rechargement):\n");
-    }
-    else
-    {
-        ladmin_log ("Request to reload the GM configuration file sended."
-                    RETCODE);
-        printf ("Request to reload the GM configuration file sended.\n");
-        printf ("Check the actual GM accounts (after reloading):\n");
-    }
-    listaccount (parameters, 1);    // 1: to list only GM
-
-    return 180;
-}
-
-//-----------------------------------------------------
-// Sub-function: Asking to modify the sex of an account
-//-----------------------------------------------------
-int changesex (char *param)
-{
-    char name[1023], sex[1023];
-
-    memset (name, '\0', sizeof (name));
-    memset (sex, '\0', sizeof (sex));
-
-    if (sscanf (param, "\"%[^\"]\" %[^\r\n]", name, sex) < 2 &&
-        sscanf (param, "'%[^']' %[^\r\n]", name, sex) < 2 &&
-        sscanf (param, "%s %[^\r\n]", name, sex) < 2)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte et un sexe svp.\n");
-            printf ("<exemple> sex nomtest Male\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour changer le sexe d'un compte (commande 'sex')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name and a sex.\n");
-            printf ("<example> sex testname Male\n");
-            ladmin_log
-                ("Incomplete parameters to change the sex of an account ('sex' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    sex[0] = toupper (sex[0]);
-    if (strchr ("MF", sex[0]) == NULL)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Sexe incorrect [%s]. Entrez M ou F svp.\n", sex);
-            ladmin_log ("Sexe incorrect [%s]. Entrez M ou F svp." RETCODE,
-                        sex);
-        }
-        else
-        {
-            printf ("Illegal gender [%s]. Please input M or F.\n", sex);
-            ladmin_log ("Illegal gender [%s]. Please input M or F." RETCODE,
-                        sex);
-        }
-        return 103;
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour changer un sexe."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to change a sex." RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x793c;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    WFIFOB (login_fd, 26) = sex[0];
-    WFIFOSET (login_fd, 27);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//-------------------------------------------------------------------------
-// Sub-function of sub-function changestate, blockaccount or unblockaccount
-// Asking to modify the state of an account
-//-------------------------------------------------------------------------
-int changestatesub (char *name, int state, char *error_message7)
-{
-    char error_message[1023];   // need to use, because we can modify error_message7
-
-    memset (error_message, '\0', sizeof (error_message));
-    strncpy (error_message, error_message7, sizeof (error_message) - 1);
-
-    if ((state < 0 || state > 9) && state != 100)
-    {                           // Valid values: 0: ok, or value of the 0x006a packet + 1
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez une des statuts suivantes svp:\n");
-            printf
-                ("  0 = Compte ok             6 = Your Game's EXE file is not the latest version\n");
-        }
-        else
-        {
-            printf ("Please input one of these states:\n");
-            printf
-                ("  0 = Account ok            6 = Your Game's EXE file is not the latest version\n");
-        }
-        printf
-            ("  1 = Unregistered ID       7 = You are Prohibited to log in until + message\n");
-        printf
-            ("  2 = Incorrect Password    8 = Server is jammed due to over populated\n");
-        printf ("  3 = This ID is expired    9 = No MSG\n");
-        printf
-            ("  4 = Rejected from Server  100 = This ID has been totally erased\n");
-        printf ("  5 = You have been blocked by the GM Team\n");
-        if (defaultlanguage == 'F')
-        {
-            printf ("<exemples> state nomtest 5\n");
-            printf ("           state nomtest 7 fin de votre ban\n");
-            printf ("           block <nom compte>\n");
-            printf ("           unblock <nom compte>\n");
-            ladmin_log
-                ("Valeur incorrecte pour le statut d'un compte (commande 'state', 'block' ou 'unblock')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("<examples> state testname 5\n");
-            printf ("           state testname 7 end of your ban\n");
-            printf ("           block <account name>\n");
-            printf ("           unblock <account name>\n");
-            ladmin_log
-                ("Invalid value for the state of an account ('state', 'block' or 'unblock' command)."
-                 RETCODE);
-        }
-        return 151;
-    }
-
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    if (state != 7)
-    {
-        strcpy (error_message, "-");
-    }
-    else
-    {
-        if (strlen (error_message) < 1)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf
-                    ("Message d'erreur trop court. Entrez un message de 1-19 caractres.\n");
-                ladmin_log
-                    ("Message d'erreur trop court. Entrez un message de 1-19 caractres."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Error message is too short. Please input a message of 1-19 bytes.\n");
-                ladmin_log
-                    ("Error message is too short. Please input a message of 1-19 bytes."
-                     RETCODE);
-            }
-            return 102;
-        }
-        if (strlen (error_message) > 19)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf
-                    ("Message d'erreur trop long. Entrez un message de 1-19 caractres.\n");
-                ladmin_log
-                    ("Message d'erreur trop long. Entrez un message de 1-19 caractres."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Error message is too long. Please input a message of 1-19 bytes.\n");
-                ladmin_log
-                    ("Error message is too long. Please input a message of 1-19 bytes."
-                     RETCODE);
-            }
-            return 102;
-        }
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour changer un statut."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to change a state." RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x7936;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    WFIFOL (login_fd, 26) = state;
-    memcpy (WFIFOP (login_fd, 30), error_message, 20);
-    WFIFOSET (login_fd, 50);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//-------------------------------------------------------
-// Sub-function: Asking to modify the state of an account
-//-------------------------------------------------------
-int changestate (char *param)
-{
-    char name[1023], error_message[1023];
-    int  state;
-
-    memset (name, '\0', sizeof (name));
-    memset (error_message, '\0', sizeof (error_message));
-
-    if (sscanf (param, "\"%[^\"]\" %d %[^\r\n]", name, &state, error_message)
-        < 2
-        && sscanf (param, "'%[^']' %d %[^\r\n]", name, &state,
-                   error_message) < 2
-        && sscanf (param, "%s %d %[^\r\n]", name, &state, error_message) < 2)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte et un statut svp.\n");
-            printf ("<exemples> state nomtest 5\n");
-            printf ("           state nomtest 7 fin de votre ban\n");
-            printf ("           block <nom compte>\n");
-            printf ("           unblock <nom compte>\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour changer le statut d'un compte (commande 'state')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name and a state.\n");
-            printf ("<examples> state testname 5\n");
-            printf ("           state testname 7 end of your ban\n");
-            printf ("           block <account name>\n");
-            printf ("           unblock <account name>\n");
-            ladmin_log
-                ("Incomplete parameters to change the state of an account ('state' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    return changestatesub (name, state, error_message);
-}
-
-//-------------------------------------------
-// Sub-function: Asking to unblock an account
-//-------------------------------------------
-int unblockaccount (char *param)
-{
-    char name[1023];
-
-    memset (name, '\0', sizeof (name));
-
-    if (strlen (param) == 0 ||
-        (sscanf (param, "\"%[^\"]\"", name) < 1 &&
-         sscanf (param, "'%[^']'", name) < 1 &&
-         sscanf (param, "%[^\r\n]", name) < 1) || strlen (name) == 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte svp.\n");
-            printf ("<exemples> state nomtest 5\n");
-            printf ("           state nomtest 7 fin de votre ban\n");
-            printf ("           block <nom compte>\n");
-            printf ("           unblock <nom compte>\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour changer le statut d'un compte (commande 'unblock')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name.\n");
-            printf ("<examples> state testname 5\n");
-            printf ("           state testname 7 end of your ban\n");
-            printf ("           block <account name>\n");
-            printf ("           unblock <account name>\n");
-            ladmin_log
-                ("Incomplete parameters to change the state of an account ('unblock' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    return changestatesub (name, 0, "-");   // state 0, no error message
-}
-
-//-------------------------------------------
-// Sub-function: Asking to unblock an account
-//-------------------------------------------
-int blockaccount (char *param)
-{
-    char name[1023];
-
-    memset (name, '\0', sizeof (name));
-
-    if (strlen (param) == 0 ||
-        (sscanf (param, "\"%[^\"]\"", name) < 1 &&
-         sscanf (param, "'%[^']'", name) < 1 &&
-         sscanf (param, "%[^\r\n]", name) < 1) || strlen (name) == 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte svp.\n");
-            printf ("<exemples> state nomtest 5\n");
-            printf ("           state nomtest 7 fin de votre ban\n");
-            printf ("           block <nom compte>\n");
-            printf ("           unblock <nom compte>\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour changer le statut d'un compte (commande 'block')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name.\n");
-            printf ("<examples> state testname 5\n");
-            printf ("           state testname 7 end of your ban\n");
-            printf ("           block <account name>\n");
-            printf ("           unblock <account name>\n");
-            ladmin_log
-                ("Incomplete parameters to change the state of an account ('block' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-
-    return changestatesub (name, 5, "-");   // state 5, no error message
-}
-
-//---------------------------------------------------------------------
-// Sub-function: Add/substract time to the validity limit of an account
-//---------------------------------------------------------------------
-int timeaddaccount (char *param)
-{
-    char name[1023], modif[1023];
-    int  year, month, day, hour, minute, second;
-    char *p_modif;
-    int  value, i;
-
-    memset (name, '\0', sizeof (name));
-    memset (modif, '\0', sizeof (modif));
-    year = month = day = hour = minute = second = 0;
-
-    if (sscanf (param, "\"%[^\"]\" %[^\r\n]", name, modif) < 2 &&
-        sscanf (param, "'%[^']' %[^\r\n]", name, modif) < 2 &&
-        sscanf (param, "%s %[^\r\n]", name, modif) < 2)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte et un modificateur svp.\n");
-            printf ("  <exemple> timeadd nomtest +1m-2mn1s-6y\n");
-            printf
-                ("            Cette exemple ajoute 1 mois et 1 seconde, et soustrait 2 minutes\n");
-            printf ("            et 6 ans dans le mme temps.\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour modifier une date limite d'utilisation (commande 'timeadd')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name and a modifier.\n");
-            printf ("  <example>: timeadd testname +1m-2mn1s-6y\n");
-            printf
-                ("             this example adds 1 month and 1 second, and substracts 2 minutes\n");
-            printf ("             and 6 years at the same time.\n");
-            ladmin_log
-                ("Incomplete parameters to modify a limit time ('timeadd' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    // lowercase for modif
-    for (i = 0; modif[i]; i++)
-        modif[i] = tolower (modif[i]);
-    p_modif = modif;
-    while (strlen (p_modif) > 0)
-    {
-        value = atoi (p_modif);
-        if (value == 0)
-        {
-            p_modif++;
-        }
-        else
-        {
-            if (p_modif[0] == '-' || p_modif[0] == '+')
-                p_modif++;
-            while (strlen (p_modif) > 0 && p_modif[0] >= '0'
-                   && p_modif[0] <= '9')
-            {
-                p_modif++;
-            }
-            if (p_modif[0] == 's')
-            {
-                second = value;
-                p_modif++;
-            }
-            else if (p_modif[0] == 'm' && p_modif[1] == 'n')
-            {
-                minute = value;
-                p_modif += 2;
-            }
-            else if (p_modif[0] == 'h')
-            {
-                hour = value;
-                p_modif++;
-            }
-            else if (p_modif[0] == 'd' || p_modif[0] == 'j')
-            {
-                day = value;
-                p_modif += 2;
-            }
-            else if (p_modif[0] == 'm')
-            {
-                month = value;
-                p_modif++;
-            }
-            else if (p_modif[0] == 'y' || p_modif[0] == 'a')
-            {
-                year = value;
-                p_modif++;
-            }
-            else
-            {
-                p_modif++;
-            }
-        }
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        printf (" anne:   %d\n", year);
-        printf (" mois:    %d\n", month);
-        printf (" jour:    %d\n", day);
-        printf (" heure:   %d\n", hour);
-        printf (" minute:  %d\n", minute);
-        printf (" seconde: %d\n", second);
-    }
-    else
-    {
-        printf (" year:   %d\n", year);
-        printf (" month:  %d\n", month);
-        printf (" day:    %d\n", day);
-        printf (" hour:   %d\n", hour);
-        printf (" minute: %d\n", minute);
-        printf (" second: %d\n", second);
-    }
-
-    if (year == 0 && month == 0 && day == 0 && hour == 0 && minute == 0
-        && second == 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Vous devez entrer un ajustement avec cette commande, svp:\n");
-            printf ("  Valeur d'ajustement (-1, 1, +1, etc...)\n");
-            printf ("  Elment modifi:\n");
-            printf ("    a ou y: anne\n");
-            printf ("    m:      mois\n");
-            printf ("    j ou d: jour\n");
-            printf ("    h:      heure\n");
-            printf ("    mn:     minute\n");
-            printf ("    s:      seconde\n");
-            printf ("  <exemple> timeadd nomtest +1m-2mn1s-6y\n");
-            printf
-                ("            Cette exemple ajoute 1 mois et 1 seconde, et soustrait 2 minutes\n");
-            printf ("            et 6 ans dans le mme temps.\n");
-            ladmin_log
-                ("Aucun ajustement n'est pas un ajustement (commande 'timeadd')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please give an adjustment with this command:\n");
-            printf ("  Adjustment value (-1, 1, +1, etc...)\n");
-            printf ("  Modified element:\n");
-            printf ("    a or y: year\n");
-            printf ("    m:      month\n");
-            printf ("    j or d: day\n");
-            printf ("    h:      hour\n");
-            printf ("    mn:     minute\n");
-            printf ("    s:      second\n");
-            printf ("  <example> timeadd testname +1m-2mn1s-6y\n");
-            printf
-                ("            this example adds 1 month and 1 second, and substracts 2 minutes\n");
-            printf ("            and 6 years at the same time.\n");
-            ladmin_log
-                ("No adjustment isn't an adjustment ('timeadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-    if (year > 127 || year < -127)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez un ajustement d'annes correct (de -127  127), svp.\n");
-            ladmin_log
-                ("Ajustement de l'anne hors norme ('timeadd' command)."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please give a correct adjustment for the years (from -127 to 127).\n");
-            ladmin_log
-                ("Abnormal adjustement for the year ('timeadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-    if (month > 255 || month < -255)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez un ajustement de mois correct (de -255  255), svp.\n");
-            ladmin_log ("Ajustement du mois hors norme ('timeadd' command)."
-                        RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please give a correct adjustment for the months (from -255 to 255).\n");
-            ladmin_log
-                ("Abnormal adjustement for the month ('timeadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-    if (day > 32767 || day < -32767)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez un ajustement de jours correct (de -32767  32767), svp.\n");
-            ladmin_log ("Ajustement des jours hors norme ('timeadd' command)."
-                        RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please give a correct adjustment for the days (from -32767 to 32767).\n");
-            ladmin_log
-                ("Abnormal adjustement for the days ('timeadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-    if (hour > 32767 || hour < -32767)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez un ajustement d'heures correct (de -32767  32767), svp.\n");
-            ladmin_log
-                ("Ajustement des heures hors norme ('timeadd' command)."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please give a correct adjustment for the hours (from -32767 to 32767).\n");
-            ladmin_log
-                ("Abnormal adjustement for the hours ('timeadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-    if (minute > 32767 || minute < -32767)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez un ajustement de minutes correct (de -32767  32767), svp.\n");
-            ladmin_log
-                ("Ajustement des minutes hors norme ('timeadd' command)."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please give a correct adjustment for the minutes (from -32767 to 32767).\n");
-            ladmin_log
-                ("Abnormal adjustement for the minutes ('timeadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-    if (second > 32767 || second < -32767)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez un ajustement de secondes correct (de -32767  32767), svp.\n");
-            ladmin_log
-                ("Ajustement des secondes hors norme ('timeadd' command)."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please give a correct adjustment for the seconds (from -32767 to 32767).\n");
-            ladmin_log
-                ("Abnormal adjustement for the seconds ('timeadd' command)."
-                 RETCODE);
-        }
-        return 137;
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour modifier une date limite d'utilisation."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to modify a time limit."
-                    RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x7950;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    WFIFOW (login_fd, 26) = (short) year;
-    WFIFOW (login_fd, 28) = (short) month;
-    WFIFOW (login_fd, 30) = (short) day;
-    WFIFOW (login_fd, 32) = (short) hour;
-    WFIFOW (login_fd, 34) = (short) minute;
-    WFIFOW (login_fd, 36) = (short) second;
-    WFIFOSET (login_fd, 38);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//-------------------------------------------------
-// Sub-function: Set a validity limit of an account
-//-------------------------------------------------
-int timesetaccount (char *param)
-{
-    char name[1023], date[1023], time[1023];
-    int  year, month, day, hour, minute, second;
-    time_t connect_until_time;  // # of seconds 1/1/1970 (timestamp): Validity limit of the account (0 = unlimited)
-    struct tm *tmtime;
-
-    memset (name, '\0', sizeof (name));
-    memset (date, '\0', sizeof (date));
-    memset (time, '\0', sizeof (time));
-    year = month = day = hour = minute = second = 0;
-    connect_until_time = 0;
-    tmtime = localtime (&connect_until_time);   // initialize
-
-    if (sscanf (param, "\"%[^\"]\" %s %[^\r\n]", name, date, time) < 2 &&   // if date = 0, time can be void
-        sscanf (param, "'%[^']' %s %[^\r\n]", name, date, time) < 2 &&  // if date = 0, time can be void
-        sscanf (param, "%s %s %[^\r\n]", name, date, time) < 2)
-    {                           // if date = 0, time can be void
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte, une date et une heure svp.\n");
-            printf
-                ("<exemple>: timeset <nom_du_compte> aaaa/mm/jj [hh:mm:ss]\n");
-            printf
-                ("           timeset <nom_du_compte> 0    (0 = illimit)\n");
-            printf ("           Heure par dfaut [hh:mm:ss]: 23:59:59.\n");
-            ladmin_log
-                ("Nombre incorrect de paramtres pour fixer une date limite d'utilisation (commande 'timeset')."
-                 RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name, a date and a hour.\n");
-            printf
-                ("<example>: timeset <account_name> yyyy/mm/dd [hh:mm:ss]\n");
-            printf
-                ("           timeset <account_name> 0   (0 = unlimited)\n");
-            printf ("           Default time [hh:mm:ss]: 23:59:59.\n");
-            ladmin_log
-                ("Incomplete parameters to set a limit time ('timeset' command)."
-                 RETCODE);
-        }
-        return 136;
-    }
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    if (time[0] == '\0')
-        strcpy (time, "23:59:59");
-
-    if (atoi (date) != 0 &&
-        ((sscanf (date, "%d/%d/%d", &year, &month, &day) < 3 &&
-          sscanf (date, "%d-%d-%d", &year, &month, &day) < 3 &&
-          sscanf (date, "%d.%d.%d", &year, &month, &day) < 3 &&
-          sscanf (date, "%d'%d'%d", &year, &month, &day) < 3) ||
-         sscanf (time, "%d:%d:%d", &hour, &minute, &second) < 3))
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Entrez 0 ou une date et une heure svp (format: 0 ou aaaa/mm/jj hh:mm:ss).\n");
-            ladmin_log
-                ("Format incorrect pour la date/heure ('timeset' command)."
-                 RETCODE);
-        }
-        else
-        {
-            printf
-                ("Please input 0 or a date and a time (format: 0 or yyyy/mm/dd hh:mm:ss).\n");
-            ladmin_log
-                ("Invalid format for the date/time ('timeset' command)."
-                 RETCODE);
-        }
-        return 102;
-    }
-
-    if (atoi (date) == 0)
-    {
-        connect_until_time = 0;
-    }
-    else
-    {
-        if (year < 70)
-        {
-            year = year + 100;
-        }
-        if (year >= 1900)
-        {
-            year = year - 1900;
-        }
-        if (month < 1 || month > 12)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf ("Entrez un mois correct svp (entre 1 et 12).\n");
-                ladmin_log ("Mois incorrect pour la date ('timeset' command)."
-                            RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please give a correct value for the month (from 1 to 12).\n");
-                ladmin_log ("Invalid month for the date ('timeset' command)."
-                            RETCODE);
-            }
-            return 102;
-        }
-        month = month - 1;
-        if (day < 1 || day > 31)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf ("Entrez un jour correct svp (entre 1 et 31).\n");
-                ladmin_log ("Jour incorrect pour la date ('timeset' command)."
-                            RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please give a correct value for the day (from 1 to 31).\n");
-                ladmin_log ("Invalid day for the date ('timeset' command)."
-                            RETCODE);
-            }
-            return 102;
-        }
-        if (((month == 3 || month == 5 || month == 8 || month == 10)
-             && day > 30) || (month == 1 && day > 29))
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf
-                    ("Entrez un jour correct en fonction du mois (%d) svp.\n",
-                     month);
-                ladmin_log
-                    ("Jour incorrect pour ce mois correspondant ('timeset' command)."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please give a correct value for a day of this month (%d).\n",
-                     month);
-                ladmin_log ("Invalid day for this month ('timeset' command)."
-                            RETCODE);
-            }
-            return 102;
-        }
-        if (hour < 0 || hour > 23)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf ("Entrez une heure correcte svp (entre 0 et 23).\n");
-                ladmin_log
-                    ("Heure incorrecte pour l'heure ('timeset' command)."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please give a correct value for the hour (from 0 to 23).\n");
-                ladmin_log ("Invalid hour for the time ('timeset' command)."
-                            RETCODE);
-            }
-            return 102;
-        }
-        if (minute < 0 || minute > 59)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf
-                    ("Entrez des minutes correctes svp (entre 0 et 59).\n");
-                ladmin_log
-                    ("Minute incorrecte pour l'heure ('timeset' command)."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please give a correct value for the minutes (from 0 to 59).\n");
-                ladmin_log ("Invalid minute for the time ('timeset' command)."
-                            RETCODE);
-            }
-            return 102;
-        }
-        if (second < 0 || second > 59)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf
-                    ("Entrez des secondes correctes svp (entre 0 et 59).\n");
-                ladmin_log
-                    ("Seconde incorrecte pour l'heure ('timeset' command)."
-                     RETCODE);
-            }
-            else
-            {
-                printf
-                    ("Please give a correct value for the seconds (from 0 to 59).\n");
-                ladmin_log ("Invalid second for the time ('timeset' command)."
-                            RETCODE);
-            }
-            return 102;
-        }
-        tmtime->tm_year = year;
-        tmtime->tm_mon = month;
-        tmtime->tm_mday = day;
-        tmtime->tm_hour = hour;
-        tmtime->tm_min = minute;
-        tmtime->tm_sec = second;
-        tmtime->tm_isdst = -1;  // -1: no winter/summer time modification
-        connect_until_time = timegm (tmtime);
-        if (connect_until_time == -1)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf ("Date incorrecte.\n");
-                printf
-                    ("Ajoutez 0 ou une date et une heure svp (format: 0 ou aaaa/mm/jj hh:mm:ss).\n");
-                ladmin_log ("Date incorrecte. ('timeset' command)." RETCODE);
-            }
-            else
-            {
-                printf ("Invalid date.\n");
-                printf
-                    ("Please add 0 or a date and a time (format: 0 or yyyy/mm/dd hh:mm:ss).\n");
-                ladmin_log ("Invalid date. ('timeset' command)." RETCODE);
-            }
-            return 102;
-        }
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour fixer une date limite d'utilisation."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Request to login-server to set a time limit." RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x7948;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    WFIFOL (login_fd, 26) = (int) connect_until_time;
-    WFIFOSET (login_fd, 30);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//------------------------------------------------------------------------------
-// Sub-function: Asking to displaying information about an account (by its name)
-//------------------------------------------------------------------------------
-int whoaccount (char *param)
-{
-    char name[1023];
-
-    memset (name, '\0', sizeof (name));
-
-    if (strlen (param) == 0 ||
-        (sscanf (param, "\"%[^\"]\"", name) < 1 &&
-         sscanf (param, "'%[^']'", name) < 1 &&
-         sscanf (param, "%[^\r\n]", name) < 1) || strlen (name) == 0)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("Entrez un nom de compte svp.\n");
-            printf ("<exemple> who nomtest\n");
-            ladmin_log ("Aucun nom n'a t donn pour trouver le compte."
-                        RETCODE);
-        }
-        else
-        {
-            printf ("Please input an account name.\n");
-            printf ("<example> who testname\n");
-            ladmin_log ("No name was given to found the account." RETCODE);
-        }
-        return 136;
-    }
-    if (verify_accountname (name) == 0)
-    {
-        return 102;
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour obtenir le information d'un compte (par le nom)."
-             RETCODE);
-    }
-    else
-    {
-        ladmin_log
-            ("Request to login-server to obtain information about an account (by its name)."
-             RETCODE);
-    }
-
-    WFIFOW (login_fd, 0) = 0x7952;
-    memcpy (WFIFOP (login_fd, 2), name, 24);
-    WFIFOSET (login_fd, 26);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//--------------------------------------------------------
-// Sub-function: Asking of the version of the login-server
-//--------------------------------------------------------
-int checkloginversion ()
-{
-    if (defaultlanguage == 'F')
-        ladmin_log
-            ("Envoi d'un requte au serveur de logins pour obtenir sa version."
-             RETCODE);
-    else
-        ladmin_log ("Request to login-server to obtain its version." RETCODE);
-
-    WFIFOW (login_fd, 0) = 0x7530;
-    WFIFOSET (login_fd, 2);
-    bytes_to_read = 1;
-
-    return 0;
-}
-
-//---------------------------------------------
-// Prompt function
-// this function wait until user type a command
-// and analyse the command.
-//---------------------------------------------
-int prompt ()
-{
-    int  i, j;
-    char buf[1024];
-    char *p;
-
-    // while we don't wait new packets
-    while (bytes_to_read == 0)
-    {
-        // for help with the console colors look here:
-        // http://www.edoceo.com/liberum/?doc=printf-with-color
-        // some code explanation (used here):
-        // \033[2J : clear screen and go up/left (0, 0 position)
-        // \033[K  : clear line from actual position to end of the line
-        // \033[0m : reset color parameter
-        // \033[1m : use bold for font
-        Iprintf ("\n");
-        if (defaultlanguage == 'F')
-        {
-            Iprintf
-                ("\033[32mPour afficher les commandes, tapez 'Entre'.\033[0m\n");
-        }
-        else
-            Iprintf ("\033[32mTo list the commands, type 'enter'.\033[0m\n");
-        Iprintf ("\033[0;36mLadmin-> \033[0m");
-        Iprintf ("\033[1m");
-        fflush (stdout);
-
-        // get command and parameter
-        memset (buf, '\0', sizeof (buf));
-        fflush (stdin);
-        if (!fgets (buf, 1023, stdin))
-            exit (0);
-        buf[1023] = '\0';
-
-        Iprintf ("\033[0m");
-        fflush (stdout);
-
-        if (!eathena_interactive_session && !strlen (buf))
-            exit (0);
-
-        // remove final \n
-        if ((p = strrchr (buf, '\n')) != NULL)
-            p[0] = '\0';
-        // remove all control char
-        for (i = 0; buf[i]; i++)
-            if (buf[i] < 32)
-            {
-                // remove cursor control.
-                if (buf[i] == 27 && buf[i + 1] == '[' && (buf[i + 2] == 'H' ||  // home position (cursor)
-                                                          buf[i + 2] == 'J' ||  // clear screen
-                                                          buf[i + 2] == 'A' ||  // up 1 line
-                                                          buf[i + 2] == 'B' ||  // down 1 line
-                                                          buf[i + 2] == 'C' ||  // right 1 position
-                                                          buf[i + 2] == 'D' ||  // left 1 position
-                                                          buf[i + 2] == 'G'))
-                {               // center cursor (windows)
-                    for (j = i; buf[j]; j++)
-                        buf[j] = buf[j + 3];
-                }
-                else if (buf[i] == 27 && buf[i + 1] == '['
-                         && buf[i + 2] == '2' && buf[i + 3] == 'J')
-                {               // clear screen
-                    for (j = i; buf[j]; j++)
-                        buf[j] = buf[j + 4];
-                }
-                else if (buf[i] == 27 && buf[i + 1] == '[' && buf[i + 3] == '~' && (buf[i + 2] == '1' ||    // home (windows)
-                                                                                    buf[i + 2] == '2' ||    // insert (windows)
-                                                                                    buf[i + 2] == '3' ||    // del (windows)
-                                                                                    buf[i + 2] == '4' ||    // end (windows)
-                                                                                    buf[i + 2] == '5' ||    // pgup (windows)
-                                                                                    buf
-                                                                                    [i
-                                                                                     +
-                                                                                     2]
-                                                                                    ==
-                                                                                    '6'))
-                {               // pgdown (windows)
-                    for (j = i; buf[j]; j++)
-                        buf[j] = buf[j + 4];
-                }
-                else
-                {
-                    // remove other control char.
-                    for (j = i; buf[j]; j++)
-                        buf[j] = buf[j + 1];
-                }
-                i--;
-            }
-
-        // extract command name and parameters
-        memset (command, '\0', sizeof (command));
-        memset (parameters, '\0', sizeof (parameters));
-        sscanf (buf, "%1023s %[^\n]", command, parameters);
-        command[1023] = '\0';
-        parameters[1023] = '\0';
-
-        // lowercase for command line
-        for (i = 0; command[i]; i++)
-            command[i] = tolower (command[i]);
-
-        if (command[0] == '?' || strlen (command) == 0)
-        {
-            if (defaultlanguage == 'F')
-            {
-                strcpy (buf, "aide");
-                strcpy (command, "aide");
-            }
-            else
-            {
-                strcpy (buf, "help");
-                strcpy (command, "help");
-            }
-        }
-
-        // Analyse of the command
-        check_command (command);    // give complete name to the command
-
-        if (strlen (parameters) == 0)
-        {
-            if (defaultlanguage == 'F')
-            {
-                ladmin_log ("Commande: '%s' (sans paramtre)" RETCODE,
-                            command, parameters);
-            }
-            else
-            {
-                ladmin_log ("Command: '%s' (without parameters)" RETCODE,
-                            command, parameters);
-            }
-        }
-        else
-        {
-            if (defaultlanguage == 'F')
-            {
-                ladmin_log ("Commande: '%s', paramtres: '%s'" RETCODE,
-                            command, parameters);
-            }
-            else
-            {
-                ladmin_log ("Command: '%s', parameters: '%s'" RETCODE,
-                            command, parameters);
-            }
-        }
-
-        // Analyse of the command
-// help
-        if (strcmp (command, "aide") == 0)
-        {
-            display_help (parameters, 1);   // 1: french
-        }
-        else if (strcmp (command, "help") == 0)
-        {
-            display_help (parameters, 0);   // 0: english
-// general commands
-        }
-        else if (strcmp (command, "add") == 0)
-        {
-            addaccount (parameters, 0); // 0: no email
-        }
-        else if (strcmp (command, "ban") == 0)
-        {
-            banaccount (parameters);
-        }
-        else if (strcmp (command, "banadd") == 0)
-        {
-            banaddaccount (parameters);
-        }
-        else if (strcmp (command, "banset") == 0)
-        {
-            bansetaccount (parameters);
-        }
-        else if (strcmp (command, "block") == 0)
-        {
-            blockaccount (parameters);
-        }
-        else if (strcmp (command, "check") == 0)
-        {
-            checkaccount (parameters);
-        }
-        else if (strcmp (command, "create") == 0)
-        {
-            addaccount (parameters, 1); // 1: with email
-        }
-        else if (strcmp (command, "delete") == 0)
-        {
-            delaccount (parameters);
-        }
-        else if (strcmp (command, "email") == 0)
-        {
-            changeemail (parameters);
-        }
-        else if (strcmp (command, "getcount") == 0)
-        {
-            getlogincount ();
-        }
-        else if (strcmp (command, "gm") == 0)
-        {
-            changegmlevel (parameters);
-        }
-        else if (strcmp (command, "id") == 0)
-        {
-            idaccount (parameters);
-        }
-        else if (strcmp (command, "info") == 0)
-        {
-            infoaccount (atoi (parameters));
-        }
-        else if (strcmp (command, "kami") == 0)
-        {
-            sendbroadcast (0, parameters);  // flag for normal
-        }
-        else if (strcmp (command, "kamib") == 0)
-        {
-            sendbroadcast (0x10, parameters);   // flag for blue
-        }
-        else if (strcmp (command, "language") == 0)
-        {
-            changelanguage (parameters);
-        }
-        else if (strcmp (command, "itemfrob") == 0)
-        {
-            itemfrob (parameters);  // 0: to list all
-        }
-        else if (strcmp (command, "list") == 0)
-        {
-            listaccount (parameters, 0);    // 0: to list all
-        }
-        else if (strcmp (command, "listban") == 0)
-        {
-            listaccount (parameters, 3);    // 3: to list only accounts with state or bannished
-        }
-        else if (strcmp (command, "listgm") == 0)
-        {
-            listaccount (parameters, 1);    // 1: to list only GM
-        }
-        else if (strcmp (command, "listok") == 0)
-        {
-            listaccount (parameters, 4);    // 4: to list only accounts without state and not bannished
-        }
-        else if (strcmp (command, "memo") == 0)
-        {
-            changememo (parameters);
-        }
-        else if (strcmp (command, "name") == 0)
-        {
-            nameaccount (atoi (parameters));
-        }
-        else if (strcmp (command, "password") == 0)
-        {
-            changepasswd (parameters);
-        }
-        else if (strcmp (command, "reloadgm") == 0)
-        {
-            reloadGM ();
-        }
-        else if (strcmp (command, "search") == 0)
-        {                       // no regex in C version
-            listaccount (parameters, 2);    // 2: to list with pattern
-        }
-        else if (strcmp (command, "sex") == 0)
-        {
-            changesex (parameters);
-        }
-        else if (strcmp (command, "state") == 0)
-        {
-            changestate (parameters);
-        }
-        else if (strcmp (command, "timeadd") == 0)
-        {
-            timeaddaccount (parameters);
-        }
-        else if (strcmp (command, "timeset") == 0)
-        {
-            timesetaccount (parameters);
-        }
-        else if (strcmp (command, "unban") == 0)
-        {
-            unbanaccount (parameters);
-        }
-        else if (strcmp (command, "unblock") == 0)
-        {
-            unblockaccount (parameters);
-        }
-        else if (strcmp (command, "version") == 0)
-        {
-            checkloginversion ();
-        }
-        else if (strcmp (command, "who") == 0)
-        {
-            whoaccount (parameters);
-// quit
-        }
-        else if (strcmp (command, "quit") == 0 ||
-                 strcmp (command, "exit") == 0 ||
-                 strcmp (command, "end") == 0)
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf ("Au revoir.\n");
-            }
-            else
-            {
-                printf ("Bye.\n");
-            }
-            exit (0);
-// unknown command
-        }
-        else
-        {
-            if (defaultlanguage == 'F')
-            {
-                printf ("Commande inconnue [%s].\n", buf);
-                ladmin_log ("Commande inconnue [%s]." RETCODE, buf);
-            }
-            else
-            {
-                printf ("Unknown command [%s].\n", buf);
-                ladmin_log ("Unknown command [%s]." RETCODE, buf);
-            }
-        }
-    }
-
-    return 0;
-}
-
-//-------------------------------------------------------------
-// Function: Parse receiving informations from the login-server
-//-------------------------------------------------------------
-int parse_fromlogin (int fd)
-{
-    struct char_session_data *sd;
-
-    if (session[fd]->eof)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf
-                ("Impossible de se connecter au serveur de login [%s:%d] !\n",
-                 loginserverip, loginserverport);
-            ladmin_log
-                ("Impossible de se connecter au serveur de login [%s:%d] !"
-                 RETCODE, loginserverip, loginserverport);
-        }
-        else
-        {
-            printf
-                ("Impossible to have a connection with the login-server [%s:%d] !\n",
-                 loginserverip, loginserverport);
-            ladmin_log
-                ("Impossible to have a connection with the login-server [%s:%d] !"
-                 RETCODE, loginserverip, loginserverport);
-        }
-        close (fd);
-        delete_session (fd);
-        exit (0);
-    }
-
-//  printf("parse_fromlogin : %d %d %d\n", fd, RFIFOREST(fd), RFIFOW(fd,0));
-    sd = session[fd]->session_data;
-
-    while (RFIFOREST (fd) >= 2)
-    {
-        switch (RFIFOW (fd, 0))
-        {
-            case 0x7919:       // answer of a connection request
-                if (RFIFOREST (fd) < 3)
-                    return 0;
-                if (RFIFOB (fd, 2) != 0)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf ("Erreur de login:\n");
-                        printf (" - mot de passe incorrect,\n");
-                        printf
-                            (" - systme d'administration non activ, ou\n");
-                        printf (" - IP non autorise.\n");
-                        ladmin_log
-                            ("Erreur de login: mot de passe incorrect, systme d'administration non activ, ou IP non autorise."
-                             RETCODE);
-                    }
-                    else
-                    {
-                        printf ("Error at login:\n");
-                        printf (" - incorrect password,\n");
-                        printf
-                            (" - administration system not activated, or\n");
-                        printf (" - unauthorised IP.\n");
-                        ladmin_log
-                            ("Error at login: incorrect password, administration system not activated, or unauthorised IP."
-                             RETCODE);
-                    }
-                    session[fd]->eof = 1;
-                    //bytes_to_read = 1; // not stop at prompt
-                }
-                else
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf ("Connexion tablie.\n");
-                        ladmin_log ("Connexion tablie." RETCODE);
-                        printf
-                            ("Lecture de la version du serveur de login...\n");
-                        ladmin_log
-                            ("Lecture de la version du serveur de login..."
-                             RETCODE);
-                    }
-                    else
-                    {
-                        Iprintf ("Established connection.\n");
-                        ladmin_log ("Established connection." RETCODE);
-                        Iprintf
-                            ("Reading of the version of the login-server...\n");
-                        ladmin_log
-                            ("Reading of the version of the login-server..."
-                             RETCODE);
-                    }
-                    //bytes_to_read = 1; // unchanged
-                    checkloginversion ();
-                }
-                RFIFOSKIP (fd, 3);
-                break;
-
-#ifdef PASSWORDENC
-            case 0x01dc:       // answer of a coding key request
-                if (RFIFOREST (fd) < 4 || RFIFOREST (fd) < RFIFOW (fd, 2))
-                    return 0;
-                {
-                    char md5str[64] =
-                        "", md5bin[32], md5key[RFIFOW (fd, 2) - 4 + 1];
-                    memcpy (md5key, RFIFOP (fd, 4), RFIFOW (fd, 2) - 4);
-                    md5key[sizeof (md5key) - 1] = '0';
-                    if (passenc == 1)
-                    {
-                        strncpy (md5str, RFIFOP (fd, 4), RFIFOW (fd, 2) - 4);
-                        strcat (md5str, loginserveradminpassword);
-                    }
-                    else if (passenc == 2)
-                    {
-                        strncpy (md5str, loginserveradminpassword,
-                                 sizeof (loginserveradminpassword));
-                        strcat (md5str, RFIFOP (fd, 4));
-                    }
-                    MD5_String2binary (md5str, md5bin);
-                    WFIFOW (login_fd, 0) = 0x7918;  // Request for administation login (encrypted password)
-                    WFIFOW (login_fd, 2) = passenc; // Encrypted type
-                    memcpy (WFIFOP (login_fd, 4), md5bin, 16);
-                    WFIFOSET (login_fd, 20);
-                    if (defaultlanguage == 'F')
-                    {
-                        Iprintf ("Rception de la clef MD5.\n");
-                        ladmin_log ("Rception de la clef MD5." RETCODE);
-                        Iprintf ("Envoi du mot de passe crypt...\n");
-                        ladmin_log ("Envoi du mot de passe crypt..."
-                                    RETCODE);
-                    }
-                    else
-                    {
-                        Iprintf ("Receiving of the MD5 key.\n");
-                        ladmin_log ("Receiving of the MD5 key." RETCODE);
-                        Iprintf ("Sending of the encrypted password...\n");
-                        ladmin_log ("Sending of the encrypted password..."
-                                    RETCODE);
-                    }
-                }
-                bytes_to_read = 1;
-                RFIFOSKIP (fd, RFIFOW (fd, 2));
-                break;
-#endif
-
-            case 0x7531:       // Displaying of the version of the login-server
-                if (RFIFOREST (fd) < 10)
-                    return 0;
-                Iprintf ("  Login-Server [%s:%d]\n", loginserverip,
-                         loginserverport);
-                if (((int) RFIFOB (login_fd, 5)) == 0)
-                {
-                    Iprintf ("  eAthena version stable-%d.%d",
-                             (int) RFIFOB (login_fd, 2),
-                             (int) RFIFOB (login_fd, 3));
-                }
-                else
-                {
-                    Iprintf ("  eAthena version dev-%d.%d",
-                             (int) RFIFOB (login_fd, 2),
-                             (int) RFIFOB (login_fd, 3));
-                }
-                if (((int) RFIFOB (login_fd, 4)) == 0)
-                    Iprintf (" revision %d", (int) RFIFOB (login_fd, 4));
-                if (((int) RFIFOB (login_fd, 6)) == 0)
-                {
-                    Iprintf ("%d.\n", RFIFOW (login_fd, 8));
-                }
-                else
-                    Iprintf ("-mod%d.\n", RFIFOW (login_fd, 8));
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 10);
-                break;
-
-            case 0x7925:       // Itemfrob-OK
-                RFIFOSKIP (fd, 2);
-                bytes_to_read = 0;
-                break;
-
-            case 0x7921:       // Displaying of the list of accounts
-                if (RFIFOREST (fd) < 4 || RFIFOREST (fd) < RFIFOW (fd, 2))
-                    return 0;
-                if (RFIFOW (fd, 2) < 5)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        ladmin_log
-                            ("  Rception d'une liste des comptes vide."
-                             RETCODE);
-                        if (list_count == 0)
-                            printf ("Aucun compte trouv.\n");
-                        else if (list_count == 1)
-                            printf ("1 compte trouv.\n");
-                        else
-                            printf ("%d comptes trouvs.\n", list_count);
-                    }
-                    else
-                    {
-                        ladmin_log ("  Receiving of a void accounts list."
-                                    RETCODE);
-                        if (list_count == 0)
-                        {
-                            Iprintf ("No account found.\n");
-                        }
-                        else if (list_count == 1)
-                        {
-                            Iprintf ("1 account found.\n");
-                        }
-                        else
-                            Iprintf ("%d accounts found.\n", list_count);
-                    }
-                    bytes_to_read = 0;
-                }
-                else
-                {
-                    int  i;
-                    if (defaultlanguage == 'F')
-                        ladmin_log ("  Rception d'une liste des comptes."
-                                    RETCODE);
-                    else
-                        ladmin_log ("  Receiving of a accounts list."
-                                    RETCODE);
-                    for (i = 4; i < RFIFOW (fd, 2); i += 38)
-                    {
-                        int  j;
-                        char userid[24];
-                        char lower_userid[24];
-                        memcpy (userid, RFIFOP (fd, i + 5), sizeof (userid));
-                        userid[sizeof (userid) - 1] = '\0';
-                        memset (lower_userid, '\0', sizeof (lower_userid));
-                        for (j = 0; userid[j]; j++)
-                            lower_userid[j] = tolower (userid[j]);
-                        list_first = RFIFOL (fd, i) + 1;
-                        // here are checks...
-                        if (list_type == 0 ||
-                            (list_type == 1 && RFIFOB (fd, i + 4) > 0) ||
-                            (list_type == 2
-                             && strstr (lower_userid, parameters) != NULL)
-                            || (list_type == 3 && RFIFOL (fd, i + 34) != 0)
-                            || (list_type == 4 && RFIFOL (fd, i + 34) == 0))
-                        {
-                            printf ("%10d ", RFIFOL (fd, i));
-                            if (RFIFOB (fd, i + 4) == 0)
-                                printf ("   ");
-                            else
-                                printf ("%2d ", (int) RFIFOB (fd, i + 4));
-                            printf ("%-24s", userid);
-                            if (defaultlanguage == 'F')
-                            {
-                                if (RFIFOB (fd, i + 29) == 0)
-                                    printf ("%-5s ", "Femme");
-                                else if (RFIFOB (fd, i + 29) == 1)
-                                    printf ("%-5s ", "Male");
-                                else
-                                    printf ("%-5s ", "Servr");
-                            }
-                            else
-                            {
-                                if (RFIFOB (fd, i + 29) == 0)
-                                    printf ("%-5s ", "Femal");
-                                else if (RFIFOB (fd, i + 29) == 1)
-                                    printf ("%-5s ", "Male");
-                                else
-                                    printf ("%-5s ", "Servr");
-                            }
-                            printf ("%6d ", RFIFOL (fd, i + 30));
-                            switch (RFIFOL (fd, i + 34))
-                            {
-                                case 0:
-                                    if (defaultlanguage == 'F')
-                                        printf ("%-27s\n", "Compte Ok");
-                                    else
-                                        printf ("%-27s\n", "Account OK");
-                                    break;
-                                case 1:
-                                    printf ("%-27s\n", "Unregistered ID");
-                                    break;
-                                case 2:
-                                    printf ("%-27s\n", "Incorrect Password");
-                                    break;
-                                case 3:
-                                    printf ("%-27s\n", "This ID is expired");
-                                    break;
-                                case 4:
-                                    printf ("%-27s\n",
-                                            "Rejected from Server");
-                                    break;
-                                case 5:
-                                    printf ("%-27s\n", "Blocked by the GM Team");   // You have been blocked by the GM Team
-                                    break;
-                                case 6:
-                                    printf ("%-27s\n", "Your EXE file is too old"); // Your Game's EXE file is not the latest version
-                                    break;
-                                case 7:
-                                    printf ("%-27s\n", "Banishement or");
-                                    printf ("                                                   Prohibited to login until...\n");   // You are Prohibited to log in until %s
-                                    break;
-                                case 8:
-                                    printf ("%-27s\n",
-                                            "Server is over populated");
-                                    break;
-                                case 9:
-                                    printf ("%-27s\n", "No MSG");
-                                    break;
-                                default:   // 100
-                                    printf ("%-27s\n", "This ID is totally erased");    // This ID has been totally erased
-                                    break;
-                            }
-                            list_count++;
-                        }
-                    }
-                    // asking of the following acounts
-                    if (defaultlanguage == 'F')
-                        ladmin_log
-                            ("Envoi d'un requte au serveur de logins pour obtenir la liste des comptes de %d  %d (complment)."
-                             RETCODE, list_first, list_last);
-                    else
-                        ladmin_log
-                            ("Request to login-server to obtain the list of accounts from %d to %d (complement)."
-                             RETCODE, list_first, list_last);
-                    WFIFOW (login_fd, 0) = 0x7920;
-                    WFIFOL (login_fd, 2) = list_first;
-                    WFIFOL (login_fd, 6) = list_last;
-                    WFIFOSET (login_fd, 10);
-                    bytes_to_read = 1;
-                }
-                RFIFOSKIP (fd, RFIFOW (fd, 2));
-                break;
-
-            case 0x7931:       // Answer of login-server about an account creation
-                if (RFIFOREST (fd) < 30)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Echec  la cration du compte [%s]. Un compte identique existe dj.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Echec  la cration du compte [%s]. Un compte identique existe dj."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s] creation failed. Same account already exists.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Account [%s] creation failed. Same account already exists."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf ("Compte [%s] cr avec succs [id: %d].\n",
-                                RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log ("Compte [%s] cr avec succs [id: %d]."
-                                    RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s] is successfully created [id: %d].\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Account [%s] is successfully created [id: %d]."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 30);
-                break;
-
-            case 0x7933:       // Answer of login-server about an account deletion
-                if (RFIFOREST (fd) < 30)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Echec de la suppression du compte [%s]. Le compte n'existe pas.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Echec de la suppression du compte [%s]. Le compte n'existe pas."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s] deletion failed. Account doesn't exist.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Account [%s] deletion failed. Account doesn't exist."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf ("Compte [%s][id: %d] SUPPRIME avec succs.\n",
-                                RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Compte [%s][id: %d] SUPPRIME avec succs."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s][id: %d] is successfully DELETED.\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Account [%s][id: %d] is successfully DELETED."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 30);
-                break;
-
-            case 0x7935:       // answer of the change of an account password
-                if (RFIFOREST (fd) < 30)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Echec de la modification du mot de passe du compte [%s].\n",
-                             RFIFOP (fd, 6));
-                        printf ("Le compte [%s] n'existe pas.\n",
-                                RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Echec de la modification du mot de passe du compte. Le compte [%s] n'existe pas."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf ("Account [%s] password changing failed.\n",
-                                RFIFOP (fd, 6));
-                        printf ("Account [%s] doesn't exist.\n",
-                                RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Account password changing failed. The compte [%s] doesn't exist."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Modification du mot de passe du compte [%s][id: %d] russie.\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Modification du mot de passe du compte [%s][id: %d] russie."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s][id: %d] password successfully changed.\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Account [%s][id: %d] password successfully changed."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 30);
-                break;
-
-            case 0x7937:       // answer of the change of an account state
-                if (RFIFOREST (fd) < 34)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Echec du changement du statut du compte [%s]. Le compte n'existe pas.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Echec du changement du statut du compte [%s]. Le compte n'existe pas."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s] state changing failed. Account doesn't exist.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Account [%s] state changing failed. Account doesn't exist."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    char tmpstr[256];
-                    if (defaultlanguage == 'F')
-                    {
-                        sprintf (tmpstr,
-                                 "Statut du compte [%s] chang avec succs en [",
-                                 RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        sprintf (tmpstr,
-                                 "Account [%s] state successfully changed in [",
-                                 RFIFOP (fd, 6));
-                    }
-                    switch (RFIFOL (fd, 30))
-                    {
-                        case 0:
-                            if (defaultlanguage == 'F')
-                                strcat (tmpstr, "0: Compte Ok");
-                            else
-                                strcat (tmpstr, "0: Account OK");
-                            break;
-                        case 1:
-                            strcat (tmpstr, "1: Unregistered ID");
-                            break;
-                        case 2:
-                            strcat (tmpstr, "2: Incorrect Password");
-                            break;
-                        case 3:
-                            strcat (tmpstr, "3: This ID is expired");
-                            break;
-                        case 4:
-                            strcat (tmpstr, "4: Rejected from Server");
-                            break;
-                        case 5:
-                            strcat (tmpstr,
-                                    "5: You have been blocked by the GM Team");
-                            break;
-                        case 6:
-                            strcat (tmpstr,
-                                    "6: [Your Game's EXE file is not the latest version");
-                            break;
-                        case 7:
-                            strcat (tmpstr,
-                                    "7: You are Prohibited to log in until...");
-                            break;
-                        case 8:
-                            strcat (tmpstr,
-                                    "8: Server is jammed due to over populated");
-                            break;
-                        case 9:
-                            strcat (tmpstr, "9: No MSG");
-                            break;
-                        default:   // 100
-                            strcat (tmpstr, "100: This ID is totally erased");
-                            break;
-                    }
-                    strcat (tmpstr, "]");
-                    printf ("%s\n", tmpstr);
-                    ladmin_log ("%s%s", tmpstr, RETCODE);
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 34);
-                break;
-
-            case 0x7939:       // answer of the number of online players
-                if (RFIFOREST (fd) < 4 || RFIFOREST (fd) < RFIFOW (fd, 2))
-                    return 0;
-                {
-                    // Get length of the received packet
-                    int  i;
-                    char name[20];
-                    if (defaultlanguage == 'F')
-                    {
-                        ladmin_log
-                            ("  Rception du nombre de joueurs en ligne."
-                             RETCODE);
-                    }
-                    else
-                    {
-                        ladmin_log
-                            ("  Receiving of the number of online players."
-                             RETCODE);
-                    }
-                    // Read information of the servers
-                    if (RFIFOW (fd, 2) < 5)
-                    {
-                        if (defaultlanguage == 'F')
-                        {
-                            printf
-                                ("  Aucun serveur n'est connect au login serveur.\n");
-                        }
-                        else
-                        {
-                            printf
-                                ("  No server is connected to the login-server.\n");
-                        }
-                    }
-                    else
-                    {
-                        if (defaultlanguage == 'F')
-                        {
-                            printf
-                                ("  Nombre de joueurs en ligne (serveur: nb):\n");
-                        }
-                        else
-                        {
-                            printf
-                                ("  Number of online players (server: number).\n");
-                        }
-                        // Displaying of result
-                        for (i = 4; i < RFIFOW (fd, 2); i += 32)
-                        {
-                            memcpy (name, RFIFOP (fd, i + 6), sizeof (name));
-                            name[sizeof (name) - 1] = '\0';
-                            printf ("    %-20s : %5d\n", name,
-                                    RFIFOW (fd, i + 26));
-                        }
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, RFIFOW (fd, 2));
-                break;
-
-            case 0x793b:       // answer of the check of a password
-                if (RFIFOREST (fd) < 30)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Le compte [%s] n'existe pas ou le mot de passe est incorrect.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Le compte [%s] n'existe pas ou le mot de passe est incorrect."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf
-                            ("The account [%s] doesn't exist or the password is incorrect.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("The account [%s] doesn't exist or the password is incorrect."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Le mot de passe donn correspond bien au compte [%s][id: %d].\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Le mot de passe donn correspond bien au compte [%s][id: %d]."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                    else
-                    {
-                        printf
-                            ("The proposed password is correct for the account [%s][id: %d].\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("The proposed password is correct for the account [%s][id: %d]."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 30);
-                break;
-
-            case 0x793d:       // answer of the change of an account sex
-                if (RFIFOREST (fd) < 30)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Echec de la modification du sexe du compte [%s].\n",
-                             RFIFOP (fd, 6));
-                        printf
-                            ("Le compte [%s] n'existe pas ou le sexe est dj celui demand.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Echec de la modification du sexe du compte. Le compte [%s] n'existe pas ou le sexe est dj celui demand."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf ("Account [%s] sex changing failed.\n",
-                                RFIFOP (fd, 6));
-                        printf
-                            ("Account [%s] doesn't exist or the sex is already the good sex.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Account sex changing failed. The compte [%s] doesn't exist or the sex is already the good sex."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Sexe du compte [%s][id: %d] chang avec succs.\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Sexe du compte [%s][id: %d] chang avec succs."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s][id: %d] sex successfully changed.\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Account [%s][id: %d] sex successfully changed."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 30);
-                break;
-
-            case 0x793f:       // answer of the change of an account GM level
-                if (RFIFOREST (fd) < 30)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Echec de la modification du niveau de GM du compte [%s].\n",
-                             RFIFOP (fd, 6));
-                        printf
-                            ("Le compte [%s] n'existe pas, le niveau de GM est dj celui demand\n",
-                             RFIFOP (fd, 6));
-                        printf
-                            ("ou il est impossible de modifier le fichier des comptes GM.\n");
-                        ladmin_log
-                            ("Echec de la modification du niveau de GM du compte. Le compte [%s] n'existe pas, le niveau de GM est dj celui demand ou il est impossible de modifier le fichier des comptes GM."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf ("Account [%s] GM level changing failed.\n",
-                                RFIFOP (fd, 6));
-                        printf
-                            ("Account [%s] doesn't exist, the GM level is already the good GM level\n",
-                             RFIFOP (fd, 6));
-                        printf
-                            ("or it's impossible to modify the GM accounts file.\n");
-                        ladmin_log
-                            ("Account GM level changing failed. The compte [%s] doesn't exist, the GM level is already the good sex or it's impossible to modify the GM accounts file."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Niveau de GM du compte [%s][id: %d] chang avec succs.\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Niveau de GM du compte [%s][id: %d] chang avec succs."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s][id: %d] GM level successfully changed.\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Account [%s][id: %d] GM level successfully changed."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 30);
-                break;
-
-            case 0x7941:       // answer of the change of an account email
-                if (RFIFOREST (fd) < 30)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Echec de la modification de l'e-mail du compte [%s].\n",
-                             RFIFOP (fd, 6));
-                        printf ("Le compte [%s] n'existe pas.\n",
-                                RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Echec de la modification de l'e-mail du compte. Le compte [%s] n'existe pas."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf ("Account [%s] e-mail changing failed.\n",
-                                RFIFOP (fd, 6));
-                        printf ("Account [%s] doesn't exist.\n",
-                                RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Account e-mail changing failed. The compte [%s] doesn't exist."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Modification de l'e-mail du compte [%s][id: %d] russie.\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Modification de l'e-mail du compte [%s][id: %d] russie."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s][id: %d] e-mail successfully changed.\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Account [%s][id: %d] e-mail successfully changed."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 30);
-                break;
-
-            case 0x7943:       // answer of the change of an account memo
-                if (RFIFOREST (fd) < 30)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Echec du changement du mmo du compte [%s]. Le compte n'existe pas.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Echec du changement du mmo du compte [%s]. Le compte n'existe pas."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s] memo changing failed. Account doesn't exist.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Account [%s] memo changing failed. Account doesn't exist."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Mmo du compte [%s][id: %d] chang avec succs.\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Mmo du compte [%s][id: %d] chang avec succs."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s][id: %d] memo successfully changed.\n",
-                             RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Account [%s][id: %d] memo successfully changed."
-                             RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 30);
-                break;
-
-            case 0x7945:       // answer of an account id search
-                if (RFIFOREST (fd) < 30)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Impossible de trouver l'id du compte [%s]. Le compte n'existe pas.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Impossible de trouver l'id du compte [%s]. Le compte n'existe pas."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf
-                            ("Unable to find the account [%s] id. Account doesn't exist.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Unable to find the account [%s] id. Account doesn't exist."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf ("Le compte [%s] a pour id: %d.\n",
-                                RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log ("Le compte [%s] a pour id: %d." RETCODE,
-                                    RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                    else
-                    {
-                        printf ("The account [%s] have the id: %d.\n",
-                                RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        ladmin_log ("The account [%s] have the id: %d."
-                                    RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 30);
-                break;
-
-            case 0x7947:       // answer of an account name search
-                if (RFIFOREST (fd) < 30)
-                    return 0;
-                if (strcmp (RFIFOP (fd, 6), "") == 0)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Impossible de trouver le nom du compte [%d]. Le compte n'existe pas.\n",
-                             RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Impossible de trouver le nom du compte [%d]. Le compte n'existe pas."
-                             RETCODE, RFIFOL (fd, 2));
-                    }
-                    else
-                    {
-                        printf
-                            ("Unable to find the account [%d] name. Account doesn't exist.\n",
-                             RFIFOL (fd, 2));
-                        ladmin_log
-                            ("Unable to find the account [%d] name. Account doesn't exist."
-                             RETCODE, RFIFOL (fd, 2));
-                    }
-                }
-                else
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf ("Le compte [id: %d] a pour nom: %s.\n",
-                                RFIFOL (fd, 2), RFIFOP (fd, 6));
-                        ladmin_log ("Le compte [id: %d] a pour nom: %s."
-                                    RETCODE, RFIFOL (fd, 2), RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf ("The account [id: %d] have the name: %s.\n",
-                                RFIFOL (fd, 2), RFIFOP (fd, 6));
-                        ladmin_log ("The account [id: %d] have the name: %s."
-                                    RETCODE, RFIFOL (fd, 2), RFIFOP (fd, 6));
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 30);
-                break;
-
-            case 0x7949:       // answer of an account validity limit set
-                if (RFIFOREST (fd) < 34)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Echec du changement de la validit du compte [%s]. Le compte n'existe pas.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Echec du changement de la validit du compte [%s]. Le compte n'existe pas."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s] validity limit changing failed. Account doesn't exist.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Account [%s] validity limit changing failed. Account doesn't exist."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    time_t timestamp = RFIFOL (fd, 30);
-                    if (timestamp == 0)
-                    {
-                        if (defaultlanguage == 'F')
-                        {
-                            printf
-                                ("Limite de validit du compte [%s][id: %d] change avec succs en [illimit].\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2));
-                            ladmin_log
-                                ("Limite de validit du compte [%s][id: %d] change avec succs en [illimit]."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        }
-                        else
-                        {
-                            printf
-                                ("Validity Limit of the account [%s][id: %d] successfully changed to [unlimited].\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2));
-                            ladmin_log
-                                ("Validity Limit of the account [%s][id: %d] successfully changed to [unlimited]."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        }
-                    }
-                    else
-                    {
-                        char tmpstr[128];
-                        strftime (tmpstr, 24, date_format,
-                                  localtime (&timestamp));
-                        if (defaultlanguage == 'F')
-                        {
-                            printf
-                                ("Limite de validit du compte [%s][id: %d] change avec succs pour tre jusqu'au %s.\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2), tmpstr);
-                            ladmin_log
-                                ("Limite de validit du compte [%s][id: %d] change avec succs pour tre jusqu'au %s."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2),
-                                 tmpstr);
-                        }
-                        else
-                        {
-                            printf
-                                ("Validity Limit of the account [%s][id: %d] successfully changed to be until %s.\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2), tmpstr);
-                            ladmin_log
-                                ("Validity Limit of the account [%s][id: %d] successfully changed to be until %s."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2),
-                                 tmpstr);
-                        }
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 34);
-                break;
-
-            case 0x794b:       // answer of an account ban set
-                if (RFIFOREST (fd) < 34)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Echec du changement de la date finale de banissement du compte [%s]. Le compte n'existe pas.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Echec du changement de la date finale de banissement du compte [%s]. Le compte n'existe pas."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s] final date of banishment changing failed. Account doesn't exist.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Account [%s] final date of banishment changing failed. Account doesn't exist."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    time_t timestamp = RFIFOL (fd, 30);
-                    if (timestamp == 0)
-                    {
-                        if (defaultlanguage == 'F')
-                        {
-                            printf
-                                ("Date finale de banissement du compte [%s][id: %d] change avec succs en [d-bannie].\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2));
-                            ladmin_log
-                                ("Date finale de banissement du compte [%s][id: %d] change avec succs en [d-bannie]."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        }
-                        else
-                        {
-                            printf
-                                ("Final date of banishment of the account [%s][id: %d] successfully changed to [unbanished].\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2));
-                            ladmin_log
-                                ("Final date of banishment of the account [%s][id: %d] successfully changed to [unbanished]."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        }
-                    }
-                    else
-                    {
-                        char tmpstr[128];
-                        strftime (tmpstr, 24, date_format,
-                                  localtime (&timestamp));
-                        if (defaultlanguage == 'F')
-                        {
-                            printf
-                                ("Date finale de banissement du compte [%s][id: %d] change avec succs pour tre jusqu'au %s.\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2), tmpstr);
-                            ladmin_log
-                                ("Date finale de banissement du compte [%s][id: %d] change avec succs pour tre jusqu'au %s."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2),
-                                 tmpstr);
-                        }
-                        else
-                        {
-                            printf
-                                ("Final date of banishment of the account [%s][id: %d] successfully changed to be until %s.\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2), tmpstr);
-                            ladmin_log
-                                ("Final date of banishment of the account [%s][id: %d] successfully changed to be until %s."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2),
-                                 tmpstr);
-                        }
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 34);
-                break;
-
-            case 0x794d:       // answer of an account ban date/time changing
-                if (RFIFOREST (fd) < 34)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Echec du changement de la date finale de banissement du compte [%s]. Le compte n'existe pas.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Echec du changement de la date finale de banissement du compte [%s]. Le compte n'existe pas."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s] final date of banishment changing failed. Account doesn't exist.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Account [%s] final date of banishment changing failed. Account doesn't exist."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    time_t timestamp = RFIFOL (fd, 30);
-                    if (timestamp == 0)
-                    {
-                        if (defaultlanguage == 'F')
-                        {
-                            printf
-                                ("Date finale de banissement du compte [%s][id: %d] change avec succs en [d-bannie].\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2));
-                            ladmin_log
-                                ("Date finale de banissement du compte [%s][id: %d] change avec succs en [d-bannie]."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        }
-                        else
-                        {
-                            printf
-                                ("Final date of banishment of the account [%s][id: %d] successfully changed to [unbanished].\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2));
-                            ladmin_log
-                                ("Final date of banishment of the account [%s][id: %d] successfully changed to [unbanished]."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        }
-                    }
-                    else
-                    {
-                        char tmpstr[128];
-                        strftime (tmpstr, 24, date_format,
-                                  localtime (&timestamp));
-                        if (defaultlanguage == 'F')
-                        {
-                            printf
-                                ("Date finale de banissement du compte [%s][id: %d] change avec succs pour tre jusqu'au %s.\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2), tmpstr);
-                            ladmin_log
-                                ("Date finale de banissement du compte [%s][id: %d] change avec succs pour tre jusqu'au %s."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2),
-                                 tmpstr);
-                        }
-                        else
-                        {
-                            printf
-                                ("Final date of banishment of the account [%s][id: %d] successfully changed to be until %s.\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2), tmpstr);
-                            ladmin_log
-                                ("Final date of banishment of the account [%s][id: %d] successfully changed to be until %s."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2),
-                                 tmpstr);
-                        }
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 34);
-                break;
-
-            case 0x794f:       // answer of a broadcast
-                if (RFIFOREST (fd) < 4)
-                    return 0;
-                if (RFIFOW (fd, 2) == (unsigned short) -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Echec de l'envoi du message. Aucun server de char en ligne.\n");
-                        ladmin_log
-                            ("Echec de l'envoi du message. Aucun server de char en ligne."
-                             RETCODE);
-                    }
-                    else
-                    {
-                        printf
-                            ("Message sending failed. No online char-server.\n");
-                        ladmin_log
-                            ("Message sending failed. No online char-server."
-                             RETCODE);
-                    }
-                }
-                else
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Message transmis au server de logins avec succs.\n");
-                        ladmin_log
-                            ("Message transmis au server de logins avec succs."
-                             RETCODE);
-                    }
-                    else
-                    {
-                        printf
-                            ("Message successfully sended to login-server.\n");
-                        ladmin_log
-                            ("Message successfully sended to login-server."
-                             RETCODE);
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 4);
-                break;
-
-            case 0x7951:       // answer of an account validity limit changing
-                if (RFIFOREST (fd) < 34)
-                    return 0;
-                if (RFIFOL (fd, 2) == -1)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        printf
-                            ("Echec du changement de la validit du compte [%s]. Le compte n'existe pas.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Echec du changement de la validit du compte [%s]. Le compte n'existe pas."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                    else
-                    {
-                        printf
-                            ("Account [%s] validity limit changing failed. Account doesn't exist.\n",
-                             RFIFOP (fd, 6));
-                        ladmin_log
-                            ("Account [%s] validity limit changing failed. Account doesn't exist."
-                             RETCODE, RFIFOP (fd, 6));
-                    }
-                }
-                else
-                {
-                    time_t timestamp = RFIFOL (fd, 30);
-                    if (timestamp == 0)
-                    {
-                        if (defaultlanguage == 'F')
-                        {
-                            printf
-                                ("Limite de validit du compte [%s][id: %d] inchange.\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2));
-                            printf
-                                ("Le compte a une validit illimite ou\n");
-                            printf
-                                ("la modification est impossible avec les ajustements demands.\n");
-                            ladmin_log
-                                ("Limite de validit du compte [%s][id: %d] inchange. Le compte a une validit illimite ou la modification est impossible avec les ajustements demands."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        }
-                        else
-                        {
-                            printf
-                                ("Validity limit of the account [%s][id: %d] unchanged.\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2));
-                            printf
-                                ("The account have an unlimited validity limit or\n");
-                            printf
-                                ("the changing is impossible with the proposed adjustments.\n");
-                            ladmin_log
-                                ("Validity limit of the account [%s][id: %d] unchanged. The account have an unlimited validity limit or the changing is impossible with the proposed adjustments."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2));
-                        }
-                    }
-                    else
-                    {
-                        char tmpstr[128];
-                        strftime (tmpstr, 24, date_format,
-                                  localtime (&timestamp));
-                        if (defaultlanguage == 'F')
-                        {
-                            printf
-                                ("Limite de validit du compte [%s][id: %d] change avec succs pour tre jusqu'au %s.\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2), tmpstr);
-                            ladmin_log
-                                ("Limite de validit du compte [%s][id: %d] change avec succs pour tre jusqu'au %s."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2),
-                                 tmpstr);
-                        }
-                        else
-                        {
-                            printf
-                                ("Validity limit of the account [%s][id: %d] successfully changed to be until %s.\n",
-                                 RFIFOP (fd, 6), RFIFOL (fd, 2), tmpstr);
-                            ladmin_log
-                                ("Validity limit of the account [%s][id: %d] successfully changed to be until %s."
-                                 RETCODE, RFIFOP (fd, 6), RFIFOL (fd, 2),
-                                 tmpstr);
-                        }
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 34);
-                break;
-
-            case 0x7953:       // answer of a request about informations of an account (by account name/id)
-                if (RFIFOREST (fd) < 150
-                    || RFIFOREST (fd) < (150 + RFIFOW (fd, 148)))
-                    return 0;
-                {
-                    char userid[24], error_message[20], lastlogin[24],
-                        last_ip[16], email[40], memo[255];
-                    time_t ban_until_time;  // # of seconds 1/1/1970 (timestamp): ban time limit of the account (0 = no ban)
-                    time_t connect_until_time;  // # of seconds 1/1/1970 (timestamp): Validity limit of the account (0 = unlimited)
-                    memcpy (userid, RFIFOP (fd, 7), sizeof (userid));
-                    userid[sizeof (userid) - 1] = '\0';
-                    memcpy (error_message, RFIFOP (fd, 40),
-                            sizeof (error_message));
-                    error_message[sizeof (error_message) - 1] = '\0';
-                    memcpy (lastlogin, RFIFOP (fd, 60), sizeof (lastlogin));
-                    lastlogin[sizeof (lastlogin) - 1] = '\0';
-                    memcpy (last_ip, RFIFOP (fd, 84), sizeof (last_ip));
-                    last_ip[sizeof (last_ip) - 1] = '\0';
-                    memcpy (email, RFIFOP (fd, 100), sizeof (email));
-                    email[sizeof (email) - 1] = '\0';
-                    connect_until_time = (time_t) RFIFOL (fd, 140);
-                    ban_until_time = (time_t) RFIFOL (fd, 144);
-                    memset (memo, '\0', sizeof (memo));
-                    strncpy (memo, RFIFOP (fd, 150), RFIFOW (fd, 148));
-                    if (RFIFOL (fd, 2) == -1)
-                    {
-                        if (defaultlanguage == 'F')
-                        {
-                            printf
-                                ("Impossible de trouver le compte [%s]. Le compte n'existe pas.\n",
-                                 parameters);
-                            ladmin_log
-                                ("Impossible de trouver le compte [%s]. Le compte n'existe pas."
-                                 RETCODE, parameters);
-                        }
-                        else
-                        {
-                            printf
-                                ("Unabled to find the account [%s]. Account doesn't exist.\n",
-                                 parameters);
-                            ladmin_log
-                                ("Unabled to find the account [%s]. Account doesn't exist."
-                                 RETCODE, parameters);
-                        }
-                    }
-                    else if (strlen (userid) == 0)
-                    {
-                        if (defaultlanguage == 'F')
-                        {
-                            printf
-                                ("Impossible de trouver le compte [id: %s]. Le compte n'existe pas.\n",
-                                 parameters);
-                            ladmin_log
-                                ("Impossible de trouver le compte [id: %s]. Le compte n'existe pas."
-                                 RETCODE, parameters);
-                        }
-                        else
-                        {
-                            printf
-                                ("Unabled to find the account [id: %s]. Account doesn't exist.\n",
-                                 parameters);
-                            ladmin_log
-                                ("Unabled to find the account [id: %s]. Account doesn't exist."
-                                 RETCODE, parameters);
-                        }
-                    }
-                    else
-                    {
-                        if (defaultlanguage == 'F')
-                        {
-                            ladmin_log
-                                ("Rception d'information concernant un compte."
-                                 RETCODE);
-                            printf
-                                ("Le compte a les caractristiques suivantes:\n");
-                        }
-                        else
-                        {
-                            ladmin_log
-                                ("Receiving information about an account."
-                                 RETCODE);
-                            printf ("The account is set with:\n");
-                        }
-                        if (RFIFOB (fd, 6) == 0)
-                        {
-                            printf (" Id:     %d (non-GM)\n", RFIFOL (fd, 2));
-                        }
-                        else
-                        {
-                            if (defaultlanguage == 'F')
-                            {
-                                printf (" Id:     %d (GM niveau %d)\n",
-                                        RFIFOL (fd, 2), (int) RFIFOB (fd, 6));
-                            }
-                            else
-                            {
-                                printf (" Id:     %d (GM level %d)\n",
-                                        RFIFOL (fd, 2), (int) RFIFOB (fd, 6));
-                            }
-                        }
-                        if (defaultlanguage == 'F')
-                        {
-                            printf (" Nom:    '%s'\n", userid);
-                            if (RFIFOB (fd, 31) == 0)
-                                printf (" Sexe:   Femme\n");
-                            else if (RFIFOB (fd, 31) == 1)
-                                printf (" Sexe:   Male\n");
-                            else
-                                printf (" Sexe:   Serveur\n");
-                        }
-                        else
-                        {
-                            printf (" Name:   '%s'\n", userid);
-                            if (RFIFOB (fd, 31) == 0)
-                                printf (" Sex:    Female\n");
-                            else if (RFIFOB (fd, 31) == 1)
-                                printf (" Sex:    Male\n");
-                            else
-                                printf (" Sex:    Server\n");
-                        }
-                        printf (" E-mail: %s\n", email);
-                        switch (RFIFOL (fd, 36))
-                        {
-                            case 0:
-                                if (defaultlanguage == 'F')
-                                    printf (" Statut: 0 [Compte Ok]\n");
-                                else
-                                    printf (" Statut: 0 [Account OK]\n");
-                                break;
-                            case 1:
-                                printf (" Statut: 1 [Unregistered ID]\n");
-                                break;
-                            case 2:
-                                printf (" Statut: 2 [Incorrect Password]\n");
-                                break;
-                            case 3:
-                                printf (" Statut: 3 [This ID is expired]\n");
-                                break;
-                            case 4:
-                                printf
-                                    (" Statut: 4 [Rejected from Server]\n");
-                                break;
-                            case 5:
-                                printf
-                                    (" Statut: 5 [You have been blocked by the GM Team]\n");
-                                break;
-                            case 6:
-                                printf
-                                    (" Statut: 6 [Your Game's EXE file is not the latest version]\n");
-                                break;
-                            case 7:
-                                printf
-                                    (" Statut: 7 [You are Prohibited to log in until %s]\n",
-                                     error_message);
-                                break;
-                            case 8:
-                                printf
-                                    (" Statut: 8 [Server is jammed due to over populated]\n");
-                                break;
-                            case 9:
-                                printf (" Statut: 9 [No MSG]\n");
-                                break;
-                            default:   // 100
-                                printf
-                                    (" Statut: %d [This ID is totally erased]\n",
-                                     RFIFOL (fd, 36));
-                                break;
-                        }
-                        if (defaultlanguage == 'F')
-                        {
-                            if (ban_until_time == 0)
-                            {
-                                printf (" Banissement: non banni.\n");
-                            }
-                            else
-                            {
-                                char tmpstr[128];
-                                strftime (tmpstr, 24, date_format,
-                                          localtime (&ban_until_time));
-                                printf (" Banissement: jusqu'au %s.\n",
-                                        tmpstr);
-                            }
-                            if (RFIFOL (fd, 32) > 1)
-                                printf (" Compteur: %d connexions.\n",
-                                        RFIFOL (fd, 32));
-                            else
-                                printf (" Compteur: %d connexion.\n",
-                                        RFIFOL (fd, 32));
-                            printf (" Dernire connexion le: %s (ip: %s)\n",
-                                    lastlogin, last_ip);
-                            if (connect_until_time == 0)
-                            {
-                                printf (" Limite de validit: illimit.\n");
-                            }
-                            else
-                            {
-                                char tmpstr[128];
-                                strftime (tmpstr, 24, date_format,
-                                          localtime (&connect_until_time));
-                                printf (" Limite de validit: jusqu'au %s.\n",
-                                        tmpstr);
-                            }
-                        }
-                        else
-                        {
-                            if (ban_until_time == 0)
-                            {
-                                printf (" Banishment: not banished.\n");
-                            }
-                            else
-                            {
-                                char tmpstr[128];
-                                strftime (tmpstr, 24, date_format,
-                                          localtime (&ban_until_time));
-                                printf (" Banishment: until %s.\n", tmpstr);
-                            }
-                            if (RFIFOL (fd, 32) > 1)
-                                printf (" Count:  %d connections.\n",
-                                        RFIFOL (fd, 32));
-                            else
-                                printf (" Count:  %d connection.\n",
-                                        RFIFOL (fd, 32));
-                            printf (" Last connection at: %s (ip: %s)\n",
-                                    lastlogin, last_ip);
-                            if (connect_until_time == 0)
-                            {
-                                printf (" Validity limit: unlimited.\n");
-                            }
-                            else
-                            {
-                                char tmpstr[128];
-                                strftime (tmpstr, 24, date_format,
-                                          localtime (&connect_until_time));
-                                printf (" Validity limit: until %s.\n",
-                                        tmpstr);
-                            }
-                        }
-                        printf (" Memo:   '%s'\n", memo);
-                    }
-                }
-                bytes_to_read = 0;
-                RFIFOSKIP (fd, 150 + RFIFOW (fd, 148));
-                break;
-
-            default:
-                printf
-                    ("Remote administration has been disconnected (unknown packet).\n");
-                ladmin_log ("'End of connection, unknown packet." RETCODE);
-                session[fd]->eof = 1;
-                return 0;
-        }
-    }
-
-    // if we don't wait new packets, do the prompt
-    prompt ();
-
-    return 0;
-}
-
-//------------------------------------
-// Function to connect to login-server
-//------------------------------------
-int Connect_login_server ()
-{
-    if (defaultlanguage == 'F')
-    {
-        Iprintf ("Essai de connection au server de logins...\n");
-        ladmin_log ("Essai de connection au server de logins..." RETCODE);
-    }
-    else
-    {
-        Iprintf ("Attempt to connect to login-server...\n");
-        ladmin_log ("Attempt to connect to login-server..." RETCODE);
-    }
-
-    if ((login_fd = make_connection (login_ip, loginserverport)) < 0)
-        return 0;
-
-#ifdef PASSWORDENC
-    if (passenc == 0)
-    {
-#endif
-        WFIFOW (login_fd, 0) = 0x7918;  // Request for administation login
-        WFIFOW (login_fd, 2) = 0;   // no encrypted
-        memcpy (WFIFOP (login_fd, 4), loginserveradminpassword, 24);
-        WFIFOSET (login_fd, 28);
-        bytes_to_read = 1;
-
-        if (defaultlanguage == 'F')
-        {
-            Iprintf ("Envoi du mot de passe...\n");
-            ladmin_log ("Envoi du mot de passe..." RETCODE);
-        }
-        else
-        {
-            Iprintf ("Sending of the password...\n");
-            ladmin_log ("Sending of the password..." RETCODE);
-        }
-#ifdef PASSWORDENC
-    }
-    else
-    {
-        WFIFOW (login_fd, 0) = 0x791a;  // Sending request about the coding key
-        WFIFOSET (login_fd, 2);
-        bytes_to_read = 1;
-        if (defaultlanguage == 'F')
-        {
-            Iprintf ("Demande de la clef MD5...\n");
-            ladmin_log ("Demande de la clef MD5..." RETCODE);
-        }
-        else
-        {
-            Iprintf ("Request about the MD5 key...\n");
-            ladmin_log ("Request about the MD5 key..." RETCODE);
-        }
-    }
-#endif
-
-    return 0;
-}
-
-//-------------------------------------------------
-// Return numerical value of a switch configuration
-// on/off, english, franais, deutsch, espaol
-//-------------------------------------------------
-int config_switch (const char *str)
-{
-    if (strcmpi (str, "on") == 0 || strcmpi (str, "yes") == 0
-        || strcmpi (str, "oui") == 0 || strcmpi (str, "ja") == 0
-        || strcmpi (str, "si") == 0)
-        return 1;
-    if (strcmpi (str, "off") == 0 || strcmpi (str, "no") == 0
-        || strcmpi (str, "non") == 0 || strcmpi (str, "nein") == 0)
-        return 0;
-
-    return atoi (str);
-}
-
-//-----------------------------------
-// Reading general configuration file
-//-----------------------------------
-int ladmin_config_read (const char *cfgName)
-{
-    char line[1024], w1[1024], w2[1024];
-    FILE *fp;
-
-    fp = fopen_ (cfgName, "r");
-    if (fp == NULL)
-    {
-        if (defaultlanguage == 'F')
-        {
-            printf ("\033[0mFichier de configuration (%s) non trouv.\n",
-                    cfgName);
-        }
-        else
-        {
-            printf ("\033[0mConfiguration file (%s) not found.\n", cfgName);
-        }
-        return 1;
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        Iprintf
-            ("\033[0m---Dbut de lecture du fichier de configuration Ladmin (%s)\n",
-             cfgName);
-    }
-    else
-    {
-        Iprintf
-            ("\033[0m---Start reading of Ladmin configuration file (%s)\n",
-             cfgName);
-    }
-    while (fgets (line, sizeof (line) - 1, fp))
-    {
-        if (line[0] == '/' && line[1] == '/')
-            continue;
-
-        line[sizeof (line) - 1] = '\0';
-        if (sscanf (line, "%[^:]: %[^\r\n]", w1, w2) == 2)
-        {
-            remove_control_chars (w1);
-            remove_control_chars (w2);
-
-            if (strcmpi (w1, "login_ip") == 0)
-            {
-                struct hostent *h = gethostbyname (w2);
-                if (h != NULL)
-                {
-                    if (defaultlanguage == 'F')
-                    {
-                        Iprintf
-                            ("Adresse du serveur de logins: %s -> %d.%d.%d.%d\n",
-                             w2, (unsigned char) h->h_addr[0],
-                             (unsigned char) h->h_addr[1],
-                             (unsigned char) h->h_addr[2],
-                             (unsigned char) h->h_addr[3]);
-                    }
-                    else
-                    {
-                        Iprintf
-                            ("Login server IP address: %s -> %d.%d.%d.%d\n",
-                             w2, (unsigned char) h->h_addr[0],
-                             (unsigned char) h->h_addr[1],
-                             (unsigned char) h->h_addr[2],
-                             (unsigned char) h->h_addr[3]);
-                    }
-                    sprintf (loginserverip, "%d.%d.%d.%d",
-                             (unsigned char) h->h_addr[0],
-                             (unsigned char) h->h_addr[1],
-                             (unsigned char) h->h_addr[2],
-                             (unsigned char) h->h_addr[3]);
-                }
-                else
-                    memcpy (loginserverip, w2, 16);
-            }
-            else if (strcmpi (w1, "login_port") == 0)
-            {
-                loginserverport = atoi (w2);
-            }
-            else if (strcmpi (w1, "admin_pass") == 0)
-            {
-                strncpy (loginserveradminpassword, w2,
-                         sizeof (loginserveradminpassword));
-                loginserveradminpassword[sizeof (loginserveradminpassword) -
-                                         1] = '\0';
-#ifdef PASSWORDENC
-            }
-            else if (strcmpi (w1, "passenc") == 0)
-            {
-                passenc = atoi (w2);
-                if (passenc < 0 || passenc > 2)
-                    passenc = 0;
-#endif
-            }
-            else if (strcmpi (w1, "defaultlanguage") == 0)
-            {
-                if (w2[0] == 'F' || w2[0] == 'E')
-                    defaultlanguage = w2[0];
-            }
-            else if (strcmpi (w1, "ladmin_log_filename") == 0)
-            {
-                strncpy (ladmin_log_filename, w2,
-                         sizeof (ladmin_log_filename));
-                ladmin_log_filename[sizeof (ladmin_log_filename) - 1] = '\0';
-            }
-            else if (strcmpi (w1, "date_format") == 0)
-            {                   // note: never have more than 19 char for the date!
-                switch (atoi (w2))
-                {
-                    case 0:
-                        strcpy (date_format, "%d-%m-%Y %H:%M:%S");  // 31-12-2004 23:59:59
-                        break;
-                    case 1:
-                        strcpy (date_format, "%m-%d-%Y %H:%M:%S");  // 12-31-2004 23:59:59
-                        break;
-                    case 2:
-                        strcpy (date_format, "%Y-%d-%m %H:%M:%S");  // 2004-31-12 23:59:59
-                        break;
-                    case 3:
-                        strcpy (date_format, "%Y-%m-%d %H:%M:%S");  // 2004-12-31 23:59:59
-                        break;
-                }
-            }
-            else if (strcmpi (w1, "import") == 0)
-            {
-                ladmin_config_read (w2);
-            }
-        }
-    }
-    fclose_ (fp);
-
-    login_ip = inet_addr (loginserverip);
-
-    if (defaultlanguage == 'F')
-    {
-        Iprintf ("---Lecture du fichier de configuration Ladmin termine.\n");
-    }
-    else
-    {
-        Iprintf ("---End reading of Ladmin configuration file.\n");
-    }
-
-    return 0;
-}
-
-//--------------------------------------
-// Function called at exit of the server
-//--------------------------------------
-void do_final (void)
-{
-
-    if (already_exit_function == 0)
-    {
-        delete_session (login_fd);
-
-        if (defaultlanguage == 'F')
-        {
-            Iprintf
-                ("\033[0m----Fin de Ladmin (fin normale avec fermeture de tous les fichiers).\n");
-            ladmin_log
-                ("----Fin de Ladmin (fin normale avec fermeture de tous les fichiers)."
-                 RETCODE);
-        }
-        else
-        {
-            Iprintf
-                ("\033[0m----End of Ladmin (normal end with closing of all files).\n");
-            ladmin_log
-                ("----End of Ladmin (normal end with closing of all files)."
-                 RETCODE);
-        }
-
-        already_exit_function = 1;
-    }
-}
-
-//------------------------
-// Main function of ladmin
-//------------------------
-int do_init (int argc, char **argv)
-{
-    // read ladmin configuration
-    ladmin_config_read ((argc > 1) ? argv[1] : LADMIN_CONF_NAME);
-
-    ladmin_log ("");
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log ("Fichier de configuration lu." RETCODE);
-    }
-    else
-    {
-        ladmin_log ("Configuration file readed." RETCODE);
-    }
-
-    srand (time (NULL));
-
-    set_termfunc (do_final);
-    set_defaultparse (parse_fromlogin);
-
-    if (defaultlanguage == 'F')
-    {
-        Iprintf ("Outil d'administration  distance de eAthena.\n");
-        Iprintf ("(pour eAthena version %d.%d.%d.)\n", ATHENA_MAJOR_VERSION,
-                 ATHENA_MINOR_VERSION, ATHENA_REVISION);
-    }
-    else
-    {
-        Iprintf ("EAthena login-server administration tool.\n");
-        Iprintf ("(for eAthena version %d.%d.%d.)\n", ATHENA_MAJOR_VERSION,
-                 ATHENA_MINOR_VERSION, ATHENA_REVISION);
-    }
-
-    if (defaultlanguage == 'F')
-    {
-        ladmin_log ("Ladmin est prt." RETCODE);
-        Iprintf ("Ladmin est \033[1;32mprt\033[0m.\n\n");
-    }
-    else
-    {
-        ladmin_log ("Ladmin is ready." RETCODE);
-        Iprintf ("Ladmin is \033[1;32mready\033[0m.\n\n");
-    }
-
-    Connect_login_server ();
-
-    atexit (do_final);
-
-    return 0;
-}
diff --git a/src/ladmin/ladmin.h b/src/ladmin/ladmin.h
deleted file mode 100644
index dc1efe6..0000000
--- a/src/ladmin/ladmin.h
+++ /dev/null
@@ -1,11 +0,0 @@
-// $Id: ladmin.h,v 1.1.1.1 2004/09/10 17:26:52 MagicalTux Exp $
-#ifndef _LADMIN_H_
-#define _LADMIN_H_
-
-#define LADMIN_CONF_NAME	"conf/ladmin_athena.conf"
-#define PASSWORDENC		3       // A definition is given when making an encryption password correspond.
-                            // It is 1 at the time of passwordencrypt.
-                            // It is made into 2 at the time of passwordencrypt2.
-                            // When it is made 3, it corresponds to both.
-
-#endif
diff --git a/src/ladmin/md5calc.c b/src/ladmin/md5calc.c
deleted file mode 100644
index cf9d958..0000000
--- a/src/ladmin/md5calc.c
+++ /dev/null
@@ -1,333 +0,0 @@
-// $Id: md5calc.c,v 1.1.1.1 2004/09/10 17:26:54 MagicalTux Exp $
-/***********************************************************
- * md5 calculation algorithm
- *
- * The source code referred to the following URL.
- * http://www.geocities.co.jp/SiliconValley-Oakland/8878/lab17/lab17.html
- *
- ***********************************************************/
-
-#include "md5calc.h"
-#include <string.h>
-#include <stdio.h>
-#include "mt_rand.h"
-
-#ifndef UINT_MAX
-#define UINT_MAX 4294967295U
-#endif
-
-// Global variable
-static unsigned int *pX;
-
-// Stirng Table
-static const unsigned int T[] = {
-    0xd76aa478, 0xe8c7b756, 0x242070db, 0xc1bdceee, //0
-    0xf57c0faf, 0x4787c62a, 0xa8304613, 0xfd469501, //4
-    0x698098d8, 0x8b44f7af, 0xffff5bb1, 0x895cd7be, //8
-    0x6b901122, 0xfd987193, 0xa679438e, 0x49b40821, //12
-    0xf61e2562, 0xc040b340, 0x265e5a51, 0xe9b6c7aa, //16
-    0xd62f105d, 0x2441453, 0xd8a1e681, 0xe7d3fbc8,  //20
-    0x21e1cde6, 0xc33707d6, 0xf4d50d87, 0x455a14ed, //24
-    0xa9e3e905, 0xfcefa3f8, 0x676f02d9, 0x8d2a4c8a, //28
-    0xfffa3942, 0x8771f681, 0x6d9d6122, 0xfde5380c, //32
-    0xa4beea44, 0x4bdecfa9, 0xf6bb4b60, 0xbebfbc70, //36
-    0x289b7ec6, 0xeaa127fa, 0xd4ef3085, 0x4881d05,  //40
-    0xd9d4d039, 0xe6db99e5, 0x1fa27cf8, 0xc4ac5665, //44
-    0xf4292244, 0x432aff97, 0xab9423a7, 0xfc93a039, //48
-    0x655b59c3, 0x8f0ccc92, 0xffeff47d, 0x85845dd1, //52
-    0x6fa87e4f, 0xfe2ce6e0, 0xa3014314, 0x4e0811a1, //56
-    0xf7537e82, 0xbd3af235, 0x2ad7d2bb, 0xeb86d391  //60
-};
-
-// ROTATE_LEFT   The left is made to rotate x [ n-bit ]. This is diverted as it is from RFC.
-#define ROTATE_LEFT(x, n) (((x) << (n)) | ((x) >> (32-(n))))
-
-// The function used for other calculation
-static unsigned int F (unsigned int X, unsigned int Y, unsigned int Z)
-{
-    return (X & Y) | (~X & Z);
-}
-
-static unsigned int G (unsigned int X, unsigned int Y, unsigned int Z)
-{
-    return (X & Z) | (Y & ~Z);
-}
-
-static unsigned int H (unsigned int X, unsigned int Y, unsigned int Z)
-{
-    return X ^ Y ^ Z;
-}
-
-static unsigned int I (unsigned int X, unsigned int Y, unsigned int Z)
-{
-    return Y ^ (X | ~Z);
-}
-
-static unsigned int Round (unsigned int a, unsigned int b, unsigned int FGHI,
-                           unsigned int k, unsigned int s, unsigned int i)
-{
-    return b + ROTATE_LEFT (a + FGHI + pX[k] + T[i], s);
-}
-
-static void Round1 (unsigned int *a, unsigned int b, unsigned int c,
-                    unsigned int d, unsigned int k, unsigned int s,
-                    unsigned int i)
-{
-    *a = Round (*a, b, F (b, c, d), k, s, i);
-}
-
-static void Round2 (unsigned int *a, unsigned int b, unsigned int c,
-                    unsigned int d, unsigned int k, unsigned int s,
-                    unsigned int i)
-{
-    *a = Round (*a, b, G (b, c, d), k, s, i);
-}
-
-static void Round3 (unsigned int *a, unsigned int b, unsigned int c,
-                    unsigned int d, unsigned int k, unsigned int s,
-                    unsigned int i)
-{
-    *a = Round (*a, b, H (b, c, d), k, s, i);
-}
-
-static void Round4 (unsigned int *a, unsigned int b, unsigned int c,
-                    unsigned int d, unsigned int k, unsigned int s,
-                    unsigned int i)
-{
-    *a = Round (*a, b, I (b, c, d), k, s, i);
-}
-
-static void MD5_Round_Calculate (const unsigned char *block,
-                                 unsigned int *A2, unsigned int *B2,
-                                 unsigned int *C2, unsigned int *D2)
-{
-    //create X It is since it is required.
-    unsigned int X[16];         //512bit 64byte
-    int  j, k;
-
-    //Save A as AA, B as BB, C as CC, and and D as DD (saving of A, B, C, and D)
-    unsigned int A = *A2, B = *B2, C = *C2, D = *D2;
-    unsigned int AA = A, BB = B, CC = C, DD = D;
-
-    //It is a large region variable reluctantly because of calculation of a round. . . for Round1...4
-    pX = X;
-
-    //Copy block(padding_message) i into X
-    for (j = 0, k = 0; j < 64; j += 4, k++)
-        X[k] = ((unsigned int) block[j])    // 8byte*4 -> 32byte conversion
-            | (((unsigned int) block[j + 1]) << 8)  // A function called Decode as used in the field of RFC
-            | (((unsigned int) block[j + 2]) << 16)
-            | (((unsigned int) block[j + 3]) << 24);
-
-    //Round 1
-    Round1 (&A, B, C, D, 0, 7, 0);
-    Round1 (&D, A, B, C, 1, 12, 1);
-    Round1 (&C, D, A, B, 2, 17, 2);
-    Round1 (&B, C, D, A, 3, 22, 3);
-    Round1 (&A, B, C, D, 4, 7, 4);
-    Round1 (&D, A, B, C, 5, 12, 5);
-    Round1 (&C, D, A, B, 6, 17, 6);
-    Round1 (&B, C, D, A, 7, 22, 7);
-    Round1 (&A, B, C, D, 8, 7, 8);
-    Round1 (&D, A, B, C, 9, 12, 9);
-    Round1 (&C, D, A, B, 10, 17, 10);
-    Round1 (&B, C, D, A, 11, 22, 11);
-    Round1 (&A, B, C, D, 12, 7, 12);
-    Round1 (&D, A, B, C, 13, 12, 13);
-    Round1 (&C, D, A, B, 14, 17, 14);
-    Round1 (&B, C, D, A, 15, 22, 15);
-
-    //Round 2
-    Round2 (&A, B, C, D, 1, 5, 16);
-    Round2 (&D, A, B, C, 6, 9, 17);
-    Round2 (&C, D, A, B, 11, 14, 18);
-    Round2 (&B, C, D, A, 0, 20, 19);
-    Round2 (&A, B, C, D, 5, 5, 20);
-    Round2 (&D, A, B, C, 10, 9, 21);
-    Round2 (&C, D, A, B, 15, 14, 22);
-    Round2 (&B, C, D, A, 4, 20, 23);
-    Round2 (&A, B, C, D, 9, 5, 24);
-    Round2 (&D, A, B, C, 14, 9, 25);
-    Round2 (&C, D, A, B, 3, 14, 26);
-    Round2 (&B, C, D, A, 8, 20, 27);
-    Round2 (&A, B, C, D, 13, 5, 28);
-    Round2 (&D, A, B, C, 2, 9, 29);
-    Round2 (&C, D, A, B, 7, 14, 30);
-    Round2 (&B, C, D, A, 12, 20, 31);
-
-    //Round 3
-    Round3 (&A, B, C, D, 5, 4, 32);
-    Round3 (&D, A, B, C, 8, 11, 33);
-    Round3 (&C, D, A, B, 11, 16, 34);
-    Round3 (&B, C, D, A, 14, 23, 35);
-    Round3 (&A, B, C, D, 1, 4, 36);
-    Round3 (&D, A, B, C, 4, 11, 37);
-    Round3 (&C, D, A, B, 7, 16, 38);
-    Round3 (&B, C, D, A, 10, 23, 39);
-    Round3 (&A, B, C, D, 13, 4, 40);
-    Round3 (&D, A, B, C, 0, 11, 41);
-    Round3 (&C, D, A, B, 3, 16, 42);
-    Round3 (&B, C, D, A, 6, 23, 43);
-    Round3 (&A, B, C, D, 9, 4, 44);
-    Round3 (&D, A, B, C, 12, 11, 45);
-    Round3 (&C, D, A, B, 15, 16, 46);
-    Round3 (&B, C, D, A, 2, 23, 47);
-
-    //Round 4
-    Round4 (&A, B, C, D, 0, 6, 48);
-    Round4 (&D, A, B, C, 7, 10, 49);
-    Round4 (&C, D, A, B, 14, 15, 50);
-    Round4 (&B, C, D, A, 5, 21, 51);
-    Round4 (&A, B, C, D, 12, 6, 52);
-    Round4 (&D, A, B, C, 3, 10, 53);
-    Round4 (&C, D, A, B, 10, 15, 54);
-    Round4 (&B, C, D, A, 1, 21, 55);
-    Round4 (&A, B, C, D, 8, 6, 56);
-    Round4 (&D, A, B, C, 15, 10, 57);
-    Round4 (&C, D, A, B, 6, 15, 58);
-    Round4 (&B, C, D, A, 13, 21, 59);
-    Round4 (&A, B, C, D, 4, 6, 60);
-    Round4 (&D, A, B, C, 11, 10, 61);
-    Round4 (&C, D, A, B, 2, 15, 62);
-    Round4 (&B, C, D, A, 9, 21, 63);
-
-    // Then perform the following additions. (let's add)
-    *A2 = A + AA;
-    *B2 = B + BB;
-    *C2 = C + CC;
-    *D2 = D + DD;
-
-    //The clearance of confidential information
-    memset (pX, 0, sizeof (X));
-}
-
-//-------------------------------------------------------------------
-// The function for the exteriors
-
-/** output is the coded binary in the character sequence which wants to code string. */
-void MD5_String2binary (const char *string, char *output)
-{
-//var
-    /*8bit */
-    unsigned char padding_message[64];  //Extended message   512bit 64byte
-    unsigned char *pstring;     //The position of string in the present scanning notes is held.
-
-//   unsigned char digest[16];
-    /*32bit */
-    unsigned int string_byte_len,   //The byte chief of string is held.
-         string_bit_len,        //The bit length of string is held.
-         copy_len,              //The number of bytes which is used by 1-3 and which remained
-         msg_digest[4];         //Message digest   128bit 4byte
-    unsigned int *A = &msg_digest[0],   //The message digest in accordance with RFC (reference)
-        *B = &msg_digest[1], *C = &msg_digest[2], *D = &msg_digest[3];
-    int  i;
-
-//prog
-    //Step 3.Initialize MD Buffer (although it is the initialization; step 3 of A, B, C, and D -- unavoidable -- a head)
-    *A = 0x67452301;
-    *B = 0xefcdab89;
-    *C = 0x98badcfe;
-    *D = 0x10325476;
-
-    //Step 1.Append Padding Bits (extension of a mark bit)
-    //1-1
-    string_byte_len = strlen (string);  //The byte chief of a character sequence is acquired.
-    pstring = (unsigned char *) string; //The position of the present character sequence is set.
-
-    //1-2  Repeat calculation until length becomes less than 64 bytes.
-    for (i = string_byte_len; 64 <= i; i -= 64, pstring += 64)
-        MD5_Round_Calculate (pstring, A, B, C, D);
-
-    //1-3
-    copy_len = string_byte_len % 64;    //The number of bytes which remained is computed.
-    strncpy ((char *) padding_message, (char *) pstring, copy_len); //A message is copied to an extended bit sequence.
-    memset (padding_message + copy_len, 0, 64 - copy_len);  //It buries by 0 until it becomes extended bit length.
-    padding_message[copy_len] |= 0x80;  //The next of a message is 1.
-
-    //1-4 
-    //If 56 bytes or more (less than 64 bytes) of remainder becomes, it will calculate by extending to 64 bytes.
-    if (56 <= copy_len)
-    {
-        MD5_Round_Calculate (padding_message, A, B, C, D);
-        memset (padding_message, 0, 56);    //56 bytes is newly fill uped with 0.
-    }
-
-    //Step 2.Append Length (the information on length is added)
-    string_bit_len = string_byte_len * 8;   //From the byte chief to bit length (32 bytes of low rank)
-    memcpy (&padding_message[56], &string_bit_len, 4);  //32 bytes of low rank is set.
-
-    //When bit length cannot be expressed in 32 bytes of low rank, it is a beam raising to a higher rank.
-    if (UINT_MAX / 8 < string_byte_len)
-    {
-        unsigned int high = (string_byte_len - UINT_MAX / 8) * 8;
-        memcpy (&padding_message[60], &high, 4);
-    }
-    else
-        memset (&padding_message[60], 0, 4);    //In this case, it is good for a higher rank at 0.
-
-    //Step 4.Process Message in 16-Word Blocks (calculation of MD5)
-    MD5_Round_Calculate (padding_message, A, B, C, D);
-
-    //Step 5.Output (output)
-    memcpy (output, msg_digest, 16);
-//   memcpy (digest, msg_digest, and 16);  //8 byte*4 < - 32byte conversion   A function called Encode as used in the field of RFC
-/*   sprintf(output,
-           "%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x",
-           digest[ 0], digest[ 1], digest[ 2], digest[ 3],
-           digest[ 4], digest[ 5], digest[ 6], digest[ 7],
-           digest[ 8], digest[ 9], digest[10], digest[11],
-           digest[12], digest[13], digest[14], digest[15]);*/
-}
-
-/** output is the coded character sequence in the character sequence which wants to code string. */
-void MD5_String (const char *string, char *output)
-{
-    unsigned char digest[16];
-
-    MD5_String2binary (string, digest);
-    sprintf (output,
-             "%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x",
-             digest[0], digest[1], digest[2], digest[3],
-             digest[4], digest[5], digest[6], digest[7],
-             digest[8], digest[9], digest[10], digest[11],
-             digest[12], digest[13], digest[14], digest[15]);
-}
-
-// Hash a password with a salt.
-char *MD5_saltcrypt(const char *key, const char *salt)
-{
-	char buf[66], *sbuf = buf+32;
-	static char obuf[33];
-
-	// hash the key then the salt
-	// buf ends up as a 64char null terminated string
-	MD5_String(key, buf);
-	MD5_String(salt, sbuf);
-
-	// Hash the buffer back into sbuf
-	MD5_String(buf, sbuf);
-
-	snprintf(obuf, 32, "!%s$%s", salt, sbuf);
-	return(obuf);
-}
-
-char *make_salt() {
-	static char salt[6];
-	int i;
-	for (i=0; i<5; i++)
-		salt[i] = (char)((mt_rand() % 78) + 48);
-	salt[5] = '\0';
-	return(salt);
-}
-
-int pass_ok(const char *password, const char *crypted) {
-	char buf[40], *salt=buf+1;
-
-	strncpy(buf, crypted, 40);
-	*strchr(buf, '$') = '\0';
-
-	if (!strcmp(crypted, MD5_saltcrypt(password, salt)))
-		return(1);
-
-	return(0);
-}
diff --git a/src/ladmin/md5calc.h b/src/ladmin/md5calc.h
deleted file mode 100644
index 3571466..0000000
--- a/src/ladmin/md5calc.h
+++ /dev/null
@@ -1,11 +0,0 @@
-// $Id: md5calc.h,v 1.1.1.1 2004/09/10 17:26:54 MagicalTux Exp $
-#ifndef _MD5CALC_H_
-#define _MD5CALC_H_
-
-void MD5_String (const char *string, char *output);
-void MD5_String2binary (const char *string, char *output);
-char *MD5_saltcrypt(const char *key, const char *salt);
-char *make_salt();
-int pass_ok(const char *password, const char *crypted);
-
-#endif
diff --git a/src/login_sql/Makefile b/src/login_sql/Makefile
deleted file mode 100644
index 12fd7f3..0000000
--- a/src/login_sql/Makefile
+++ /dev/null
@@ -1,19 +0,0 @@
-include ../../make.defs
-
-all: login-server_sql
-sql: login-server_sql
-
-shared_libs=all
-COMMON_OBJ = ../common/core.o ../common/socket.o ../common/timer.o ../common/db.o ../common/malloc.o
-COMMON_H = ../common/core.h ../common/socket.h ../common/timer.h ../common/mmo.h ../common/version.h ../common/db.h ../common/malloc.h
-
-login-server_sql: login.o md5calc.o strlib.o $(COMMON_OBJ)
-	$(CC) -o ../../$@ $^ $(LIB_S)
-
-login.o: login.c login.h md5calc.h strlib.h $(COMMON_H)
-md5calc.o: md5calc.c md5calc.h
-strlib.o: strlib.c strlib.h
-
-clean:
-	rm -f *.o ../../login-server_sql
-
diff --git a/src/login_sql/login.c b/src/login_sql/login.c
deleted file mode 100644
index cc59f19..0000000
--- a/src/login_sql/login.c
+++ /dev/null
@@ -1,2073 +0,0 @@
-// $Id: login.c,v 1.6 2004/09/19 21:12:07 Valaris Exp $
-// original : login2.c 2003/01/28 02:29:17 Rev.1.1.1.1
-// txt version 1.100
-
-#include <sys/types.h>
-
-#ifdef LCCWIN32
-#include <winsock.h>
-#pragma lib <libmysql.lib>
-#else
-#include <sys/socket.h>
-#include <netinet/in.h>
-#include <sys/time.h>
-#include <sys/ioctl.h>
-#include <arpa/inet.h>
-#endif
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <netinet/in.h>
-#include <sys/time.h>
-#include <time.h>
-#include <sys/ioctl.h>
-#include <sys/stat.h>           // for stat/lstat/fstat
-#include <unistd.h>
-#include <signal.h>
-#include <fcntl.h>
-#include <string.h>
-#include <arpa/inet.h>
-
-//add include for DBMS(mysql)
-#include <mysql.h>
-
-#include "strlib.h"
-#include "timer.h"
-/*
-#include "timer.h"
-#include "core.h"
-#include "socket.h"
-#include "login.h"
-#include "mmo.h"
-#include "version.h"
-#include "db.h"
-*/
-
-#include "../common/core.h"
-#include "../common/socket.h"
-#include "login.h"
-#include "../common/mmo.h"
-#include "../common/version.h"
-#include "../common/db.h"
-#include "../common/timer.h"
-
-#ifdef PASSWORDENC
-#include "md5calc.h"
-#endif
-
-#ifdef MEMWATCH
-#include "memwatch.h"
-#endif
-
-#define J_MAX_MALLOC_SIZE 65535
-
-//-----------------------------------------------------
-// global variable
-//-----------------------------------------------------
-int  account_id_count = START_ACCOUNT_NUM;
-int  server_num;
-int  new_account_flag = 0;
-int  login_port = 6900;
-char lan_char_ip[128];          // Lan char ip added by kashy
-int  subnetmaski[4];            // Subnetmask added by kashy
-
-struct mmo_char_server server[MAX_SERVERS];
-int  server_fd[MAX_SERVERS];
-int  server_freezeflag[MAX_SERVERS];    // Char-server anti-freeze system. Counter. 5 ok, 4...0 freezed
-int  anti_freeze_enable = 0;
-int  ANTI_FREEZE_INTERVAL = 15;
-
-int  login_fd;
-
-char date_format[32] = "%Y-%m-%d %H:%M:%S";
-int  auth_num = 0, auth_max = 0;
-
-int  min_level_to_connect = 0;  // minimum level of player/GM (0: player, 1-99: gm) to connect on the server
-int  check_ip_flag = 1;         // It's to check IP of a player between login-server and char-server (part of anti-hacking system)
-
-MYSQL mysql_handle;
-
-int  ipban = 1;
-int  dynamic_account_ban = 1;
-int  dynamic_account_ban_class = 0;
-int  dynamic_pass_failure_ban = 1;
-int  dynamic_pass_failure_ban_time = 5;
-int  dynamic_pass_failure_ban_how_many = 3;
-int  dynamic_pass_failure_ban_how_long = 60;
-
-int  login_server_port = 3306;
-char login_server_ip[32] = "127.0.0.1";
-char login_server_id[32] = "ragnarok";
-char login_server_pw[32] = "ragnarok";
-char login_server_db[32] = "ragnarok";
-int  use_md5_passwds = 0;
-char login_db[256] = "login";
-char loginlog_db[256] = "loginlog";
-
-// added to help out custom login tables, without having to recompile 
-// source so options are kept in the login_athena.conf or the inter_athena.conf
-char login_db_account_id[256] = "account_id";
-char login_db_userid[256] = "userid";
-char login_db_user_pass[256] = "user_pass";
-char login_db_level[256] = "level";
-
-char tmpsql[65535], tmp_sql[65535];
-
-//-----------------------------------------------------
-
-#define AUTH_FIFO_SIZE 256
-struct
-{
-    int  account_id, login_id1, login_id2;
-    int  ip, sex, delflag;
-} auth_fifo[AUTH_FIFO_SIZE];
-
-int  auth_fifo_pos = 0;
-
-//-----------------------------------------------------
-
-static char md5key[20], md5keylen = 16;
-
-//-----------------------------------------------------
-// check user level
-//-----------------------------------------------------
-
-int isGM (int account_id)
-{
-    int  level;
-
-    MYSQL_RES *sql_res;
-    MYSQL_ROW sql_row;
-    level = 0;
-    sprintf (tmpsql, "SELECT `%s` FROM `%s` WHERE `%s`='%d'", login_db_level,
-             login_db, login_db_account_id, account_id);
-    if (mysql_query (&mysql_handle, tmpsql))
-    {
-        printf ("DB server Error (select GM Level to Memory)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res)
-    {
-        sql_row = mysql_fetch_row (sql_res);
-        level = atoi (sql_row[0]);
-        if (level > 99)
-            level = 99;
-    }
-
-    if (level == 0)
-    {
-        return 0;
-        //not GM
-    }
-
-    mysql_free_result (sql_res);
-
-    return level;
-}
-
-//-----------------------------------------------------
-// Function to suppress control characters in a string.
-//-----------------------------------------------------
-int remove_control_chars (unsigned char *str)
-{
-    int  i;
-    int  change = 0;
-
-    for (i = 0; str[i]; i++)
-    {
-        if (str[i] < 32)
-        {
-            str[i] = '_';
-            change = 1;
-        }
-    }
-
-    return change;
-}
-
-//---------------------------------------------------
-// E-mail check: return 0 (not correct) or 1 (valid).
-//---------------------------------------------------
-int e_mail_check (unsigned char *email)
-{
-    char ch;
-    unsigned char *last_arobas;
-
-    // athena limits
-    if (strlen (email) < 3 || strlen (email) > 39)
-        return 0;
-
-    // part of RFC limits (official reference of e-mail description)
-    if (strchr (email, '@') == NULL || email[strlen (email) - 1] == '@')
-        return 0;
-
-    if (email[strlen (email) - 1] == '.')
-        return 0;
-
-    last_arobas = strrchr (email, '@');
-
-    if (strstr (last_arobas, "@.") != NULL ||
-        strstr (last_arobas, "..") != NULL)
-        return 0;
-
-    for (ch = 1; ch < 32; ch++)
-    {
-        if (strchr (last_arobas, ch) != NULL)
-        {
-            return 0;
-            break;
-        }
-    }
-
-    if (strchr (last_arobas, ' ') != NULL ||
-        strchr (last_arobas, ';') != NULL)
-        return 0;
-
-    // all correct
-    return 1;
-}
-
-//-----------------------------------------------------
-// Read Account database - mysql db
-//-----------------------------------------------------
-int mmo_auth_sqldb_init (void)
-{
-
-    printf ("Login server init....\n");
-
-    // memory initialize
-    printf ("memory initialize....\n");
-
-    mysql_init (&mysql_handle);
-
-    // DB connection start
-    printf ("Connect Login Database Server....\n");
-    if (!mysql_real_connect
-        (&mysql_handle, login_server_ip, login_server_id, login_server_pw,
-         login_server_db, login_server_port, (char *) NULL, 0))
-    {
-        // pointer check
-        printf ("%s\n", mysql_error (&mysql_handle));
-        exit (1);
-    }
-    else
-    {
-        printf ("connect success!\n");
-    }
-
-    sprintf (tmpsql,
-             "INSERT INTO `%s`(`time`,`ip`,`user`,`rcode`,`log`) VALUES (NOW(), '', 'lserver', '100','login server started')",
-             loginlog_db);
-
-    //query
-    if (mysql_query (&mysql_handle, tmpsql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-
-    return 0;
-}
-
-//-----------------------------------------------------
-// DB server connect check
-//-----------------------------------------------------
-void mmo_auth_sqldb_sync (void)
-{
-    // db connect check? or close?
-    // ping pong DB server -if losted? then connect try. else crash.
-}
-
-//-----------------------------------------------------
-// close DB
-//-----------------------------------------------------
-void mmo_db_close (void)
-{
-
-    //set log.
-    sprintf (tmpsql,
-             "INSERT INTO `%s`(`time`,`ip`,`user`,`rcode`,`log`) VALUES (NOW(), '', 'lserver','100', 'login server shutdown')",
-             loginlog_db);
-
-    //query
-    if (mysql_query (&mysql_handle, tmpsql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-
-    //delete all server status
-    sprintf (tmpsql, "DELETE FROM `sstatus`");
-    //query
-    if (mysql_query (&mysql_handle, tmpsql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-
-    mysql_close (&mysql_handle);
-    printf ("close DB connect....\n");
-
-    int  i, fd;
-
-    for (i = 0; i < MAX_SERVERS; i++)
-    {
-        if ((fd = server_fd[i]) >= 0)
-            delete_session (fd);
-    }
-    delete_session (login_fd);
-}
-
-//-----------------------------------------------------
-// Make new account
-//-----------------------------------------------------
-int mmo_auth_sqldb_new (struct mmo_account *account, const char *tmpstr,
-                        char sex)
-{
-    //no need on DB version
-
-    printf ("Request new account.... - not support on this version\n");
-
-    return 0;
-}
-
-//-----------------------------------------------------
-// Make new account
-//-----------------------------------------------------
-int mmo_auth_new (struct mmo_account *account, const char *tmpstr, char sex)
-{
-
-    return 0;
-}
-
-#ifdef LCCWIN32
-extern void gettimeofday (struct timeval *t, struct timezone *dummy);
-#endif
-
-//-----------------------------------------------------
-// Auth
-//-----------------------------------------------------
-int mmo_auth (struct mmo_account *account, int fd)
-{
-    struct timeval tv;
-    time_t ban_until_time;
-    char tmpstr[256];
-    char t_uid[256], t_pass[256];
-    char user_password[256];
-
-    MYSQL_RES *sql_res;
-    MYSQL_ROW sql_row;
-    //int sql_fields, sql_cnt;
-    char md5str[64], md5bin[32];
-
-    char ip[16];
-
-    unsigned char *sin_addr =
-        (unsigned char *) &session[fd]->client_addr.sin_addr;
-
-    printf ("auth start...\n");
-
-    sprintf (ip, "%d.%d.%d.%d", sin_addr[0], sin_addr[1], sin_addr[2],
-             sin_addr[3]);
-
-    // auth start : time seed
-    gettimeofday (&tv, NULL);
-    strftime (tmpstr, 24, "%Y-%m-%d %H:%M:%S", gmtime (&(tv.tv_sec)));
-    sprintf (tmpstr + 19, ".%03d", (int) tv.tv_usec / 1000);
-
-    jstrescapecpy (t_uid, account->userid);
-    jstrescapecpy (t_pass, account->passwd);
-
-    // make query
-    sprintf (tmpsql,
-             "SELECT `%s`,`%s`,`%s`,`lastlogin`,`logincount`,`sex`,`connect_until`,`last_ip`,`ban_until`,`state`,`%s`"
-             " FROM `%s` WHERE `%s`='%s'", login_db_account_id,
-             login_db_userid, login_db_user_pass, login_db_level, login_db,
-             login_db_userid, t_uid);
-    //login {0-account_id/1-userid/2-user_pass/3-lastlogin/4-logincount/5-sex/6-connect_untl/7-last_ip/8-ban_until/9-state}
-
-    // query
-    if (mysql_query (&mysql_handle, tmpsql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    if (sql_res)
-    {
-        sql_row = mysql_fetch_row (sql_res);    //row fetching
-        if (!sql_row)
-        {
-            //there's no id.
-            printf ("auth failed no account %s %s %s\n", tmpstr,
-                    account->userid, account->passwd);
-            mysql_free_result (sql_res);
-            return 0;
-        }
-    }
-    else
-    {
-        printf ("mmo_auth DB result error ! \n");
-        return 0;
-    }
-    // Documented by CLOWNISIUS || LLRO || Gunstar lead this one with me
-    // IF changed to diferent returns~ you get diferent responses from your msgstringtable.txt
-    //Ireturn 2  == line 9
-    //Ireturn 5  == line 311
-    //Ireturn 6  == line 450
-    //Ireturn 7  == line 440
-    //Ireturn 8  == line 682
-    //Ireturn 9  == line 704
-    //Ireturn 10 == line 705
-    //Ireturn 11 == line 706
-    //Ireturn 12 == line 707
-    //Ireturn 13 == line 708
-    //Ireturn 14 == line 709
-    //Ireturn 15 == line 710
-    //Ireturn -1 == line 010
-    // Check status
-    {
-        if (atoi (sql_row[9]) == -3)
-        {
-            //id is banned
-            mysql_free_result (sql_res);
-            return -3;
-        }
-        else if (atoi (sql_row[9]) == -2)
-        {                       //dynamic ban
-            //id is banned
-            mysql_free_result (sql_res);
-            //add IP list.
-            return -2;
-        }
-
-        if (use_md5_passwds)
-        {
-            MD5_String (account->passwd, user_password);
-        }
-        else
-        {
-            jstrescapecpy (user_password, account->passwd);
-        }
-        printf ("account id ok encval:%d\n", account->passwdenc);
-        int  encpasswdok = 0;
-#ifdef PASSWORDENC
-        if (account->passwdenc > 0)
-        {
-            printf ("start md5calc..\n");
-            int  j = account->passwdenc;
-            if (j > 2)
-                j = 1;
-            do
-            {
-                if (j == 1)
-                {
-                    sprintf (md5str, "%s%s", md5key, sql_row[2]);
-                }
-                else if (j == 2)
-                {
-                    sprintf (md5str, "%s%s", sql_row[2], md5key);
-                }
-                else
-                    md5str[0] = 0;
-                printf ("j:%d mdstr:%s\n", j, md5str);
-                MD5_String2binary (md5str, md5bin);
-                encpasswdok = (memcmp (user_password, md5bin, 16) == 0);
-            }
-            while (j < 2 && !encpasswdok && (j++) != account->passwdenc);
-            //printf("key[%s] md5 [%s] ", md5key, md5);
-            printf ("client [%s] accountpass [%s]\n", user_password,
-                    sql_row[2]);
-            printf ("end md5calc..\n");
-        }
-#endif
-        if ((strcmp (user_password, sql_row[2]) && !encpasswdok))
-        {
-            if (account->passwdenc == 0)
-            {
-                printf ("auth failed pass error %s %s %s" RETCODE, tmpstr,
-                        account->userid, user_password);
-#ifdef PASSWORDENC
-            }
-            else
-            {
-                char logbuf[1024], *p = logbuf;
-                int  j;
-                p += sprintf (p, "auth failed pass error %s %s recv-md5[",
-                              tmpstr, account->userid);
-                for (j = 0; j < 16; j++)
-                    p += sprintf (p, "%02x",
-                                  ((unsigned char *) user_password)[j]);
-                p += sprintf (p, "] calc-md5[");
-                for (j = 0; j < 16; j++)
-                    p += sprintf (p, "%02x", ((unsigned char *) md5bin)[j]);
-                p += sprintf (p, "] md5key[");
-                for (j = 0; j < md5keylen; j++)
-                    p += sprintf (p, "%02x", ((unsigned char *) md5key)[j]);
-                p += sprintf (p, "]" RETCODE);
-                printf ("%s\n", p);
-#endif
-            }
-            return 1;
-        }
-        printf ("auth ok %s %s" RETCODE, tmpstr, account->userid);
-    }
-
-    if (atoi (sql_row[9]))
-    {
-        switch (atoi (sql_row[9]))
-        {                       // packet 0x006a value + 1
-            case 1:            // 0 = Unregistered ID
-            case 2:            // 1 = Incorrect Password
-            case 3:            // 2 = This ID is expired
-            case 4:            // 3 = Rejected from Server
-            case 5:            // 4 = You have been blocked by the GM Team
-            case 6:            // 5 = Your Game's EXE file is not the latest version
-            case 7:            // 6 = Your are Prohibited to log in until %s
-            case 8:            // 7 = Server is jammed due to over populated
-            case 9:            // 8 = No MSG (actually, all states after 9 except 99 are No MSG, use only this)
-            case 100:          // 99 = This ID has been totally erased
-                printf ("Auth Error #%d\n", atoi (sql_row[9]));
-                return atoi (sql_row[9]) - 1;
-                break;
-            default:
-                return 99;      // 99 = ID has been totally erased
-                break;
-        }
-    }
-
-/*
-// do not remove this section. this is meant for future, and current forums usage
-// as a login manager and CP for login server. [CLOWNISIUS]
-	if (atoi(sql_row[10]) == 1) {
-		return 4;
-	}
-
-	if (atoi(sql_row[10]) >= 5) {
-		switch(atoi(sql_row[10])) {
-		case 5:
-			return 5;
-			break;
-		case 6:
-			return 7;
-			break;
-		case 7:
-			return 9;
-			break;
-		case 8:
-			return 10;
-			break;
-		case 9:
-			return 11;
-			break;
-		default:
-			return 10;
-			break;
-		}
-	}
-*/
-    ban_until_time = atol (sql_row[8]);
-
-    //login {0-account_id/1-userid/2-user_pass/3-lastlogin/4-logincount/5-sex/6-connect_untl/7-last_ip/8-ban_until/9-state}
-    if (ban_until_time != 0)
-    {                           // if account is banned
-        strftime (tmpstr, 20, date_format, gmtime (&ban_until_time));
-        tmpstr[19] = '\0';
-        if (ban_until_time > time (NULL))
-        {                       // always banned
-            return 6;           // 6 = Your are Prohibited to log in until %s
-        }
-        else
-        {                       // ban is finished
-            // reset the ban time
-            sprintf (tmpsql,
-                     "UPDATE `%s` SET `ban_until`='0' WHERE `%s`='%s'",
-                     login_db, login_db_userid, t_uid);
-            if (mysql_query (&mysql_handle, tmpsql))
-            {
-                printf ("DB server Error - %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-    }
-
-    if (atol (sql_row[6]) != 0 && atol (sql_row[6]) < time (NULL))
-    {
-        return 2;               // 2 = This ID is expired
-    }
-
-    account->account_id = atoi (sql_row[0]);
-    account->login_id1 = rand ();
-    account->login_id2 = rand ();
-    memcpy (tmpstr, sql_row[3], 19);
-    memcpy (account->lastlogin, tmpstr, 24);
-    account->sex = sql_row[5][0] == 'S' ? 2 : sql_row[5][0] == 'M';
-
-    sprintf (tmpsql,
-             "UPDATE `%s` SET `lastlogin` = NOW(), `logincount`=`logincount` +1, `last_ip`='%s'  WHERE  `%s` = '%s'",
-             login_db, ip, login_db_userid, sql_row[1]);
-    mysql_free_result (sql_res);    //resource free
-    if (mysql_query (&mysql_handle, tmpsql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-
-    return -1;
-}
-
-// Send to char
-int charif_sendallwos (int sfd, unsigned char *buf, unsigned int len)
-{
-    int  i, c;
-    int  fd;
-
-    c = 0;
-    for (i = 0; i < MAX_SERVERS; i++)
-    {
-        if ((fd = server_fd[i]) > 0 && fd != sfd)
-        {
-            memcpy (WFIFOP (fd, 0), buf, len);
-            WFIFOSET (fd, len);
-            c++;
-        }
-    }
-
-    return c;
-}
-
-//--------------------------------
-// Char-server anti-freeze system
-//--------------------------------
-int char_anti_freeze_system (int tid, unsigned int tick, int id, int data)
-{
-    int  i;
-
-    for (i = 0; i < MAX_SERVERS; i++)
-    {
-        if (server_fd[i] >= 0)
-        {                       // if char-server is online
-//          printf("char_anti_freeze_system: server #%d '%s', flag: %d.\n", i, server[i].name, server_freezeflag[i]);
-            if (server_freezeflag[i]-- < 1)
-            {                   // Char-server anti-freeze system. Counter. 5 ok, 4...0 freezed
-                session[server_fd[i]]->eof = 1;
-            }
-        }
-    }
-
-    return 0;
-}
-
-//-----------------------------------------------------
-// char-server packet parse
-//-----------------------------------------------------
-int parse_fromchar (int fd)
-{
-    int  i, id;
-    MYSQL_RES *sql_res;
-    MYSQL_ROW sql_row = NULL;
-
-    unsigned char *p = (unsigned char *) &session[fd]->client_addr.sin_addr;
-    char ip[16];
-
-    sprintf (ip, "%d.%d.%d.%d", p[0], p[1], p[2], p[3]);
-
-    for (id = 0; id < MAX_SERVERS; id++)
-        if (server_fd[id] == fd)
-            break;
-
-    if (id == MAX_SERVERS || session[fd]->eof)
-    {
-        if (id < MAX_SERVERS)
-        {
-            printf ("Char-server '%s' has disconnected.\n", server[id].name);
-            server_fd[id] = -1;
-            memset (&server[id], 0, sizeof (struct mmo_char_server));
-            // server delete
-            sprintf (tmpsql, "DELETE FROM `sstatus` WHERE `index`='%d'", id);
-            // query
-            if (mysql_query (&mysql_handle, tmpsql))
-            {
-                printf ("DB server Error - %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-        close (fd);
-        delete_session (fd);
-        return 0;
-    }
-
-    while (RFIFOREST (fd) >= 2)
-    {
-//      printf("char_parse: %d %d packet case=%x\n", fd, RFIFOREST(fd), RFIFOW(fd, 0));
-
-        switch (RFIFOW (fd, 0))
-        {
-            case 0x2712:
-                if (RFIFOREST (fd) < 19)
-                    return 0;
-                {
-                    int  account_id;
-                    account_id = RFIFOL (fd, 2);    // speed up
-                    for (i = 0; i < AUTH_FIFO_SIZE; i++)
-                    {
-                        if (auth_fifo[i].account_id == account_id &&
-                            auth_fifo[i].login_id1 == RFIFOL (fd, 6) &&
-#if CMP_AUTHFIFO_LOGIN2 != 0
-                            auth_fifo[i].login_id2 == RFIFOL (fd, 10) &&    // relate to the versions higher than 18 
-#endif
-                            auth_fifo[i].sex == RFIFOB (fd, 14) &&
-#if CMP_AUTHFIFO_IP != 0
-                            auth_fifo[i].ip == RFIFOL (fd, 15) &&
-#endif
-                            !auth_fifo[i].delflag)
-                        {
-                            auth_fifo[i].delflag = 1;
-                            printf ("auth -> %d\n", i);
-                            break;
-                        }
-                    }
-
-                    if (i != AUTH_FIFO_SIZE)
-                    {           // send account_reg
-                        int  p;
-                        time_t connect_until_time = 0;
-                        char email[40] = "";
-                        account_id = RFIFOL (fd, 2);
-                        sprintf (tmpsql,
-                                 "SELECT `email`,`connect_until` FROM `%s` WHERE `%s`='%d'",
-                                 login_db, login_db_account_id, account_id);
-                        if (mysql_query (&mysql_handle, tmpsql))
-                        {
-                            printf ("DB server Error - %s\n",
-                                    mysql_error (&mysql_handle));
-                        }
-                        sql_res = mysql_store_result (&mysql_handle);
-                        if (sql_res)
-                        {
-                            sql_row = mysql_fetch_row (sql_res);
-                            connect_until_time = atol (sql_row[1]);
-                            strcpy (email, sql_row[0]);
-                        }
-                        mysql_free_result (sql_res);
-                        if (account_id > 0)
-                        {
-                            sprintf (tmpsql,
-                                     "SELECT `str`,`value` FROM `global_reg_value` WHERE `type`='1' AND `account_id`='%d'",
-                                     account_id);
-                            if (mysql_query (&mysql_handle, tmpsql))
-                            {
-                                printf ("DB server Error - %s\n",
-                                        mysql_error (&mysql_handle));
-                            }
-                            sql_res = mysql_store_result (&mysql_handle);
-                            if (sql_res)
-                            {
-                                WFIFOW (fd, 0) = 0x2729;
-                                WFIFOL (fd, 4) = account_id;
-                                for (p = 8;
-                                     (sql_row = mysql_fetch_row (sql_res));
-                                     p += 36)
-                                {
-                                    memcpy (WFIFOP (fd, p), sql_row[0], 32);
-                                    WFIFOL (fd, p + 32) = atoi (sql_row[1]);
-                                }
-                                WFIFOW (fd, 2) = p;
-                                WFIFOSET (fd, p);
-                                //printf("account_reg2 send : login->char (auth fifo)\n");
-                                WFIFOW (fd, 0) = 0x2713;
-                                WFIFOL (fd, 2) = account_id;
-                                WFIFOB (fd, 6) = 0;
-                                memcpy (WFIFOP (fd, 7), email, 40);
-                                WFIFOL (fd, 47) =
-                                    (unsigned long) connect_until_time;
-                                WFIFOSET (fd, 51);
-                            }
-                            mysql_free_result (sql_res);
-                        }
-                    }
-                    else
-                    {
-                        WFIFOW (fd, 0) = 0x2713;
-                        WFIFOL (fd, 2) = account_id;
-                        WFIFOB (fd, 6) = 1;
-                        WFIFOSET (fd, 51);
-                    }
-                }
-                RFIFOSKIP (fd, 19);
-                break;
-
-            case 0x2714:
-                if (RFIFOREST (fd) < 6)
-                    return 0;
-                // how many users on world? (update)
-                if (server[id].users != RFIFOL (fd, 2))
-                    printf ("set users %s : %d\n", server[id].name,
-                            RFIFOL (fd, 2));
-                server[id].users = RFIFOL (fd, 2);
-                if (anti_freeze_enable)
-                    server_freezeflag[id] = 5;  // Char anti-freeze system. Counter. 5 ok, 4...0 freezed
-
-                sprintf (tmpsql,
-                         "UPDATE `sstatus` SET `user` = '%d' WHERE `index` = '%d'",
-                         server[id].users, id);
-                // query
-                if (mysql_query (&mysql_handle, tmpsql))
-                {
-                    printf ("DB server Error - %s\n",
-                            mysql_error (&mysql_handle));
-                }
-                RFIFOSKIP (fd, 6);
-                break;
-
-                // We receive an e-mail/limited time request, because a player comes back from a map-server to the char-server
-            case 0x2716:
-                if (RFIFOREST (fd) < 6)
-                    return 0;
-                {
-                    int  account_id;
-                    time_t connect_until_time = 0;
-                    char email[40] = "";
-                    account_id = RFIFOL (fd, 2);
-                    sprintf (tmpsql,
-                             "SELECT `email`,`connect_until` FROM `%s` WHERE `%s`='%d'",
-                             login_db, login_db_account_id, account_id);
-                    if (mysql_query (&mysql_handle, tmpsql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-                    sql_res = mysql_store_result (&mysql_handle);
-                    if (sql_res)
-                    {
-                        sql_row = mysql_fetch_row (sql_res);
-                        connect_until_time = atol (sql_row[1]);
-                        strcpy (email, sql_row[0]);
-                    }
-                    mysql_free_result (sql_res);
-                    //printf("parse_fromchar: E-mail/limited time request from '%s' server (concerned account: %d)\n", server[id].name, RFIFOL(fd,2));
-                    WFIFOW (fd, 0) = 0x2717;
-                    WFIFOL (fd, 2) = RFIFOL (fd, 2);
-                    memcpy (WFIFOP (fd, 6), email, 40);
-                    WFIFOL (fd, 46) = (unsigned long) connect_until_time;
-                    WFIFOSET (fd, 50);
-                }
-                RFIFOSKIP (fd, 6);
-                break;
-
-            case 0x2720:       // GM
-                if (RFIFOREST (fd) < 4)
-                    return 0;
-                if (RFIFOREST (fd) < RFIFOW (fd, 2))
-                    return 0;
-                //oldacc = RFIFOL(fd,4);
-                printf
-                    ("change GM isn't support in this login server version.\n");
-                printf ("change GM error 0 %s\n", RFIFOP (fd, 8));
-
-                RFIFOSKIP (fd, RFIFOW (fd, 2));
-                WFIFOW (fd, 0) = 0x2721;
-                WFIFOL (fd, 2) = RFIFOL (fd, 4);    // oldacc;
-                WFIFOL (fd, 6) = 0; // newacc;
-                WFIFOSET (fd, 10);
-                return 0;
-
-                // Map server send information to change an email of an account via char-server
-            case 0x2722:       // 0x2722 <account_id>.L <actual_e-mail>.40B <new_e-mail>.40B
-                if (RFIFOREST (fd) < 86)
-                    return 0;
-                {
-                    int  acc;
-                    char actual_email[40], new_email[40];
-                    acc = RFIFOL (fd, 2);
-                    memcpy (actual_email, RFIFOP (fd, 6), 40);
-                    memcpy (new_email, RFIFOP (fd, 46), 40);
-                    if (e_mail_check (actual_email) == 0)
-                        printf
-                            ("Char-server '%s': Attempt to modify an e-mail on an account (@email GM command), but actual email is invalid (account: %d, ip: %s)"
-                             RETCODE, server[id].name, acc, ip);
-                    else if (e_mail_check (new_email) == 0)
-                        printf
-                            ("Char-server '%s': Attempt to modify an e-mail on an account (@email GM command) with a invalid new e-mail (account: %d, ip: %s)"
-                             RETCODE, server[id].name, acc, ip);
-                    else if (strcmpi (new_email, "a@a.com") == 0)
-                        printf
-                            ("Char-server '%s': Attempt to modify an e-mail on an account (@email GM command) with a default e-mail (account: %d, ip: %s)"
-                             RETCODE, server[id].name, acc, ip);
-                    else
-                    {
-                        sprintf (tmpsql,
-                                 "SELECT `%s`,`email` FROM `%s` WHERE `%s` = '%d'",
-                                 login_db_userid, login_db,
-                                 login_db_account_id, acc);
-                        if (mysql_query (&mysql_handle, tmpsql))
-                            printf ("DB server Error - %s\n",
-                                    mysql_error (&mysql_handle));
-                        sql_res = mysql_store_result (&mysql_handle);
-                        if (sql_res)
-                        {
-                            sql_row = mysql_fetch_row (sql_res);    //row fetching
-
-                            if (strcmpi (sql_row[1], actual_email) == 0)
-                            {
-                                sprintf (tmpsql,
-                                         "UPDATE `%s` SET `email` = '%s' WHERE `%s` = '%d'",
-                                         login_db, new_email,
-                                         login_db_account_id, acc);
-                                // query
-                                if (mysql_query (&mysql_handle, tmpsql))
-                                {
-                                    printf ("DB server Error - %s\n",
-                                            mysql_error (&mysql_handle));
-                                }
-                                printf
-                                    ("Char-server '%s': Modify an e-mail on an account (@email GM command) (account: %d (%s), new e-mail: %s, ip: %s)."
-                                     RETCODE, server[id].name, acc,
-                                     sql_row[0], actual_email, ip);
-                            }
-                        }
-
-                    }
-                }
-                RFIFOSKIP (fd, 86);
-                break;
-
-            case 0x2724:       // Receiving of map-server via char-server a status change resquest (by Yor)
-                if (RFIFOREST (fd) < 10)
-                    return 0;
-                {
-                    int  acc, statut;
-                    acc = RFIFOL (fd, 2);
-                    statut = RFIFOL (fd, 6);
-                    sprintf (tmpsql,
-                             "SELECT `state` FROM `%s` WHERE `%s` = '%d'",
-                             login_db, login_db_account_id, acc);
-                    if (mysql_query (&mysql_handle, tmpsql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-                    sql_res = mysql_store_result (&mysql_handle);
-                    if (sql_res)
-                    {
-                        sql_row = mysql_fetch_row (sql_res);    // row fetching
-                    }
-                    if (atoi (sql_row[0]) != statut && statut != 0)
-                    {
-                        unsigned char buf[16];
-                        WBUFW (buf, 0) = 0x2731;
-                        WBUFL (buf, 2) = acc;
-                        WBUFB (buf, 6) = 0; // 0: change of statut, 1: ban
-                        WBUFL (buf, 7) = statut;    // status or final date of a banishment
-                        charif_sendallwos (-1, buf, 11);
-                    }
-                    sprintf (tmpsql,
-                             "UPDATE `%s` SET `state` = '%d' WHERE `%s` = '%d'",
-                             login_db, statut, login_db_account_id, acc);
-                    //query
-                    if (mysql_query (&mysql_handle, tmpsql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-                    RFIFOSKIP (fd, 10);
-                }
-                return 0;
-
-            case 0x2725:       // Receiving of map-server via char-server a ban resquest (by Yor)
-                if (RFIFOREST (fd) < 18)
-                    return 0;
-                {
-                    int  acc;
-                    struct tm *tmtime;
-                    time_t timestamp, tmptime;
-                    acc = RFIFOL (fd, 2);
-                    sprintf (tmpsql,
-                             "SELECT `ban_until` FROM `%s` WHERE `%s` = '%d'",
-                             login_db, login_db_account_id, acc);
-                    if (mysql_query (&mysql_handle, tmpsql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-                    sql_res = mysql_store_result (&mysql_handle);
-                    if (sql_res)
-                    {
-                        sql_row = mysql_fetch_row (sql_res);    // row fetching
-                    }
-                    tmptime = atol (sql_row[0]);
-                    if (tmptime == 0 || tmptime < time (NULL))
-                        timestamp = time (NULL);
-                    else
-                        timestamp = tmptime;
-                    tmtime = gmtime (&timestamp);
-                    tmtime->tm_year =
-                        tmtime->tm_year + (short) RFIFOW (fd, 6);
-                    tmtime->tm_mon = tmtime->tm_mon + (short) RFIFOW (fd, 8);
-                    tmtime->tm_mday =
-                        tmtime->tm_mday + (short) RFIFOW (fd, 10);
-                    tmtime->tm_hour =
-                        tmtime->tm_hour + (short) RFIFOW (fd, 12);
-                    tmtime->tm_min = tmtime->tm_min + (short) RFIFOW (fd, 14);
-                    tmtime->tm_sec = tmtime->tm_sec + (short) RFIFOW (fd, 16);
-                    timestamp = timegm (tmtime);
-                    if (timestamp != -1)
-                    {
-                        if (timestamp <= time (NULL))
-                            timestamp = 0;
-                        if (tmptime != timestamp)
-                        {
-                            if (timestamp != 0)
-                            {
-                                unsigned char buf[16];
-                                WBUFW (buf, 0) = 0x2731;
-                                WBUFL (buf, 2) = acc;
-                                WBUFB (buf, 6) = 1; // 0: change of statut, 1: ban
-                                WBUFL (buf, 7) = timestamp; // status or final date of a banishment
-                                charif_sendallwos (-1, buf, 11);
-                            }
-                            printf ("Account: %d Banned until: %ld\n", acc,
-                                    timestamp);
-                            sprintf (tmpsql,
-                                     "UPDATE `%s` SET `ban_until` = '%ld', `state`='7' WHERE `%s` = '%d'",
-                                     login_db, timestamp, login_db_account_id,
-                                     acc);
-                            // query
-                            if (mysql_query (&mysql_handle, tmpsql))
-                            {
-                                printf ("DB server Error - %s\n",
-                                        mysql_error (&mysql_handle));
-                            }
-                        }
-                    }
-                    RFIFOSKIP (fd, 18);
-                    break;
-                }
-                return 0;
-
-            case 0x2727:
-                if (RFIFOREST (fd) < 6)
-                    return 0;
-                {
-                    int  acc, sex;
-                    unsigned char buf[16];
-                    acc = RFIFOL (fd, 4);
-                    sprintf (tmpsql,
-                             "SELECT `sex` FROM `%s` WHERE `%s` = '%d'",
-                             login_db, login_db_account_id, acc);
-
-                    if (mysql_query (&mysql_handle, tmpsql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                        return 0;
-                    }
-
-                    sql_res = mysql_store_result (&mysql_handle);
-
-                    if (sql_res)
-                    {
-                        if (mysql_num_rows (sql_res) == 0)
-                        {
-                            mysql_free_result (sql_res);
-                            return 0;
-                        }
-                        sql_row = mysql_fetch_row (sql_res);    //row fetching
-                    }
-
-                    if (strcmpi (sql_row[0], "M") == 0)
-                        sex = 1;
-                    else
-                        sex = 0;
-                    sprintf (tmpsql,
-                             "UPDATE `%s` SET `sex` = '%c' WHERE `%s` = '%d'",
-                             login_db, (sex == 0 ? 'M' : 'F'),
-                             login_db_account_id, acc);
-                    //query
-                    if (mysql_query (&mysql_handle, tmpsql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-                    WBUFW (buf, 0) = 0x2723;
-                    WBUFL (buf, 2) = acc;
-                    WBUFB (buf, 6) = sex;
-                    charif_sendallwos (-1, buf, 7);
-                    RFIFOSKIP (fd, 6);
-                }
-                return 0;
-
-            case 0x2728:       // save account_reg
-                if (RFIFOREST (fd) < 4 || RFIFOREST (fd) < RFIFOW (fd, 2))
-                    return 0;
-                {
-                    int  acc, p, j;
-                    char str[32];
-                    char temp_str[32];
-                    int  value;
-                    acc = RFIFOL (fd, 4);
-
-                    if (acc > 0)
-                    {
-                        unsigned char buf[RFIFOW (fd, 2) + 1];
-                        for (p = 8, j = 0;
-                             p < RFIFOW (fd, 2) && j < ACCOUNT_REG2_NUM;
-                             p += 36, j++)
-                        {
-                            memcpy (str, RFIFOP (fd, p), 32);
-                            value = RFIFOL (fd, p + 32);
-                            sprintf (tmpsql,
-                                     "DELETE FROM `global_reg_value` WHERE `type`='1' AND `account_id`='%d' AND `str`='%s';",
-                                     acc, jstrescapecpy (temp_str, str));
-                            if (mysql_query (&mysql_handle, tmpsql))
-                            {
-                                printf ("DB server Error - %s\n",
-                                        mysql_error (&mysql_handle));
-                            }
-                            sprintf (tmpsql,
-                                     "INSERT INTO `global_reg_value` (`type`, `account_id`, `str`, `value`) VALUES ( 1 , '%d' , '%s' , '%d');",
-                                     acc, jstrescapecpy (temp_str, str),
-                                     value);
-                            if (mysql_query (&mysql_handle, tmpsql))
-                            {
-                                printf ("DB server Error - %s\n",
-                                        mysql_error (&mysql_handle));
-                            }
-                        }
-
-                        // Send to char
-                        memcpy (WBUFP (buf, 0), RFIFOP (fd, 0),
-                                RFIFOW (fd, 2));
-                        WBUFW (buf, 0) = 0x2729;
-                        charif_sendallwos (fd, buf, WBUFW (buf, 2));
-                    }
-                }
-                RFIFOSKIP (fd, RFIFOW (fd, 2));
-                //printf("login: save account_reg (from char)\n");
-                break;
-
-            case 0x272a:       // Receiving of map-server via char-server a unban resquest (by Yor)
-                if (RFIFOREST (fd) < 6)
-                    return 0;
-                {
-                    int  acc;
-                    acc = RFIFOL (fd, 2);
-                    sprintf (tmpsql,
-                             "SELECT `ban_until` FROM `%s` WHERE `%s` = '%d'",
-                             login_db, login_db_account_id, acc);
-                    if (mysql_query (&mysql_handle, tmpsql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-                    sql_res = mysql_store_result (&mysql_handle);
-                    if (sql_res)
-                    {
-                        sql_row = mysql_fetch_row (sql_res);    //row fetching
-                    }
-                    if (atol (sql_row[0]) != 0)
-                    {
-                        sprintf (tmpsql,
-                                 "UPDATE `%s` SET `ban_until` = '0', `state`='0' WHERE `%s` = '%d'",
-                                 login_db, login_db_account_id, acc);
-                        //query
-                        if (mysql_query (&mysql_handle, tmpsql))
-                        {
-                            printf ("DB server Error - %s\n",
-                                    mysql_error (&mysql_handle));
-                        }
-                        break;
-                    }
-                    RFIFOSKIP (fd, 6);
-                }
-                return 0;
-
-            default:
-                printf ("login: unknown packet %x! (from char).\n",
-                        RFIFOW (fd, 0));
-                session[fd]->eof = 1;
-                return 0;
-        }
-    }
-
-    return 0;
-}
-
-//Lan ip check added by Kashy
-int lan_ip_check (unsigned char *p)
-{
-    int  y;
-    int  lancheck = 1;
-    int  lancharip[4];
-
-    unsigned int k0, k1, k2, k3;
-    sscanf (lan_char_ip, "%d.%d.%d.%d", &k0, &k1, &k2, &k3);
-    lancharip[0] = k0;
-    lancharip[1] = k1;
-    lancharip[2] = k2;
-    lancharip[3] = k3;
-
-    for (y = 0; y < 4; y++)
-    {
-        if ((lancharip[y] & subnetmaski[y]) != (p[y]))
-            lancheck = 0;
-        break;
-    }
-
-    printf ("LAN check: %s.\n",
-            (lancheck) ? "\033[1;32mLAN\033[0m" : "\033[1;31mWAN\033[0m");
-    return lancheck;
-}
-
-//----------------------------------------------------------------------------------------
-// Default packet parsing (normal players or administation/char-server connection requests)
-//----------------------------------------------------------------------------------------
-int parse_login (int fd)
-{
-    //int len;
-
-    MYSQL_RES *sql_res;
-    MYSQL_ROW sql_row = NULL;
-
-    char t_uid[100];
-    //int sql_fields, sql_cnt;
-    struct mmo_account account;
-
-    int  result, i;
-    unsigned char *p = (unsigned char *) &session[fd]->client_addr.sin_addr;
-    char ip[16];
-
-    sprintf (ip, "%d.%d.%d.%d", p[0], p[1], p[2], p[3]);
-
-    if (ipban > 0)
-    {
-        //ip ban
-        //p[0], p[1], p[2], p[3]
-        //request DB connection
-        //check
-        sprintf (tmpsql,
-                 "SELECT count(*) FROM `ipbanlist` WHERE `list` = '%d.*.*.*' OR `list` = '%d.%d.*.*' OR `list` = '%d.%d.%d.*' OR `list` = '%d.%d.%d.%d'",
-                 p[0], p[0], p[1], p[0], p[1], p[2], p[0], p[1], p[2], p[3]);
-        if (mysql_query (&mysql_handle, tmpsql))
-        {
-            printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        }
-
-        sql_res = mysql_store_result (&mysql_handle);
-        sql_row = mysql_fetch_row (sql_res);    //row fetching
-
-        if (atoi (sql_row[0]) > 0)
-        {
-            // ip ban ok.
-            printf ("packet from banned ip : %d.%d.%d.%d" RETCODE, p[0], p[1],
-                    p[2], p[3]);
-            sprintf (tmpsql,
-                     "INSERT INTO `%s`(`time`,`ip`,`user`,`rcode`,`log`) VALUES (NOW(), '%d.%d.%d.%d', 'unknown','-3', 'ip banned')",
-                     loginlog_db, p[0], p[1], p[2], p[3]);
-
-            // query
-            if (mysql_query (&mysql_handle, tmpsql))
-            {
-                printf ("DB server Error - %s\n",
-                        mysql_error (&mysql_handle));
-            }
-            printf ("close session connection...\n");
-
-            // close connection
-            session[fd]->eof = 1;
-
-        }
-        else
-        {
-            printf ("packet from ip (ban check ok) : %d.%d.%d.%d" RETCODE,
-                    p[0], p[1], p[2], p[3]);
-        }
-        mysql_free_result (sql_res);
-    }
-
-    if (session[fd]->eof)
-    {
-        for (i = 0; i < MAX_SERVERS; i++)
-            if (server_fd[i] == fd)
-                server_fd[i] = -1;
-        close (fd);
-        delete_session (fd);
-        return 0;
-    }
-
-    while (RFIFOREST (fd) >= 2)
-    {
-        printf ("parse_login : %d %d packet case=%x\n", fd, RFIFOREST (fd),
-                RFIFOW (fd, 0));
-
-        switch (RFIFOW (fd, 0))
-        {
-            case 0x200:        // New alive packet: structure: 0x200 <account.userid>.24B. used to verify if client is always alive.
-                if (RFIFOREST (fd) < 26)
-                    return 0;
-                RFIFOSKIP (fd, 26);
-                break;
-
-            case 0x204:        // New alive packet: structure: 0x204 <encrypted.account.userid>.16B. (new ragexe from 22 june 2004)
-                if (RFIFOREST (fd) < 18)
-                    return 0;
-                RFIFOSKIP (fd, 18);
-                break;
-
-            case 0x64:         // request client login
-            case 0x01dd:       // request client login with encrypt
-                if (RFIFOREST (fd) < ((RFIFOW (fd, 0) == 0x64) ? 55 : 47))
-                    return 0;
-
-                printf ("client connection request %s from %d.%d.%d.%d\n",
-                        RFIFOP (fd, 6), p[0], p[1], p[2], p[3]);
-
-                account.userid = RFIFOP (fd, 6);
-                account.passwd = RFIFOP (fd, 30);
-#ifdef PASSWORDENC
-                account.passwdenc =
-                    (RFIFOW (fd, 0) == 0x64) ? 0 : PASSWORDENC;
-#else
-                account.passwdenc = 0;
-#endif
-                result = mmo_auth (&account, fd);
-
-                jstrescapecpy (t_uid, RFIFOP (fd, 6));
-                if (result == -1)
-                {
-                    int  gm_level = isGM (account.account_id);
-                    if (min_level_to_connect > gm_level)
-                    {
-                        WFIFOW (fd, 0) = 0x81;
-                        WFIFOL (fd, 2) = 1; // 01 = Server closed
-                        WFIFOSET (fd, 3);
-                    }
-                    else
-                    {
-                        if (p[0] != 127)
-                        {
-                            sprintf (tmpsql,
-                                     "INSERT INTO `%s`(`time`,`ip`,`user`,`rcode`,`log`) VALUES (NOW(), '%d.%d.%d.%d', '%s','100', 'login ok')",
-                                     loginlog_db, p[0], p[1], p[2], p[3],
-                                     t_uid);
-                            //query
-                            if (mysql_query (&mysql_handle, tmpsql))
-                            {
-                                printf ("DB server Error - %s\n",
-                                        mysql_error (&mysql_handle));
-                            }
-                        }
-                        if (gm_level)
-                            printf
-                                ("Connection of the GM (level:%d) account '%s' accepted.\n",
-                                 gm_level, account.userid);
-                        else
-                            printf
-                                ("Connection of the account '%s' accepted.\n",
-                                 account.userid);
-                        server_num = 0;
-                        for (i = 0; i < MAX_SERVERS; i++)
-                        {
-                            if (server_fd[i] >= 0)
-                            {
-                                //Lan check added by Kashy
-                                if (lan_ip_check (p))
-                                    WFIFOL (fd, 47 + server_num * 32) =
-                                        inet_addr (lan_char_ip);
-                                else
-                                    WFIFOL (fd, 47 + server_num * 32) =
-                                        server[i].ip;
-                                WFIFOW (fd, 47 + server_num * 32 + 4) =
-                                    server[i].port;
-                                memcpy (WFIFOP (fd, 47 + server_num * 32 + 6),
-                                        server[i].name, 20);
-                                WFIFOW (fd, 47 + server_num * 32 + 26) =
-                                    server[i].users;
-                                WFIFOW (fd, 47 + server_num * 32 + 28) =
-                                    server[i].maintenance;
-                                WFIFOW (fd, 47 + server_num * 32 + 30) =
-                                    server[i].new;
-                                server_num++;
-                            }
-                        }
-                        // if at least 1 char-server
-                        if (server_num > 0)
-                        {
-                            WFIFOW (fd, 0) = 0x69;
-                            WFIFOW (fd, 2) = 47 + 32 * server_num;
-                            WFIFOL (fd, 4) = account.login_id1;
-                            WFIFOL (fd, 8) = account.account_id;
-                            WFIFOL (fd, 12) = account.login_id2;
-                            WFIFOL (fd, 16) = 0;
-                            memcpy (WFIFOP (fd, 20), account.lastlogin, 24);
-                            WFIFOB (fd, 46) = account.sex;
-                            WFIFOSET (fd, 47 + 32 * server_num);
-                            if (auth_fifo_pos >= AUTH_FIFO_SIZE)
-                                auth_fifo_pos = 0;
-                            auth_fifo[auth_fifo_pos].account_id =
-                                account.account_id;
-                            auth_fifo[auth_fifo_pos].login_id1 =
-                                account.login_id1;
-                            auth_fifo[auth_fifo_pos].login_id2 =
-                                account.login_id2;
-                            auth_fifo[auth_fifo_pos].sex = account.sex;
-                            auth_fifo[auth_fifo_pos].delflag = 0;
-                            auth_fifo[auth_fifo_pos].ip =
-                                session[fd]->client_addr.sin_addr.s_addr;
-                            auth_fifo_pos++;
-                        }
-                        else
-                        {
-                            WFIFOW (fd, 0) = 0x81;
-                            WFIFOL (fd, 2) = 1; // 01 = Server closed
-                            WFIFOSET (fd, 3);
-                        }
-                    }
-                }
-                else
-                {
-                    char tmp_sql[512];
-                    char error[64];
-                    sprintf (tmp_sql,
-                             "INSERT INTO `%s`(`time`,`ip`,`user`,`rcode`,`log`) VALUES (NOW(), '%d.%d.%d.%d', '%s', '%d','login failed : %%s')",
-                             loginlog_db, p[0], p[1], p[2], p[3], t_uid,
-                             result);
-                    switch ((result + 1))
-                    {
-                        case -2:   //-3 = Account Banned
-                            sprintf (tmpsql, tmp_sql, "Account banned.");
-                            sprintf (error, "Account banned.");
-                            break;
-                        case -1:   //-2 = Dynamic Ban
-                            sprintf (tmpsql, tmp_sql,
-                                     "dynamic ban (ip and account).");
-                            sprintf (error, "dynamic ban (ip and account).");
-                            break;
-                        case 1:    // 0 = Unregistered ID
-                            sprintf (tmpsql, tmp_sql, "Unregisterd ID.");
-                            sprintf (error, "Unregisterd ID.");
-                            break;
-                        case 2:    // 1 = Incorrect Password
-                            sprintf (tmpsql, tmp_sql, "Incorrect Password.");
-                            sprintf (error, "Incorrect Password.");
-                            break;
-                        case 3:    // 2 = This ID is expired
-                            sprintf (tmpsql, tmp_sql, "Account Expired.");
-                            sprintf (error, "Account Expired.");
-                            break;
-                        case 4:    // 3 = Rejected from Server
-                            sprintf (tmpsql, tmp_sql,
-                                     "Rejected from server.");
-                            sprintf (error, "Rejected from server.");
-                            break;
-                        case 5:    // 4 = You have been blocked by the GM Team
-                            sprintf (tmpsql, tmp_sql, "Blocked by GM.");
-                            sprintf (error, "Blocked by GM.");
-                            break;
-                        case 6:    // 5 = Your Game's EXE file is not the latest version
-                            sprintf (tmpsql, tmp_sql, "Not latest game EXE.");
-                            sprintf (error, "Not latest game EXE.");
-                            break;
-                        case 7:    // 6 = Your are Prohibited to log in until %s
-                            sprintf (tmpsql, tmp_sql, "Banned.");
-                            sprintf (error, "Banned.");
-                            break;
-                        case 8:    // 7 = Server is jammed due to over populated
-                            sprintf (tmpsql, tmp_sql,
-                                     "Server Over-population.");
-                            sprintf (error, "Server Over-population.");
-                            break;
-                        case 9:    // 8 = No MSG (actually, all states after 9 except 99 are No MSG, use only this)
-                            sprintf (tmpsql, tmp_sql, " ");
-                            sprintf (error, " ");
-                            break;
-                        case 100:  // 99 = This ID has been totally erased
-                            sprintf (tmpsql, tmp_sql, "Account gone.");
-                            sprintf (error, "Account gone.");
-                            break;
-                        default:
-                            sprintf (tmpsql, tmp_sql, "Uknown Error.");
-                            sprintf (error, "Uknown Error.");
-                            break;
-                    }
-                    //query
-                    if (mysql_query (&mysql_handle, tmpsql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-                    if ((result == 1) && (dynamic_pass_failure_ban != 0))
-                    {           // failed password
-                        sprintf (tmpsql, "SELECT count(*) FROM `%s` WHERE `ip` = '%d.%d.%d.%d' AND `rcode` = '1' AND `time` > NOW() - INTERVAL %d MINUTE", loginlog_db, p[0], p[1], p[2], p[3], dynamic_pass_failure_ban_time); //how many times filed account? in one ip.
-                        if (mysql_query (&mysql_handle, tmpsql))
-                        {
-                            printf ("DB server Error - %s\n",
-                                    mysql_error (&mysql_handle));
-                        }
-                        //check query result
-                        sql_res = mysql_store_result (&mysql_handle);
-                        sql_row = mysql_fetch_row (sql_res);    //row fetching
-
-                        if (atoi (sql_row[0]) >=
-                            dynamic_pass_failure_ban_how_many)
-                        {
-                            sprintf (tmpsql,
-                                     "INSERT INTO `ipbanlist`(`list`,`btime`,`rtime`,`reason`) VALUES ('%d.%d.%d.*', NOW() , NOW() +  INTERVAL %d MINUTE ,'Password error ban: %s')",
-                                     p[0], p[1], p[2],
-                                     dynamic_pass_failure_ban_how_long,
-                                     t_uid);
-                            if (mysql_query (&mysql_handle, tmpsql))
-                            {
-                                printf ("DB server Error - %s\n",
-                                        mysql_error (&mysql_handle));
-                            }
-                        }
-                        mysql_free_result (sql_res);
-                    }
-                    else if (result == -2)
-                    {           //dynamic banned - add ip to ban list.
-                        sprintf (tmpsql,
-                                 "INSERT INTO `ipbanlist`(`list`,`btime`,`rtime`,`reason`) VALUES ('%d.%d.%d.*', NOW() , NOW() +  INTERVAL 1 MONTH ,'Dynamic banned user id : %s')",
-                                 p[0], p[1], p[2], t_uid);
-                        if (mysql_query (&mysql_handle, tmpsql))
-                        {
-                            printf ("DB server Error - %s\n",
-                                    mysql_error (&mysql_handle));
-                        }
-                        result = -3;
-                    }
-
-                    sprintf (tmpsql,
-                             "SELECT `ban_until` FROM `%s` WHERE `%s` = '%s'",
-                             login_db, login_db_userid, t_uid);
-                    if (mysql_query (&mysql_handle, tmpsql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-                    sql_res = mysql_store_result (&mysql_handle);
-                    if (sql_res)
-                    {
-                        sql_row = mysql_fetch_row (sql_res);    //row fetching
-                    }
-                    //cannot connect login failed
-                    memset (WFIFOP (fd, 0), '\0', 23);
-                    WFIFOW (fd, 0) = 0x6a;
-                    WFIFOB (fd, 2) = result;
-                    if (result == 6)
-                    {           // 6 = Your are Prohibited to log in until %s
-                        if (atol (sql_row[0]) != 0)
-                        {       // if account is banned, we send ban timestamp
-                            char tmpstr[256];
-                            time_t ban_until_time;
-                            ban_until_time = atol (sql_row[0]);
-                            strftime (tmpstr, 20, date_format,
-                                      gmtime (&ban_until_time));
-                            tmpstr[19] = '\0';
-                            memcpy (WFIFOP (fd, 3), tmpstr, 20);
-                        }
-                        else
-                        {       // we send error message
-                            memcpy (WFIFOP (fd, 3), error, 20);
-                        }
-                    }
-                    WFIFOSET (fd, 23);
-                }
-                RFIFOSKIP (fd, (RFIFOW (fd, 0) == 0x64) ? 55 : 47);
-                break;
-
-            case 0x01db:       // request password key
-                if (session[fd]->session_data)
-                {
-                    printf
-                        ("login: abnormal request of MD5 key (already opened session).\n");
-                    session[fd]->eof = 1;
-                    return 0;
-                }
-                printf ("Request Password key -%s\n", md5key);
-                RFIFOSKIP (fd, 2);
-                WFIFOW (fd, 0) = 0x01dc;
-                WFIFOW (fd, 2) = 4 + md5keylen;
-                memcpy (WFIFOP (fd, 4), md5key, md5keylen);
-                WFIFOSET (fd, WFIFOW (fd, 2));
-                break;
-
-            case 0x2710:       // request Char-server connection
-                if (RFIFOREST (fd) < 86)
-                    return 0;
-                {
-                    sprintf (tmpsql,
-                             "INSERT INTO `%s`(`time`,`ip`,`user`,`rcode`,`log`) VALUES (NOW(), '%d.%d.%d.%d', '%s@%s','100', 'charserver - %s@%d.%d.%d.%d:%d')",
-                             loginlog_db, p[0], p[1], p[2], p[3], RFIFOP (fd,
-                                                                          2),
-                             RFIFOP (fd, 60), RFIFOP (fd, 60), RFIFOB (fd,
-                                                                       54),
-                             RFIFOB (fd, 55), RFIFOB (fd, 56), RFIFOB (fd,
-                                                                       57),
-                             RFIFOW (fd, 58));
-
-                    //query
-                    if (mysql_query (&mysql_handle, tmpsql))
-                    {
-                        printf ("DB server Error - %s\n",
-                                mysql_error (&mysql_handle));
-                    }
-                    printf
-                        ("server connection request %s @ %d.%d.%d.%d:%d (%d.%d.%d.%d)\n",
-                         RFIFOP (fd, 60), RFIFOB (fd, 54), RFIFOB (fd, 55),
-                         RFIFOB (fd, 56), RFIFOB (fd, 57), RFIFOW (fd, 58),
-                         p[0], p[1], p[2], p[3]);
-                    unsigned char *server_name;
-                    account.userid = RFIFOP (fd, 2);
-                    account.passwd = RFIFOP (fd, 26);
-                    account.passwdenc = 0;
-                    server_name = RFIFOP (fd, 60);
-                    result = mmo_auth (&account, fd);
-                    //printf("Result: %d - Sex: %d - Account ID: %d\n",result,account.sex,(int) account.account_id);
-
-                    if (result == -1 && account.sex == 2
-                        && account.account_id < MAX_SERVERS
-                        && server_fd[account.account_id] == -1)
-                    {
-                        printf
-                            ("Connection of the char-server '%s' accepted.\n",
-                             server_name);
-                        memset (&server[account.account_id], 0,
-                                sizeof (struct mmo_char_server));
-                        server[account.account_id].ip = RFIFOL (fd, 54);
-                        server[account.account_id].port = RFIFOW (fd, 58);
-                        memcpy (server[account.account_id].name,
-                                RFIFOP (fd, 60), 20);
-                        server[account.account_id].users = 0;
-                        server[account.account_id].maintenance =
-                            RFIFOW (fd, 82);
-                        server[account.account_id].new = RFIFOW (fd, 84);
-                        server_fd[account.account_id] = fd;
-                        if (anti_freeze_enable)
-                            server_freezeflag[account.account_id] = 5;  // Char-server anti-freeze system. Counter. 5 ok, 4...0 freezed
-                        sprintf (tmpsql,
-                                 "DELETE FROM `sstatus` WHERE `index`='%ld'",
-                                 account.account_id);
-                        //query
-                        if (mysql_query (&mysql_handle, tmpsql))
-                        {
-                            printf ("DB server Error - %s\n",
-                                    mysql_error (&mysql_handle));
-                        }
-
-                        jstrescapecpy (t_uid,
-                                       server[account.account_id].name);
-                        sprintf (tmpsql,
-                                 "INSERT INTO `sstatus`(`index`,`name`,`user`) VALUES ( '%ld', '%s', '%d')",
-                                 account.account_id,
-                                 server[account.account_id].name, 0);
-                        //query
-                        if (mysql_query (&mysql_handle, tmpsql))
-                        {
-                            printf ("DB server Error - %s\n",
-                                    mysql_error (&mysql_handle));
-                        }
-                        WFIFOW (fd, 0) = 0x2711;
-                        WFIFOB (fd, 2) = 0;
-                        WFIFOSET (fd, 3);
-                        session[fd]->func_parse = parse_fromchar;
-                        realloc_fifo (fd, FIFOSIZE_SERVERLINK,
-                                      FIFOSIZE_SERVERLINK);
-                    }
-                    else
-                    {
-                        WFIFOW (fd, 0) = 0x2711;
-                        WFIFOB (fd, 2) = 3;
-                        WFIFOSET (fd, 3);
-                    }
-                }
-                RFIFOSKIP (fd, 86);
-                return 0;
-
-            case 0x7530:       // request Athena information
-                WFIFOW (fd, 0) = 0x7531;
-                WFIFOB (fd, 2) = ATHENA_MAJOR_VERSION;
-                WFIFOB (fd, 3) = ATHENA_MINOR_VERSION;
-                WFIFOB (fd, 4) = ATHENA_REVISION;
-                WFIFOB (fd, 5) = ATHENA_RELEASE_FLAG;
-                WFIFOB (fd, 6) = ATHENA_OFFICIAL_FLAG;
-                WFIFOB (fd, 7) = ATHENA_SERVER_LOGIN;
-                WFIFOW (fd, 8) = ATHENA_MOD_VERSION;
-                WFIFOSET (fd, 10);
-                RFIFOSKIP (fd, 2);
-                printf ("Athena version check...\n");
-                break;
-
-            case 0x7532:
-            default:
-                printf ("End of connection (ip: %s)" RETCODE, ip);
-                session[fd]->eof = 1;
-                return 0;
-        }
-    }
-
-    return 0;
-}
-
-//-------------------------------------------------
-// Return numerical value of a switch configuration
-// on/off, english, franais, deutsch, espaol
-//-------------------------------------------------
-int config_switch (const char *str)
-{
-    if (strcmpi (str, "on") == 0 || strcmpi (str, "yes") == 0
-        || strcmpi (str, "oui") == 0 || strcmpi (str, "ja") == 0
-        || strcmpi (str, "si") == 0)
-        return 1;
-    if (strcmpi (str, "off") == 0 || strcmpi (str, "no") == 0
-        || strcmpi (str, "non") == 0 || strcmpi (str, "nein") == 0)
-        return 0;
-
-    return atoi (str);
-}
-
-//Lan Support conf reading added by Kashy
-int login_lan_config_read (const char *lancfgName)
-{
-    int  i;
-    char subnetmask[128];
-    char line[1024], w1[1024], w2[1024];
-    FILE *fp;
-
-    fp = fopen_ (lancfgName, "r");
-
-    if (fp == NULL)
-    {
-        printf ("file not found: %s\n", lancfgName);
-        return 1;
-    }
-    printf ("Start reading of Lan Support configuration file\n");
-    while (fgets (line, sizeof (line) - 1, fp))
-    {
-        if (line[0] == '/' && line[1] == '/')
-            continue;
-
-        i = sscanf (line, "%[^:]: %[^\r\n]", w1, w2);
-        if (i != 2)
-            continue;
-
-        else if (strcmpi (w1, "lan_char_ip") == 0)
-        {
-            strcpy (lan_char_ip, w2);
-            printf ("set Lan_Char_IP : %s\n", w2);
-        }
-
-        else if (strcmpi (w1, "subnetmask") == 0)
-        {
-            strcpy (subnetmask, w2);
-            unsigned int k0, k1, k2, k3;
-            sscanf (subnetmask, "%d.%d.%d.%d", &k0, &k1, &k2, &k3);
-            subnetmaski[0] = k0;
-            subnetmaski[1] = k1;
-            subnetmaski[2] = k2;
-            subnetmaski[3] = k3;
-            printf ("set subnetmask : %s\n", w2);
-        }
-    }
-    fclose_ (fp);
-
-    {
-        unsigned int a0, a1, a2, a3;
-        unsigned char p[4];
-        sscanf (lan_char_ip, "%d.%d.%d.%d", &a0, &a1, &a2, &a3);
-        p[0] = a0;
-        p[1] = a1;
-        p[2] = a2;
-        p[3] = a3;
-        printf ("LAN test of LAN IP of the char-server: ");
-        if (lan_ip_check (p) == 0)
-        {
-            printf
-                ("\033[1;31m***ERROR: LAN IP of the char-server doesn't belong to the specified Sub-network\033[0m\n");
-        }
-    }
-
-    printf ("End reading of Lan Support configuration file\n");
-
-    return 0;
-}
-
-//-----------------------------------------------------
-//BANNED IP CHECK.
-//-----------------------------------------------------
-int ip_ban_check (int tid, unsigned int tick, int id, int data)
-{
-
-    //query
-    if (mysql_query
-        (&mysql_handle, "DELETE FROM `ipbanlist` WHERE `rtime` <= NOW()"))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-
-    return 0;
-}
-
-//-----------------------------------------------------
-// reading configuration
-//-----------------------------------------------------
-int login_config_read (const char *cfgName)
-{
-    int  i;
-    char line[1024], w1[1024], w2[1024];
-    FILE *fp;
-
-    fp = fopen_ (cfgName, "r");
-
-    if (fp == NULL)
-    {
-        printf ("Configuration file (%s) not found.\n", cfgName);
-        return 1;
-    }
-    printf ("start reading configuration...\n");
-    while (fgets (line, sizeof (line) - 1, fp))
-    {
-        if (line[0] == '/' && line[1] == '/')
-            continue;
-
-        i = sscanf (line, "%[^:]: %[^\r\n]", w1, w2);
-        if (i != 2)
-            continue;
-
-        else if (strcmpi (w1, "login_port") == 0)
-        {
-            login_port = atoi (w2);
-            printf ("set login_port : %s\n", w2);
-        }
-        else if (strcmpi (w1, "ipban") == 0)
-        {
-            ipban = atoi (w2);
-            printf ("set ipban : %d\n", ipban);
-        }
-        //account ban -> ip ban
-        else if (strcmpi (w1, "dynamic_account_ban") == 0)
-        {
-            dynamic_account_ban = atoi (w2);
-            printf ("set dynamic_account_ban : %d\n", dynamic_account_ban);
-        }
-        else if (strcmpi (w1, "dynamic_account_ban_class") == 0)
-        {
-            dynamic_account_ban_class = atoi (w2);
-            printf ("set dynamic_account_ban_class : %d\n",
-                    dynamic_account_ban_class);
-        }
-        //dynamic password error ban
-        else if (strcmpi (w1, "dynamic_pass_failure_ban") == 0)
-        {
-            dynamic_pass_failure_ban = atoi (w2);
-            printf ("set dynamic_pass_failure_ban : %d\n",
-                    dynamic_pass_failure_ban);
-        }
-        else if (strcmpi (w1, "dynamic_pass_failure_ban_time") == 0)
-        {
-            dynamic_pass_failure_ban_time = atoi (w2);
-            printf ("set dynamic_pass_failure_ban_time : %d\n",
-                    dynamic_pass_failure_ban_time);
-        }
-        else if (strcmpi (w1, "dynamic_pass_failure_ban_how_many") == 0)
-        {
-            dynamic_pass_failure_ban_how_many = atoi (w2);
-            printf ("set dynamic_pass_failure_ban_how_many : %d\n",
-                    dynamic_pass_failure_ban_how_many);
-        }
-        else if (strcmpi (w1, "dynamic_pass_failure_ban_how_long") == 0)
-        {
-            dynamic_pass_failure_ban_how_long = atoi (w2);
-            printf ("set dynamic_pass_failure_ban_how_long : %d\n",
-                    dynamic_pass_failure_ban_how_long);
-        }
-        else if (strcmpi (w1, "anti_freeze_enable") == 0)
-        {
-            anti_freeze_enable = config_switch (w2);
-        }
-        else if (strcmpi (w1, "anti_freeze_interval") == 0)
-        {
-            ANTI_FREEZE_INTERVAL = atoi (w2);
-            if (ANTI_FREEZE_INTERVAL < 5)
-                ANTI_FREEZE_INTERVAL = 5;   // minimum 5 seconds
-        }
-        else if (strcmpi (w1, "import") == 0)
-        {
-            login_config_read (w2);
-        }
-        else if (strcmpi (w1, "use_MD5_passwords") == 0)
-        {
-            if (!strcmpi (w2, "yes"))
-            {
-                use_md5_passwds = 1;
-            }
-            else if (!strcmpi (w2, "no"))
-            {
-                use_md5_passwds = 0;
-            }
-            printf ("Using MD5 Passwords: %s \n", w2);
-        }
-        else if (strcmpi (w1, "date_format") == 0)
-        {                       // note: never have more than 19 char for the date!
-            switch (atoi (w2))
-            {
-                case 0:
-                    strcpy (date_format, "%d-%m-%Y %H:%M:%S");  // 31-12-2004 23:59:59
-                    break;
-                case 1:
-                    strcpy (date_format, "%m-%d-%Y %H:%M:%S");  // 12-31-2004 23:59:59
-                    break;
-                case 2:
-                    strcpy (date_format, "%Y-%d-%m %H:%M:%S");  // 2004-31-12 23:59:59
-                    break;
-                case 3:
-                    strcpy (date_format, "%Y-%m-%d %H:%M:%S");  // 2004-12-31 23:59:59
-                    break;
-            }
-        }
-        else if (strcmpi (w1, "min_level_to_connect") == 0)
-        {
-            min_level_to_connect = atoi (w2);
-        }
-        else if (strcmpi (w1, "check_ip_flag") == 0)
-        {
-            check_ip_flag = config_switch (w2);
-        }
-    }
-    fclose_ (fp);
-    printf ("End reading configuration...\n");
-    return 0;
-}
-
-void sql_config_read (const char *cfgName)
-{                               /* Kalaspuff, to get login_db */
-    int  i;
-    char line[1024], w1[1024], w2[1024];
-    printf ("reading configure: %s\n", cfgName);
-    FILE *fp = fopen_ (cfgName, "r");
-    if (fp == NULL)
-    {
-        printf ("file not found: %s\n", cfgName);
-        exit (1);
-    }
-    while (fgets (line, sizeof (line) - 1, fp))
-    {
-        if (line[0] == '/' && line[1] == '/')
-            continue;
-        i = sscanf (line, "%[^:]: %[^\r\n]", w1, w2);
-        if (i != 2)
-            continue;
-        if (strcmpi (w1, "login_db") == 0)
-        {
-            strcpy (login_db, w2);
-        }
-        //add for DB connection
-        else if (strcmpi (w1, "login_server_ip") == 0)
-        {
-            strcpy (login_server_ip, w2);
-            printf ("set login_server_ip : %s\n", w2);
-        }
-        else if (strcmpi (w1, "login_server_port") == 0)
-        {
-            login_server_port = atoi (w2);
-            printf ("set login_server_port : %s\n", w2);
-        }
-        else if (strcmpi (w1, "login_server_id") == 0)
-        {
-            strcpy (login_server_id, w2);
-            printf ("set login_server_id : %s\n", w2);
-        }
-        else if (strcmpi (w1, "login_server_pw") == 0)
-        {
-            strcpy (login_server_pw, w2);
-            printf ("set login_server_pw : %s\n", w2);
-        }
-        else if (strcmpi (w1, "login_server_db") == 0)
-        {
-            strcpy (login_server_db, w2);
-            printf ("set login_server_db : %s\n", w2);
-        }
-        //added for custom column names for custom login table
-        else if (strcmpi (w1, "login_db_account_id") == 0)
-        {
-            strcpy (login_db_account_id, w2);
-        }
-        else if (strcmpi (w1, "login_db_userid") == 0)
-        {
-            strcpy (login_db_userid, w2);
-        }
-        else if (strcmpi (w1, "login_db_user_pass") == 0)
-        {
-            strcpy (login_db_user_pass, w2);
-        }
-        else if (strcmpi (w1, "login_db_level") == 0)
-        {
-            strcpy (login_db_level, w2);
-        }
-        //end of custom table config
-        else if (strcmpi (w1, "loginlog_db") == 0)
-        {
-            strcpy (loginlog_db, w2);
-        }
-    }
-    fclose_ (fp);
-    printf ("reading configure done.....\n");
-}
-
-int do_init (int argc, char **argv)
-{
-    //initialize login server
-    int  i;
-
-    //read login configue
-    login_config_read ((argc > 1) ? argv[1] : LOGIN_CONF_NAME);
-    sql_config_read (SQL_CONF_NAME);
-    login_lan_config_read ((argc > 1) ? argv[1] : LAN_CONF_NAME);
-    //Generate Passworded Key.
-    printf ("memset md5key \n");
-    memset (md5key, 0, sizeof (md5key));
-    printf ("memset md5key complete\n");
-    printf ("memset keyleng\n");
-    md5keylen = rand () % 4 + 12;
-    for (i = 0; i < md5keylen; i++)
-        md5key[i] = rand () % 255 + 1;
-    printf ("memset keyleng complete\n");
-
-    printf ("set FIFO Size\n");
-    for (i = 0; i < AUTH_FIFO_SIZE; i++)
-        auth_fifo[i].delflag = 1;
-    printf ("set FIFO Size complete\n");
-
-    printf ("set max servers\n");
-    for (i = 0; i < MAX_SERVERS; i++)
-        server_fd[i] = -1;
-    printf ("set max servers complete\n");
-    //server port open & binding
-
-    login_fd = make_listen_port (login_port);
-
-    //Auth start
-    printf ("Running mmo_auth_sqldb_init()\n");
-    mmo_auth_sqldb_init ();
-    printf ("finished mmo_auth_sqldb_init()\n");
-    //sync account when terminating.
-    //but no need when you using DBMS (mysql)
-    set_termfunc (mmo_db_close);
-
-    //set default parser as parse_login function
-    set_defaultparse (parse_login);
-
-    if (anti_freeze_enable > 0)
-    {
-        add_timer_func_list (char_anti_freeze_system,
-                             "char_anti_freeze_system");
-        i = add_timer_interval (gettick () + 1000, char_anti_freeze_system, 0,
-                                0, ANTI_FREEZE_INTERVAL * 1000);
-    }
-
-    // ban deleter timer - 1 minute term
-    printf ("add interval tic (ip_ban_check)....\n");
-    i = add_timer_interval (gettick () + 10, ip_ban_check, 0, 0, 60 * 1000);
-
-    printf
-        ("The login-server is \033[1;32mready\033[0m (Server is listening on the port %d).\n\n",
-         login_port);
-
-    return 0;
-}
diff --git a/src/login_sql/login.h b/src/login_sql/login.h
deleted file mode 100644
index 7eb3a84..0000000
--- a/src/login_sql/login.h
+++ /dev/null
@@ -1,42 +0,0 @@
-#ifndef _LOGIN_H_
-#define _LOGIN_H_
-
-#define MAX_SERVERS 30
-
-#define LOGIN_CONF_NAME	"conf/login_athena.conf"
-#define SQL_CONF_NAME "conf/inter_athena.conf"
-#define LAN_CONF_NAME     "conf/lan_support.conf"
-
-#define PASSWORDENC		3       // A definition is given when making an encryption password correspond.
-                            // It is 1 at the time of passwordencrypt.
-                            // It is made into 2 at the time of passwordencrypt2.
-                            // When it is made 3, it corresponds to both.
-
-#define START_ACCOUNT_NUM	  2000000
-#define END_ACCOUNT_NUM		100000000
-
-struct mmo_account
-{
-    char *userid;
-    char *passwd;
-    int  passwdenc;
-
-    long account_id;
-    long login_id1;
-    long login_id2;
-    long char_id;
-    char lastlogin[24];
-    int  sex;
-};
-
-struct mmo_char_server
-{
-    char name[20];
-    long ip;
-    short port;
-    int  users;
-    int  maintenance;
-    int  new;
-};
-
-#endif
diff --git a/src/login_sql/make.sh b/src/login_sql/make.sh
deleted file mode 100644
index 198d33b..0000000
--- a/src/login_sql/make.sh
+++ /dev/null
@@ -1,6 +0,0 @@
-#!/bin/sh
-	rsqlt=`rm -rf *.o`
-	gcc -c login.c -I/usr/local/include/mysql/
-	gcc -c md5calc.c -I/usr/local/include/mysql/
-	gcc -c strlib.c
-	gcc -o login-server login.o strlib.o md5calc.o ../common/core.o ../common/socket.o ../common/timer.o ../common/db.o -L/usr/local/lib/mysql/ -lmysqlclient -lz
diff --git a/src/login_sql/md5calc.c b/src/login_sql/md5calc.c
deleted file mode 100644
index 0f0b65d..0000000
--- a/src/login_sql/md5calc.c
+++ /dev/null
@@ -1,292 +0,0 @@
-/***********************************************************
- * md5 calculation algorithm
- *
- * The source code referred to the following URL.
- * http://www.geocities.co.jp/SiliconValley-Oakland/8878/lab17/lab17.html
- *
- ***********************************************************/
-
-#include "md5calc.h"
-#include <string.h>
-#include <stdio.h>
-
-#ifndef UINT_MAX
-#define UINT_MAX 4294967295U
-#endif
-
-// Global variable
-static unsigned int *pX;
-
-// Stirng Table
-static const unsigned int T[] = {
-    0xd76aa478, 0xe8c7b756, 0x242070db, 0xc1bdceee, //0
-    0xf57c0faf, 0x4787c62a, 0xa8304613, 0xfd469501, //4
-    0x698098d8, 0x8b44f7af, 0xffff5bb1, 0x895cd7be, //8
-    0x6b901122, 0xfd987193, 0xa679438e, 0x49b40821, //12
-    0xf61e2562, 0xc040b340, 0x265e5a51, 0xe9b6c7aa, //16
-    0xd62f105d, 0x2441453, 0xd8a1e681, 0xe7d3fbc8,  //20
-    0x21e1cde6, 0xc33707d6, 0xf4d50d87, 0x455a14ed, //24
-    0xa9e3e905, 0xfcefa3f8, 0x676f02d9, 0x8d2a4c8a, //28
-    0xfffa3942, 0x8771f681, 0x6d9d6122, 0xfde5380c, //32
-    0xa4beea44, 0x4bdecfa9, 0xf6bb4b60, 0xbebfbc70, //36
-    0x289b7ec6, 0xeaa127fa, 0xd4ef3085, 0x4881d05,  //40
-    0xd9d4d039, 0xe6db99e5, 0x1fa27cf8, 0xc4ac5665, //44
-    0xf4292244, 0x432aff97, 0xab9423a7, 0xfc93a039, //48
-    0x655b59c3, 0x8f0ccc92, 0xffeff47d, 0x85845dd1, //52
-    0x6fa87e4f, 0xfe2ce6e0, 0xa3014314, 0x4e0811a1, //56
-    0xf7537e82, 0xbd3af235, 0x2ad7d2bb, 0xeb86d391  //60
-};
-
-// ROTATE_LEFT   The left is made to rotate x [ n-bit ]. This is diverted as it is from RFC.
-#define ROTATE_LEFT(x, n) (((x) << (n)) | ((x) >> (32-(n))))
-
-// The function used for other calculation
-static unsigned int F (unsigned int X, unsigned int Y, unsigned int Z)
-{
-    return (X & Y) | (~X & Z);
-}
-
-static unsigned int G (unsigned int X, unsigned int Y, unsigned int Z)
-{
-    return (X & Z) | (Y & ~Z);
-}
-
-static unsigned int H (unsigned int X, unsigned int Y, unsigned int Z)
-{
-    return X ^ Y ^ Z;
-}
-
-static unsigned int I (unsigned int X, unsigned int Y, unsigned int Z)
-{
-    return Y ^ (X | ~Z);
-}
-
-static unsigned int Round (unsigned int a, unsigned int b, unsigned int FGHI,
-                           unsigned int k, unsigned int s, unsigned int i)
-{
-    return b + ROTATE_LEFT (a + FGHI + pX[k] + T[i], s);
-}
-
-static void Round1 (unsigned int *a, unsigned int b, unsigned int c,
-                    unsigned int d, unsigned int k, unsigned int s,
-                    unsigned int i)
-{
-    *a = Round (*a, b, F (b, c, d), k, s, i);
-}
-
-static void Round2 (unsigned int *a, unsigned int b, unsigned int c,
-                    unsigned int d, unsigned int k, unsigned int s,
-                    unsigned int i)
-{
-    *a = Round (*a, b, G (b, c, d), k, s, i);
-}
-
-static void Round3 (unsigned int *a, unsigned int b, unsigned int c,
-                    unsigned int d, unsigned int k, unsigned int s,
-                    unsigned int i)
-{
-    *a = Round (*a, b, H (b, c, d), k, s, i);
-}
-
-static void Round4 (unsigned int *a, unsigned int b, unsigned int c,
-                    unsigned int d, unsigned int k, unsigned int s,
-                    unsigned int i)
-{
-    *a = Round (*a, b, I (b, c, d), k, s, i);
-}
-
-static void MD5_Round_Calculate (const unsigned char *block,
-                                 unsigned int *A2, unsigned int *B2,
-                                 unsigned int *C2, unsigned int *D2)
-{
-    //create X It is since it is required.
-    unsigned int X[16];         //512bit 64byte
-    int  j, k;
-
-    //Save A as AA, B as BB, C as CC, and and D as DD (saving of A, B, C, and D)
-    unsigned int A = *A2, B = *B2, C = *C2, D = *D2;
-    unsigned int AA = A, BB = B, CC = C, DD = D;
-
-    //It is a large region variable reluctantly because of calculation of a round. . . for Round1...4
-    pX = X;
-
-    //Copy block(padding_message) i into X
-    for (j = 0, k = 0; j < 64; j += 4, k++)
-        X[k] = ((unsigned int) block[j])    // 8byte*4 -> 32byte conversion
-            | (((unsigned int) block[j + 1]) << 8)  // A function called Decode as used in the field of RFC
-            | (((unsigned int) block[j + 2]) << 16)
-            | (((unsigned int) block[j + 3]) << 24);
-
-    //Round 1
-    Round1 (&A, B, C, D, 0, 7, 0);
-    Round1 (&D, A, B, C, 1, 12, 1);
-    Round1 (&C, D, A, B, 2, 17, 2);
-    Round1 (&B, C, D, A, 3, 22, 3);
-    Round1 (&A, B, C, D, 4, 7, 4);
-    Round1 (&D, A, B, C, 5, 12, 5);
-    Round1 (&C, D, A, B, 6, 17, 6);
-    Round1 (&B, C, D, A, 7, 22, 7);
-    Round1 (&A, B, C, D, 8, 7, 8);
-    Round1 (&D, A, B, C, 9, 12, 9);
-    Round1 (&C, D, A, B, 10, 17, 10);
-    Round1 (&B, C, D, A, 11, 22, 11);
-    Round1 (&A, B, C, D, 12, 7, 12);
-    Round1 (&D, A, B, C, 13, 12, 13);
-    Round1 (&C, D, A, B, 14, 17, 14);
-    Round1 (&B, C, D, A, 15, 22, 15);
-
-    //Round 2
-    Round2 (&A, B, C, D, 1, 5, 16);
-    Round2 (&D, A, B, C, 6, 9, 17);
-    Round2 (&C, D, A, B, 11, 14, 18);
-    Round2 (&B, C, D, A, 0, 20, 19);
-    Round2 (&A, B, C, D, 5, 5, 20);
-    Round2 (&D, A, B, C, 10, 9, 21);
-    Round2 (&C, D, A, B, 15, 14, 22);
-    Round2 (&B, C, D, A, 4, 20, 23);
-    Round2 (&A, B, C, D, 9, 5, 24);
-    Round2 (&D, A, B, C, 14, 9, 25);
-    Round2 (&C, D, A, B, 3, 14, 26);
-    Round2 (&B, C, D, A, 8, 20, 27);
-    Round2 (&A, B, C, D, 13, 5, 28);
-    Round2 (&D, A, B, C, 2, 9, 29);
-    Round2 (&C, D, A, B, 7, 14, 30);
-    Round2 (&B, C, D, A, 12, 20, 31);
-
-    //Round 3
-    Round3 (&A, B, C, D, 5, 4, 32);
-    Round3 (&D, A, B, C, 8, 11, 33);
-    Round3 (&C, D, A, B, 11, 16, 34);
-    Round3 (&B, C, D, A, 14, 23, 35);
-    Round3 (&A, B, C, D, 1, 4, 36);
-    Round3 (&D, A, B, C, 4, 11, 37);
-    Round3 (&C, D, A, B, 7, 16, 38);
-    Round3 (&B, C, D, A, 10, 23, 39);
-    Round3 (&A, B, C, D, 13, 4, 40);
-    Round3 (&D, A, B, C, 0, 11, 41);
-    Round3 (&C, D, A, B, 3, 16, 42);
-    Round3 (&B, C, D, A, 6, 23, 43);
-    Round3 (&A, B, C, D, 9, 4, 44);
-    Round3 (&D, A, B, C, 12, 11, 45);
-    Round3 (&C, D, A, B, 15, 16, 46);
-    Round3 (&B, C, D, A, 2, 23, 47);
-
-    //Round 4
-    Round4 (&A, B, C, D, 0, 6, 48);
-    Round4 (&D, A, B, C, 7, 10, 49);
-    Round4 (&C, D, A, B, 14, 15, 50);
-    Round4 (&B, C, D, A, 5, 21, 51);
-    Round4 (&A, B, C, D, 12, 6, 52);
-    Round4 (&D, A, B, C, 3, 10, 53);
-    Round4 (&C, D, A, B, 10, 15, 54);
-    Round4 (&B, C, D, A, 1, 21, 55);
-    Round4 (&A, B, C, D, 8, 6, 56);
-    Round4 (&D, A, B, C, 15, 10, 57);
-    Round4 (&C, D, A, B, 6, 15, 58);
-    Round4 (&B, C, D, A, 13, 21, 59);
-    Round4 (&A, B, C, D, 4, 6, 60);
-    Round4 (&D, A, B, C, 11, 10, 61);
-    Round4 (&C, D, A, B, 2, 15, 62);
-    Round4 (&B, C, D, A, 9, 21, 63);
-
-    // Then perform the following additions. (let's add)
-    *A2 = A + AA;
-    *B2 = B + BB;
-    *C2 = C + CC;
-    *D2 = D + DD;
-
-    //The clearance of confidential information
-    memset (pX, 0, sizeof (X));
-}
-
-//-------------------------------------------------------------------
-// The function for the exteriors
-
-/** output is the coded binary in the character sequence which wants to code string. */
-void MD5_String2binary (const char *string, char *output)
-{
-//var
-    /*8bit */
-    unsigned char padding_message[64];  //Extended message   512bit 64byte
-    unsigned char *pstring;     //The position of string in the present scanning notes is held.
-
-//   unsigned char digest[16];
-    /*32bit */
-    unsigned int string_byte_len,   //The byte chief of string is held.
-         string_bit_len,        //The bit length of string is held.
-         copy_len,              //The number of bytes which is used by 1-3 and which remained
-         msg_digest[4];         //Message digest   128bit 4byte
-    unsigned int *A = &msg_digest[0],   //The message digest in accordance with RFC (reference)
-        *B = &msg_digest[1], *C = &msg_digest[2], *D = &msg_digest[3];
-    int  i;
-
-//prog
-    //Step 3.Initialize MD Buffer (although it is the initialization; step 3 of A, B, C, and D -- unavoidable -- a head)
-    *A = 0x67452301;
-    *B = 0xefcdab89;
-    *C = 0x98badcfe;
-    *D = 0x10325476;
-
-    //Step 1.Append Padding Bits (extension of a mark bit)
-    //1-1
-    string_byte_len = strlen (string);  //The byte chief of a character sequence is acquired.
-    pstring = (unsigned char *) string; //The position of the present character sequence is set.
-
-    //1-2  Repeat calculation until length becomes less than 64 bytes.
-    for (i = string_byte_len; 64 <= i; i -= 64, pstring += 64)
-        MD5_Round_Calculate (pstring, A, B, C, D);
-
-    //1-3
-    copy_len = string_byte_len % 64;    //The number of bytes which remained is computed.
-    strncpy ((char *) padding_message, (char *) pstring, copy_len); //A message is copied to an extended bit sequence.
-    memset (padding_message + copy_len, 0, 64 - copy_len);  //It buries by 0 until it becomes extended bit length.
-    padding_message[copy_len] |= 0x80;  //The next of a message is 1.
-
-    //1-4 
-    //If 56 bytes or more (less than 64 bytes) of remainder becomes, it will calculate by extending to 64 bytes.
-    if (56 <= copy_len)
-    {
-        MD5_Round_Calculate (padding_message, A, B, C, D);
-        memset (padding_message, 0, 56);    //56 bytes is newly fill uped with 0.
-    }
-
-    //Step 2.Append Length (the information on length is added)
-    string_bit_len = string_byte_len * 8;   //From the byte chief to bit length (32 bytes of low rank)
-    memcpy (&padding_message[56], &string_bit_len, 4);  //32 bytes of low rank is set.
-
-    //When bit length cannot be expressed in 32 bytes of low rank, it is a beam raising to a higher rank.
-    if (UINT_MAX / 8 < string_byte_len)
-    {
-        unsigned int high = (string_byte_len - UINT_MAX / 8) * 8;
-        memcpy (&padding_message[60], &high, 4);
-    }
-    else
-        memset (&padding_message[60], 0, 4);    //In this case, it is good for a higher rank at 0.
-
-    //Step 4.Process Message in 16-Word Blocks (calculation of MD5)
-    MD5_Round_Calculate (padding_message, A, B, C, D);
-
-    //Step 5.Output (output)
-    memcpy (output, msg_digest, 16);
-//   memcpy (digest, msg_digest, and 16);  //8 byte*4 < - 32byte conversion   A function called Encode as used in the field of RFC
-/*   sprintf(output,
-           "%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x",
-           digest[ 0], digest[ 1], digest[ 2], digest[ 3],
-           digest[ 4], digest[ 5], digest[ 6], digest[ 7],
-           digest[ 8], digest[ 9], digest[10], digest[11],
-           digest[12], digest[13], digest[14], digest[15]);*/
-}
-
-/** output is the coded character sequence in the character sequence which wants to code string. */
-void MD5_String (const char *string, char *output)
-{
-    unsigned char digest[16];
-
-    MD5_String2binary (string, digest);
-    sprintf (output,
-             "%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x",
-             digest[0], digest[1], digest[2], digest[3],
-             digest[4], digest[5], digest[6], digest[7],
-             digest[8], digest[9], digest[10], digest[11],
-             digest[12], digest[13], digest[14], digest[15]);
-}
diff --git a/src/login_sql/md5calc.h b/src/login_sql/md5calc.h
deleted file mode 100644
index 16c122d..0000000
--- a/src/login_sql/md5calc.h
+++ /dev/null
@@ -1,7 +0,0 @@
-#ifndef _MD5CALC_H_
-#define _MD5CALC_H_
-
-void MD5_String (const char *string, char *output);
-void MD5_String2binary (const char *string, char *output);
-
-#endif
diff --git a/src/login_sql/readme.txt b/src/login_sql/readme.txt
deleted file mode 100644
index b945af7..0000000
--- a/src/login_sql/readme.txt
+++ /dev/null
@@ -1,120 +0,0 @@
-// Encoded UTF-8
-//---------------------------------------------
-// 007 - by Jazz
-1. 0590 official version.
-
-//---------------------------------------------
-// 006 - by Jazz
-1.  IP.
-2. login_athena.conf
-
-//---------------------------------------------
-// 005 - by Jazz
-1.  ID IP.
-2. .
-
-//---------------------------------------------
-// 004 - by Jazz
-1. aphostropy . .
-2. SQL.
-3. server  SQL.
-
-//---------------------------------------------
-// 003 - by Jazz
-1.  DB.
-2. IP.
-
-//---------------------------------------------
-// 002 - by Jazz
-1. .
-
-//---------------------------------------------
-// 001 - by Jazz
-1.  version.
-
-
-// notice some..
-In this program, new parts are under BSD License.
-and imported parts are under GPL as athena did.
-
-this program is not public license. but modification and editing are
-unlimit permitted. but auther don't have any responsibility on that.
-
-this realase does not gurantee working perfectly. and, I would
-answer neither that question nor technical one.
-
-I use...
-P4 2.4Gh/512MB/WinXP/cygwin
-
-athena is under GPL license.
-Ragnarok is Gravity's trademark.
-login-db for athena is BSD license except code from original athena.
-cygwin is Redhat's trademark.
-
-// About compile.
-You need mysqlclient library to compile this. You can get this by
-compiling mysql source.
-
-"-lmysqlclient" option needed when you did compile.
-
-some patch need on mysql when you did compile under cygwin.
-
-//   
-
-     BSD    .
- import    athena GPL   .
-
-  public license .  , , 
-       .
-
-      .   
-    .
-
-    .
-
- 
-P4 2.4Gh/512MB/WinXP/cygwin
-
-athena GPL   .
-Ragnarok Gravity trademark.
-login-db for athena athena    BSD  .
-cygwin Redhat trademark.
-
-//  .
-
-    mysqlclient  library .
- mysql    .
-
- -lmysqlclient  .
-
-cygwin    .
-
-// 
-
- BSD .
- import  athena GPL .
-
- public license. , , 
-.
-
-. 
-.
-
-.
-
-
-P4 2.4Gh/512MB/WinXP/cygwin
-
-athena GPL .
-Ragnarok Gravity trademark.
-login-db for athena athena BSD .
-cygwin Redhat trademark.
-
-// .
-
- mysqlclient library.
- mysql.
-
- -lmysqlclient .
-
-cygwin.
\ No newline at end of file
diff --git a/src/login_sql/strlib.c b/src/login_sql/strlib.c
deleted file mode 100644
index 5c87ef6..0000000
--- a/src/login_sql/strlib.c
+++ /dev/null
@@ -1,64 +0,0 @@
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-
-#include "strlib.h"
-#include "utils.h"
-
-//-----------------------------------------------
-// string lib.
-unsigned char *jstrescape (unsigned char *pt)
-{
-    //copy from here
-    unsigned char *ptr;
-    int  i = 0, j = 0;
-
-    //copy string to temporary
-    CREATE (ptr, char, J_MAX_MALLOC_SIZE);
-    strcpy (ptr, pt);
-
-    while (ptr[i] != '\0')
-    {
-        switch (ptr[i])
-        {
-            case '\'':
-                pt[j++] = '\\';
-                pt[j++] = ptr[i++];
-                break;
-            case '\\':
-                pt[j++] = '\\';
-                pt[j++] = ptr[i++];
-                break;
-            default:
-                pt[j++] = ptr[i++];
-        }
-    }
-    pt[j++] = '\0';
-    free (ptr);
-    return (unsigned char *) &pt[0];
-}
-
-unsigned char *jstrescapecpy (unsigned char *pt, unsigned char *spt)
-{
-    //copy from here
-    int  i = 0, j = 0;
-
-    while (spt[i] != '\0')
-    {
-        switch (spt[i])
-        {
-            case '\'':
-                pt[j++] = '\\';
-                pt[j++] = spt[i++];
-                break;
-            case '\\':
-                pt[j++] = '\\';
-                pt[j++] = spt[i++];
-                break;
-            default:
-                pt[j++] = spt[i++];
-        }
-    }
-    pt[j++] = '\0';
-    return (unsigned char *) &pt[0];
-}
diff --git a/src/login_sql/strlib.h b/src/login_sql/strlib.h
deleted file mode 100644
index fadd30f..0000000
--- a/src/login_sql/strlib.h
+++ /dev/null
@@ -1,9 +0,0 @@
-#ifndef _J_STR_LIB_H_
-#define _J_STR_LIB_H_
-#define J_MAX_MALLOC_SIZE 65535
-// String function library.
-// code by Jioh L. Jung (ziozzang@4wish.net)
-// This code is under license "BSD"
-unsigned char *jstrescape (unsigned char *pt);
-unsigned char *jstrescapecpy (unsigned char *pt, unsigned char *spt);
-#endif
diff --git a/src/login_sql/timer.h b/src/login_sql/timer.h
deleted file mode 100644
index 8abc259..0000000
--- a/src/login_sql/timer.h
+++ /dev/null
@@ -1,45 +0,0 @@
-// original : core.h 2003/03/14 11:55:25 Rev 1.4
-
-#ifndef	_TIMER_H_
-#define	_TIMER_H_
-
-#define BASE_TICK 5
-
-#define TIMER_ONCE_AUTODEL 1
-#define TIMER_INTERVAL 2
-#define TIMER_REMOVE_HEAP 16
-
-#define DIFF_TICK(a,b) ((int)((a)-(b)))
-
-// Struct declaration
-
-struct TimerData
-{
-    unsigned int tick;
-    int  (*func) (int, unsigned int, int, int);
-    int  id;
-    int  data;
-    int  type;
-    int  interval;
-    int  heap_pos;
-};
-
-// Function prototype declaration
-
-unsigned int gettick_nocache (void);
-unsigned int gettick (void);
-
-int  add_timer (unsigned int, int (*)(int, unsigned int, int, int), int, int);
-int  add_timer_interval (unsigned int, int (*)(int, unsigned int, int, int),
-                         int, int, int);
-int  delete_timer (int, int (*)(int, unsigned int, int, int));
-
-int  addtick_timer (int tid, unsigned int tick);
-struct TimerData *get_timer (int tid);
-
-int  do_timer (unsigned int tick);
-
-int  add_timer_func_list (int (*)(int, unsigned int, int, int), char *);
-char *search_timer_func_list (int (*)(int, unsigned int, int, int));
-
-#endif // _TIMER_H_
diff --git a/src/map/clif.c b/src/map/clif.c
index d3c59fc..ee64515 100644
--- a/src/map/clif.c
+++ b/src/map/clif.c
@@ -7331,7 +7331,7 @@ void clif_parse_GetCharNameRequest (int fd, struct map_session_data *sd)
             struct guild *g = NULL;
             struct party *p = NULL;
 
-            char *guild_name = "", *guild_pos = "", *party_name = "";
+            char *guild_name = 0, *guild_pos = 0, *party_name = 0;
 
             int send = 0;
 
@@ -7360,12 +7360,25 @@ void clif_parse_GetCharNameRequest (int fd, struct map_session_data *sd)
             {
                 WFIFOW (fd, 0) = 0x195;
                 WFIFOL (fd, 2) = account_id;
-                memcpy (WFIFOP (fd, 6), party_name, 24);
-                memcpy (WFIFOP (fd, 30), guild_name, 24);
-                memcpy (WFIFOP (fd, 54), guild_pos, 24);
-                memcpy (WFIFOP (fd, 78), guild_pos, 24); // We send this value twice because the client expects it
+                if (party_name)
+                    memcpy (WFIFOP (fd, 6), party_name, 24);
+                else
+                    *(WFIFOP (fd, 6)) = 0;
+                if (guild_name)
+                    memcpy (WFIFOP (fd, 30), guild_name, 24);
+                else
+                    *(WFIFOP (fd, 30)) = 0;
+                if (guild_pos)
+                {
+                    memcpy (WFIFOP (fd, 54), guild_pos, 24);
+                    memcpy (WFIFOP (fd, 78), guild_pos, 24); // We send this value twice because the client expects it
+                }
+                else
+                {
+                    *(WFIFOP (fd, 54)) = 0;
+                    *(WFIFOP (fd, 78)) = 0;
+                }
                 WFIFOSET (fd, packet_len_table[0x195]);
-
             }
 
 #if 0
diff --git a/src/map/npc.c b/src/map/npc.c
index 7e45a95..cf79dff 100644
--- a/src/map/npc.c
+++ b/src/map/npc.c
@@ -1016,7 +1016,6 @@ int npc_untouch_areanpc (struct map_session_data *sd)
 {
     nullpo_retr (1, sd);
 
-    int xs, ys;
     int users = 0;
     struct npc_data *nd;
 
@@ -1037,6 +1036,7 @@ int npc_untouch_areanpc (struct map_session_data *sd)
     struct event_data *ev = strdb_search (ev_db, name);
     if (ev)
     {
+        int xs, ys;
         xs = nd->u.scr.xs;
         ys = nd->u.scr.ys;
         map_foreachinarea_cond (npc_untouch_getareausers_sub,
diff --git a/src/txt-converter/char/Makefile b/src/txt-converter/char/Makefile
deleted file mode 100644
index 47d97d3..0000000
--- a/src/txt-converter/char/Makefile
+++ /dev/null
@@ -1,15 +0,0 @@
-include ../../../make.defs
-
-all: char-converter
-sql: char-converter
-
-COMMON_OBJ = ../../common/core.o ../../common/socket.o ../../common/timer.o ../../common/db.o ../../common/malloc.o
-
-char-converter: char-converter.o strlib.o $(COMMON_OBJ)
-	$(CC) -o ../../../$@ $^ $(LIB_S)
-
-char-converter.o: char-converter.c char.h strlib.h
-strlib.o: strlib.c strlib.h
-clean:
-	rm -f *.o ../../../char-converter
-
diff --git a/src/txt-converter/char/char-converter.c b/src/txt-converter/char/char-converter.c
deleted file mode 100644
index 1abd8f4..0000000
--- a/src/txt-converter/char/char-converter.c
+++ /dev/null
@@ -1,971 +0,0 @@
-// $Id: char-converter.c,v 1.1.1.1 2004/09/10 17:45:03 MagicalTux Exp $
-// original : char2.c 2003/03/14 11:58:35 Rev.1.5
-
-#include <sys/types.h>
-#include <sys/socket.h>
-#include <stdio.h>
-#include <stdlib.h>
-#include <netinet/in.h>
-#include <sys/time.h>
-#include <sys/ioctl.h>
-#include <unistd.h>
-#include <signal.h>
-#include <fcntl.h>
-#include <string.h>
-#include <arpa/inet.h>
-
-#define STORAGE_MEMINC	16
-
-#include "char.h"
-#include "strlib.h"
-
-#ifdef MEMWATCH
-#include "memwatch.h"
-#endif
-
-char pet_txt[256] = "save/pet.txt";
-char storage_txt[256] = "save/storage.txt";
-
-MYSQL mysql_handle;
-MYSQL_RES *sql_res;
-MYSQL_ROW sql_row;
-int  sql_fields, sql_cnt;
-char tmp_sql[65535];
-
-int  db_server_port = 3306;
-char db_server_ip[16] = "127.0.0.1";
-char db_server_id[32] = "ragnarok";
-char db_server_pw[32] = "ragnarok";
-char db_server_logindb[32] = "ragnarok";
-
-struct storage *storage = NULL;
-
-struct mmo_map_server server[MAX_MAP_SERVERS];
-int  server_fd[MAX_MAP_SERVERS];
-
-int  login_fd;
-char userid[24];
-char passwd[24];
-char server_name[20];
-char login_ip_str[16];
-int  login_port = 6900;
-char char_ip_str[16];
-int  char_ip;
-int  char_port = 6121;
-int  char_maintenance;
-int  char_new;
-char char_txt[256];
-
-char t_name[256];
-
-#define CHAR_STATE_WAITAUTH 0
-#define CHAR_STATE_AUTHOK 1
-struct char_session_data
-{
-    int  state;
-    int  account_id, login_id1, login_id2, sex;
-    int  found_char[9];
-};
-
-#define AUTH_FIFO_SIZE 256
-struct
-{
-    int  account_id, char_id, login_id1, char_pos, delflag, sex;
-} auth_fifo[AUTH_FIFO_SIZE];
-int  auth_fifo_pos = 0;
-
-int  char_id_count = 100000;
-struct mmo_charstatus *char_dat;
-int  char_num, char_max;
-int  max_connect_user = 0;
-int  autosave_interval = DEFAULT_AUTOSAVE_INTERVAL;
-
-// (conf   )
-struct point start_point = { "new_1-1.gat", 53, 111 };
-
-int inter_pet_fromstr (char *str, struct s_pet *p)
-{
-    int  s;
-    int  tmp_int[16];
-    char tmp_str[256];
-
-    memset (p, 0, sizeof (struct s_pet));
-
-//  printf("sscanf pet main info\n");
-    s = sscanf (str, "%d, %d,%[^\t]\t%d, %d, %d, %d, %d, %d, %d, %d, %d",
-                &tmp_int[0], &tmp_int[1], tmp_str, &tmp_int[2], &tmp_int[3],
-                &tmp_int[4], &tmp_int[5], &tmp_int[6], &tmp_int[7],
-                &tmp_int[8], &tmp_int[9], &tmp_int[10]);
-
-    if (s != 12)
-        return 1;
-
-    p->pet_id = tmp_int[0];
-    p->class = tmp_int[1];
-    memcpy (p->name, tmp_str, 24);
-    p->account_id = tmp_int[2];
-    p->char_id = tmp_int[3];
-    p->level = tmp_int[4];
-    p->egg_id = tmp_int[5];
-    p->equip = tmp_int[6];
-    p->intimate = tmp_int[7];
-    p->hungry = tmp_int[8];
-    p->rename_flag = tmp_int[9];
-    p->incuvate = tmp_int[10];
-
-    if (p->hungry < 0)
-        p->hungry = 0;
-    else if (p->hungry > 100)
-        p->hungry = 100;
-    if (p->intimate < 0)
-        p->intimate = 0;
-    else if (p->intimate > 1000)
-        p->intimate = 1000;
-
-    return 0;
-}
-
-//---------------------------------------------------------
-int inter_pet_tosql (int pet_id, struct s_pet *p)
-{
-    //`pet` (`pet_id`, `class`,`name`,`account_id`,`char_id`,`level`,`egg_id`,`equip`,`intimate`,`hungry`,`rename_flag`,`incuvate`)
-
-    char tmp_sql[65535];
-    MYSQL_RES *sql_res;
-    MYSQL_ROW sql_row;
-
-    jstrescapecpy (t_name, p->name);
-    if (p->hungry < 0)
-        p->hungry = 0;
-    else if (p->hungry > 100)
-        p->hungry = 100;
-    if (p->intimate < 0)
-        p->intimate = 0;
-    else if (p->intimate > 1000)
-        p->intimate = 1000;
-    sprintf (tmp_sql, "SELECT * FROM `pet` WHERE `pet_id`='%d'", pet_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-    sql_res = mysql_store_result (&mysql_handle);
-    sql_row = mysql_fetch_row (sql_res);    //row fetching
-    if (!sql_row)               //no row -> insert
-        sprintf (tmp_sql,
-                 "INSERT INTO `pet` (`pet_id`, `class`,`name`,`account_id`,`char_id`,`level`,`egg_id`,`equip`,`intimate`,`hungry`,`rename_flag`,`incuvate`) VALUES ('%d', '%d', '%s', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d')",
-                 p->pet_id, p->class, t_name, p->account_id, p->char_id,
-                 p->level, p->egg_id, p->equip, p->intimate, p->hungry,
-                 p->rename_flag, p->incuvate);
-    else                        //row reside -> updating
-        sprintf (tmp_sql,
-                 "UPDATE `pet` SET `class`='%d',`name`='%s',`account_id`='%d',`char_id`='%d',`level`='%d',`egg_id`='%d',`equip`='%d',`intimate`='%d',`hungry`='%d',`rename_flag`='%d',`incuvate`='%d' WHERE `pet_id`='%d'",
-                 p->class, t_name, p->account_id, p->char_id, p->level,
-                 p->egg_id, p->equip, p->intimate, p->hungry, p->rename_flag,
-                 p->incuvate, p->pet_id);
-    mysql_free_result (sql_res);    //resource free
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-
-    printf ("pet dump success! - %d:%s\n", pet_id, p->name);
-
-    return 0;
-}
-
-int storage_tosql (int account_id, struct storage *p)
-{
-    // id -> DB dump
-    // storage {`account_id`/`id`/`nameid`/`amount`/`equip`/`identify`/`refine`/`attribute`/`card0`/`card1`/`card2`/`card3`}
-    int  i, j;
-
-    j = 0;
-
-    //printf ("starting storage dump to DB - id: %d\n", account_id);
-
-    //delete old data.
-    sprintf (tmp_sql, "DELETE FROM `storage` WHERE `account_id`='%d'",
-             account_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-    }
-
-    //printf ("all storage item was deleted ok\n");
-
-    for (i = 0; i < MAX_STORAGE; i++)
-    {
-        //printf ("save storage num: %d (%d:%d)\n",i, p->storage[i].nameid , p->storage[i].amount);
-
-        if ((p->storage[i].nameid) && (p->storage[i].amount))
-        {
-            sprintf (tmp_sql,
-                     "INSERT INTO `storage` (`account_id`,`nameid`,`amount`,`equip`,`identify`,`refine`,`attribute`,`card0`,`card1`,`card2`,`card3`,`broken`) VALUES ('%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d')",
-                     p->account_id, p->storage[i].nameid,
-                     p->storage[i].amount, p->storage[i].equip,
-                     p->storage[i].identify, p->storage[i].refine,
-                     p->storage[i].attribute, p->storage[i].card[0],
-                     p->storage[i].card[1], p->storage[i].card[2],
-                     p->storage[i].card[3], p->storage[i].broken);
-            //printf ("%s\n",tmp_sql);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error - %s\n",
-                        mysql_error (&mysql_handle));
-            }
-            j++;
-        }
-    }
-
-    printf ("storage dump to DB - id: %d (total: %d)\n", account_id, j);
-    return 0;
-}
-
-// char to storage
-int storage_fromstr (char *str, struct storage *p)
-{
-    int  tmp_int[256];
-    int  set, next, len, i;
-
-    set = sscanf (str, "%d, %d%n", &tmp_int[0], &tmp_int[1], &next);
-    p->storage_amount = tmp_int[1];
-
-    if (set != 2)
-        return 0;
-    if (str[next] == '\n' || str[next] == '\r')
-        return 1;
-    next++;
-    for (i = 0; str[next] && str[next] != '\t'; i++)
-    {
-        if (sscanf (str + next, "%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d%n",
-                    &tmp_int[0], &tmp_int[1], &tmp_int[2], &tmp_int[3],
-                    &tmp_int[4], &tmp_int[5], &tmp_int[6],
-                    &tmp_int[7], &tmp_int[8], &tmp_int[9], &tmp_int[10],
-                    &tmp_int[11], &len) == 12)
-        {
-            p->storage[i].id = tmp_int[0];
-            p->storage[i].nameid = tmp_int[1];
-            p->storage[i].amount = tmp_int[2];
-            p->storage[i].equip = tmp_int[3];
-            p->storage[i].identify = tmp_int[4];
-            p->storage[i].refine = tmp_int[5];
-            p->storage[i].attribute = tmp_int[6];
-            p->storage[i].card[0] = tmp_int[7];
-            p->storage[i].card[1] = tmp_int[8];
-            p->storage[i].card[2] = tmp_int[9];
-            p->storage[i].card[3] = tmp_int[10];
-            p->storage[i].broken = tmp_int[11];
-            next += len;
-            if (str[next] == ' ')
-                next++;
-        }
-
-        else if (sscanf (str + next, "%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d%n",
-                         &tmp_int[0], &tmp_int[1], &tmp_int[2], &tmp_int[3],
-                         &tmp_int[4], &tmp_int[5], &tmp_int[6],
-                         &tmp_int[7], &tmp_int[8], &tmp_int[9], &tmp_int[10],
-                         &len) == 11)
-        {
-            p->storage[i].id = tmp_int[0];
-            p->storage[i].nameid = tmp_int[1];
-            p->storage[i].amount = tmp_int[2];
-            p->storage[i].equip = tmp_int[3];
-            p->storage[i].identify = tmp_int[4];
-            p->storage[i].refine = tmp_int[5];
-            p->storage[i].attribute = tmp_int[6];
-            p->storage[i].card[0] = tmp_int[7];
-            p->storage[i].card[1] = tmp_int[8];
-            p->storage[i].card[2] = tmp_int[9];
-            p->storage[i].card[3] = tmp_int[10];
-            p->storage[i].broken = 0;
-            next += len;
-            if (str[next] == ' ')
-                next++;
-        }
-
-        else
-            return 0;
-    }
-    return 1;
-}
-
-/////////////////////////////////
-int mmo_char_fromstr (char *str, struct mmo_charstatus *p)
-{
-    int  tmp_int[256];
-    int  set, next, len, i;
-
-    // initilialise character
-    memset (p, '\0', sizeof (struct mmo_charstatus));
-
-    // If it's not char structure of version 1008 and after
-    if ((set = sscanf (str, "%d\t%d,%d\t%[^\t]\t%d,%d,%d\t%d,%d,%d\t%d,%d,%d,%d\t%d,%d,%d,%d,%d,%d\t%d,%d" "\t%d,%d,%d\t%d,%d,%d\t%d,%d,%d\t%d,%d,%d,%d,%d" "\t%[^,],%d,%d\t%[^,],%d,%d,%d%n", &tmp_int[0], &tmp_int[1], &tmp_int[2], p->name,  //
-                       &tmp_int[3], &tmp_int[4], &tmp_int[5], &tmp_int[6], &tmp_int[7], &tmp_int[8], &tmp_int[9], &tmp_int[10], &tmp_int[11], &tmp_int[12], &tmp_int[13], &tmp_int[14], &tmp_int[15], &tmp_int[16], &tmp_int[17], &tmp_int[18], &tmp_int[19], &tmp_int[20], &tmp_int[21], &tmp_int[22], &tmp_int[23],   //
-                       &tmp_int[24], &tmp_int[25], &tmp_int[26], &tmp_int[27], &tmp_int[28], &tmp_int[29], &tmp_int[30], &tmp_int[31], &tmp_int[32], &tmp_int[33], &tmp_int[34], p->last_point.map, &tmp_int[35], &tmp_int[36], //
-                       p->save_point.map, &tmp_int[37], &tmp_int[38],
-                       &tmp_int[39], &next)) != 43)
-    {
-        tmp_int[39] = 0;        // partner id
-        // If not char structure from version 384 to 1007
-        if ((set = sscanf (str, "%d\t%d,%d\t%[^\t]\t%d,%d,%d\t%d,%d,%d\t%d,%d,%d,%d\t%d,%d,%d,%d,%d,%d\t%d,%d" "\t%d,%d,%d\t%d,%d,%d\t%d,%d,%d\t%d,%d,%d,%d,%d" "\t%[^,],%d,%d\t%[^,],%d,%d%n", &tmp_int[0], &tmp_int[1], &tmp_int[2], p->name, //
-                           &tmp_int[3], &tmp_int[4], &tmp_int[5], &tmp_int[6], &tmp_int[7], &tmp_int[8], &tmp_int[9], &tmp_int[10], &tmp_int[11], &tmp_int[12], &tmp_int[13], &tmp_int[14], &tmp_int[15], &tmp_int[16], &tmp_int[17], &tmp_int[18], &tmp_int[19], &tmp_int[20], &tmp_int[21], &tmp_int[22], &tmp_int[23],   //
-                           &tmp_int[24], &tmp_int[25], &tmp_int[26], &tmp_int[27], &tmp_int[28], &tmp_int[29], &tmp_int[30], &tmp_int[31], &tmp_int[32], &tmp_int[33], &tmp_int[34], p->last_point.map, &tmp_int[35], &tmp_int[36], //
-                           p->save_point.map, &tmp_int[37], &tmp_int[38],
-                           &next)) != 42)
-        {
-            // It's char structure of a version before 384
-            tmp_int[26] = 0;    // pet id
-            set = sscanf (str, "%d\t%d,%d\t%[^\t]\t%d,%d,%d\t%d,%d,%d\t%d,%d,%d,%d\t%d,%d,%d,%d,%d,%d\t%d,%d" "\t%d,%d,%d\t%d,%d\t%d,%d,%d\t%d,%d,%d,%d,%d" "\t%[^,],%d,%d\t%[^,],%d,%d%n", &tmp_int[0], &tmp_int[1], &tmp_int[2], p->name, //
-                          &tmp_int[3], &tmp_int[4], &tmp_int[5], &tmp_int[6], &tmp_int[7], &tmp_int[8], &tmp_int[9], &tmp_int[10], &tmp_int[11], &tmp_int[12], &tmp_int[13], &tmp_int[14], &tmp_int[15], &tmp_int[16], &tmp_int[17], &tmp_int[18], &tmp_int[19], &tmp_int[20], &tmp_int[21], &tmp_int[22], &tmp_int[23],    //
-                          &tmp_int[24], &tmp_int[25],   //
-                          &tmp_int[27], &tmp_int[28], &tmp_int[29], &tmp_int[30], &tmp_int[31], &tmp_int[32], &tmp_int[33], &tmp_int[34], p->last_point.map, &tmp_int[35], &tmp_int[36],    //
-                          p->save_point.map, &tmp_int[37], &tmp_int[38],
-                          &next);
-            set += 2;
-            //printf("char: old char data ver.1\n");
-            // Char structure of version 1007 or older
-        }
-        else
-        {
-            set++;
-            //printf("char: old char data ver.2\n");
-        }
-        // Char structure of version 1008+
-    }
-    else
-    {
-        //printf("char: new char data ver.3\n");
-    }
-    if (set != 43)
-        return 0;
-
-    p->char_id = tmp_int[0];
-    p->account_id = tmp_int[1];
-    p->char_num = tmp_int[2];
-    p->class = tmp_int[3];
-    p->base_level = tmp_int[4];
-    p->job_level = tmp_int[5];
-    p->base_exp = tmp_int[6];
-    p->job_exp = tmp_int[7];
-    p->zeny = tmp_int[8];
-    p->hp = tmp_int[9];
-    p->max_hp = tmp_int[10];
-    p->sp = tmp_int[11];
-    p->max_sp = tmp_int[12];
-    p->str = tmp_int[13];
-    p->agi = tmp_int[14];
-    p->vit = tmp_int[15];
-    p->int_ = tmp_int[16];
-    p->dex = tmp_int[17];
-    p->luk = tmp_int[18];
-    p->status_point = tmp_int[19];
-    p->skill_point = tmp_int[20];
-    p->option = tmp_int[21];
-    p->karma = tmp_int[22];
-    p->manner = tmp_int[23];
-    p->party_id = tmp_int[24];
-    p->guild_id = tmp_int[25];
-    p->pet_id = tmp_int[26];
-    p->hair = tmp_int[27];
-    p->hair_color = tmp_int[28];
-    p->clothes_color = tmp_int[29];
-    p->weapon = tmp_int[30];
-    p->shield = tmp_int[31];
-    p->head_top = tmp_int[32];
-    p->head_mid = tmp_int[33];
-    p->head_bottom = tmp_int[34];
-    p->last_point.x = tmp_int[35];
-    p->last_point.y = tmp_int[36];
-    p->save_point.x = tmp_int[37];
-    p->save_point.y = tmp_int[38];
-    p->partner_id = tmp_int[39];
-
-    // Some checks
-    for (i = 0; i < char_num; i++)
-    {
-        if (char_dat[i].char_id == p->char_id)
-        {
-            printf
-                ("\033[1;31mmmo_auth_init: ******Error: a character has an identical id to another.\n");
-            printf
-                ("               character id #%d -> new character not readed.\n",
-                 p->char_id);
-            printf ("               Character saved in log file.\033[0m\n");
-            return -1;
-        }
-        else if (strcmp (char_dat[i].name, p->name) == 0)
-        {
-            printf
-                ("\033[1;31mmmo_auth_init: ******Error: character name already exists.\n");
-            printf
-                ("               character name '%s' -> new character not readed.\n",
-                 p->name);
-            printf ("               Character saved in log file.\033[0m\n");
-            return -2;
-        }
-    }
-
-    if (str[next] == '\n' || str[next] == '\r')
-        return 1;               // 
-
-    next++;
-
-    for (i = 0; str[next] && str[next] != '\t'; i++)
-    {
-        set =
-            sscanf (str + next, "%[^,],%d,%d%n", p->memo_point[i].map,
-                    &tmp_int[0], &tmp_int[1], &len);
-        if (set != 3)
-            return -3;
-        p->memo_point[i].x = tmp_int[0];
-        p->memo_point[i].y = tmp_int[1];
-        next += len;
-        if (str[next] == ' ')
-            next++;
-    }
-
-    next++;
-
-    for (i = 0; str[next] && str[next] != '\t'; i++)
-    {
-        if (sscanf (str + next, "%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d%n",
-                    &tmp_int[0], &tmp_int[1], &tmp_int[2], &tmp_int[3],
-                    &tmp_int[4], &tmp_int[5], &tmp_int[6],
-                    &tmp_int[7], &tmp_int[8], &tmp_int[9], &tmp_int[10],
-                    &tmp_int[11], &len) == 12)
-        {
-            // do nothing, it's ok
-        }
-        else if (sscanf (str + next, "%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d%n",
-                         &tmp_int[0], &tmp_int[1], &tmp_int[2], &tmp_int[3],
-                         &tmp_int[4], &tmp_int[5], &tmp_int[6],
-                         &tmp_int[7], &tmp_int[8], &tmp_int[9], &tmp_int[10],
-                         &len) == 11)
-        {
-            tmp_int[11] = 0;    // broken doesn't exist in this version -> 0
-        }
-        else                    // invalid structure
-            return -4;
-        p->inventory[i].id = tmp_int[0];
-        p->inventory[i].nameid = tmp_int[1];
-        p->inventory[i].amount = tmp_int[2];
-        p->inventory[i].equip = tmp_int[3];
-        p->inventory[i].identify = tmp_int[4];
-        p->inventory[i].refine = tmp_int[5];
-        p->inventory[i].attribute = tmp_int[6];
-        p->inventory[i].card[0] = tmp_int[7];
-        p->inventory[i].card[1] = tmp_int[8];
-        p->inventory[i].card[2] = tmp_int[9];
-        p->inventory[i].card[3] = tmp_int[10];
-        p->inventory[i].broken = tmp_int[11];
-        next += len;
-        if (str[next] == ' ')
-            next++;
-    }
-
-    next++;
-
-    for (i = 0; str[next] && str[next] != '\t'; i++)
-    {
-        if (sscanf (str + next, "%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d%n",
-                    &tmp_int[0], &tmp_int[1], &tmp_int[2], &tmp_int[3],
-                    &tmp_int[4], &tmp_int[5], &tmp_int[6],
-                    &tmp_int[7], &tmp_int[8], &tmp_int[9], &tmp_int[10],
-                    &tmp_int[11], &len) == 12)
-        {
-            // do nothing, it's ok
-        }
-        else if (sscanf (str + next, "%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d%n",
-                         &tmp_int[0], &tmp_int[1], &tmp_int[2], &tmp_int[3],
-                         &tmp_int[4], &tmp_int[5], &tmp_int[6],
-                         &tmp_int[7], &tmp_int[8], &tmp_int[9], &tmp_int[10],
-                         &len) == 11)
-        {
-            tmp_int[11] = 0;    // broken doesn't exist in this version -> 0
-        }
-        else                    // invalid structure
-            return -5;
-        p->cart[i].id = tmp_int[0];
-        p->cart[i].nameid = tmp_int[1];
-        p->cart[i].amount = tmp_int[2];
-        p->cart[i].equip = tmp_int[3];
-        p->cart[i].identify = tmp_int[4];
-        p->cart[i].refine = tmp_int[5];
-        p->cart[i].attribute = tmp_int[6];
-        p->cart[i].card[0] = tmp_int[7];
-        p->cart[i].card[1] = tmp_int[8];
-        p->cart[i].card[2] = tmp_int[9];
-        p->cart[i].card[3] = tmp_int[10];
-        p->cart[i].broken = tmp_int[11];
-        next += len;
-        if (str[next] == ' ')
-            next++;
-    }
-
-    next++;
-
-    for (i = 0; str[next] && str[next] != '\t'; i++)
-    {
-        set = sscanf (str + next, "%d,%d%n", &tmp_int[0], &tmp_int[1], &len);
-        if (set != 2)
-            return -6;
-        p->skill[tmp_int[0]].id = tmp_int[0];
-        p->skill[tmp_int[0]].lv = tmp_int[1];
-        next += len;
-        if (str[next] == ' ')
-            next++;
-    }
-
-    next++;
-
-    for (i = 0;
-         str[next] && str[next] != '\t' && str[next] != '\n'
-         && str[next] != '\r'; i++)
-    {                           // global_regathena.txt'\n'
-        set =
-            sscanf (str + next, "%[^,],%d%n", p->global_reg[i].str,
-                    &p->global_reg[i].value, &len);
-        if (set != 2)
-        {
-            // because some scripts are not correct, the str can be "". So, we must check that.
-            // If it's, we must not refuse the character, but just this REG value.
-            // Character line will have something like: nov_2nd_cos,9 ,9 nov_1_2_cos_c,1 (here, ,9 is not good)
-            if (str[next] == ','
-                && sscanf (str + next, ",%d%n", &p->global_reg[i].value,
-                           &len) == 1)
-                i--;
-            else
-                return -7;
-        }
-        next += len;
-        if (str[next] == ' ')
-            next++;
-    }
-    p->global_reg_num = i;
-
-    return 1;
-}
-
-//==========================================================================================================
-int mmo_char_tosql (int char_id, struct mmo_charstatus *p)
-{
-    int  i, save_flag;
-
-    save_flag = char_id;
-    printf ("request save char data... (%d)\n", char_id);
-
-    //`char`( `char_id`,`account_id`,`char_num`,`name`,`class`,`base_level`,`job_level`,`base_exp`,`job_exp`,`zeny`, //9
-    //`str`,`agi`,`vit`,`int`,`dex`,`luk`, //15
-    //`max_hp`,`hp`,`max_sp`,`sp`,`status_point`,`skill_point`, //21
-    //`option`,`karma`,`manner`,`party_id`,`guild_id`,`pet_id`, //27
-    //`hair`,`hair_color`,`clothes_color`,`weapon`,`shield`,`head_top`,`head_mid`,`head_bottom`, //35
-    //`last_map`,`last_x`,`last_y`,`save_map`,`save_x`,`save_y`)
-    sprintf (tmp_sql,
-             "INSERT INTO `char` SET `char_id`='%d', `account_id`='%d', `char_num`='%d', `name`='%s', `class`='%d', `base_level`='%d', `job_level`='%d',"
-             "`base_exp`='%d', `job_exp`='%d', `zeny`='%d',"
-             "`max_hp`='%d',`hp`='%d',`max_sp`='%d',`sp`='%d',`status_point`='%d',`skill_point`='%d',"
-             "`str`='%d',`agi`='%d',`vit`='%d',`int`='%d',`dex`='%d',`luk`='%d',"
-             "`option`='%d',`karma`='%d',`manner`='%d',`party_id`='%d',`guild_id`='%d',`pet_id`='%d',"
-             "`hair`='%d',`hair_color`='%d',`clothes_color`='%d',`weapon`='%d',`shield`='%d',`head_top`='%d',`head_mid`='%d',`head_bottom`='%d',"
-             "`last_map`='%s',`last_x`='%d',`last_y`='%d',`save_map`='%s',`save_x`='%d',`save_y`='%d', `partner_id` = '%d'",
-             char_id, p->account_id, p->char_num, p->name, p->class,
-             p->base_level, p->job_level, p->base_exp, p->job_exp, p->zeny,
-             p->max_hp, p->hp, p->max_sp, p->sp, p->status_point,
-             p->skill_point, p->str, p->agi, p->vit, p->int_, p->dex, p->luk,
-             p->option, p->karma, p->manner, p->party_id, p->guild_id,
-             p->pet_id, p->hair, p->hair_color, p->clothes_color, p->weapon,
-             p->shield, p->head_top, p->head_mid, p->head_bottom,
-             p->last_point.map, p->last_point.x, p->last_point.y,
-             p->save_point.map, p->save_point.x, p->save_point.y,
-             p->partner_id);
-
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (update `char`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    //`memo` (`memo_id`,`char_id`,`map`,`x`,`y`)
-    sprintf (tmp_sql, "DELETE FROM `memo` WHERE `char_id`='%d'", char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `memo`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    //insert here.
-    for (i = 0; i < 10; i++)
-    {
-        if (p->memo_point[i].map[0])
-        {
-            sprintf (tmp_sql,
-                     "INSERT INTO `memo`(`char_id`,`map`,`x`,`y`) VALUES ('%d', '%s', '%d', '%d')",
-                     char_id, p->memo_point[i].map, p->memo_point[i].x,
-                     p->memo_point[i].y);
-            if (mysql_query (&mysql_handle, tmp_sql))
-                printf ("DB server Error (insert `memo`)- %s\n",
-                        mysql_error (&mysql_handle));
-        }
-    }
-    //`inventory` (`id`,`char_id`, `nameid`, `amount`, `equip`, `identify`, `refine`, `attribute`, `card0`, `card1`, `card2`, `card3`, `broken`)
-    sprintf (tmp_sql, "DELETE FROM `inventory` WHERE `char_id`='%d'",
-             char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `inventory`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    //insert here.
-    for (i = 0; i < MAX_INVENTORY; i++)
-    {
-        if (p->inventory[i].nameid)
-        {
-            sprintf (tmp_sql,
-                     "INSERT INTO `inventory`(`id`,`char_id`, `nameid`, `amount`, `equip`, `identify`, `refine`, `attribute`, `card0`, `card1`, `card2`, `card3`, `broken`)"
-                     " VALUES ('%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d')",
-                     p->inventory[i].id, char_id, p->inventory[i].nameid,
-                     p->inventory[i].amount, p->inventory[i].equip,
-                     p->inventory[i].identify, p->inventory[i].refine,
-                     p->inventory[i].attribute, p->inventory[i].card[0],
-                     p->inventory[i].card[1], p->inventory[i].card[2],
-                     p->inventory[i].card[3], p->inventory[i].broken);
-            if (mysql_query (&mysql_handle, tmp_sql))
-                printf ("DB server Error (insert `inventory`)- %s\n",
-                        mysql_error (&mysql_handle));
-        }
-    }
-
-    //`cart_inventory` (`id`,`char_id`, `nameid`, `amount`, `equip`, `identify`, `refine`, `attribute`, `card0`, `card1`, `card2`, `card3`, `broken`)
-    sprintf (tmp_sql, "DELETE FROM `cart_inventory` WHERE `char_id`='%d'",
-             char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `cart_inventory`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    //insert here.
-    for (i = 0; i < MAX_CART; i++)
-    {
-        if (p->cart[i].nameid)
-        {
-            sprintf (tmp_sql,
-                     "INSERT INTO `cart_inventory`(`id`,`char_id`, `nameid`, `amount`, `equip`, `identify`, `refine`, `attribute`, `card0`, `card1`, `card2`, `card3`, `broken`)"
-                     " VALUES ('%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d', '%d' )",
-                     p->cart[i].id, char_id, p->cart[i].nameid,
-                     p->cart[i].amount, p->cart[i].equip, p->cart[i].identify,
-                     p->cart[i].refine, p->cart[i].attribute,
-                     p->cart[i].card[0], p->cart[i].card[1],
-                     p->cart[i].card[2], p->cart[i].card[3],
-                     p->cart[i].broken);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (insert `cart_inventory`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-    }
-
-    //`skill` (`char_id`, `id`, `lv`)
-    sprintf (tmp_sql, "DELETE FROM `skill` WHERE `char_id`='%d'", char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `skill`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    //insert here.
-    for (i = 0; i < MAX_SKILL; i++)
-    {
-        if (p->skill[i].id)
-        {
-            if (p->skill[i].id && p->skill[i].flag != 1)
-            {
-                sprintf (tmp_sql,
-                         "INSERT INTO `skill`(`char_id`,`id`, `lv`) VALUES ('%d', '%d', '%d')",
-                         char_id, p->skill[i].id,
-                         (p->skill[i].flag ==
-                          0) ? p->skill[i].lv : p->skill[i].flag - 2);
-                if (mysql_query (&mysql_handle, tmp_sql))
-                {
-                    printf ("DB server Error (insert `skill`)- %s\n",
-                            mysql_error (&mysql_handle));
-                }
-            }
-        }
-    }
-    //`global_reg_value` (`char_id`, `str`, `value`)
-    sprintf (tmp_sql, "DELETE FROM `global_reg_value` WHERE `char_id`='%d'",
-             char_id);
-    if (mysql_query (&mysql_handle, tmp_sql))
-    {
-        printf ("DB server Error (delete `global_reg_value`)- %s\n",
-                mysql_error (&mysql_handle));
-    }
-
-    //insert here.
-    for (i = 0; i < p->global_reg_num; i++)
-    {
-        if (p->global_reg[i].value != 0)
-        {
-            sprintf (tmp_sql,
-                     "INSERT INTO `global_reg_value` (`char_id`, `str`, `value`) VALUES ('%d', '%s','%d')",
-                     char_id, p->global_reg[i].str, p->global_reg[i].value);
-            if (mysql_query (&mysql_handle, tmp_sql))
-            {
-                printf ("DB server Error (insert `global_reg_value`)- %s\n",
-                        mysql_error (&mysql_handle));
-            }
-        }
-    }
-
-    printf ("saving char is done... (%d)\n", char_id);
-    save_flag = 0;
-
-    return 0;
-}
-
-//==========================================================================================================
-
-int mmo_char_init (void)
-{
-    char line[65536];
-    struct s_pet *p;
-    int  ret;
-    int  i = 0, set, tmp_int[2], c = 0;
-    char input;
-    FILE *fp;
-
-    //DB connection initialized
-    mysql_init (&mysql_handle);
-    printf ("Connect DB server.... (inter server)\n");
-    if (!mysql_real_connect
-        (&mysql_handle, db_server_ip, db_server_id, db_server_pw,
-         db_server_logindb, db_server_port, (char *) NULL, 0))
-    {
-        //pointer check
-        printf ("%s\n", mysql_error (&mysql_handle));
-        exit (1);
-    }
-    else
-    {
-        printf ("connect success! (inter server)\n");
-    }
-
-    printf
-        ("Warning : Make sure you backup your databases before continuing!\n");
-    printf
-        ("\nDo you wish to convert your Character Database to SQL? (y/n) : ");
-    input = getchar ();
-    if (input == 'y' || input == 'Y')
-    {
-        printf ("\nConverting Character Database...\n");
-        fp = fopen_ ("save/athena.txt", "r");
-        char_dat = malloc (sizeof (char_dat[0]) * 256);
-        char_max = 256;
-        if (fp == NULL)
-            return 0;
-        while (fgets (line, 65535, fp))
-        {
-            if (char_num >= char_max)
-            {
-                char_max += 256;
-                char_dat =
-                    realloc (char_dat, sizeof (char_dat[0]) * char_max);
-            }
-            memset (&char_dat[char_num], 0, sizeof (char_dat[0]));
-            ret = mmo_char_fromstr (line, &char_dat[char_num]);
-            if (ret)
-            {
-                mmo_char_tosql (char_dat[char_num].char_id,
-                                &char_dat[char_num]);
-                printf ("convert %d -> DB\n", char_dat[char_num].char_id);
-                if (char_dat[char_num].char_id >= char_id_count)
-                    char_id_count = char_dat[char_num].char_id + 1;
-                char_num++;
-            }
-        }
-        printf ("char data convert end\n");
-        fclose_ (fp);
-    }
-
-    while (getchar () != '\n');
-    printf
-        ("\nDo you wish to convert your Storage Database to SQL? (y/n) : ");
-    input = getchar ();
-    if (input == 'y' || input == 'Y')
-    {
-        printf ("\nConverting Storage Database...\n");
-        fp = fopen_ (storage_txt, "r");
-        if (fp == NULL)
-        {
-            printf ("cant't read : %s\n", storage_txt);
-            return 0;
-        }
-
-        while (fgets (line, 65535, fp))
-        {
-            set = sscanf (line, "%d,%d", &tmp_int[0], &tmp_int[1]);
-            if (set == 2)
-            {
-                if (i == 0)
-                {
-                    storage = malloc (sizeof (struct storage));
-                }
-                else
-                {
-                    storage =
-                        realloc (storage, sizeof (struct storage) * (i + 1));
-                }
-                memset (&storage[i], 0, sizeof (struct storage));
-                storage[i].account_id = tmp_int[0];
-                storage_fromstr (line, &storage[i]);
-                storage_tosql (tmp_int[0], &storage[i]);    //to sql. (dump)
-                i++;
-            }
-        }
-        fclose_ (fp);
-    }
-
-    while (getchar () != '\n');
-    printf ("\nDo you wish to convert your Pet Database to SQL? (y/n) : ");
-    input = getchar ();
-    if (input == 'y' || input == 'Y')
-    {
-        printf ("\nConverting Pet Database...\n");
-        if ((fp = fopen_ (pet_txt, "r")) == NULL)
-            return 1;
-
-        p = malloc (sizeof (struct s_pet));
-        while (fgets (line, sizeof (line), fp))
-        {
-            if (p == NULL)
-            {
-                printf ("int_pet: out of memory!\n");
-                exit (0);
-            }
-            if (inter_pet_fromstr (line, p) == 0 && p->pet_id > 0)
-            {
-                //pet dump
-                inter_pet_tosql (p->pet_id, p);
-            }
-            else
-            {
-                printf ("int_pet: broken data [%s] line %d\n", pet_txt, c);
-            }
-            c++;
-        }
-        fclose_ (fp);
-    }
-
-    return 0;
-}
-
-int inter_config_read (const char *cfgName)
-{
-    printf ("start reading interserver configuration: %s\n", cfgName);
-    int  i;
-    char line[1024], w1[1024], w2[1024];
-    FILE *fp;
-
-    fp = fopen_ (cfgName, "r");
-    if (fp == NULL)
-    {
-        printf ("file not found: %s\n", cfgName);
-        return 1;
-    }
-    while (fgets (line, 1020, fp))
-    {
-        i = sscanf (line, "%[^:]:%s", w1, w2);
-        if (i != 2)
-            continue;
-        if (strcmpi (w1, "storage_txt") == 0)
-        {
-            printf ("set storage_txt : %s\n", w2);
-            strncpy (storage_txt, w2, sizeof (storage_txt));
-        }
-        else if (strcmpi (w1, "pet_txt") == 0)
-        {
-            printf ("set pet_txt : %s\n", w2);
-            strncpy (pet_txt, w2, sizeof (pet_txt));
-        }
-        //add for DB connection
-        else if (strcmpi (w1, "db_server_ip") == 0)
-        {
-            strcpy (db_server_ip, w2);
-            printf ("set db_server_ip : %s\n", w2);
-        }
-        else if (strcmpi (w1, "db_server_port") == 0)
-        {
-            db_server_port = atoi (w2);
-            printf ("set db_server_port : %s\n", w2);
-        }
-        else if (strcmpi (w1, "db_server_id") == 0)
-        {
-            strcpy (db_server_id, w2);
-            printf ("set db_server_id : %s\n", w2);
-        }
-        else if (strcmpi (w1, "db_server_pw") == 0)
-        {
-            strcpy (db_server_pw, w2);
-            printf ("set db_server_pw : %s\n", w2);
-        }
-        else if (strcmpi (w1, "db_server_logindb") == 0)
-        {
-            strcpy (db_server_logindb, w2);
-            printf ("set db_server_logindb : %s\n", w2);
-        }
-    }
-    fclose_ (fp);
-
-    printf ("success reading interserver configuration\n");
-
-    return 0;
-}
-
-int char_config_read (const char *cfgName)
-{
-    printf ("start reading interserver configuration: %s\n", cfgName);
-    int  i;
-    char line[1024], w1[1024], w2[1024];
-    FILE *fp;
-
-    fp = fopen_ (cfgName, "r");
-    if (fp == NULL)
-    {
-        printf ("file not found: %s\n", cfgName);
-        return 1;
-    }
-
-    while (fgets (line, 1020, fp))
-    {
-        if (line[0] == '/' && line[1] == '/')
-            continue;
-
-        i = sscanf (line, "%[^:]:%s", w1, w2);
-        if (i != 2)
-            continue;
-        if (strcmpi (w1, "char_txt") == 0)
-        {
-            printf ("set char_txt : %s\n", w2);
-            strcpy (char_txt, w2);
-        }
-    }
-    fclose_ (fp);
-    printf ("reading configure done.....\n");
-
-    return 0;
-}
-
-int do_init (int argc, char **argv)
-{
-
-    char_config_read ((argc > 1) ? argv[1] : CHAR_CONF_NAME);
-    inter_config_read ((argc > 2) ? argv[2] : inter_cfgName);
-
-    mmo_char_init ();
-    printf ("all conversion success!\n");
-    exit (0);
-    return 0;
-}
diff --git a/src/txt-converter/char/char.h b/src/txt-converter/char/char.h
deleted file mode 100644
index 6ea18a3..0000000
--- a/src/txt-converter/char/char.h
+++ /dev/null
@@ -1,39 +0,0 @@
-#include "../../common/core.h"
-#include "../../common/socket.h"
-#include "../../common/timer.h"
-#include "../common/mmo.h"
-#include "../../common/version.h"
-#include "../../common/db.h"
-
-#ifndef _CHAR_H_
-#define _CHAR_H_
-
-#define MAX_MAP_SERVERS 30
-
-#define CHAR_CONF_NAME	"conf/char_athena.conf"
-
-#define UNKNOWN_CHAR_NAME "Unknown"
-
-#define DEFAULT_AUTOSAVE_INTERVAL 300*1000
-
-struct mmo_map_server
-{
-    long ip;
-    short port;
-    int  users;
-    char map[MAX_MAP_PER_SERVER][16];
-};
-
-int  mapif_sendall (unsigned char *buf, unsigned int len);
-int  mapif_sendallwos (int fd, unsigned char *buf, unsigned int len);
-int  mapif_send (int fd, unsigned char *buf, unsigned int len);
-
-extern int autosave_interval;
-
-#endif
-
-#include "inter.h"
-#include "int_pet.h"
-#include "int_guild.h"
-#include "int_party.h"
-#include "int_storage.h"
diff --git a/src/txt-converter/char/int_guild.h b/src/txt-converter/char/int_guild.h
deleted file mode 100644
index 98aea58..0000000
--- a/src/txt-converter/char/int_guild.h
+++ /dev/null
@@ -1,10 +0,0 @@
-#ifndef _INT_GUILD_H_
-#define _INT_GUILD_H_
-
-int  inter_guild_init ();
-int  inter_guild_save ();
-int  inter_guild_parse_frommap (int fd);
-
-extern char guild_txt[256];
-
-#endif
diff --git a/src/txt-converter/char/int_party.h b/src/txt-converter/char/int_party.h
deleted file mode 100644
index 30fdd04..0000000
--- a/src/txt-converter/char/int_party.h
+++ /dev/null
@@ -1,11 +0,0 @@
-#ifndef _INT_PARTY_H_
-#define _INT_PARTY_H_
-
-int  inter_party_init ();
-int  inter_party_save ();
-
-int  inter_party_parse_frommap (int fd);
-
-extern char party_txt[256];
-
-#endif
diff --git a/src/txt-converter/char/int_pet.h b/src/txt-converter/char/int_pet.h
deleted file mode 100644
index 7f1157c..0000000
--- a/src/txt-converter/char/int_pet.h
+++ /dev/null
@@ -1,12 +0,0 @@
-#ifndef _INT_PET_H_
-#define _INT_PET_H_
-
-int  inter_pet_init ();
-int  inter_pet_save ();
-int  inter_pet_delete (int pet_id);
-
-int  inter_pet_parse_frommap (int fd);
-
-//extern char pet_txt[256];
-
-#endif
diff --git a/src/txt-converter/char/int_storage.h b/src/txt-converter/char/int_storage.h
deleted file mode 100644
index 1c5c3f9..0000000
--- a/src/txt-converter/char/int_storage.h
+++ /dev/null
@@ -1,11 +0,0 @@
-#ifndef _INT_STORAGE_H_
-#define _INT_STORAGE_H_
-
-int  inter_storage_init ();
-int  inter_storage_save ();
-
-int  inter_storage_parse_frommap (int fd);
-
-//extern char storage_txt[256];
-
-#endif
diff --git a/src/txt-converter/char/inter.h b/src/txt-converter/char/inter.h
deleted file mode 100644
index 2662052..0000000
--- a/src/txt-converter/char/inter.h
+++ /dev/null
@@ -1,27 +0,0 @@
-#ifndef _INTER_H_
-#define _INTER_H_
-
-int  inter_init (const char *file);
-int  inter_save ();
-int  inter_parse_frommap (int fd);
-
-int  inter_check_length (int fd, int length);
-
-#define inter_cfgName "conf/inter_athena.conf"
-
-//add include for DBMS(mysql)
-#include <mysql.h>
-
-extern MYSQL mysql_handle;
-extern char tmp_sql[65535];
-extern MYSQL_RES *sql_res;
-extern MYSQL_ROW sql_row;
-extern int sql_cnt;
-
-extern int db_server_port;
-extern char db_server_ip[16];
-extern char db_server_id[32];
-extern char db_server_pw[32];
-extern char db_server_logindb[32];
-
-#endif
diff --git a/src/txt-converter/char/strlib.c b/src/txt-converter/char/strlib.c
deleted file mode 100644
index 463b830..0000000
--- a/src/txt-converter/char/strlib.c
+++ /dev/null
@@ -1,76 +0,0 @@
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-
-#include "strlib.h"
-
-//-----------------------------------------------
-// string lib.
-unsigned char *jstrescape (unsigned char *pt)
-{
-    //copy from here
-    unsigned char *ptr;
-    int  i = 0, j = 0;
-
-    //copy string to temporary
-    ptr = malloc (J_MAX_MALLOC_SIZE);
-    strcpy (ptr, pt);
-
-    while (ptr[i] != '\0')
-    {
-        switch (ptr[i])
-        {
-            case '\'':
-                pt[j++] = '\\';
-                pt[j++] = ptr[i++];
-                break;
-            default:
-                pt[j++] = ptr[i++];
-        }
-    }
-    pt[j++] = '\0';
-    free (ptr);
-    return (unsigned char *) &pt[0];
-}
-
-unsigned char *jstrescapecpy (unsigned char *pt, unsigned char *spt)
-{
-    //copy from here
-    int  i = 0, j = 0;
-
-    while (spt[i] != '\0')
-    {
-        switch (spt[i])
-        {
-            case '\'':
-                pt[j++] = '\\';
-                pt[j++] = spt[i++];
-                break;
-            default:
-                pt[j++] = spt[i++];
-        }
-    }
-    pt[j++] = '\0';
-    return (unsigned char *) &pt[0];
-}
-
-int jmemescapecpy (unsigned char *pt, unsigned char *spt, int size)
-{
-    //copy from here
-    int  i = 0, j = 0;
-
-    while (i < size)
-    {
-        switch (spt[i])
-        {
-            case '\'':
-                pt[j++] = '\\';
-                pt[j++] = spt[i++];
-                break;
-            default:
-                pt[j++] = spt[i++];
-        }
-    }
-    // copy size is 0 ~ (j-1)
-    return j;
-}
diff --git a/src/txt-converter/char/strlib.h b/src/txt-converter/char/strlib.h
deleted file mode 100644
index 962f1bc..0000000
--- a/src/txt-converter/char/strlib.h
+++ /dev/null
@@ -1,9 +0,0 @@
-#ifndef _J_STR_H_
-#define _J_STR_H_
-#define J_MAX_MALLOC_SIZE 65535
-//string functions.
-//code by Jioh L. Jung
-unsigned char *jstrescape (unsigned char *pt);
-unsigned char *jstrescapecpy (unsigned char *pt, unsigned char *spt);
-int  jmemescapecpy (unsigned char *pt, unsigned char *spt, int size);
-#endif
diff --git a/src/txt-converter/common/mmo.h b/src/txt-converter/common/mmo.h
deleted file mode 100644
index 0295f6b..0000000
--- a/src/txt-converter/common/mmo.h
+++ /dev/null
@@ -1,300 +0,0 @@
-// Original : mmo.h 2003/03/14 12:07:02 Rev.1.7
-
-#ifndef	_MMO_H_
-#define	_MMO_H_
-
-#include <time.h>
-
-#ifdef CYGWIN
-// txtlog
-#define RETCODE	"\r\n"          // (CR/LFWindows)
-#else
-#define RETCODE "\n"            // (LFUnix
-#endif
-
-#define FIFOSIZE_SERVERLINK	128*1024
-
-#define MAX_MAP_PER_SERVER 512
-#define MAX_INVENTORY 100
-#define MAX_AMOUNT 30000
-#define MAX_ZENY 1000000000     // 1G zeny
-#define MAX_CART 100
-#define MAX_SKILL 450
-#define GLOBAL_REG_NUM 96
-#define ACCOUNT_REG_NUM 16
-#define ACCOUNT_REG2_NUM 16
-#define DEFAULT_WALK_SPEED 150
-#define MIN_WALK_SPEED 0
-#define MAX_WALK_SPEED 1000
-#define MAX_STORAGE 100
-#define MAX_GUILD_STORAGE 1000
-#define MAX_PARTY 12
-#define MAX_GUILD 140            // increased max guild members to accomodate for +2 increase for extension levels [Valaris]
-#define MAX_GUILDPOSITION 56    // increased max guild positions to accomodate for all members [Valaris]
-#define MAX_GUILDEXPLUSION 32
-#define MAX_GUILDALLIANCE 16
-#define MAX_GUILDSKILL	8
-#define MAX_GUILDCASTLE 24      // increased to include novice castles [Valaris]
-#define MAX_GUILDLEVEL 50
-
-#define MIN_HAIR_STYLE 0
-#define MAX_HAIR_STYLE 20
-#define MIN_HAIR_COLOR 0
-#define MAX_HAIR_COLOR 9
-#define MIN_CLOTH_COLOR 0
-#define MAX_CLOTH_COLOR 4
-
-// for produce
-#define MIN_ATTRIBUTE 0
-#define MAX_ATTRIBUTE 4
-#define ATTRIBUTE_NORMAL 0
-#define MIN_STAR 0
-#define MAX_STAR 3
-
-#define MIN_PORTAL_MEMO 0
-#define MAX_PORTAL_MEMO 2
-
-#define MAX_STATUS_TYPE 5
-
-#define WEDDING_RING_M 2634
-#define WEDDING_RING_F 2635
-
-#define CHAR_CONF_NAME  "conf/char_athena.conf"
-
-struct item
-{
-    int  id;
-    short nameid;
-    short amount;
-    unsigned short equip;
-    char identify;
-    char refine;
-    char attribute;
-    short card[4];
-    short broken;
-};
-struct point
-{
-    char map[24];
-    short x, y;
-};
-struct skill
-{
-    unsigned short id, lv, flag;
-};
-struct global_reg
-{
-    char str[32];
-    int  value;
-};
-struct s_pet
-{
-    int  account_id;
-    int  char_id;
-    int  pet_id;
-    short class;
-    short level;
-    short egg_id;               //pet egg id
-    short equip;                //pet equip name_id
-    short intimate;             //pet friendly
-    short hungry;               //pet hungry
-    char name[24];
-    char rename_flag;
-    char incuvate;
-};
-
-struct mmo_charstatus
-{
-    int  char_id;
-    int  account_id;
-    int  partner_id;
-
-    int  base_exp, job_exp, zeny;
-
-    short class;
-    short status_point, skill_point;
-    int  hp, max_hp, sp, max_sp;
-    short option, karma, manner;
-    short hair, hair_color, clothes_color;
-    int  party_id, guild_id, pet_id;
-
-    short weapon, shield;
-    short head_top, head_mid, head_bottom;
-
-    char name[24];
-    unsigned char base_level, job_level;
-    short str, agi, vit, int_, dex, luk;
-    unsigned char char_num, sex;
-
-    struct point last_point, save_point, memo_point[10];
-    struct item inventory[MAX_INVENTORY], cart[MAX_CART];
-    struct skill skill[MAX_SKILL];
-    int  global_reg_num;
-    struct global_reg global_reg[GLOBAL_REG_NUM];
-    int  account_reg_num;
-    struct global_reg account_reg[ACCOUNT_REG_NUM];
-    int  account_reg2_num;
-    struct global_reg account_reg2[ACCOUNT_REG2_NUM];
-};
-
-struct storage
-{
-    int  account_id;
-    short storage_status;
-    short storage_amount;
-    struct item storage[MAX_STORAGE];
-};
-
-struct guild_storage
-{
-    int  guild_id;
-    short storage_status;
-    short storage_amount;
-    struct item storage[MAX_GUILD_STORAGE];
-};
-
-struct map_session_data;
-
-struct gm_account
-{
-    int  account_id;
-    int  level;
-};
-
-struct party_member
-{
-    int  account_id;
-    char name[24], map[24];
-    int  leader, online, lv;
-    struct map_session_data *sd;
-};
-struct party
-{
-    int  party_id;
-    char name[24];
-    int  exp;
-    int  item;
-    struct party_member member[MAX_PARTY];
-};
-
-struct guild_member
-{
-    int  account_id, char_id;
-    short hair, hair_color, gender, class, lv;
-    int  exp, exp_payper;
-    short online, position;
-    int  rsv1, rsv2;
-    char name[24];
-    struct map_session_data *sd;
-};
-struct guild_position
-{
-    char name[24];
-    int  mode;
-    int  exp_mode;
-};
-struct guild_alliance
-{
-    int  opposition;
-    int  guild_id;
-    char name[24];
-};
-struct guild_explusion
-{
-    char name[24];
-    char mes[40];
-    char acc[40];
-    int  account_id;
-    int  rsv1, rsv2, rsv3;
-};
-struct guild_skill
-{
-    int  id, lv;
-};
-struct guild
-{
-    int  guild_id;
-    short guild_lv, connect_member, max_member, average_lv;
-    int  exp, next_exp, skill_point, castle_id;
-    char name[24], master[24];
-    struct guild_member member[MAX_GUILD];
-    struct guild_position position[MAX_GUILDPOSITION];
-    char mes1[60], mes2[120];
-    int  emblem_len, emblem_id;
-    char emblem_data[2048];
-    struct guild_alliance alliance[MAX_GUILDALLIANCE];
-    struct guild_explusion explusion[MAX_GUILDEXPLUSION];
-    struct guild_skill skill[MAX_GUILDSKILL];
-};
-struct guild_castle
-{
-    int  castle_id;
-    char map_name[24];
-    char castle_name[24];
-    int  guild_id;
-    int  economy;
-    int  defense;
-    int  triggerE;
-    int  triggerD;
-    int  nextTime;
-    int  payTime;
-    int  createTime;
-    int  visibleC;
-    int  visibleG0;
-    int  visibleG1;
-    int  visibleG2;
-    int  visibleG3;
-    int  visibleG4;
-    int  visibleG5;
-    int  visibleG6;
-    int  visibleG7;
-    int  Ghp0;                  // added Guardian HP [Valaris]
-    int  Ghp1;
-    int  Ghp2;
-    int  Ghp3;
-    int  Ghp4;
-    int  Ghp5;
-    int  Ghp6;
-    int  Ghp7;
-    int  GID0;
-    int  GID1;
-    int  GID2;
-    int  GID3;
-    int  GID4;
-    int  GID5;
-    int  GID6;
-    int  GID7;                  // end addition [Valaris]
-
-};
-struct square
-{
-    int  val1[5];
-    int  val2[5];
-};
-
-enum
-{
-    GBI_EXP = 1,                // EXP
-    GBI_GUILDLV = 2,            // Lv
-    GBI_SKILLPOINT = 3,         // 
-    GBI_SKILLLV = 4,            // Lv
-
-    GMI_POSITION = 0,           // 
-    GMI_EXP = 1,                // EXP
-
-};
-
-#ifndef strcmpi
-#define strcmpi strcasecmp
-#endif
-#ifndef stricmp
-#define stricmp strcasecmp
-#endif
-#ifndef strncmpi
-#define strncmpi strncasecmp
-#endif
-#ifndef strnicmp
-#define strnicmp strncasecmp
-#endif
-
-#endif // _MMO_H_
diff --git a/src/txt-converter/login/Makefile b/src/txt-converter/login/Makefile
deleted file mode 100644
index 832a21a..0000000
--- a/src/txt-converter/login/Makefile
+++ /dev/null
@@ -1,12 +0,0 @@
-include ../../../make.defs
-all: login-converter
-sql: login-converter
-
-COMMON_OBJ = ../../common/core.o ../../common/socket.o ../../common/timer.o ../../common/db.o ../../common/malloc.o
-COMMON_H = ../../common/core.h ../../common/socket.h ../../common/timer.h ../../common/mmo.h ../../common/version.h ../../common/db.h ../../common/malloc.h
-
-login-converter: login-converter.o ../../login_sql/md5calc.o ../../login_sql/strlib.o $(COMMON_OBJ)
-	$(CC) -o ../../../$@ $^ $(LIB_S)
-login-converter.o: login-converter.c ../../login_sql/login.h ../../login_sql/md5calc.h ../../login_sql/strlib.h $(COMMON_H)
-clean:
-	rm -f *.o ../../../login-converter
diff --git a/src/txt-converter/login/login-converter.c b/src/txt-converter/login/login-converter.c
deleted file mode 100644
index 477a0cc..0000000
--- a/src/txt-converter/login/login-converter.c
+++ /dev/null
@@ -1,282 +0,0 @@
-// $Id: login-converter.c,v 1.1.1.1 2004/09/10 17:45:03 MagicalTux Exp $
-// original : login2.c 2003/01/28 02:29:17 Rev.1.1.1.1
-// login data file to mysql conversion utility.
-//
-#include <sys/types.h>
-#include <sys/socket.h>
-#include <stdio.h>
-#include <stdlib.h>
-#include <netinet/in.h>
-#include <sys/time.h>
-#include <time.h>
-#include <sys/ioctl.h>
-#include <unistd.h>
-#include <signal.h>
-#include <fcntl.h>
-#include <string.h>
-#include <arpa/inet.h>
-
-#include <mysql.h>
-
-#include "../../common/core.h"
-#include "../../common/socket.h"
-#include "../../login/login.h"
-#include "../../common/mmo.h"
-#include "../../common/version.h"
-#include "../../common/db.h"
-
-int  account_id_count = START_ACCOUNT_NUM;
-int  server_num;
-int  new_account_flag = 0;
-int  login_port = 6900;
-
-struct mmo_char_server server[MAX_SERVERS];
-int  server_fd[MAX_SERVERS];
-
-#define AUTH_FIFO_SIZE 256
-struct
-{
-    int  account_id, login_id1, login_id2;
-    int  sex, delflag;
-} auth_fifo[AUTH_FIFO_SIZE];
-int  auth_fifo_pos = 0;
-struct
-{
-    int  account_id, sex;
-    char userid[24], pass[24], lastlogin[24];
-    int  logincount;
-    int  state;                 // packet 0x006a value + 1 (0: compte OK)
-    char email[40];             // e-mail (by default: a@a.com)
-    char error_message[20];     // Message of error code #6 = Your are Prohibited to log in until %s (packet 0x006a)
-    time_t ban_until_time;      // # of seconds 1/1/1970 (timestamp): ban time limit of the account (0 = no ban)
-    time_t connect_until_time;  // # of seconds 1/1/1970 (timestamp): Validity limit of the account (0 = unlimited)
-    char last_ip[16];           // save of last IP of connection
-    char memo[255];             // a memo field
-    int  account_reg2_num;
-    struct global_reg account_reg2[ACCOUNT_REG2_NUM];
-}   *auth_dat;
-int  auth_num = 0, auth_max = 0;
-
-char login_account_id[256] = "account_id";
-char login_userid[256] = "userid";
-char login_user_pass[256] = "user_pass";
-char login_db[256] = "login";
-
-static struct dbt *gm_account_db;
-
-int  db_server_port = 3306;
-char db_server_ip[16] = "127.0.0.1";
-char db_server_id[32] = "ragnarok";
-char db_server_pw[32] = "ragnarok";
-char db_server_logindb[32] = "ragnarok";
-
-int isGM (int account_id)
-{
-    struct gm_account *p;
-    p = numdb_search (gm_account_db, account_id);
-    if (p == NULL)
-        return 0;
-    return p->level;
-}
-
-int read_gm_account ()
-{
-    char line[8192];
-    struct gm_account *p;
-    FILE *fp;
-    int  c = 0;
-
-    gm_account_db = numdb_init ();
-    printf ("gm_account: read start\n");
-
-    if ((fp = fopen_ ("conf/GM_account.txt", "r")) == NULL)
-        return 1;
-    while (fgets (line, sizeof (line), fp))
-    {
-        if (line[0] == '/' && line[1] == '/')
-            continue;
-        p = malloc (sizeof (struct gm_account));
-        if (p == NULL)
-        {
-            printf ("gm_account: out of memory!\n");
-            exit (0);
-        }
-        if (sscanf (line, "%d %d", &p->account_id, &p->level) != 2
-            || p->level <= 0)
-        {
-            printf ("gm_account: broken data [conf/GM_account.txt] line %d\n",
-                    c);
-        }
-        else
-        {
-            if (p->level > 99)
-                p->level = 99;
-            numdb_insert (gm_account_db, p->account_id, p);
-        }
-        c++;
-    }
-    fclose_ (fp);
-    printf ("gm_account: read done (%d gm account ID)\n", c);
-    return 0;
-}
-
-int mmo_auth_init (void)
-{
-    MYSQL mysql_handle;
-    char tmpsql[1024];
-    MYSQL_RES *sql_res;
-    MYSQL_ROW sql_row;
-
-    mysql_init (&mysql_handle);
-    if (!mysql_real_connect
-        (&mysql_handle, db_server_ip, db_server_id, db_server_pw,
-         db_server_logindb, db_server_port, (char *) NULL, 0))
-    {
-        //pointer check
-        printf ("%s\n", mysql_error (&mysql_handle));
-        exit (1);
-    }
-    else
-    {
-        printf ("connect success!\n");
-    }
-    printf ("convert start...\n");
-
-    FILE *fp;
-    int  account_id, logincount, user_level, state, n, i;
-    char line[2048], userid[2048], pass[2048], lastlogin[2048], sex,
-        email[2048], error_message[2048], last_ip[2048], memo[2048];
-    time_t ban_until_time;
-    time_t connect_until_time;
-    char t_uid[256];
-
-    fp = fopen_ ("save/account.txt", "r");
-    auth_dat = malloc (sizeof (auth_dat[0]) * 256);
-    auth_max = 256;
-    if (fp == NULL)
-        return 0;
-    while (fgets (line, 1023, fp) != NULL)
-    {
-
-        if (line[0] == '/' && line[1] == '/')
-            continue;
-
-        i = sscanf (line, "%d\t%[^\t]\t%[^\t]\t%[^\t]\t%c\t%d\t%d\t"
-                    "%[^\t]\t%[^\t]\t%ld\t%[^\t]\t%[^\t]\t%ld%n",
-                    &account_id, userid, pass, lastlogin, &sex, &logincount,
-                    &state, email, error_message, &connect_until_time,
-                    last_ip, memo, &ban_until_time, &n);
-
-        sprintf (tmpsql,
-                 "SELECT `%s`,`%s`,`%s`,`lastlogin`,`logincount`,`sex`,`connect_until`,`last_ip`,`ban_until`,`state`"
-                 " FROM `%s` WHERE `%s`='%s'", login_account_id, login_userid,
-                 login_user_pass, login_db, login_userid, t_uid);
-
-        if (mysql_query (&mysql_handle, tmpsql))
-        {
-            printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        }
-        user_level = isGM (account_id);
-        printf ("userlevel: %s (%d)- %d\n", userid, account_id, user_level);
-        sql_res = mysql_store_result (&mysql_handle);
-        sql_row = mysql_fetch_row (sql_res);    //row fetching
-        if (!sql_row)           //no row -> insert
-            sprintf (tmpsql,
-                     "INSERT INTO `login` (`account_id`, `userid`, `user_pass`, `lastlogin`, `sex`, `logincount`, `email`, `level`) VALUES (%d, '%s', '%s', '%s', '%c', %d, 'user@athena', %d);",
-                     account_id, userid, pass, lastlogin, sex, logincount,
-                     user_level);
-        else                    //row reside -> updating
-            sprintf (tmpsql,
-                     "UPDATE `login` SET `account_id`='%d', `userid`='%s', `user_pass`='%s', `lastlogin`='%s', `sex`='%c', `logincount`='%d', `email`='user@athena', `level`='%d'\nWHERE `account_id`='%d';",
-                     account_id, userid, pass, lastlogin, sex, logincount,
-                     user_level, account_id);
-        printf ("Query: %s\n", tmpsql);
-        mysql_free_result (sql_res);    //resource free
-        if (mysql_query (&mysql_handle, tmpsql))
-        {
-            printf ("DB server Error - %s\n", mysql_error (&mysql_handle));
-        }
-    }
-    fclose_ (fp);
-
-    printf ("convert end...\n");
-
-    return 0;
-}
-
-// ???
-void nowork (void)
-{
-    //null
-}
-
-int login_config_read (const char *cfgName)
-{
-    int  i;
-    char line[1024], w1[1024], w2[1024];
-    FILE *fp;
-
-    fp = fopen_ (cfgName, "r");
-
-    if (fp == NULL)
-    {
-        printf ("file not found: %s\n", cfgName);
-        return 1;
-    }
-    printf ("start reading configuration...\n");
-    while (fgets (line, 1020, fp))
-    {
-        if (line[0] == '/' && line[1] == '/')
-            continue;
-
-        i = sscanf (line, "%[^:]:%s", w1, w2);
-        if (i != 2)
-            continue;
-
-        //add for DB connection
-        if (strcmpi (w1, "db_server_ip") == 0)
-        {
-            strcpy (db_server_ip, w2);
-            printf ("set db_server_ip : %s\n", w2);
-        }
-        else if (strcmpi (w1, "db_server_port") == 0)
-        {
-            db_server_port = atoi (w2);
-            printf ("set db_server_port : %s\n", w2);
-        }
-        else if (strcmpi (w1, "db_server_id") == 0)
-        {
-            strcpy (db_server_id, w2);
-            printf ("set db_server_id : %s\n", w2);
-        }
-        else if (strcmpi (w1, "db_server_pw") == 0)
-        {
-            strcpy (db_server_pw, w2);
-            printf ("set db_server_pw : %s\n", w2);
-        }
-        else if (strcmpi (w1, "db_server_logindb") == 0)
-        {
-            strcpy (db_server_logindb, w2);
-            printf ("set db_server_logindb : %s\n", w2);
-        }
-    }
-    fclose_ (fp);
-    printf ("End reading configuration...\n");
-    return 0;
-}
-
-int do_init (int argc, char **argv)
-{
-    char input;
-    login_config_read ((argc > 1) ? argv[1] : LOGIN_CONF_NAME);
-    read_gm_account ();
-
-    printf
-        ("\nWarning : Make sure you backup your databases before continuing!\n");
-    printf ("\nDo you wish to convert your Login Database to SQL? (y/n) : ");
-    input = getchar ();
-    if (input == 'y' || input == 'Y')
-        mmo_auth_init ();
-
-    exit (0);
-}
diff --git a/src/webserver/Makefile b/src/webserver/Makefile
deleted file mode 100644
index 417fa7c..0000000
--- a/src/webserver/Makefile
+++ /dev/null
@@ -1,26 +0,0 @@
-include ../../make.defs
-
-all:
-	#Generate framework...
-	$(CC) $(CFLAGS) -c parse.c
-	$(CC) $(CFLAGS) -c generate.c
-	$(CC) $(CFLAGS) -c htmlstyle.c
-	$(CC) $(CFLAGS) -c logs.c
-	
-	#Generate "pages"...
-	cd pages && $(CC) $(CFLAGS) -c about.c && cd ..
-	cd pages && $(CC) $(CFLAGS) -c sample.c && cd ..
-	cd pages && $(CC) $(CFLAGS) -c notdone.c && cd ..
-
-	#Building the server...
-	$(CC) $(CFLAGS) -o webserver main.c parse.o generate.o htmlstyle.o \
-	logs.o pages/about.o pages/sample.o pages/notdone.o
-	
-
-
-
-clean:
-	rm -f *.o
-	rm -f pages/*.o
-	rm -f webserver
-	
diff --git a/src/webserver/doc/API.txt b/src/webserver/doc/API.txt
deleted file mode 100644
index c80f7bd..0000000
--- a/src/webserver/doc/API.txt
+++ /dev/null
@@ -1,50 +0,0 @@
-Here's the webserver API, so you can work on the webserver.
-
-My personal goal is to make this interface simple, so that coding it
-will be like coding in some scripting language...
-
-
-
-char *get_param(char in_string[500], char swhat[500]);
-
-This function simply returns various data from the query string.
-	*Pass get_param NOTHING longer than 500 in length!
-
-	What do I pass where in_string is?
-		The query string.
-
-	What do I pass where swhat is?
-		One of two things...
-		Either 0 for the path of the 'page'
-		or you can pass it the param you wish to lookup. 
-
-
-
-
-
-
-char *get_query(char *inquery);
-
-This function simply returns a query string from the raw server request.
-This is used once in main, I doubt you'll need it.
-
-
-
-
-
-void web_send(int sockin, char *in_data);
-
-Super easy way of sending data to a webpage!
-Simply put in the socket name and then the data.
-
-	Ex:
-		web_send(socket, "I like cheese!\n");
-
-
-
-
-char *html_header(char* title);
-Easy way to print the eAthena header for the server.
-
-	Ex:
-		web_send(sockethere, html_header("About"));
diff --git a/src/webserver/doc/README b/src/webserver/doc/README
deleted file mode 100644
index 0e94ff2..0000000
--- a/src/webserver/doc/README
+++ /dev/null
@@ -1,11 +0,0 @@
-This readme is intended for the programmers of eAthena.
-
-This webserver's apis are in API.txt.
-
-To make this simple, generate.c should handle most of the work this sever does
-in terms of what people see.
-
-When a request is made the server shoots it off to generate.c.
-
-You are welcome to create more functions used by generate.c to generate pages
-though, so don't feel limited by that one file.
diff --git a/src/webserver/generate.c b/src/webserver/generate.c
deleted file mode 100644
index 1fed224..0000000
--- a/src/webserver/generate.c
+++ /dev/null
@@ -1,35 +0,0 @@
-
-void generate_page (char password[25], int sock_in, char *query, char *ip)
-{
-    char *page = get_param (query, 0);
-    char *ppass = get_param (query, "password");
-
-    if ((ppass == 0) || (strcmp (password, ppass) != 0))
-    {
-        web_send (sock_in, html_header ("Enter your password"));
-        web_send (sock_in,
-                  "<H1>NOT LOGGED IN!</H1><form action=\"/\" method=\"GET\">\n");
-        web_send (sock_in,
-                  "Enter your password:<br>\n<input type=\"text\" name=\"password\">\n");
-        web_send (sock_in, "<input type=\"submit\" value=\"Login\">\n");
-    }
-    else
-    {
-
-        //To make this simple, we will have a bunch of if statements
-        //that then shoot out data off into functions.
-
-        //The 'index'
-        if (strcmp (page, "/") == 0)
-            generate_notdone (sock_in, query, ip);
-
-        //About page:
-        if (strcmp (page, "/about.html") == 0)
-            generate_about (sock_in, query, ip);
-
-        //Test page:
-        if (strcmp (page, "/testing/") == 0)
-            generate_sample (sock_in, query, ip);
-
-    }
-}
diff --git a/src/webserver/htmlstyle.c b/src/webserver/htmlstyle.c
deleted file mode 100644
index 3007a24..0000000
--- a/src/webserver/htmlstyle.c
+++ /dev/null
@@ -1,45 +0,0 @@
-char output[10000];
-
-char *html_header (char *title)
-{
-    memset (output, 0x0, 10000);
-    char *text =
-        "<body text=\"#000000\" bgcolor=\"#939393\" link=\"#0033FF\">\n"
-        "<br><table width=\"92%\" cellspacing=\"1\" cellpadding=\"0\" border=\"0\"\n"
-        "align=\"center\" class=\"bordercolor\"><tbody><tr><td class=\"bordercolor\" width=\"100%\">\n"
-        "<table bgcolor=\"#ffffff\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\">\n"
-        "<tbody><tr><td><table border=\"0\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" bgcolor=\"#ffffff\">\n"
-        "<tbody><tr><img src=\"http://eathena.sourceforge.net/athena.jpg\" alt=\"Athena\">\n"
-        "<td bgcolor=\"#ffffff\"></td></tr></tbody></table></td></tr></tbody></table>\n"
-        "</td></tr><tr align=\"left\"><td class=\"bordercolor\"><table bgcolor=\"#c6c6c6\" width=\"100%\" cellspacing=\"0\"\n"
-        "cellpadding=\"0\" style=\"text-align: left; margin-right: auto; margin-left: 0px;\">\n";
-    "<tbody><tr><td width=\"100%\" align=\"center\"><table border=\"0\" width=\"100%\" cellpadding=\"3\"\n"
-        "cellspacing=\"0\" bgcolor=\"#c6c6c6\" align=\"center\"><tbody><tr>"
-        "<td valign=\"middle\" bgcolor=\"#c6c6c6\" align=\"center\"><a href=\"/cgi-bin/forum/YaBB.cgi\">"
-        "<span style=\"text-decoration: underline;\"><span style=\"font-weight: bold;\">\n"
-        "To the Forum</span></span></a><br></td></tr></tbody></table></td></tr></tbody>\n"
-        "</table></td></tr><tr><td class=\"bordercolor\" align=\"center\">\n"
-        "<table bgcolor=\"#ffffff\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\">\n"
-        "<tbody><tr><td width=\"100%\" align=\"center\"><table border=\"0\" width=\"100%\" cellpadding=\"5\"\n"
-        "cellspacing=\"0\" bgcolor=\"#ffffff\" align=\"center\"><tbody><tr>\n"
-        "<td valign=\"middle\" bgcolor=\"#ffffff\" align=\"center\"><font size=\"2\" color=\"#6e94b7\">\n"
-        "<b>Athena</b> &laquo; Portal &raquo;</font></td></tr></tbody></table></td></tr></tbody>"
-        "</table></td></tr></tbody></table>\n";
-
-    sprintf (output, "<title>%s</title>\n%s\n", title, text);
-
-    return output;
-}
-
-char *html_start_form (char *location, char *action)
-{
-    memset (output, 0x0, 10000);
-    sprintf (output, "<form action=\"%s\" method=\"%s\">", location, action);
-    return output;
-
-}
-
-char *html_end_forum (void)
-{
-    return "</form>";
-}
diff --git a/src/webserver/logs.c b/src/webserver/logs.c
deleted file mode 100644
index 67bf55e..0000000
--- a/src/webserver/logs.c
+++ /dev/null
@@ -1,8 +0,0 @@
-#include <time.h>
-
-void log_visit (char *query, char *ip)
-{
-    time_t timer;
-    timer = time (NULL);
-    printf ("%s - \"%s\" - %s", ip, query, asctime (localtime (&timer)));
-}
diff --git a/src/webserver/main.c b/src/webserver/main.c
deleted file mode 100644
index 0e227d3..0000000
--- a/src/webserver/main.c
+++ /dev/null
@@ -1,145 +0,0 @@
-/***************************************************************************
-                                description
-                             -------------------
-    author               : (C) 2004 by Michael J. Flickinger
-    email                : mjflick@cpan.org
-
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <unistd.h>
-#include <errno.h>
-#include <string.h>
-#include <sys/types.h>
-#include <sys/socket.h>
-#include <netinet/in.h>
-#include <arpa/inet.h>
-#include <sys/wait.h>
-#include <signal.h>
-
-#define BLOG 10
-
-char *header = "<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n";
-char recvin[500], password[25];
-int  s_port;
-
-void sigchld_handler (int s)
-{
-    while (wait (NULL) > 0);
-}
-
-int main (int argc, char **argv)
-{
-    if (argc < 3)
-    {
-        printf ("eAthena Web Server\n");
-        printf ("usage: %s [password] [port]\n", argv[0]);
-        exit (0);
-    }
-
-    s_port = atoi (argv[2]);
-
-    if ((s_port < 1) || (s_port > 65534))
-    {
-        printf ("Error: The port you choose is not valid port.\n");
-        exit (0);
-    }
-
-    if (strlen (argv[1]) > 25)
-    {
-        printf ("Error: Your password is too long.\n");
-        printf ("It must be shorter than 25 characters.\n");
-        exit (0);
-    }
-
-    memset (password, 0x0, 25);
-    memcpy (password, argv[1], strlen (argv[1]));
-
-    int  sockfd, new_fd;
-    struct sockaddr_in my_addr;
-    struct sockaddr_in their_addr;
-    int  sin_size;
-
-    struct sigaction sa;
-
-    int  yes = 1;
-
-    if ((sockfd = socket (AF_INET, SOCK_STREAM, 0)) == -1)
-    {
-        perror ("Darn, this is broken.");
-        exit (0);
-    }
-
-    if (setsockopt (sockfd, SOL_SOCKET, SO_REUSEADDR, &yes, sizeof (int)) ==
-        -1)
-    {
-        perror ("Error... :-(");
-    }
-
-    //Now we know we have a working socket. :-)
-
-    my_addr.sin_family = AF_INET;
-    my_addr.sin_port = htons (s_port);
-    my_addr.sin_addr.s_addr = INADDR_ANY;
-    memset (&(my_addr.sin_zero), '\0', 8);
-
-    if (bind (sockfd, (struct sockaddr *) &my_addr, sizeof (struct sockaddr))
-        == -1)
-    {
-        perror ("can not bind to this port");
-        exit (0);
-    }
-
-    if (listen (sockfd, BLOG) == -1)
-    {
-        perror ("can not listen on port");
-        exit (0);
-    }
-
-    sa.sa_handler = sigchld_handler;
-
-    sigemptyset (&sa.sa_mask);
-    sa.sa_flags = SA_RESTART;
-
-    if (sigaction (SIGCHLD, &sa, NULL) == -1)
-    {
-        perror ("sigaction sucks");
-        exit (0);
-    }
-
-    printf ("The eAthena webserver is up and listening on port %i.\n",
-            s_port);
-
-    while (1)
-    {
-        sin_size = sizeof (struct sockaddr_in);
-        new_fd = accept (sockfd, (struct sockaddr *) &their_addr, &sin_size);
-
-        if (!fork ())
-        {
-            close (sockfd);
-            memset (recvin, 0x0, 500);
-            recv (new_fd, recvin, 500, 0);
-            send (new_fd, header, strlen (header), 0);
-            generate_page (password, new_fd, get_query (recvin),
-                           inet_ntoa (their_addr.sin_addr));
-            log_visit (get_query (recvin), inet_ntoa (their_addr.sin_addr));
-
-            close (new_fd);
-            exit (0);
-        }
-        close (new_fd);
-    }
-
-    return 0;
-}
diff --git a/src/webserver/pages/about.c b/src/webserver/pages/about.c
deleted file mode 100644
index b548da9..0000000
--- a/src/webserver/pages/about.c
+++ /dev/null
@@ -1,6 +0,0 @@
-void generate_about (int sock_in, char *query, char *ip)
-{
-//printf("%s", html_header("About"));
-    web_send (sock_in, html_header ("About"));
-    web_send (sock_in, "<center>eAthena Web Server!</center>\n");
-}
diff --git a/src/webserver/pages/notdone.c b/src/webserver/pages/notdone.c
deleted file mode 100644
index 1fcd44b..0000000
--- a/src/webserver/pages/notdone.c
+++ /dev/null
@@ -1,6 +0,0 @@
-void generate_notdone (int sock_in, char *query, char *ip)
-{
-    web_send (sock_in, "<title>Not here!</title>\n");
-    web_send (sock_in,
-              "<h2><center>This page/feature is not done yet.</center>\n</h2>");
-}
diff --git a/src/webserver/pages/sample.c b/src/webserver/pages/sample.c
deleted file mode 100644
index 6a33dc0..0000000
--- a/src/webserver/pages/sample.c
+++ /dev/null
@@ -1,22 +0,0 @@
-
-void generate_sample (int sock_in, char *query, char *ip)
-{
-
-    char *name = get_param (query, "name");
-
-    web_send (sock_in, "<title>SAMPLE</title>\n");
-
-    //If a name was not entered...
-    if (name == '\0')
-    {
-        web_send (sock_in, "<form action=\"/testing/\" method=\"GET\">\n");
-        web_send (sock_in, "<input type=\"text\" name=\"name\">\n");
-        web_send (sock_in, "<input type=\"submit\">\n");
-    }
-    else
-    {
-        web_send (sock_in, "Your name is: ");
-        web_send (sock_in, get_param (query, "name"));
-    }
-    printf ("OK!\n");
-}
diff --git a/src/webserver/parse.c b/src/webserver/parse.c
deleted file mode 100644
index 66ef43b..0000000
--- a/src/webserver/parse.c
+++ /dev/null
@@ -1,132 +0,0 @@
-#include <stdlib.h>
-
-char filtered_query[2000];
-char rdata[500];
-char param_n[500];
-char param_d[500];
-
-char *get_query (char *inquery)
-{
-    memset (filtered_query, 0x0, 2000);
-    sscanf (inquery, "GET %s %[$]", filtered_query);
-    return (filtered_query);
-}
-
-void web_send (int sockin, char *in_data)
-{
-    send (sockin, in_data, strlen (in_data), 0);
-}
-
-//THIS IS BAD CODE BE CAREFULL WITH IT!
-//Watch out for buffer overflow...
-//When using please make sure to check the string size.
-
-//Also note:
-//I take no pride in this code, it is a really bad way of doing this...
-char *get_param (char in_string[500], char swhat[500])
-{
-    int  i = 0;
-    int  marker, iswitch, pint, dint;
-    char flux[500];
-    memset (flux, 0x0, 500);
-
-    //Get the path of out "page"
-    if (swhat == 0)
-    {
-        //while i is not equal to array size
-        while (i != 500)
-        {
-            //if there is a question mark, halt!
-            if (in_string[i] == '?')
-            {
-                i = 499;
-            }
-            else
-                rdata[i] = in_string[i];
-
-            i++;
-        }
-        return rdata;
-    }
-    else                        //so, we want a param...
-    {
-        //calculate where param begins
-        while (i != 500)
-        {
-            if (in_string[i] == '?')
-            {
-                marker = i + 1;
-                i = 499;
-            }
-            i++;
-        }
-
-        i = 0;
-
-        //keep morons from trying to crash this
-        if ((marker > 500) || (marker < 1))
-            marker = 500;
-
-        while (marker != 500)
-        {
-            if ((in_string[marker] != '&') && (in_string[marker] != '\0'))
-            {
-                flux[i] = in_string[marker];
-                i++;
-            }
-            else
-            {
-
-                //we have a param, now we must dig through it
-
-                //clear temp vars
-                memset (param_n, 0x0, 500);
-                memset (param_d, 0x0, 500);
-                iswitch = 0;
-                pint = 0;
-                dint = 0;
-                i = 0;
-
-                //split result into param_n and param_d
-                while (i != 500)
-                {
-                    if ((flux[i] != '=') && (flux[i] != '\0'))
-                    {
-                        if (iswitch == 0)
-                        {
-                            param_n[pint] = flux[i];
-                            pint++;
-                        }
-                        else
-                        {
-                            param_d[dint] = flux[i];
-                            dint++;
-                        }
-                    }
-                    else
-                    {
-                        iswitch = 1;
-                    }
-                    if (flux[i] == '\0')
-                        i = 499;
-
-                    i++;
-                }
-
-                if (strcmp (param_n, swhat) == 0)
-                {
-                    return param_d;
-                }
-
-                i = 0;
-            }
-
-            if (in_string[marker] == '\0')
-            {
-                marker = 499;
-            }
-            marker++;
-        }
-        return 0;
-    }
-}
-- 
2.1.0

